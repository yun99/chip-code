var o=Object.create,e=Object.defineProperty,i=Object.defineProperties,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,a=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(o,i,t)=>i in o?e(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,g=(o,e)=>{for(var i in e||(e={}))p.call(e,i)&&u(o,i,e[i]);if(s)for(var i of s(e))l.call(e,i)&&u(o,i,e[i]);return o},d=(o,e)=>i(o,n(e)),c=o=>e(o,"__esModule",{value:!0}),h=(o,i,n)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let s of r(i))p.call(o,s)||"default"===s||e(o,s,{get:()=>i[s],enumerable:!(n=t(i,s))||n.enumerable});return o},P=i=>h(c(e(null!=i?o(a(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i),I=(o,e,i)=>new Promise(((t,n)=>{var r=o=>{try{a(i.next(o))}catch(o){n(o)}},s=o=>{try{a(i.throw(o))}catch(o){n(o)}},a=o=>o.done?t(o.value):Promise.resolve(o.value).then(r,s);a((i=i.apply(o,e)).next())}));((o,i)=>{for(var t in c(o),i)e(o,t,{get:i[t],enumerable:!0})})(exports,{default:()=>j});var f=P(require("./gp.js")),m=P(require("./ga.js")),y=P(require("./gs.js")),L=P(require("./ao.js")),S=P(require("./u9.js")),E=P(require("./go.js")),C=P(require("./pa.js")),x=P(require("./gf.js")),T=P(require("./uh.js")),O=P(require("./ug.js")),R=P(require("./u8.js")),v=P(require("./gd.js")),_=P(require("./gg.js")),A=P(require("./u4.js")),b=P(require("./aw.js")),q=P(require("./gk.js")),D=P(require("./gh.js")),w=P(require("./gl.js"));h(exports,P(require("./gs.js"))),h(exports,P(require("./gg.js")));var{querystring:M}=require("./p3.js"),{tabBarList:N=["pages/index/index","pages/categorySkuList/index","pages/cookbook/index","pages/cart/index","pages/userCenter/index"]}=require("./gj.js"),U={[y.JumpTarget.LIGHTEN]:{originPath:"pages/multiPoiPage/index?noHandTouch=1",protocal:"igrocery://www.grocery.com/multi_poi/page"},[y.JumpTarget.SELF_PICK]:{originPath:"subPackages/location/pages/selfPickSelect/index?noHandTouch=1",protocal:"/subPackages/location/pages/selfPickSelect/index?noHandTouch=1"}},$={200:L.PoiLocationErrorType.BACK_END_API_FAIL,403:L.PoiLocationErrorType.ANTI_ERROR,420:L.PoiLocationErrorType.ANTI_ERROR_420,other:L.PoiLocationErrorType.HTTP_ERROR},B=null,j=new class{constructor(){this.times=0,this.isConfirmed=!1,this._poiInfoIsChanged=!0,this.dataCenter=new w.default,this.loginSuccessBindThis=this.loginSuccess.bind(this),A.default.on(A.CONTANTS.LOGIN_SUCCESS,this.loginSuccessBindThis)}get appShowOptions(){return this.app.$appShowOptions}get multiPoiModal(){var o;const e=null==(o=this.app.page())?void 0:o.selectComponent("#multi_poi_modal");return e||(0,_.poiLogger)("error","：没有注册多门店弹窗"),e}get app(){return B}init(o){(0,_.poiLogger)("init"),B=o,this.preRequestPoiInfo()}resetPendingData(o){(0,_.poiLogger)("resetPendingData scene",o),this.pendingResponse=void 0,this.requestPoiPromise=void 0,this.innerError=void 0}loginSuccess(o,e){(0,_.poiLogger)("loginSuccess code",e),o&&2===e&&(0,R.isApp)()&&this.resetPendingData("loginSuccess")}resetPoiStatus(){(0,_.poiLogger)("app hide resetPoiStatus"),this.resetPendingData("resetPoiStatus"),this.execPoiPageInfo=void 0}beforeRequestPoi(){return I(this,null,(function*(){const o=(0,O.buildStartPoint)(),{$login:e}=this.app,i=T.default.getCacheValue("logindata"),t=[];let n={};if(((0,R.isMTChannel)()||(0,R.isApp)())&&((0,_.poiLogger)("beforeRequestPoi:美团环境和独立app获取经纬度和城市信息"),t.push(D.default.getLocationPromise()),t.push(new Promise((o=>{(()=>{I(this,null,(function*(){var e,i;if((0,R.isMT)())wx.getSelectedCityInfo?wx.getSelectedCityInfo({success(e){const{id:i=0}=e;o(i)},fail(e){(0,_.poiLogger)("beforeRequestPoi->wx.getSelectedCityInfo失败：",e),o(0)}}):((0,_.poiLogger)("beforeRequestPoi 缺少wx.getSelectedCityInfo"),o(0));else if((0,R.isWXMT)()){const t=null==(i=null==(e=getApp())?void 0:e.getOriginApp())?void 0:i.getCityInfo;try{const e=yield t();o(e.id||0)}catch(e){(0,_.poiLogger)("beforeRequestPoi 美团小程序优选频道获取外部城市失败",e),o(0)}}else o(-1)}))})()})))),!(0,R.isMMP)()&&i&&i.openIdCipher||t.push(e.beforeLocationLogin()),(0,R.isMTChannel)()||(0,R.isApp)()){const[o,e]=yield Promise.all(t);n={location:o,cityId:e},(0,_.poiLogger)(`beforeRequestPoi:ok 美团环境和独立app，beforeRequestParams:${JSON.stringify(n)}`)}const r=(0,O.buildProportion)("PrepareForRequest");return t.length&&(r("NeedPrepare"),yield Promise.all(t)),o("poiLocationAndLogin"),n}))}preRequestPoiInfo(){(0,O.tagTime)("onPoiStart"),(0,_.poiLogger)("preRequestPoiInfo requestPoiInfo"),this.requestPoiPromise=this.requestPoiInfo()}requestPoiInfo(o=null){return I(this,null,(function*(){return!this.requestPoiPromise||(0,R.isApp)()&&this.app.$systemInfo.isIOS()?new Promise(((e,i)=>{(()=>{I(this,null,(function*(){var t,n,r,s;try{const a=this.appShowOptions.path.includes("pages/index/index"),{r:p,g:l}=this.appShowOptions.pendingSceneVal;let u;if(a&&!p&&!l){const o=(0,x.getPrefetchData)();(null==(n=null==(t=null==o?void 0:o.lbsLocationResult)?void 0:t.jumpInfo)?void 0:n.type)===y.PoiResType.LOCATIOM_TAG&&(0,_.poiMainCatReport)(_.PoiFirstTarget.PREFETCH_IP),w.default.checkPrefetchDataVaid(o)&&(u=o),(0,_.poiLogger)("execFunction response",null==u?void 0:u.lbsLocationResult),this.pendingResponse=u}const g=(0,O.buildStartPoint)();if(u)(0,O.tagTime)("dataDone"),g("dataDone"),(0,_.poiLogger)("requestPoiInfo->getPrefetchData:ok");else{(0,O.tagTime)("onBeforeRequestPoi");const{location:e,cityId:t}=yield this.beforeRequestPoi(),{extPoiIds:n,shareUserId:u,extPoiIdStr:d}=this.appShowOptions.getExtPoiIds();try{const i={r:p,g:l,extPoiIds:o||n,extPoiIdStr:d,shareUserId:u,sceneCode:(null==(s=null==(r=this.appShowOptions)?void 0:r.query)?void 0:s.sceneCode)||B.$sceneCode,location:e,cityId:t};e||delete i.location,(0,_.poiLogger)("requestPoiInfo->fetchPoiInfos",`参数 params:${JSON.stringify(i)}，isHomepage:${a}`),(0,O.tagTime)("onFetchPoiInfosStart");const c=(0,O.buildStartPoint)();this.pendingResponse=yield(0,x.fetchPoiInfos)(i,a),c("fetchPoiFactStage"),(0,_.poiLogger)("requestPoiInfo->pendingResponse end"),(0,O.tagTime)("dataDone"),g("dataDone")}catch(o){const{statusCode:e="other"}=(null==o?void 0:o.res)||{},{code:t}=(null==o?void 0:o.data)||{},n=$[t||e]||L.PoiLocationErrorType.HTTP_ERROR;return(0,_.poiLogger)("error",`requestPoiInfo->fetchPoiInfos，${e}`,t,n,o),this.setInnerError(n,o),this.requestPoiPromise=null,i(o)}}this.pendingResponse||(this.setInnerError(L.PoiLocationErrorType.BACK_END_EMPTY_RESPONSE,null),(0,_.poiLogger)("requestPoiInfo:lbs接口返回空")),this.requestPoiPromise=null,e(null)}catch(o){this.requestPoiPromise=null,i(o),(0,_.poiLogger)(`requestPoiInfo:error ${JSON.stringify(o)}`)}}))})()})):((0,_.poiLogger)("requestPoiInfo requestPoiPromise",this.requestPoiPromise),null)}))}getMTCityId(){return new Promise((o=>{(()=>{I(this,null,(function*(){o(-1)}))})()}))}emitInnerError(o,e){var i,t;(0,_.poiLogger)("emitInnerError",o,e),o===L.PoiLocationErrorType.LOCATION_ACCESS_API_ERROR_WX_LOCATION?(0,_.poiMainCatReport)(_.PoiFirstTarget.NO_LOCATION):(0,_.poiMainCatReport)(_.PoiFirstTarget.ERROR),this.resetPendingData("emitInnerError"),null==(i=this.multiPoiModal)||i.showInnerPoiModal({code:o,error:e});const n=getApp();n.page&&(null==(t=n.page())?void 0:t.removeSkeletonErrorReport)&&n.page().removeSkeletonErrorReport()}setInnerError(o,e){(0,_.poiMainCatReport)(_.PoiFirstTarget.ERROR),this.innerError={code:o,error:e},this.emitInnerError(o,e)}execError(){}hasConfirmed(){return this.isConfirmed}execPoi(){return this.times++,(0,_.poiLogger)(`execPoi 执行次数:${this.times}`),(0,_.poiLogger)("execPoi requestPoiInfo begin"),this.requestPoiInfo().then((()=>{(0,_.poiLogger)("execPoi requestPoiInfo end"),this.innerError?this.execError():this.pendingResponse&&this.handlepoiLocationResponse(this.pendingResponse)}))}backExecPath(){const{path:o,options:e}=this.execPoiPageInfo||this.beforeHiddenPageInfo||{};return(0,_.poiLogger)(`backExecPath execPoiPageInfo:${JSON.stringify(this.execPoiPageInfo)},beforeHiddenPageInfo:${JSON.stringify(this.beforeHiddenPageInfo)}`),o?new Promise(((e,i)=>{if(N.find((e=>o.includes(e))))wx.switchTab({url:`/${o}`,success(o){(0,_.poiLogger)("backExecPath:switchTab回到原始页成功"),e(o)},fail(o){(0,_.poiLogger)("backExecPath:switchTab回到原始页面错误",o)}});else{const i=this.app.pages()||[],t=i.findIndex((e=>{const i=e.__route__||e.route;return o.includes(i)})),n=i.length-1-t;wx.navigateBack({delta:n,success(o){(0,_.poiLogger)("backExecPath:navigateBack回到原始页成功",n),e(o)},fail(o){(0,_.poiLogger)("backExecPath:navigateBack回到原始页面错误",n,o)}})}})):null}judgeAndExecPoi(o){return I(this,null,(function*(){var e,i;if((0,v.default)(o.path))return void(0,_.poiLogger)("judgeAndExecPoi->execPoiPageInfo.path",null==o?void 0:o.path);if(this.times++,(0,_.poiLogger)("judgeAndExecPoi:","poiInfo:",this.poiInfo,"isConfirmed",this.isConfirmed,"pendingResponse:",this.pendingResponse,"requestPoiPromise:",this.requestPoiPromise,"execPoiPageInfo:",this.execPoiPageInfo),this.poiInfo&&this.isConfirmed&&!this.pendingResponse&&!this.requestPoiPromise)return(0,_.poiLogger)("judgeAndExecPoi:门店稳定的状态"),o.onPoiInfoUpdated(this.poiInfo,this.extraInfo),void o.onPoiInfoConfirmed(this.poiInfo,d(g({},this.extraInfo),{isConfirmed:!0}));if(this.execPoiPageInfo){const{path:o,options:i}=this.execPoiPageInfo,t=`/${o}?${decodeURIComponent(M.stringify(i))}`,n=null==(e=this.app)?void 0:e.page(),r=(null==n?void 0:n.__route__)||(null==n?void 0:n.route);return o&&r&&(0,_.poiRollBackCatReport)(o,r),this.execPoiPageInfo=void 0,(0,_.poiLogger)("judgeAndExecPoi reLaunch bengin"),wx.reLaunch({url:t,success(){(0,_.poiLogger)(`judgeAndExecPoi reLaunch success：多门店逻辑在当页都没有走完去了其他需要门店的页面，重回页面${t}成功`)},fail(o){(0,_.poiLogger)("judgeAndExecPoi reLaunch fail",JSON.stringify(o))}}),void(0,_.poiLogger)("judgeAndExecPoi reLaunch end")}(0,O.tagTime)("onFirstJudgeAndExecPoi"),(0,_.poiLogger)("judgeAndExecPoi:第一次需要门店的页面执行多门店逻辑"),this.execPoiPageInfo=o,this.beforeHiddenPageInfo=o;const{options:t}=this.execPoiPageInfo,{extPoiIds:n,extPoiIdStr:r}=this.appShowOptions.parseExtPoiIds(t),{extPoiIds:s=null,extPoiIds:a=""}=this.appShowOptions.getExtPoiIds()||{};(n&&n!==s||r&&r!==a)&&this.resetPendingData("extPoi!=onShowExtPoiId"),(0,_.poiPathsCatReport)(o.path,!!n),!this.requestPoiPromise||(0,R.isApp)()&&this.app.$systemInfo.isIOS()?this.pendingResponse||((0,_.poiLogger)("judgeAndExecPoi->requestPoiInfo",{extPoiIds:n,extPoiIdStr:r}),yield this.requestPoiInfo(n)):yield this.requestPoiPromise,this.innerError?this.execError():((0,_.poiLogger)("judgeAndExecPoi->handlepoiLocationResponse",{lbsLocationResult:null==(i=this.pendingResponse)?void 0:i.lbsLocationResult}),(0,O.tagTime)("onHandlepoiLocationResponseStart"),this.pendingResponse&&this.handlepoiLocationResponse(this.pendingResponse),(0,O.tagTime)("onHandlepoiLocationResponseDone"))}))}fetchPoiByLocation(o){return I(this,null,(function*(){var e,i,t,n,r,s,a,p,l,u,c,h,P;if(!o||!o.longitude||!o.latitude)return this.poiByIPConfirmd(),void(((0,R.isWX)()||(0,R.isApp)())&&f.default.jumpOtherSelfPick({showCityListView:!1},!1));try{const I=d(g({},o),{popType:2}),{showPop:m,popLayer:y}=yield B.$service.getRecommendPoiByLocation(I);m&&((null==(e=null==y?void 0:y.targetPoiInfo)?void 0:e.poiId)&&(null==(i=null==y?void 0:y.targetPoiInfo)?void 0:i.poiId)!==(null==(t=this.poiInfo)?void 0:t.poiId)||(null==(n=null==y?void 0:y.targetPoiInfo)?void 0:n.poiIdStr)&&(null==(r=null==y?void 0:y.targetPoiInfo)?void 0:r.poiIdStr)!==(null==(s=this.poiInfo)?void 0:s.poiIdStr))?(null==(a=this.multiPoiModal)||a.showIPPoiModal(y),(0,_.poiAddressStrategyIp)(_.IpPoiDialogTarget.DIALOG_SHOW)):(this.poiByIPConfirmd(),!(0,R.isWX)()&&!(0,R.isApp)()||m||f.default.jumpOtherSelfPick({showCityListView:!1},!1)),((null==(p=null==y?void 0:y.targetPoiInfo)?void 0:p.poiId)&&(null==(l=null==y?void 0:y.targetPoiInfo)?void 0:l.poiId)===(null==(u=this.poiInfo)?void 0:u.poiId)||(null==(c=null==y?void 0:y.targetPoiInfo)?void 0:c.poiIdStr)&&(null==(h=null==y?void 0:y.targetPoiInfo)?void 0:h.poiIdStr)===(null==(P=this.poiInfo)?void 0:P.poiIdStr))&&(0,_.poiAddressStrategyIp)(_.IpPoiDialogTarget.POI_SAME)}catch(o){(0,_.poiLogger)("fetchPoiByLocation error",o),this.poiByIPConfirmd(),((0,R.isWX)()||(0,R.isApp)())&&f.default.jumpOtherSelfPick({showCityListView:!1},!1)}}))}changePoiInfo(o,e=!1,i={}){var t,n,r,s;this._poiInfoIsChanged=!((null==(t=this.poiInfo)?void 0:t.poiId)&&(null==(n=this.poiInfo)?void 0:n.poiId)===o.poiId||(null==(r=this.poiInfo)?void 0:r.poiIdStr)&&(null==(s=this.poiInfo)?void 0:s.poiIdStr)===o.poiIdStr),this.poiInfo=o,this.extraInfo=i,this.setAppPoiEnv(o),(0,_.poiLogger)("changePoiInfo 门店信息更新：",o,e),A.default.emit(C.POI_ON_UPDATED,o,i),!this.isConfirmed&&e&&((0,_.poiLogger)("门店从不确定到确定，执行confirm逻辑",e),this.confirmPoiInfo())}updatePoiInfo(o){this.poiInfo=o,this.setAppPoiEnv(o),(0,_.poiLogger)("changePoiInfo 门店信息更新：",o),A.default.emit(C.UPDATE_POIINFO_FINISH,o,{})}confirmPoiInfo(){return I(this,null,(function*(){const{onPoiInfoConfirmed:o=(()=>{})}=this.execPoiPageInfo||{};(0,_.poiLogger)("confirmPoiInfo 最终门店确认：",this.poiInfo,this.execPoiPageInfo),this.isConfirmed=!0,this.pendingResponse=void 0,this.closeAllModal();const{toggleSource:e}=this.extraInfo;e===y.ToggleSource.SELF_PICK_PAGE&&(yield this.backExecPath()),A.default.emit(C.POI_ON_FINISHED,this.poiInfo,this.extraInfo),o(this.poiInfo,d(g({},this.extraInfo),{isConfirmed:!0,poiInfoIsChanged:this._poiInfoIsChanged}))}))}closeAllModal(){const o=this.app.pages();(0,_.poiLogger)("closeAllModal"),o.forEach((o=>{const e=o.selectComponent("#multi_poi_modal");e&&e.closeInnerPoiModal()}))}gotoPage(o){return I(this,null,(function*(){const e=U[o];if((0,R.isMT)())wx.reLaunch({url:`/${e.originPath}`,success(){(0,_.poiLogger)("gotoPage 美团app场景跳到点亮页")},fail(o){(0,_.poiLogger)("gotoPage 美团app场景跳到点亮页失败：",o)}});else{(0,_.poiLogger)("gotoPage begin",null==e?void 0:e.protocal);try{yield this.app.$router.goto(e.protocal);(0,_.poiLogger)("gotoPage->item.protocal",e.protocal)}catch(o){(0,_.poiLogger)("gotoPage->error",o)}}}))}judgeJumpPage(){return I(this,null,(function*(){const o={};let e;this.app.$sceneCode===b.SCENE_CODE.LIVE&&((0,R.isMMP)()?o.subChannel=q.SUB_CHANNEL.MEITUAN_LIVE:o.subChannel=q.SUB_CHANNEL.WX_LIVE);try{if(e=yield S.default.onGetLocationCache(!0),e&&e.latitude){Object.assign(o,g({pageType:2},e));const{type:i}=yield(0,m.getRecommendPoiList)(o);if(1===i)return void this.gotoPage(y.JumpTarget.LIGHTEN);throw new Error("接口调用失败")}throw new Error("获取定位失败")}catch(o){(0,_.poiLogger)(`${e&&e.latitude?"接口调用失败":"获取定位失败"}：${JSON.stringify(o)}， 跳转选择自提页`),this.gotoPage(y.JumpTarget.SELF_PICK)}}))}handlepoiLocationResponse(o){var e,i,t;(0,O.tagTime)("onPoiHandle");try{this.app.$forceUpdate.checkShouldUpdate(o)}catch(o){(0,_.poiLogger)("handlepoiLocationResponse checkShouldUpdate",o)}this.isConfirmed=!1;const{lbsLocationResult:n={},homePageAggregationData:r,M_TraceId:s=""}=o,{targetPoiInfo:a,wxCodeParseResult:p,outLinkPopLayer:l,jumpInfo:u}=n;if(this.appShowOptions.appendOptions(p),a&&(a.poiId||a.poiIdStr)){const o=!l||!l.showPop;if(r&&(r.M_TraceId=s),this.changePoiInfo(a,o,{homePageAggregationData:r}),1===(null==a?void 0:a.poiServiceType)&&5==+(null==u?void 0:u.type)&&((0,_.poiMainCatReport)(_.PoiFirstTarget.SAMPLE_ROOM_GO_SELF),S.default.locationStrategy.setAuthDialogOperationSwitch(!0),S.default.locationStrategy.setAuthDialogOperationStrategy(E.AUTH_DIALOG_OPERATION_STRATEGY.MIIT)),6==+(null==u?void 0:u.type)&&(S.default.locationStrategy.setAuthDialogOperationSwitch(!0),S.default.locationStrategy.setAuthDialogOperationStrategy(E.AUTH_DIALOG_OPERATION_STRATEGY.POI_CONFIRMED_BY_IP,{[E.LOCATION_AUTH_STATUS.AGGREE]:this.fetchPoiByLocation.bind(this),[E.LOCATION_AUTH_STATUS.DENY]:()=>{this.poiByIPConfirmd()}})),o)return 6!=+(null==u?void 0:u.type)&&this.poiByIPConfirmd(),void(0,_.poiMainCatReport)(_.PoiFirstTarget.CONFIRM_DIRECT);const i={commonPoiInfos:l.recommendPoiInfos,shareUserWXName:l.shareUserWXName,targetPoiInfo:l.targetPoiInfo,recommendTag:l.recommendTag,recommendTitle:l.recommendTitle};return(0,_.poiLogger)("handlepoiLocationResponse->showMultiPoisModal 1"),null==(e=this.multiPoiModal)||e.showMultiPoisModal(i),void(0,_.poiMainCatReport)(_.PoiFirstTarget.MUILT_POI)}if(u){if(1==+u.type)return(0,_.poiMainCatReport)(_.PoiFirstTarget.GO_LIGHTEN),void this.gotoPage(y.JumpTarget.LIGHTEN);if(2==+u.type)return(0,_.poiLogger)("handlepoiLocationResponse，唤起定位失败弹窗"),void this.emitInnerError(L.PoiLocationErrorType.LOCATION_ACCESS_API_ERROR_WX_LOCATION,u);if(3==+u.type)return(0,_.poiMainCatReport)(_.PoiFirstTarget.JUDGE_AGAIN),void this.judgeJumpPage()}else{const{targetPoiInfo:o,recommendTitle:e,recommendTag:n}=l||{},r="上次访问的自提点暂停营业啦换一个看看吧";if((e?e.replace(/[\r\n]/g,"").replace(/ +/g,""):"")===r)return(0,_.poiLogger)("handlepoiLocationResponse->showMultiPoisModal 2"),void(null==(i=this.multiPoiModal)||i.showMultiPoisModal({targetPoiInfo:o,recommendTitle:e,recommendTag:n,modalType:"historyPoiOff",commonPoiInfos:l.recommendPoiInfos}));if(o&&o.poiBusinessStatus===y.PoiStatus.OFF_LINE)return(0,_.poiLogger)("handlepoiLocationResponse->showMultiPoisModal 3"),null==(t=this.multiPoiModal)||t.showMultiPoisModal({targetPoiInfo:o,commonPoiInfos:l.recommendPoiInfos}),void(0,_.poiMainCatReport)(_.PoiFirstTarget.POI_OFFLINE)}this.emitInnerError(L.PoiLocationErrorType.BACK_END_ERROR,o)}getLocationWithoutError(){return S.default.onGetLocationCache().catch((()=>null))}togglePoiByPoi(o){return I(this,arguments,(function*(o,e=y.ToggleSource.MULTI_POI_MODAL){(0,_.poiLogger)("togglePoiByPoi",o,e);const{poiId:i,poiIdStr:t}=o||{};let n={result:!1,poiInfoIsChanged:!1,poiInfo:{},needBreak:!1};i&&!(i<=0)||t||(0,_.poiLogger)(`togglePoiByPoi 门店切换失败 ${o} poi 无效`);const r=e===y.ToggleSource.SELF_PICK_PAGE&&!this.isConfirmed;if(this.poiInfo&&(this.poiInfo.poiId&&i===this.poiInfo.poiId||this.poiInfo.poiIdStr&&t===this.poiInfo.poiIdStr))return this._poiInfoIsChanged=!1,this.extraInfo.toggleSource=e,!this.isConfirmed&&this.confirmPoiInfo(),n={result:!0,poiInfoIsChanged:!1,poiInfo:this.poiInfo,needBreak:r},n;let s={poiIds:i};t&&(s=d(g({},s),{poiIdStr_poiIds:t}));try{const o=yield this.getLocationWithoutError();o&&(s=g(g({},s),o));const t=yield(0,x.togglePoi)(s),{targetPoiInfo:a}=t;if(a){const{cityId:o=""}=a;return(0,_.poiLogger)(`togglePoiByPoi 门店切换成功：${JSON.stringify(a)}`),this.changePoiInfo(a,!0,{toggleSource:e}),n={result:!0,poiInfoIsChanged:!0,poiInfo:this.poiInfo,needBreak:r},n}(0,_.poiLogger)(`togglePoiByPoi 门店切换失败：poiId ${i}`)}catch(o){(0,_.poiLogger)("togglePoiByPoi 门店切换接口报错：",o)}return n}))}togglePoiByCityId(o){return I(this,null,(function*(){if((!o||o<=0)&&(0,_.poiLogger)(`togglePoiByCityId 门店切换失败 ${o} cityId 无效`),this.poiInfo&&o===this.poiInfo.cityId)return!this.isConfirmed&&this.confirmPoiInfo(),!0;let e={cityId:o};try{const i=yield this.getLocationWithoutError();i&&(e=g(g({},e),i));const t=yield(0,x.toggleCity)(e),{targetPoiInfo:n}=t;if(n)return(0,_.poiLogger)(`togglePoiByCityId 门店切换成功：${JSON.stringify(n)}`),this.changePoiInfo(n,!0),!0;(0,_.poiLogger)(`togglePoiByCityId 门店切换失败：cityId ${o}`)}catch(o){(0,_.poiLogger)("togglePoiByCityId 门店切换接口报错：",o)}}))}setAppPoiEnv(o){(0,_.poiLogger)("setAppPoiEnv");const{poiId:e,cityId:i,poiName:t,poiIdStr:n}=o;this.app.$poiId=e,this.app.$poiIdStr=n,this.app.$poiName=t,this.app.$cityId=i,this.app.$lxLog.setLxEnv({cityId:i}),this.app.$poi.poiInfo=o,i&&this.app.$store.setCache("cityIdCache",{cityId:i})}resetAll(){(0,_.poiLogger)("resetAll"),this.resetPoiStatus(),this.poiInfo=null,this.isConfirmed=!1,this.app.$poiId=null,this.app.$poiIdStr="",this.app.$poiName=null,this.app.$cityId=null,this.app.$poi.poiInfo=null}poiByIPConfirmd(){A.default.emit(C.POI_BY_IP_CONFIRMD,this.poiInfo)}};