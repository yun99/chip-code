var e=Object.create,t=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,c=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,l=s=>{return((e,s,r)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let a of u(s))n.call(e,a)||"default"===a||t(e,a,{get:()=>s[a],enumerable:!(r=i(s,a))||r.enumerable});return e})((r=t(null!=s?e(o(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0}),t(r,"__esModule",{value:!0})),s);var r},S=l(require("./sm.js")),b=l(require("./u8.js")),d=l(require("./kv.js")),y=getApp(),{UPDATE_SUBSCRIBE_STATUE:R}=y.$event.CONTANTS,{subscribeAll:h,unsubscribeAll:O}=require("./sz.js");Component(new class{constructor(){this.attached=function(){this.updateStateThis=this.updateState.bind(this),y.$event.on(R,this.updateStateThis)},this.detached=function(){y.$event.off(R,this.updateStateThis)},this.methods={updateState(e){const{status:t,skuId:s}=e;s===this.data.skuId&&this.setData({innerSubStatus:t})},lxClick(e){if(this.data.isReportLxByTriggerEvent)return void this.triggerEvent("proxyLxEvent",{type:d.LxEventTypes.RemindClick,options:{switch_type:e}},{bubbles:!0});const{lxData:t,skuId:i}=this.data;var u;t.bid&&y.$lxLog.mc(t.bid,(u=((e,t)=>{for(var s in t||(t={}))n.call(t,s)&&c(e,s,t[s]);if(a)for(var s of a(t))p.call(t,s)&&c(e,s,t[s]);return e})({},t.val),s(u,r({switch_type:e}))),t.cid)},subscribe(e){return t=this,s=null,i=function*(){const{innerSubStatus:e,skuId:t}=this.data;let s,i,r,u;if(1===e||this.data.subStatus&&-1===e){this.lxClick("off"),s=this.getSkuArriveSubscribeRequest(S.SUBSCRIBE_MAJOR_TYPE.MAJOR,S.SKU_ARRIVE_SUBSCRIBE_STATUS.UNSUBSCRIBE),i=this.getSeckillActivitySubscribeRequest(S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),r=this.getCouponExpirationSubscribeRequest(S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR);const e=[s,i],t=[s,i,r];u=yield O((0,b.isWXMT)()?e:t)}else{this.lxClick("on"),s=this.getSkuArriveSubscribeRequest(S.SUBSCRIBE_MAJOR_TYPE.MAJOR,S.SKU_ARRIVE_SUBSCRIBE_STATUS.SUBSCRIBE),i=this.getSeckillActivitySubscribeRequest(S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),r=this.getCouponExpirationSubscribeRequest(S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR);const e=[s,i],t=[s,i,r];u=yield h((0,b.isWXMT)()?e:t)}1!==u.success&&4!==u.status&&(y.$event.emit(R,{status:u.status,skuId:t}),this.setData({innerSubStatus:u.status}))},new Promise(((e,r)=>{var u=e=>{try{o(i.next(e))}catch(e){r(e)}},a=e=>{try{o(i.throw(e))}catch(e){r(e)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(u,a);o((i=i.apply(t,s)).next())}));var t,s,i},getSeckillActivitySubscribeRequest:(e=S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR)=>({subType:"seckillActivity",major:e,params:{poiId:y.$poi.getPoiId()||"",poiIdStr:y.$poi.getPoiIdStr()||""}}),getSkuArriveSubscribeRequest(e=S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR,t){return{subType:"skuArrive",major:e,params:{poiId:y.$poi.getPoiId()||"",poiIdStr:y.$poi.getPoiIdStr()||"",skuId:this.data.skuId||"",op:t}}},getCouponExpirationSubscribeRequest:(e=S.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR)=>({subType:"couponExpire",major:e,params:{poiId:y.$poi.getPoiId()||"",poiIdStr:y.$poi.getPoiIdStr()||""}})},this.properties={skuId:{type:Number,value:-1},subStatus:{type:Boolean,value:!1},type:{type:String,value:""},isReportLxByTriggerEvent:Boolean},this.data={innerSubStatus:-1}}});