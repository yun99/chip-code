var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,a=e=>t(e,"__esModule",{value:!0}),i=i=>((e,n,a)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let i of o(n))s.call(e,i)||"default"===i||t(e,i,{get:()=>n[i],enumerable:!(a=r(n,i))||a.enumerable});return e})(a(t(null!=i?e(n(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);((e,r)=>{for(var o in a(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{default:()=>m});var l=i(require("./dg.js")),u=i(require("./j9.js")),p=i(require("./k5.js")),g=i(require("./ze.js")),c="resource",d=[],m=class{constructor(e,t){this.cfgManager=e,this.errManager=t}_parse(e){return e.pageUrl||(e.pageUrl=this.cfgManager.get("pageUrl")||(0,l.getPageUrl)()),e.project||(e.project=this.cfgManager.get("project")),e}_stringify(e){let t=[];if(e){let e=this.cfgManager.get(c).sendTriggerThreshold||10;t=d.splice(0,e)}else t=d.splice(0,d.length);let r=t;if(r&&r.length)try{let e={},t=this.cfgManager.getExtension(),o=[],n={region:"",operator:"",network:"",container:"",os:""};for(let e=0;e<r.length;e++)o.push(r[e]);for(let e in n)n.hasOwnProperty(e)&&(n[e]=t[e]||"");return n.unionId=this.cfgManager.get("unionId")||"",n.infos=o,e=n,e}catch(e){}}pushApi(e,t){try{let r=this.cfgManager.get(c);if(Math.random()>r.sample)return;let o=this._parse(e),n=new g.default(o);d.push(n),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),d.length>=(r.sendTriggerThreshold||10)?this.report(!0):t?this.report():this.timeout=setTimeout((()=>{this.report()}),r.delay||1500)}catch(e){}}addApi(e,t){try{if(!e)return;if(void 0!==e.networkCode&&"number"!=typeof e.networkCode)return;if(void 0!==e.statusCode&&"number"!=typeof e.statusCode)return;let r=e.networkCode||0===e.networkCode?e.networkCode:"",o=e.statusCode||0===e.statusCode?e.statusCode:"",n={type:"api",connectType:e.connectType||"https",resourceUrl:e.name,statusCode:`${r}|${o}`,responsetime:e.responseTime&&e.responseTime.toString()?e.responseTime.toString():"0",pageUrl:e.pageUrl||""};e.content&&(n.firstCategory=p.CATEGORY.AJAX,n.secondCategory=e.secondCategory||e.name,n.logContent=e.content),this.pushApi(n,t)}catch(e){}}addApiError(e,t,r){let o=this.cfgManager.get(c).errSample||.2;Math.random()>o||this.errManager.pushError({sec_category:e,content:t,category:p.CATEGORY.AJAX,level:p.LEVEL.WARN},r)}report(e=!1){try{let t=this._stringify(e);if(t){const e=this.cfgManager;let r=`${(0,u.stringify)(e.getApiPath(c))}&pageId=${e.get("pageId")}&${(0,u.getReportVersions)(e.config)}`;(0,u.requestQueue)({url:r,method:"POST",data:JSON.stringify(t)})}}catch(e){}}};