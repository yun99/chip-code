var e=Object.create,t=Object.defineProperty,s=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,a=e=>t(e,"__esModule",{value:!0}),i=i=>((e,o,a)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let i of r(o))n.call(e,i)||"default"===i||t(e,i,{get:()=>o[i],enumerable:!(a=s(o,i))||a.enumerable});return e})(a(t(null!=i?e(o(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);((e,s)=>{for(var r in a(e),s)t(e,r,{get:s[r],enumerable:!0})})(exports,{default:()=>g});var u=i(require("./kw.js")),l=i(require("./iu.js")),h=i(require("./xz.js")),p=i(require("./ob.js")),I=i(require("./u8.js")),f=i(require("./uh.js")),m=i(require("./ui.js")),g=class extends u.default{constructor(e,t){super(e,t),this.lastRemovePath=null,this.userInfo=null,this.mallLoginData=null}get storageUserInfo(){return f.default.getCacheValue("logindata")}static register(e){const t=new g("user",e);return e.addModule(t),t}setUserInfo(e){this.userInfo=e,this.app.$user=e,(0,I.isInWX)()&&e&&!e.openId&&p.log.error("微信登录无openId",e)}setMallLoginData(e){this.mallLoginData=e}getLastRemoveUserInfoPath(){return this.lastRemovePath}getMtUserInfo(){return this.app.$mtuser}getUserInfo(){return this.userInfo}getOpenId(){return this.userInfo?this.userInfo.openId:this.mallLoginData?this.mallLoginData.openId:this.storageUserInfo?this.storageUserInfo.openId:""}getToken(){return this.userInfo?this.userInfo.token:this.storageUserInfo?this.storageUserInfo.token:""}getUserId(){return this.userInfo?this.userInfo.userId:this.storageUserInfo?this.storageUserInfo.userId:0}getOpenIdCipher(){return this.userInfo?this.userInfo.openIdCipher:this.mallLoginData?this.mallLoginData.openIdCipher:this.storageUserInfo?this.storageUserInfo.openIdCipher:""}getUnionId(){const e=this.userInfo||this.mallLoginData||this.storageUserInfo;return(null==e?void 0:e.unionId)||""}getWxNickName(){return this.userInfo&&this.userInfo.wxUserInfo&&this.userInfo.wxUserInfo.nickName?this.userInfo.wxUserInfo.nickName:""}getWxAvatarUrl(){return this.userInfo&&this.userInfo.wxUserInfo&&this.userInfo.wxUserInfo.avatarUrl?this.userInfo.wxUserInfo.avatarUrl:""}removeUserInfo(e){this.lastRemovePath=e||"path is empty",p.log.info("清除用户数据"),this.app.$store.remove("user"),this.app.$store.remove("mtuser"),this.app.$user={},this.app.$mtuser=null,this.app.$currentAddressId=null,this.userInfo=null,(0,h.setCartBarBadge)(),(0,m.removeAuthInfo)().then((()=>{p.log.info("清除用户信息成功"),this.app.$store.remove("logindata"),this.event.emit(this.event.CONTANTS.REMOVE_USER_INFO,e)}),(e=>{p.log.error("清除用户信息失败"),this.app.$store.remove("logindata"),this.app.$cat.reportError(l.CAT_SEC_CATEGORY.LOGIN_FAIL_ERROR(e))}))}destroy(){this.event.off(this.event.CONTANTS.REMOVE_USER_INFO),this.checkLogin&&this.checkLogin.destroy()}};