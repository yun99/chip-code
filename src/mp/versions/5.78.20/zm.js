var e=Object.create,t=Object.defineProperty,s=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,n=e=>t(e,"__esModule",{value:!0}),h=i=>((e,i,o)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let u of r(i))a.call(e,u)||"default"===u||t(e,u,{get:()=>i[u],enumerable:!(o=s(i,u))||o.enumerable});return e})(n(t(null!=i?e(o(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);((e,s)=>{for(var r in n(e),s)t(e,r,{get:s[r],enumerable:!0})})(exports,{default:()=>p});var l=h(require("./b3.js")),c=h(require("./u6.js")),p=class{constructor({key:e,count:t=-1,expires:s=7776e3,value:r,isOnlyCache:i,timestamp:o=Date.now(),currentCount:a=0}={},u=(()=>{throw new Error("必须传入model")})()){this._Model=u,this.storageKey=(0,c.genStorageKey)(e),this.key=(0,c.genKey)(e),this.value="",this._updateValue(r),this.isOnlyCache=i,i||(this.expires=s,this.timestamp=o,this.count=t,this.currentCount=a),this._updateStorage()}_updateValue(e){if("simpleModel"===this._Model){if("object"==typeof e&&null!==e)throw new Error(`key为${this.key}的cache在simpleModel中标注为简单类型，实际传入${JSON.stringify(this.value)}为复杂类型，请检查`);this.value=e}else this.value=this._Model&&new this._Model(e)}_updateStorage(e){const t=getApp(),s=t&&t.$store;if(!this.isOnlyCache&&this.key&&this.value){const t=this,{key:r,value:o}=t,n=((e,t)=>{var s={};for(var r in e)a.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&i)for(var r of i(e))t.indexOf(r)<0&&u.call(e,r)&&(s[r]=e[r]);return s})(t,["key","value"]);this.checkIfValid(e)?(0,l.setItem)(this.storageKey,o,n):s&&s.remove(this.key)}}expiresAfterGetCount(e=-1,t=0){return this.count=e,this.currentCount=t,this._updateStorage(),this}expiresAfterTime(e=7776e3){return this.expires=e,this.timestamp=Date.now(),this._updateStorage(),this}update(e,t={}){e&&this._updateValue(e);const{count:s,expires:r,isOnlyCache:i,currentCount:o,timestamp:a}=t;return i&&!this.isOnlyCache&&p.removeItem(this.key),this.isOnlyCache=i||this.isOnlyCache,this.isOnlyCache||(this.timestamp=a||this.timestamp||Date.now(),this.count=s||this.count||-1,this.currentCount=o||this.currentCount||0,this.expires=r||this.expires||7776e3),this._updateStorage(),this}checkIfValid(e){return!(this.expires&&this.timestamp+1e3*this.expires<Date.now())&&!(this.count&&-1!==this.count&&this.currentCount+!e>this.count)}updateCurrentCount(){(this.currentCount||0===this.currentCount)&&(this.currentCount+=1,this._updateStorage(!0))}static getItemObj(e){const t=(0,c.genStorageKey)(e);return(0,l.getItemObj)(t)}static removeItem(e){const t=(0,c.genStorageKey)(e);(0,l.removeItem)(t)}};