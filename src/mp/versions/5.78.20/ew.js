var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,u=(e,r,a)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,p=i=>{return((e,i,n)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let s of a(i))o.call(e,s)||"default"===s||t(e,s,{get:()=>i[s],enumerable:!(n=r(i,s))||n.enumerable});return e})((s=t(null!=i?e(n(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0}),t(s,"__esModule",{value:!0})),i);var s},d=p(require("./ob.js")),l=p(require("./u5.js")),c=p(require("./pa.js")),g=p(require("./cr.js")),y=p(require("./a8.js")),m=p(require("./kv.js")),k=p(require("./kb.js")),v=p(require("./ml.js")),h=p(require("./mz.js")),x=p(require("./cz.js")),{LX_CONFIG:C}=require("./u2.js");var f={},b=getApp(),E=[m.LxEventTypes.CardClick,m.LxEventTypes.CardView,m.LxEventTypes.AddCartClick],T=[m.LxEventTypes.CardClick,m.LxEventTypes.DecreaseCartClick,m.LxEventTypes.AddCartClick,m.LxEventTypes.RemindClick,m.LxEventTypes.ShareBtnClick,m.LxEventTypes.FeedbackBtnClick,m.LxEventTypes.SpecPopupShowClick];Component(new class{constructor(){this.attached=function(){this.onEventHideMaskBindThis=this.onEventHideMask.bind(this),this.onSpuAddCartDoneBindThis=this.onSpuAddCartDone.bind(this),l.$event.on("SKU_CARD_HIDE_MASK",this.onEventHideMaskBindThis),l.$event.on("SPU_ADD_CART_DONE",this.onSpuAddCartDoneBindThis)},this.detached=function(){l.$event.off("SKU_CARD_HIDE_MASK",this.onEventHideMaskBindThis),l.$event.off("SPU_ADD_CART_DONE",this.onSpuAddCartDoneBindThis)},this.methods={triggerLxEvent(e,t={},r=null){const{type:a,sku:i,index:n,parentIndex:o}=this.data,s=y.default.getLxOperator((0,y.genOperatorKey)(a));if(!s)return;const{bid:u,cid:p,operator:d,isTypeOperator:c=!1}=s.getInfo(e)||{};if(E.includes(e)&&!u)throw new Error(`${a}商品列表缺少${e}的bid`);let g;g=c&&r||Object.assign((0,k.default)({},i,n),t),d!==k.default&&(g=d(g,i,n,o,e)),""===g.requestid&&(g.requestid=void 0);const m=getCurrentPages(),v=m[m.length-1].route,h=p||C[v]&&C[v].cid||"";if(T.includes(e))l.$lxLog.mc(u,g,{cid:h});else{const t=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}(`${p}-${u}-${null==i?void 0:i.skuId}-${a}-${n}-${e}`).toString();f[t]||(f[t]=1,l.$lxLog.mv(u,g,{cid:h}))}},funcA(){this.triggerEvent("addToCartCompletely"),this.triggerEvent("customTextJumpTap"),this.triggerEvent("getRecSku")},gotoSkuDetail(e){var t,r;const{canDirect:a,sku:n,proxyData:p}=this.data,c=((0,g.isEmptyObject)(this.data.jumpOptions)?null:this.data.jumpOptions)||(null==p?void 0:p.jumpOptions)||{};try{if(this.triggerEvent("gotoSkuDetail",n),!a)return!1;this.triggerLxEvent(m.LxEventTypes.CardClick),l.$router.goto(`igrocery://www.grocery.com/detail?originalPoiId=${l.$poi.getPoiId()}&poiIdStr_originalPoiId=${l.$poi.getPoiIdStr()}&skuId=${n.skuId}`,((e,t)=>{for(var r in t||(t={}))o.call(t,r)&&u(e,r,t[r]);if(i)for(var r of i(t))s.call(t,r)&&u(e,r,t[r]);return e})({skuCardPicUrl:n.picUrl||""},c)),d.log.info(`<skuCardRender gotoSkuDetail success> page: ${"function"==typeof(null==b?void 0:b.page)&&(null==(t=b.page())?void 0:t.route)||""};`)}catch(e){d.log.warn(`<skuCardRender gotoSkuDetail error> 卡片商详跳转异常;\n                        page: ${"function"==typeof(null==b?void 0:b.page)&&(null==(r=b.page())?void 0:r.route)||""};\n                        errorMessage：${e&&e.message}`)}},onLongPress(e){h.closeAllFeedbackMask(),this.setData({showMask:!0}),h.setIsAnyMaskOpen()},onEventHideMask(e){this.data.showMask&&this.setData({showMask:!1})},onSpuAddCartDone(e){this.data.sku.skuId===e.originalSkuId&&this.triggerEvent("addToCartCompletely",e.sku)},onClickMask(e){this.setData({showMask:!1})},onClickMaskBtn(e){var t,r,a;const i=e.currentTarget.dataset.btnInfo||{},n=e.currentTarget.dataset.btnIndex||-1;if(h.updateBtnClickRecord(),this.triggerLxEvent(m.LxEventTypes.FeedbackBtnClick,{button_name:i.text,tag_index_id:n}),i.isDelete&&this.triggerEvent("removeSelf",{sku:this.data.sku,index:this.data.index}),i.needReport){const e=this.data.sku||{},n={poiId:l.$poi.getPoiId(),poiIdStr:l.$poi.getPoiIdStr()||l.$poi.getPoiId(),skuId:e.skuId,sellPrice:(null==(t=e.sellPrice)?void 0:t.text)||"",originPrice:(null==(a=null==(r=e.originPrice)?void 0:r.newDashPrice)?void 0:a.text)||"",categoryId:i.categoryId,optType:i.type,exhibition:1};(0,v.guessLikeFeedback)(n)}i.jumperUrl&&(d.log.info("[skuCardRender] jumperUrl",i.jumperUrl),l.$router.goto(i.jumperUrl)),this.setData({showMask:!1})},onFeedbackBtnMv(e){const t=e.currentTarget.dataset.btnInfo||{},r=e.currentTarget.dataset.btnIndex||-1;this.triggerLxEvent(m.LxEventTypes.FeedbackBtnView,{button_name:t.text,tag_index_id:r})},onMvReport(){this.triggerLxEvent(m.LxEventTypes.CardView);const{skuId:e="-999",topClickInfo:t={}}=this.data.sku||{},{type:r="-999",boardType:a="-999",text:i={}}=t||{};i.text&&l.$lxLog.mv("b_youxuan_nyzggbxa_mv",{sku_tips:r,list_id:a,message:i.text||"-999",sku_id:e})},onSkuImgLoad(e){this.triggerEvent("skuImgLoad",{sku:this.data.sku,index:this.data.index,dataset:e.currentTarget.dataset})},proxyTap(e){var t;const{type:r="default",url:a="",slug:i="",targetname:n=""}=e.currentTarget.dataset;if("default"===r)this.gotoSkuDetail();else if("goto"===r){if(a){const{skuId:e="-999",productId:r="-999",topClickInfo:i={}}=this.data.sku||{},{type:n="-999",boardType:o="-999",text:s={}}=i||{};l.$lxLog.mc("b_youxuan_nyzggbxa_mc",{sku_id:e,product_id:r,type:null==(t=this.data.sku.topClickInfo)?void 0:t.type,sku_tips:n,list_id:o,message:s.text||"-999"}),l.$router.goto(a)}}else"event"===r&&this.triggerEvent(`${n}${i}`,this.data.sku);d.log.info(`<skuCardRender proxyTap> params: ${JSON.stringify({type:r,url:a,slug:i,targetname:n})};`)},proxyCustomEvent(e){const{type:t,dataFn:r,options:a={}}=e.detail;this.triggerEvent(t,"function"==typeof r?r(this.data):{},a)},proxyLxEvent(e){const{type:t,dataFn:r,options:a={}}=e.detail;this.triggerLxEvent(t,a,"function"==typeof r?r(this.data):null)},proxyMethod(e){const{type:t,event:r}=e.detail;"function"==typeof this[t]&&this[t](r)},popupAddToCart(e){var t,r,a,i,n,o;this.triggerLxEvent(m.LxEventTypes.SpecPopupShowClick);const{panelType:s,customOpCartParams:u={}}=e.detail||{},{type:p,sku:d,index:l,parentIndex:c}=this.data;let g={skuView:"",editAttrClick:"",addCartClick:"",buyNowClick:"",remindClick:""},v={};if(p&&y.default.getLxOperator((0,y.genOperatorKey)(p))){const e=y.default.getLxOperator((0,y.genOperatorKey)(p));g=Object.assign({},g,{skuView:(null==(t=e.getBid)?void 0:t.call(e,m.LxEventTypes.SpecPopupSkuView))||"",editAttrClick:(null==(r=e.getBid)?void 0:r.call(e,m.LxEventTypes.SpecPopupEditAttrClick))||"",addCartClick:(null==(a=e.getBid)?void 0:a.call(e,m.LxEventTypes.SpecPopupAddCartClick))||"",buyNowClick:(null==(i=e.getBid)?void 0:i.call(e,m.LxEventTypes.SpecPopupBuyNowClick))||"",remindClick:(null==(n=e.getBid)?void 0:n.call(e,m.LxEventTypes.SpecPopupRemindClick))||""}),v=Object.assign((0,k.default)({},d,l));const{operator:s}=(null==(o=e.getInfo)?void 0:o.call(e,m.LxEventTypes.SpecPopupSkuView))||{};v=(null==s?void 0:s(v,d,l,c,m.LxEventTypes.SpecPopupSkuView))||{}}const{skuId:h}=d;b.page().popupSkuPurchasePanel({popupStatus:!0,panelType:s,requestParams:{skuId:h,productPattern:2,choicesScene:1},moduleLxBids:g,moduleLxParams:v,customOpCartParams:u})},orderNow(e){return t=this,r=null,a=function*(){var t;const{sku:r}=this.data,{skuId:a,productId:i,productPattern:n=1}=r;if(i&&2===n)this.popupAddToCart({detail:{panelType:x.SkuPurchasePanelType.PURCHASE_NOW}});else{this.triggerLxEvent(m.LxEventTypes.AddCartClick);const r=`${(null==(t=b.$user)?void 0:t.userId)||""}_${Date.now()}`,i={cartOpSource:"BUYNOW",cartOpType:"INCREASE",opTarget:{opTargets:[{skuId:a}]},tempCartId:r,createTempCart:!0,showSuccessToast:!1,needAnimation:!1};yield b.$cart.operateCart(i,e),b.$router.goto(`igrocery://www.grocery.com/submit_order?cartOpSource=buyNow&tempCartId=${r}`)}},new Promise(((e,i)=>{var n=e=>{try{s(a.next(e))}catch(e){i(e)}},o=e=>{try{s(a.throw(e))}catch(e){i(e)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);s((a=a.apply(t,r)).next())}));var t,r,a},groupLeaderShare(){l.$event.emit(c.HOME_PAGE_TUANZHANG_SHARE,{skuCardType:this.data.type||"default",skuInfo:this.data.sku})}},this.properties={sku:{type:Object,value:{}},schema:{type:Object,value:{}},jumpOptions:{type:Object,value:{}},index:Number,parentIndex:Number,type:{type:String,value:"default"},canDirect:{type:Boolean,value:!0},proxyData:{type:Object,value:{}},enableLongPress:{type:Boolean,value:!1},useSlot:{type:Boolean,value:!1}},this.data={showMask:!1}}});