var e=Object.create,t=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,m=(e,r,a)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,g=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&m(e,r,t[r]);if(s)for(var r of s(t))l.call(t,r)&&m(e,r,t[r]);return e},p=(e,t)=>r(e,n(t)),c=e=>t(e,"__esModule",{value:!0}),d=r=>((e,r,n)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let s of u(r))i.call(e,s)||"default"===s||t(e,s,{get:()=>r[s],enumerable:!(n=a(r,s))||n.enumerable});return e})(c(t(null!=r?e(o(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);((e,r)=>{for(var a in c(e),r)t(e,a,{get:r[a],enumerable:!0})})(exports,{default:()=>U,genGameParams:()=>Q});var y=d(require("./30.js")),h=d(require("./ua.js")),b=d(require("./39.js")),f=d(require("./u8.js")),$=d(require("./u2.js")),v=require("./p3.js"),{generateParams:P}=require("./p0.js");function Q(e={}){var t;const r=getApp(),{longitude:a,latitude:n}=r.$location||{},u=r.$store.getCacheValue("addressLongitude")||a||"",s=r.$store.getCacheValue("addressLatitude")||n||"",o=r.getModule("user");return p(g({token:o.getToken()||"",userId:o.getUserId(),sourceApp:(0,f.getH5Source)(),stockPois:r.$poiIdStr||r.$poiId||"",poiId:r.$poiId||"",poiIdStr:r.$poi.getPoiIdStr()||"",uuid:r.$uuid},$.DefaultQueryString),{bizId:4,app_tag:r.$appTag,utm_term:r.$version,utm_source:e.utm_source||r.$scene,ci:r.$cityId,lng:u,lat:s,acquisitionScene:null==(t=h.default.get("utm"))?void 0:t.utm_campaign,__lxsdk_params:e.__lxsdk_params||h.default&&h.default.setURLEnv&&h.default.setURLEnv()||"",template_id:r.$lxLog.templateId,message_id:r.$lxLog.messageId,lxAppName:"meituanyouxuan_dyapp"})}var _={containerQuery:"",gameH5path:"",gameQuery:"",genContainerPath(){return`igrocery://www.grocery.com/marketingGameWebview?${this.containerQuery}`},genContainerQuery(){return this.containerQuery=P({url:encodeURIComponent(this.gameH5path)}),this},genGameH5Path(e){const t=getApp(),r=t.getModule("env").getSwimlane(),a="test"===t.getModule("env").getEnv(),n=v.parse(a?e.debugUrl:e.url),{protocol:u,host:s,path:o}=n;return this.gameH5path=`${u}//${a&&r?`${r}-sl-${s}`:s}${o}?${this.gameQuery}`,this},genGameQuery(e){return this.gameQuery=P(e),this}},x={containerQuery:"",gameH5path:"",gameQuery:"",genContainerPath(){const e=(0,f.isMT)()?"meituan":"grocery";return`i${e}://www.${e}.com/web_knb?${this.containerQuery}`},genContainerQuery(e){return this.containerQuery=P(p(g({},e),{url:encodeURIComponent(this.gameH5path)})),this},genGameH5Path(e){const t=getApp(),r=t.getModule("env").getSwimlane(),a="test"===t.getModule("env").getEnv(),n=v.parse(a?e.mtDebugUrl||e.debugUrl:e.mtUrl||e.url),{protocol:u,host:s,path:o}=n;return this.gameH5path=`${u}//${a&&r?`${r}-sl-${s}`:s}${o}?${this.gameQuery}`,this},genGameQuery(e,t){return this.gameQuery=P(g(g({},e),t)),this}},U=class extends b.default{constructor(e){super(e),this.use=e=>{const t=e.getUri(),r=t.getPath(),a=t.getQuery()||{},n=Object.keys(a).reduce(((e,t)=>p(g({},e),{[t]:encodeURIComponent(a[t])})),{}),u=Object.keys(y.gameConfigList).filter((e=>r===`/marketingGame/${e}`))[0]||"",s=y.gameConfigList[u]||{};if((0,f.isWX)()){const t=_.genGameQuery(n).genGameH5Path(s).genContainerQuery().genContainerPath();e.setUri(t)}else if((0,f.isApp)()||(0,f.isMT)()){const t=x.genGameQuery(g(g(g({},n),s.useX5?{webkit:"x5"}:{}),s.noRotate?{KNBNoRotate:1}:{}),Q()).genGameH5Path(s).genContainerQuery({notitlebar:1,singleton:1,redirect:0,keepNavigationBarState:1}).genContainerPath();e.setUri(t)}return Promise.resolve(e)},this.name="MarketingGameInterceptor"}};