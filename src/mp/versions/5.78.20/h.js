var t=Object.create,e=Object.defineProperty,r=Object.defineProperties,s=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,d=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,c=(t,e)=>{for(var r in e||(e={}))i.call(e,r)&&d(t,r,e[r]);if(n)for(var r of n(e))p.call(e,r)&&d(t,r,e[r]);return t},l=r=>{return((t,r,a)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let n of o(r))i.call(t,n)||"default"===n||e(t,n,{get:()=>r[n],enumerable:!(a=s(r,n))||a.enumerable});return t})((a=e(null!=r?t(u(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0}),e(a,"__esModule",{value:!0})),r);var a},h=(t,e,r)=>new Promise(((s,a)=>{var o=t=>{try{u(r.next(t))}catch(t){a(t)}},n=t=>{try{u(r.throw(t))}catch(t){a(t)}},u=t=>t.done?s(t.value):Promise.resolve(t.value).then(o,n);u((r=r.apply(t,e)).next())})),y=l(require("./u8.js")),m=l(require("./pa.js")),g=l(require("./cz.js")),v=l(require("./kv.js")),b=l(require("./kb.js")),C=l(require("./kg.js")),{getOneDayExpires:k}=require("./p0.js"),E=getApp();Component(new class{constructor(){this.created=function(){this.updateSkuCountBindthis=this.updateSkuCount.bind(this)},this.ready=function(){this.data.options.useVirtualCart?E.$event.on(m.VIRTUAL_UPDATE_SKU_COUNT,this.updateSkuCountBindthis):E.$event.on(m.UPDATE_SKU_COUNT,this.updateSkuCountBindthis),this.updateSkuCount()},this.detached=function(){this.data.options.useVirtualCart?E.$event.off(m.VIRTUAL_UPDATE_SKU_COUNT,this.updateSkuCountBindthis):E.$event.off(m.UPDATE_SKU_COUNT,this.updateSkuCountBindthis)},this.methods={updateSkuCount(t){var e;const r=(null==(e=null==t?void 0:t.opTarget)?void 0:e.opTargets)||[],s=this.getSkuCount();r.length?r.some((t=>t.skuId===this.data.sku.skuId||2===this.data.sku.productPattern&&t.productId===this.data.sku.productId))&&this.setData({skuCount:s}):s>0&&this.setData({skuCount:s})},onShareBtnMvReport(t){this.triggerEvent("proxyLxEvent",{type:v.LxEventTypes.ShareBtnView,dataFn:t=>{const{sku:e,index:r}=t;return(0,b.shareDataGenFn)({},e,r)}},{bubbles:!0,composed:!0})},getSkuCount(){const{options:t,sku:e}=this.data;if(!e)return 0;const{productId:r,skuId:s,productPattern:a=1}=e;let o=0;return o=r&&2===a?E.$cart.getSkuNumByProductId(r):t.useVirtualCart?E.$cart.virtualSkuQtyList[s]:E.$cart.skuRealQtyList[s],o?+o:0},getExpectedCount(t){const e=this.getSkuCount();return"INCREASE"===t?this.getSkuCount()+1:e?this.getSkuCount()-1:0},share(){var t,e;this.triggerEvent("proxyLxEvent",{type:v.LxEventTypes.ShareBtnClick,dataFn:t=>{const{sku:e,index:r}=t;return(0,b.shareDataGenFn)({},e,r)}},{bubbles:!0,composed:!0}),(null==(t=this.data.options)?void 0:t.isCustomShareEvent)||(null==(e=this.data.proxyData)?void 0:e.isCustomShareEvent)?this.triggerEvent("proxyCustomEvent",{type:"skuShare",dataFn:t=>(null==t?void 0:t.sku)||{}},{bubbles:!0,composed:!0}):this.triggerEvent("groupLeaderShare",{},{bubbles:!0,composed:!0})},decrease(t){this.addToCart("DECREASE")},increase(t){this.addToCart("INCREASE",t)},orderNow(t){return h(this,null,(function*(){(yield(0,C.default)(E))||(E.$login.isLogin()?this.triggerEvent("orderNow",{},{bubbles:!0}):E.$login.login())}))},addToCart(t="INCREASE",e){return h(this,null,(function*(){if(yield(0,C.default)(E))return;const{sku:s,options:o,proxyData:n}=this.data,{skuId:u,productId:i,productPattern:p=1}=s,d=(null==o?void 0:o.customOpCartParams)||(null==n?void 0:n.customOpCartParams)||{},{needAnimation:l}=o;if(i&&2===p&&"INCREASE"===t)return void this.triggerEvent("popupAddToCart",{panelType:g.SkuPurchasePanelType.ADD_TO_CART,customOpCartParams:d},{bubbles:!0,composed:!0});this.triggerEvent("proxyLxEvent",{type:"INCREASE"===t?v.LxEventTypes.AddCartClick:v.LxEventTypes.DecreaseCartClick},{bubbles:!0,composed:!0});let h={};h=o.useVirtualCart?c({cartOpSource:"BUYNOW",cartOpType:t,opTarget:{opTargets:[{skuId:u,productId:i}]},tempCartId:this.data.sku.tempCartId||"",needAnimation:l},d):c({cartOpSource:"ITEMLIST",cartOpType:t,needAnimation:l,opTarget:{opTargets:[{skuId:u,productId:i,processingServiceId:0}]}},d);const y=this.getExpectedCount(t);this.setData({skuCount:y}),E.$cart.operateCart(h,e).then((e=>{this.getSkuCount()!==y&&this.setData({skuCount:this.getSkuCount()}),"INCREASE"===t&&this.handleRec(),this.triggerEvent("proxyCustomEvent",{type:"addToCartCompletely",dataFn:e=>{return s=c({},e.sku),o={cartOpType:t,sku:e.sku},r(s,a(o));var s,o}},{bubbles:!0,composed:!0})}))}))},similarJump(){this.triggerEvent("proxyLxEvent",{type:v.LxEventTypes.SimilarClick},{bubbles:!0,composed:!0});const{skuId:t}=this.data.sku;E.$router.goto("igrocery://www.grocery.com/normal_cart/similar_goods",{type:"similarList",skuId:t})},handleRec(){var t,e,r;const{canRec:s,skuId:a,multiPromotionId:o}=this.data.sku;((-1===E.$store.getOrInit("recHistory",{skuIds:[]},{expires:k()}).value.skuIds.indexOf(a)||(null==(t=this.data.options)?void 0:t.unSaveRecId)||(null==(r=null==(e=this.data)?void 0:e.proxyData)?void 0:r.unSaveRecId))&&s||o)&&this.triggerEvent("proxyCustomEvent",{type:"getRecSku",dataFn:t=>({index:t.index})},{bubbles:!0,composed:!0})},subscibeProxyLxEvent(t){this.triggerEvent("proxyLxEvent",t.detail,{bubbles:!0,composed:!0})}},this.properties={sku:{type:Object,value:{}},options:{type:Object,value:{}},innerClass:{type:Object,value:{numberWidthClass:"w_60"}},index:{type:Number},proxyData:{type:Object,value:{}}},this.data={skuCount:0,isMMP:(0,y.isMMP)(),isApp:(0,y.isApp)()}}});