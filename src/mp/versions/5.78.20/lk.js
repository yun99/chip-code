var e=Object.create,t=Object.defineProperty,a=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,s=Object.getPrototypeOf,r=Object.prototype.hasOwnProperty,p=e=>t(e,"__esModule",{value:!0}),n=n=>((e,s,p)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let n of o(s))r.call(e,n)||"default"===n||t(e,n,{get:()=>s[n],enumerable:!(p=a(s,n))||p.enumerable});return e})(p(t(null!=n?e(s(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);((e,a)=>{for(var o in p(e),a)t(e,o,{get:a[o],enumerable:!0})})(exports,{default:()=>c});var l=n(require("./ob.js")),i=n(require("./is.js")),u="[Router]:updateManger",c=class{constructor(){this.checkAppUpdate=e=>new Promise(((t,a)=>{mmp.callCustomAPI("checkAndUpdateApp",{version:e.appVersion||"",message:e.message||"为了保证您的体验，请升级到优选App最新版本，感谢您的谅解",fail(e){a(e)},success(e){const a=getApp();a.page().loading(!1),e&&0===e.needUpdate&&a.page().toast("当前已是最新版本"),t(e)}})})),this.updateMiniProgramVesion=(e=!0)=>{wx.getUpdateManager?(this.updateManager=wx.getUpdateManager(),l.log.info(u,"onCheckForUpdate"),this.updateManager.onCheckForUpdate((t=>{if(l.log.info(u,"updateVesion",t),t.hasUpdate){this.updateManager.onUpdateReady((()=>{this.showUpdate(e)}));getApp().$cat.reportCustomMetrics(i.YXReportTarget.FORCE_UPDATE,i.ReportValue.SUCCESS,{success:e?"兜底降级更新":"首页强制更新"})}else e&&this.showFaild("当前版本已经是最新了"),l.log.info(u,"onCheckForUpdate hasUpdate = false")})),this.updateManager.onUpdateFailed((()=>{e&&this.showFaild("更新失败"),l.log.info(u,"onUpdateFailed");getApp().$cat.reportCustomMetrics(i.YXReportTarget.FORCE_UPDATE,i.ReportValue.FAILED,{fail:e?"兜底降级更新":"首页强制更新"})}))):l.log.info(u,"no support getUpdateManager")},this.showUpdate=e=>{wx.showModal({title:"更新提示",content:"需要升级到最新版本才能体验哟～是否重启应用进行升级?",success:e=>{e.confirm&&this.updateManager.applyUpdate()},showCancel:!!e,confirmText:"确定",confirmColor:"#FFD100"})},this.showFaild=e=>{wx.showModal({title:"提示",content:e,showCancel:!1,success:e=>{}})},this.updateManager=null}};