var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,a=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,l=e=>t(e,"__esModule",{value:!0}),u=u=>((e,a,l)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let u of o(a))n.call(e,u)||"default"===u||t(e,u,{get:()=>a[u],enumerable:!(l=r(a,u))||l.enumerable});return e})(l(t(null!=u?e(a(u)):{},"default",u&&u.__esModule&&"default"in u?{get:()=>u.default,enumerable:!0}:{value:u,enumerable:!0})),u);((e,r)=>{for(var o in l(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{default:()=>p});var s=u(require("./j0.js")),c=u(require("./j9.js"));function p(e,t,r=s.context.request){if(!e)return e;let o=Date.now(),{url:a,path:n,complete:l,connectType:u,reportError:i,isRequest:d}=e;u=u||(a?"https":n?"cloudContainer":"https");let f,m=a||n||"",g=(t.cfgManager.get("resource").defaultNetworkCode||500)+"";try{let r=t.cfgManager.get("project");if(r&&t.cfgManager.get("enableLogTrace")&&(f=(0,c.traceid)(),f)){e.header=e.header||{},e.header["M-TRACEID"]=f;let t="mmp"===s.sign?"mtmp":"wxmp";e.header["M-APPKEY"]=`${t}_${r}`}}catch(e){}try{e.complete=function(e){try{let r={resourceUrl:m,responsetime:(Date.now()-o).toString(),timestamp:o.toString(),connectType:u};if(f&&(r.traceid=f),e&&"object"==typeof e){let{statusCode:t="",errMsg:o="request:ok"}=e;if(r.statusCode=`${t||g}|`,"function"==typeof i){let t;try{t=i(e,p)}catch(e){}let{code:a="",name:n="",log:l="",ignoreAjaxError:u=!1}=t||{};(a||0===a)&&(r.statusCode=`${r.statusCode}${a}`),u||(o.indexOf("request:fail")>-1||o.indexOf("cloud.callContainer:fail")>-1||n||l)&&(r.firstCategory="ajaxError",r.secondCategory=n||m,r.logContent=l||o)}}else r.statusCode=`${g}|`;t.resource.pushApi(r)}catch(e){t.error.addError("request options complete err",e)}finally{l&&l.apply(this,arguments)}}}catch(e){}return d&&"https"===u&&r(e),e}