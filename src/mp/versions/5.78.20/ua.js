function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r,i,a="undefined",o=!1;("undefined"==typeof mmp?"undefined":t(mmp))!==a?(r=mmp,i="MT",o=!0):i=("undefined"==typeof swan?"undefined":t(swan))!==a?(r=swan,"Baidu"):("undefined"==typeof tt?"undefined":t(tt))!==a?(r=tt,"TouTiao"):("undefined"==typeof ks?"undefined":t(ks))!==a?(r=ks,"KuaiShou"):(r=wx,"WX");var c=Object.prototype,s=c.toString,u=c.hasOwnProperty;function f(e,n){return function(e){return t(e)}(e)===n}function l(e){return f(e,"function")}function d(e){return e&&f(e,"string")}function v(e){return e&&"[object Object]"===s.call(e)}function h(){return new Date-0}var g=Array.isArray||function(e){return"[object Array]"===s.call(e)};function p(e){if(!e)return!1;var t=e.length;return!(!g(e)&&(!(e&&function(e){return f(e,"number")}(t)&&0<=t)||v(e)&&1<t&&!(t-1 in e)))}function _(e,t,n){var r,i,a;if(e)if(p(e))for(i=0,a=e.length;i<a&&!1!==t.call(n,e[i],i,e);i++);else for(r in e)if(u.call(e,r)&&!1===t.call(n,e[r],r,e))break}function m(e,t,n){var r,i=!0===e;return i||(n=t,t=e),t&&v(t)||(t={}),n&&v(n)||(n={}),_(n,(function(e,a){i&&v(n[a])?(r=v(t[a])?t[a]=t[a]||{}:t[a]={},m(i,r,n[a])):t[a]=n[a]})),t}function y(e,t,n){var r=[];return p(e)&&_(e,(function(e){r.push(t?t.call(n,e):e)}),n),r}function x(){return Math.ceil(65535*Math.random()).toString(16)}function S(){var e=y(arguments);e.unshift("[LX SDK]")}function k(){var e=y(arguments);e.unshift("[LX SDK]")}function w(){return h().toString(16)+"-"+x()+"-"+x()}function b(e,t){try{r.setStorageSync("_lx_sdk_"+e,t)}catch(e){S("setCache error :",e)}}function T(e){try{return r.getStorageSync("_lx_sdk_"+e)}catch(e){return void S("getCache error :",e)}}function C(e){try{r.removeStorageSync("_lx_sdk_"+e)}catch(e){S("removeCache error: ",e)}}function P(e){var t=Math;return t.ceil(t.min(1e3*(.5+t.random())*t.pow(2,e),15e3))}var A={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,i,a,o,c,s="",u=0;for(e=A._utf8_encode(e);u<e.length;)i=(t=e.charCodeAt(u++))>>2,a=(3&t)<<4|(n=e.charCodeAt(u++))>>4,o=(15&n)<<2|(r=e.charCodeAt(u++))>>6,c=63&r,isNaN(n)?o=c=64:isNaN(r)&&(c=64),s=s+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(c);return s},decode:function(e){var t,n,r,i,a,o,c="",s=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");s<e.length;)t=this._keyStr.indexOf(e.charAt(s++))<<2|(i=this._keyStr.indexOf(e.charAt(s++)))>>4,n=(15&i)<<4|(a=this._keyStr.indexOf(e.charAt(s++)))>>2,r=(3&a)<<6|(o=this._keyStr.indexOf(e.charAt(s++))),c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(n)),64!=o&&(c+=String.fromCharCode(r));return A._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",n=0,r=0,i=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):191<r&&r<224?(i=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&i),n+=2):(i=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&c3),n+=3);return t}},O={hasBuiltRTTEnv:!1,nativeReport:!1};var M="onShow",q="onHide",L="onUnload",j="onLoad",E="onLaunch",D={hasMMPInternalLX:I(),tryNative:function(){return D.toNative("cmd").then((function(e){return Promise.resolve(e.code<=400)}))},toNative:function(e,t){return e?new Promise((function(n){if(D.hasMMPInternalLX){if(D.internalLX=D.internalLX||requirePrivate("lx"),"cmd"===e)return void D.internalLX.requireCMD(t||{},(function(e,t){n(e)}));D.internalLX.requireUpdate({method:e},(function(e){var t=e["mmp.status"],r=e.code;if("success"!==t||200!==r)return n({code:400});n({data:e.data,code:200})}))}else n({code:400})})):Promise.resolve({code:400})}};function I(){if(global._lx_usingOldMMP)return!1;if("undefined"==typeof mmp||"undefined"==typeof requirePrivate)return!1;var e=requirePrivate("lx");return e&&e.requireUpdate}var N=[],V={},B=!1;var R,U=function(e){if(v(e))V=e;else if(d(e))try{V=JSON.parse(e)}catch(t){V=e}},J={_cachedTags:undefined,_dirty:!1,ctx:undefined,setCurrentCtx:function(e){this.ctx=e},push:function(e){var t=e.ctx,r=e.key,i=e.val;t=t||this.ctx;var a,c,s=N.findIndex((function(e){return e.ctx===t}));if(0<=s&&(a=N[s]),a){if(!r||!i)return;if(c=a.tag||{},v(i))for(var u in c[r]=c[r]||{},i)c[r][u]=i[u];a.tag=c}else r&&i&&(c=n({},r,i)),a={ctx:t,tag:c},N.push(a);this._dirty=!0,c&&o&&O.nativeReport&&D.toNative("cmd",{mn:"setTag",cn:"techportal",data:{key:r,value:i}}).then((function(e){global.show(JSON.stringify({key:r,value:i,result:e}))}))},back:function(e){var t=N.findIndex((function(t){return t.ctx===e}))-1;0<=t&&(this._dirty=!0,N.splice(t,N.length-t))},get:function(e){var t=this.getAll();return d(e)?t[e]:t},getAll:function(){var e;if(this._dirty)if(N.length){var t={},n=!1;_(N,(function(e){var r=e.tag;r&&(t=m(n=!0,t,r))})),e=this._cachedTags=n?t:undefined}else e=this._cachedTags=undefined;else e=this._cachedTags;return B?e:function(e,t){for(var n in t)v(e[n])?m(!0,e[n],t[n]):e[n]=t[n];return e}(m(!0,{},V),e)},clear:function(e){N=[],e||(V={},B=!0)}},Q=null,W=[],X="lx_send_cache_data",F=undefined,K=[],$=[],G={},H=null,z={};function Z(e,t,n,i){if(t&&t.length&&(W=[].concat(t)).length){var a=W[W.length-1].evs;if(a&&a.length||W.pop(),g(W)&&t.length){var o=JSON.stringify(W);(function(e){var t=e.url,n=e.data,i=e.success,a=e.fail;r.request({method:"POST",url:t,data:n,success:function(e){var t=e.statusCode;t<400?i&&i():a(t)},fail:function(){a(0)}})})({url:e,data:o,success:function(){!function(e,t){if("MVL"===t)return clearTimeout(H),H=null,$=[],void Y(e,"MVL");"AQ"===t&&(clearTimeout(H),H=null,C(X)),Q=null,te()&&Y(e)}(e,n)},fail:function(){(function(e,t,n){if("MVL"===t){if(n<=3)return n++,void setTimeout((function(){Z(e,$,t,n)}),P(n));$=[],clearTimeout(H),H=null,Y(e,"MVL")}else{if(n<=3)return n++,void setTimeout((function(){_(W,(function(e){_(e.evs,(function(e){var t=e.lx_inner_data;t&&((t=e.lx_inner_data=JSON.parse(JSON.stringify(t))).isRetry=!0)}))})),Z(e,W,t,n)}),P(n));"AQ"===t&&(C("lx_send_cache_data"),clearTimeout(H),H=null),W=[],Q=null,te()&&Y(e)}})(e,n,i||0),re("report.js","wx-request-fail","report fail")}}),K=[],ne()}}}function Y(e,t){"MVL"!==t?Q=setTimeout((function(){if(!te())return clearTimeout(Q),void(Q=null);Z(e,K)}),500):H=setTimeout((function(){var t=ee();t.length&&($=$.concat(t)),$.length?Z(e,$,"MVL"):(clearTimeout(H),H=null)}),5e3)}function ee(){var e={},t=[];return _(G,(function(t,n){var r=t.category;if(t.evs,t.mvlId,!e[r]){var i=m(!0,{evs:[]},me(null,!0));i.category="data_sdk_"+r,i.rtt_env&&(i.rtt_env.category=i.category),e[r]=i}e[r].evs.push(t.evs)})),_(e,(function(e){t.push(e)})),G={},t}function te(){return!!K.length&&K[0]&&K[0].evs&&K[0].evs.length}function ne(){var e=m(!0,{},me(null,!0));e.evs=[],K.length&&0===(K[K.length-1].evs||[]).length?K[K.length-1]=e:K.push(e)}function re(e,t,n,i){if(z.url)try{var a=getCurrentPages(),o="app.js";a.length&&a[a.length-1]&&(o=a[a.length-1].__route__);var c=[{project:"wx-lx-sdk",pageUrl:o,resourceUrl:e,category:i?"jsError":"ajaxError",sec_category:t||"",level:"error",unionId:me("lxcuid"),timestamp:h(),content:""+n||""}];r.request({method:"POST",url:z.url,data:"c=".concat(encodeURIComponent(JSON.stringify(c))),header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){},fail:function(e){S("cat report error:",e)}})}catch(e){S("reportError error:",e)}}var ie,ae=D.toNative,oe=["category","_lx_validcode"],ce={sdk_ver:"2.9.1-beta.1",ch:"weixin",lch:"wx",rtt:"mp"},se=["sdk_ver","lxcuid"],ue=["sdk_env","_lx_validcode"];ce.lxcuid=function(e){var t=T("lxcuid");if(t)return t;var n,r,i=function(){for(var e=1*new Date,t=0;e===1*new Date&&t<200;)t++;return e.toString(16)+t.toString(16)},a=+(Math.random()+"").slice(2),o=e.ua||"",c=[],s=0;function u(e,t){var n,r=0;for(n=0;n<t.length;n++)r|=c[n]<<8*n;return e^r}for(n=0;n<o.length;n++)r=o.charCodeAt(n),c.unshift(255&r),4<=c.length&&(s=u(s,c),c=[]);0<c.length&&(s=u(s,c)),o=s;var f=0;e.sc&&(f=+(f=e.sc.split("*"))[0]*+f[1]);var l=[i(),a,o,f,i()].map((function(e){return e.toString(16)})).join("-");return b("lxcuid",l),l}(ce);var fe="online";function le(){return Se("oldmmp","1"),new Promise((function(e){var t=!1;setTimeout((function(){t||e({})}),100),wx.getLxEnvironment({success:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=n.env,i=n.tag;if(t=!0,r){var a={nativeEnv:r,nativeTag:i,type:"old"};de(a),e(a)}else e({})}})}))}function de(e){R=e,setTimeout((function(){R=null}),1e3)}function ve(){return R?Promise.resolve(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),i.forEach((function(t){n(e,t,r[t])}))}return e}({},R,{fromCache:!0})):I()?Promise.all([ae("getEnv"),ae("getTag")]).then((function(e){var t=e[0].data,n=e[1].data;if(t){var r={nativeEnv:t,nativeTag:n};return de(r),Promise.resolve(r)}if(wx.getLxEnvironment)return le()})):wx.getLxEnvironment?le():Promise.resolve({})}function he(e){try{var t=r.getSystemInfoSync(),n="MicroMessenger"+i+"A ("+t.model+"; "+t.system+"; "+t.pixelRatio+"dpr; language/"+t.language+") "+t.platform+"/"+t.version+" NetType/";ce.ct=t.platform.toLowerCase(),"ios"===ce.ct&&(ce.ct=(t.model||"").replace(/^.*(iPad|iPhone|iPod).*$/,"$1"),/^(iPad|iPhone|iPod)$/.test(ce.ct)||(ce.ct="ios"),ce.ct&&(ce.ct=ce.ct.toLowerCase())),ce.os=t.system,ce.sc=t.screenWidth+"*"+t.screenHeight,ce.ua=n,Se("mmp",t.mmpSDKVersion)}catch(e){ce.ua=ce.ct=ce.os=ce.sc=""}return new Promise((function(t){var n=T("wxid"),r=T("wxunionid");n&&(ce.wxid=n),r&&(ce.wxunionid=r),ve().then((function(n){var r=n.nativeEnv,i=n.nativeTag;"old"===n.type?_(r||{},(function(t,n){e.set(n,t)})):r&&function(e){if(!O.hasBuiltRTTEnv){var t={},n=ce.category;for(var r in ie=(e=e||{}).sdk_env||"online",ce)t[r]=ce[r],oe.includes(r)&&(e[r]=ce[r]),delete ce[r];for(var i in ce.rtt_env=t,e)e[i]&&(ce[i]=e[i]);ce.category=n,O.hasBuiltRTTEnv=!0,_e()}}(r),i&&U(i),t(ce)}))})).then((function(){var e=O.hasBuiltRTTEnv?ce.rtt_env:ce;return new Promise((function(t){try{r.getNetworkType({success:function(n){e.net=n.networkType.toUpperCase(),e.ua=e.ua.replace(/(NetType\/).*/,"$1"+n.networkType.toUpperCase()),t(e)},fail:function(){t(e)}})}catch(n){t(e)}}))}))}function ge(e,t){delete(O.hasBuiltRTTEnv?ce.rtt_env:ce)[e],t&&delete ce[e]}function pe(e,t,n){var r=O.hasBuiltRTTEnv?ce.rtt_env:ce;r[e]!==t&&(-1<se.indexOf(e)||("category"===e&&(t="data_sdk_"+t,ce[e]=t),"wxid"!==e&&"wxunionid"!==e||b(e,t),"msid"===e&&ce.scene&&ge("scene"),-1<ue.indexOf(e)?ce[e]=t:r[e]=t,n&&n({})))}function _e(){var e="online";"offline"!==fe&&"offline"!==ie||(e="offline"),ce.sdk_env=e,ne()}function me(e,t){var n=O.hasBuiltRTTEnv?ce.rtt_env:ce;return n=t?ce:n,e?n[e]:n}function ye(e){if(O.hasBuiltRTTEnv&&ce.rtt_env&&v(e)){var t=ce.rtt_env.category;for(var n in ie=e.sdk_env||"online",e)e[n]&&(ce[n]=e[n]);ce.category=t,_e()}}var xe={};function Se(e,t){t?xe[e]=t:delete xe[e]}function ke(e,t){try{[M,q,E].forEach((function(n){var r=t[n],i=function(e,t){r&&r.apply(e,t)};n===E&&(t[n]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i(this,t)}),n===M&&(t[n]=function(t){e._config.hasAs=!1,e._config.hasAq=!1;var n=t||{},r=n.query,a=void 0===r?{}:r,o=n.scene;o&&e.set("scene",o),a.lch&&e.setLch(a.lch),a.oauid&&e.set("oauid",a.oauid),a.sunion_id&&e.set("sunion_id",a.sunion_id),a.tc&&e.set("tc",a.tc),a.tn&&e.set("tn",a.tn),t&&e._autoSetUTM(t),e.start(t?{custom:t}:null),e._config.hasAs=!0;for(var c=arguments.length,s=new Array(1<c?c-1:0),u=1;u<c;u++)s[u-1]=arguments[u];i(this,[t].concat(s))}),n===q&&(t[n]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i(this,n),e._config.hasAq?k("PD（页面离开）灵犀集成自动上报，请注释灵犀 quit 接口调用！"):e.quit()})}))}catch(e){re("index.js","lx-api-error",e.message,!0),S(e.message)}return t}var we=App;function be(e,t,n){try{[L,M,q,j].forEach((function(n){var r=t[n],i=function(e,t){r&&r.apply(e,t)};switch(n){case j:t[j]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];0<n.length&&"{}"!==JSON.stringify(n[0])&&(e._config.query=n[0]),i(this,n)};break;case M:t[M]=function(){e._config.hasPv=!1,e._config.hasPd=!1;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i(this,n)};break;case q:t[q]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i(this,n);var a=e._config;a.hasPv&&!a.hasPd?(a.autoPd=!0,e.pageDisappear({}),a.autoPd=!1):k("PD（页面离开）灵犀集成自动上报，请注释灵犀 pageDisappear 接口调用！")};break;case L:t[L]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i(this,n);var a=e._config;a.hasPv&&!a.hasPd?(a.autoPd=!0,e.pageDisappear({}),a.autoPd=!1):k("PD（页面离开）灵犀集成自动上报，请注释灵犀 pageDisappear 接口调用！"),J.back(this)}}}))}catch(e){re("index.js","lx-api-error",e.message,!0),S(e.message)}return t}var Te=Page;var Ce,Pe=["uid","uuid","union_id","sdk_ver","msid","ct","os","appnm","app","category","utm"],Ae=["val_bid","val_cid","lng","lat","val_lab","req_id","nm","val_ref","seq","tm"],Oe=[],Me={},qe=0;function Le(e,t){if(v(Me)){g(Me.envInfo)&&(Pe=Pe.concat(Me.envInfo)),g(Me.evsInfo)&&(Ae=Ae.concat(Me.evsInfo));var n=e.nm;switch(n){case"AS":Me.hasAS&&je(e,t);break;case"AQ":Me.hasAQ&&je(e,t);break;case"PV":case"PD":g(Me.PV)&&-1<Me.PV.indexOf(e.val_cid)&&je(e,t);break;default:(function(e,t){return!!(g(e)&&-1<e.indexOf(t.val_bid))})(Me[n],e)&&je(e,t)}}}function je(e,t){var n={};_(Ae,(function(t){n["evs."+t]=e[t]||""})),n["evs.fseq"]=qe++;var r=m(!0,{},me());m(!0,r,t||{}),_(Pe,(function(e){var t=r[e];"category"===e&&(t="data_sdk_"+t.replace("data_sdk_","")),n[e]=t||""})),Oe.push(n),30===Oe.length&&(De(Oe,1),Oe=[])}function Ee(e,t){t<=3&&(t++,setTimeout((function(){De(e,t)}),P(t)))}function De(e,t){0!==e.length&&r.request({method:"POST",url:"https://hreport.meituan.com",data:e,success:function(n){n.statusCode<400||Ee(e,t)},fail:function(){Ee(e,t)}})}var Ie,Ne,Ve,Be,Re,Ue,Je,Qe,We=!0,Xe=r.getStorageSync("_lx_sdk_interceptData"),Fe={cnt:0,list:{cid:[],bid:[],bid_null:0},ut:Xe?Xe.ut:""};function Ke(e,t){try{if(!We)return;if(!Xe)return;var n=Xe.bid,r=Xe.cid,i=Xe.empty_bid_blk;if(t){if(r.includes(t))return!Fe.list.cid.some((function(e,n){if(e.id===t)return e["M*"]++,!0}))&&Fe.list.cid.push({id:t,"M*":1}),Fe.cnt++,!0;if(e){if(e in n){if(!n[e].length)return!Fe.list.bid.some((function(t,n){if(t.id===e)return t.cnt++,!0}))&&Fe.list.bid.push({id:e,cnt:1}),Fe.cnt++,!0;if(n[e].includes(t))return!Fe.list.bid.some((function(t,n){if(t.id===e)return t.cnt++,!0}))&&Fe.list.bid.push({id:e,cnt:1}),Fe.cnt++,!0}}else if(i)return Fe.list.bid_null++,Fe.cnt++,!0}else if(e){if(e in n&&!n[e].length)return!Fe.list.bid.some((function(t,n){if(t.id===e)return t.cnt++,!0}))&&Fe.list.bid.push({id:e,cnt:1}),Fe.cnt++,!0}else if(i)return Fe.list.bid_null++,Fe.cnt++,!0;return!1}catch(e){re("data_intercept.js","lx-needInterception-error",e.message,!0),S(e.message)}}function $e(){return Ce}function Ge(e,t){e?pe("_lx_validcode",Ce=t):ge("_lx_validcode"),ne()}var He=["lxcuid","appnm","msid","wxid","scene","lch","utm","utm_source","utm_content","utm_medium","utm_term","utm_campaign","union_id","uuid","dpid","wxunionid"],ze=Date.now(),Ze=1,Ye=0,et=Date.now(),nt=undefined,rt=undefined,it=new Map,at=undefined,ot=undefined,ct={},st={},ut=!1,ft=[],lt=[],dt=!1,vt=0;function ht(){var e=this;St({keepNTag:!0}),he(e).then((function(){Ye=1,xt("init"),Ye=2,xt("set"),Ye=3,ne(),Be&&e.start(Be,!0);try{Ue&&Ue(m(!0,{},me(null,!0)))}catch(e){}})),e._opts={},e._config={autoUTM:!0},Ie=w()}var gt=ht.prototype;function pt(){Ye=2;var e=xt("set");Ye=3,e&&ne(),Ye=4,xt("data"),Ye=5}gt.init=function(e,t,n){try{var i=this,a=i._opts;if(Ye<1){Re=[e,t,n];var o=t.appnm;return void(t.appnm=o)}if(function(e){try{r.request({url:"https://report.meituan.com/wxapi/trackblk/wxapp/config",data:{appnm:e},success:function(t){var n=t.data;We=n.enable;var i=n.url;if(We&&i){var a=n.ver;if(Fe.ut){if(!(a>Fe.ut))return;Fe.ut=a}else Fe.ut=a;r.request({url:i,success:function(t){var n=t.data;n.app_name===e&&(Xe=n,r.setStorageSync("_lx_sdk_interceptData",n))},fail:function(e){re("data_intercept.js","lx-request-error",e.errMsg,!0),S(e.errMsg)}})}},fail:function(e){re("data_intercept.js","lx-request-error",e.errMsg,!0),S(e.errMsg)}})}catch(e){re("data_intercept.js","lx-getInterception-error",e.message,!0),S(e.message)}}(t.appnm),a.reportUrl)return;i._config=n=m(i._config||{},n),n.catMode&&function(e,t){if("domainReport"===t.catMode)z.url="https://catfront.dianping.com/api/log?v=1";else if(e&&"nginxReport"===t.catMode){var n=e.match(/^(https:\/\/)[^\/]+/);n&&(z.url=n[0]+"/lx-cat")}}(e,n),a.reportUrl=e;var c=t.appnm,s=t.category;c||S("没有设置应用标识（appnm）!"),s||(t.category=c),t.appnm=c,i._config.category=t.category,_(t||{},(function(e,t){if(!d(t)||undefined===e)return a[t];i.set(t,e),a[t]=e}))}catch(e){re("index.js","lx-api-error",e.message,!0),S(e.message)}},gt.onLoad=function(e){Ue=e},gt.setLch=function(e){if(Ye<2)return lt.push({type:"setLch",args:[e]});ot&&ot===e||(ot=e,!dt&&5<=Ye&&St(),this.set("lch",e))},gt.setUTM=function(e,t){if(Ye<2)return lt.push({type:"setUTM",args:[e,t]});if(e){var n=e||{},r=this.get("utm"),i=n.query||{},a=n.referrerInfo||{},o=["utm_source","utm_medium","utm_term","utm_content","utm_campaign"],c={};if("clear"===n&&!dt)return 5<=Ye&&St(),void ne();if(i&&_(o,(function(e){d(i[e])&&(c[e]=i[e])})),a.extraData){var s=a.extraData;if(d(s))try{s=JSON.parse(s)}catch(e){s={},re("index.js","lx-api-error",e.message,!0),S(e.message)}_(o,(function(e){d(s[e])&&(c[e]=s[e])}))}_(o,(function(e){d(n[e])&&(c[e]=n[e])}));var u=parseInt(n.scene);c.utm_source||isNaN(u)||1037!==u&&1038!==u||n.referrerInfo&&n.referrerInfo.appId&&(c.utm_source=n.referrerInfo.appId,c.utm_medium="otherApp"),0<Object.keys(c).length?(c.utm_source&&at!==c.utm_source&&(!dt&&5<=Ye&&St(),at=c.utm_source),t&&(c=m(!0,m(!0,{},r),c)),this.set("utm",c)):k("没有设置utm(站外来源)!")}},gt._autoSetUTM=function(e){if(Ye<2)return lt.push({type:"_autoSetUTM",args:[e]});this._config.autoUTM&&this.setUTM(e)},gt.set=function(e,t){if(Ye<2)return lt.push({type:"set",args:[e,t]});d(e)&&0!==e.replace(/(^\s*)|(\s*$)/g,"").length&&pe(e,t,!dt&&ne)},gt.get=function(e){return me(e)},gt.setTagWithCtx=function(e,t,n){if(t){if(Ye<2)return lt.push({type:"setTagWithCtx",args:[e,t,n]});var r=this;d(t)?J.push({ctx:e,key:t,val:n}):v(t)&&_(t,(function(t,n){r.setTagWithCtx(e,n,t)}))}},gt.setTag=function(e,t){if(Ye<2)return lt.push({type:"setTag",args:[e,t]});var n=getCurrentPages(),r=n[n.length-1];this.setTagWithCtx(r,e,t)},gt.setTagFromWV=function(e){try{if(!e)return;var t=JSON.parse(A.decode(e)),n=getCurrentPages(),r=n[n.length-2];this.setTagWithCtx(r,t)}catch(e){re("index.js","lx-api-error-setTagFromWV",e.message,!0),S(e.message)}},gt.clearTag=function(e){if(Ye<2)return lt.push({type:"clearTag",args:[e]});e?J.back(e):J.clear()},gt.getTag=function(e){var t=J.getAll();return d(e)?t[e]:t},O._show=function(e,t){wx.showModal({title:e,content:t})},gt.start=function(e,t){var n=this;if(t||!this._config.hasAs||dt)if(Ye<3)Be=e||{};else{if(Ye=1,Je=rt=undefined,l(wx.getEnterOptionsSync)){var r,i=wx.getEnterOptionsSync().referrerInfo;if(i&&i.extraData)r=i.extraData._lx_validcode;else try{var a=wx.getStorageSync("_lx_sdk_valid_info").split(","),o=+new Date,c=a[0];o<parseInt(a[1])+18e5?r=c:wx.removeStorageSync("_lx_sdk_valid_info")}catch(e){}if(r){Ge(!0,r);try{wx.setStorageSync("_lx_sdk_valid_info",[r,+new Date].join(","))}catch(e){}}}ve().then((function(t){var r=t.nativeEnv,i=t.nativeTag;t.fromCache||(ye(r),U(i)),e=v(e)?e:undefined,et=Date.now();var a=kt("AS",Ve=w(),e);a.isauto=6,n.send(a),pt()}))}else k("AS（应用启动）灵犀集成自动上报，请注释灵犀 start 接口调用！")},gt.quit=function(e){if(Ye<4)return ft.push({type:"quit",args:[e]});e=v(e)?e:{},e=m({duration:""+(Date.now()-et)},e),this._config.hasAq=!0;var t=kt("AQ",Ve,e);t.isauto=6,this.send(t)},gt.debug=function(e,t){ut=!!e;var n=(t=t||{}).code&&t.code.toString()||"";ut?/^\d{6,8}$/.test(n)&&Ge(!0,n):Ge(!1)},gt.pageView=function(e,t,n,r){var i=this,a=i._config;try{var o=function(){if(vt++,t=v(t)?t:{},a.query&&(t.custom?t.custom.__lxsdk_query=JSON.stringify(a.query):t.custom={__lxsdk_query:JSON.stringify(a.query)}),a.query="",Ne=Ie||null,Ie=w(),e)Je=rt,wt(rt=e);else{var o=getCurrentPages();if(o&&o.length){var c=o[o.length-1];c&&c.__route__&&(it.get(c.__route__)?e=it.get(c.__route__):(e=c.__route__,Je=rt,rt=e))}}a.hasPv=!0,nt=Date.now();var s=s=kt("PV",Ie,t);r&&bt(r,s),i.send(s,n)};if(Ye<4)return ft.push({type:"pageView",args:[e,t,n]});if(4===Ye)return o();Ye=1,ve().then((function(e){var t=e.nativeEnv;e.fromCache||ye(t),o(),pt()}))}catch(e){re("index.js","lx-api-error-pageView",e.message,!0),S(e.message)}},gt.pageDisappear=function(e,t){try{if(Ye<4)return ft.push({type:"pageDisappear",args:[e,t]});var n=this._config;if(!n.hasPv||!Ie)return void k("该页面没有上报PV(页面展示)事件，请确认!");e=v(e)?e:{},nt&&(e=m({duration:""+(Date.now()-nt)},e)),n.hasPd=!0;var r=kt("PD",Ie,e);this._config.autoPd?r.isauto=6:r.isauto=7,t&&bt(t,r),this.send(r),nt=undefined}catch(e){re("index.js","lx-api-error-pageDisappear",e.message,!0),S(e.message)}},gt.moduleView=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length?arguments[3]:void 0;try{if(Ye<4)return ft.push({type:"moduleView",args:[e,t,n]});if(Ke(e,n.cid))return;var i=kt("MV",Ie,t,e,n);this.precheck(i,n),r&&bt(r,i),this.send(i,n)}catch(e){re("index.js","lx-api-error-moduleView",e.message,!0),S(e.message)}},gt.systemCheck=function(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;try{if(Ye<4)return ft.push({type:"systemCheck",args:[t,n,r]});if(Ke(t,r.cid))return;var a=kt("SC",Ie,n,t);i&&bt(i,a),this.send(a,r)}catch(t){re("index.js","lx-api-error-systemCheck",e.message,!0),t(e.message)}},gt.moduleClick=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length?arguments[3]:void 0;try{if(Ye<4)return ft.push({type:"moduleClick",args:[e,t,n]});if(Ke(e,n.cid))return;var i=kt("MC",Ie,t,e,n);this.precheck(i,n),r&&bt(r,i),this.send(i,n)}catch(e){re("index.js","lx-api-error-moduleClick",e.message,!0),S(e.message)}},gt.moduleEdit=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length?arguments[3]:void 0;try{if(Ye<4)return ft.push({type:"moduleEdit",args:[e,t,n]});if(Ke(e,n.cid))return;var i=kt("ME",Ie,t,e,n);this.precheck(i,n),r&&bt(r,i),this.send(i,n)}catch(e){re("index.js","lx-api-error-moduleEdit",e.message,!0),S(e.message)}},gt.order=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;try{if(Ye<4)return ft.push({type:"order",args:[e,t,n,r]});if(Ke(e,r.cid))return;n=m(n||{},{order_id:t});var a=kt("BO",Ie,n,e,r);this.precheck(a,r),i&&bt(i,a),this.send(a,r)}catch(e){re("index.js","lx-api-error-order",e.message,!0),S(e.message)}},gt.pay=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;try{if(Ye<4)return ft.push({type:"pay",args:[e,t,n,r]});if(Ke(e,r.cid))return;n=m(n||{},{order_id:t});var a=kt("BP",Ie,n,e,r);this.precheck(a,r),i&&bt(i,a),this.send(a,r)}catch(e){re("index.js","lx-api-error-pay",e.message,!0),S(e.message)}},gt.precheck=function(e,t){if(t=t||{},this._config.quickReportOptions){var n=t.category,r=this._config.category;Le(e,{category:d(n)&&n||r})}e.lx_inner_data=m({},e.lx_inner_data||{}),e.lx_inner_data.cid_quality=t.cid?1:0},gt.send=function(e,t){var n=this._config,r=this._opts.reportUrl,i=(t=t||{}).category,a=this._config.category;if(!r)return S("Must config reportUrl!");if("MVL"===e.nm){var o=d(i)&&i||n.category;!function(e,t){if((t=v(t)?t:{}).mvlId&&t.evs){var n=t.mvlId,r=t.evs.val_lab||{};r._tm=t.evs.tm,r._seq=t.evs.seq,G[n]?G[n].evs.val_lab.mv_list.push(r):(t.evs.val_lab={mv_list:[r]},G[n]=t)}H||Y(e,"MVL")}(r,{category:o,mvlId:e.val_bid+e.req_id+o,evs:e})}else d(i)?Qe===i||pe("category",Qe=i,ne):Qe&&(Qe=undefined,pe("category",a,ne)),function(e,t){if(F||(F=T(X)||[])&&F.length&&(Q=!0,Z(e,K=F)),t){var n=K[K.length-1],r=t.nm;switch(n.evs.push(t),r){case"PD":case"AQ":K=K.concat(ee()),$=[],"AQ"===r&&b(X,K),Q&&(clearTimeout(Q),Q=null),Z(e,K,r);break;case"BO":case"BP":Q&&(clearTimeout(Q),Q=null),Q=!0,Z(e,K,"PD");break;default:Q||Y(e)}}}(r,e)},gt.presetGeolocation=function(e,t){var n=parseFloat(e),r=parseFloat(t);return n&&(ct.lng=n),r&&(ct.lat=r),this},gt.resetGeolocation=function(e,t){var n=parseFloat(e),r=parseFloat(t);n&&(st.lng=n),r&&(st.lat=r)},gt.getValidationState=function(){return Promise.resolve().then((function(e){var t=$e();return{validating:!!me("_lx_validcode"),code:t}}))};var _t=function(){var e={};return rt&&(e.val_cid=rt),Ie&&(e.req_id=Ie),1<vt&&Ne&&(e.refer_req_id=Ne),e};gt.sendEvsAsyncBefore=_t,gt.sendEvsAsycBefore=_t;var mt=function(e,t){if(!v(t)||!v(e))return!1;var n;switch(""+t.nm.toUpperCase()){case"MC":n=kt("MC",Ie,t.valLab,t.valBid,t.options,e);break;case"MV":n=kt("MV",Ie,t.valLab,t.valBid,undefined,e);break;case"ME":n=kt("ME",Ie,t.valLab,t.valBid,undefined,e);break;case"BO":t.valLab=m(t.valLab||{},{order_id:t.orderId}),n=kt("BO",Ie,t.valLab,t.valBid,undefined,e);break;case"BP":t.valLab=m(t.valLab||{},{order_id:t.orderId}),n=kt("BP",Ie,t.valLab,t.valBid,undefined,e);break;default:return}this.send(n)};gt.sendEvsAsyncAfter=mt,gt.sendEvsAsycAfter=mt,gt.moduleViewList=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length?arguments[3]:void 0;try{if(Ye<4)return ft.push({type:"moduleViewList",args:[e,t]});if(Ke(e,n.cid))return;if(!e||!d(e))return;var i=kt("MVL",Ie,t,e);this.precheck(i,n),r&&bt(r,i),this.send(i,n)}catch(e){re("index.js","lx-api-error-moduleViewList",e.message,!0),S(e.message)}},gt.appLifeCycleInterceptor=function(){var e=this;return function(t){return ke(e,t)}},gt.pageLifeCycleInterceptor=function(){var e=this;return function(t){return be(e,t)}},gt.overrideApp=function(e){return function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];try{var n=function(t){t=ke(e,t),we(t)};return t&&we&&(App=n),n.OriginApp=we,n}catch(e){re("index.js","lx-api-error",e.message,!0),S(e.message)}}(this,e)},gt.overridePage=function(e){return function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];try{var n=function(t){t=be(e,t),Te(t)};return t&&Te&&(Page=n),n.OriginPage=Te,n}catch(e){re("index.js","lx-api-error",e.message,!0),S(e.message)}}(this,e)},gt.setCanaryReleaseVersion=function(e){e&&this.set("canary_release",e+"")},gt.setURLEnv=function(e){var t=me(),n=me(null,!0),r=[];_(He,(function(e){var i=t[e]||n[e];i&&("utm"===e&&v(i)?_(i,(function(e,t){t&&r.push("".concat(t,":").concat(e))})):r.push("".concat(e,":").concat(i)))}));var i=n.sdk_env;r.push("".concat("sdk_env",":").concat(i||"online"));var a=$e();a&&r.push("v:".concat(a));var o=(e||{}).withEnvKeys||[];g(o)&&0<o.length&&_(o,(function(e){e&&d(me(e))&&(He[e]||r.push("".concat(e,":").concat(A.encode(me(e)))))})),r=A.encode(r.join(";"));var c=J.getAll();if(c){var s=JSON.stringify(c);if("{}"!==s){var u=A.encode(s);u.length<5e3&&(r=r+"&_lx_tag="+u)}}return r+"&_lx_ver=2.9.1-beta.1"},gt.collectParamsToWeb=gt.setURLEnv,gt.dev=function(e){fe=e?"offline":"online",O.hasBuiltRTTEnv?(ce.rtt_env.sdk_env=fe,_e()):(ce.sdk_env=fe,ne())},gt.updateQuickConfig=function(e){v(e)&&(this._config.quickReportOptions=e||null,b("quickOptions",e||{}),function(e){e=e||T("quickOptions"),v(Me=e.quickReport||{})&&(g(Me.envInfo)&&_(Me.envInfo,(function(e){-1===Pe.indexOf(e)&&Pe.push(e)})),g(Me.evsInfo)&&_(Me.evsInfo,(function(e){-1===Ae.indexOf(e)&&Ae.push(e)}))),setInterval((function(){De(Oe,1),Oe=[]}),500)}(this._config.quickReportOptions))};var yt=new ht;function xt(e){var t=!1;return dt=!0,"init"===e&&Re&&(yt.init.apply(yt,Re),Re=undefined),"set"===e&&(t=!!lt.length,_(lt,(function(e){var t=e.type,n=e.args;yt[t]&&yt[t].apply(yt,n)})),lt=[]),"data"===e&&(_(ft,(function(e){var t=e.type,n=e.args;yt[t]&&yt[t].apply(yt,n)})),ft=[]),dt=!1,t}function St(e){var t=e||{},n=t.keepTagSF,r=t.keepNTag;Ze=1,qe=0,pe("msid",function(){var e=[],t=h();return e.push(t.toString(16)),e.push(x()),e.push(x()),e.push(x()),e.join("-")}()),ge("utm"),ge("oaid"),ge("sunion_id"),ge("tc"),ge("tn"),ge("lch"),at=undefined,!n&&J.clear(r)}function kt(e,t,n,r,i,a){i=i||{};try{18e5<h()-ze&&(St({keepTagSF:!0}),ne()),ze=h();var c={nm:e,tm:h(),nt:o?4:3,seq:Ze++,isauto:7,req_id:t};if(c=m((c=m(c||{},st))||{},ct),ct={},d(i.cid))c.val_cid=i.cid;else{var s=getCurrentPages();if(s&&s.length){var u=s[s.length-1];u&&u.__route__&&(c.val_cid=it.get(u.__route__)?it.get(u.__route__):u.__route__)}}if(Je!==rt&&rt!==c.val_cid&&"PV"===e?(c.val_ref=rt,rt=c.val_cid):c.val_ref=Je,n){"PV"===e&&(n.poi_id&&n.poi_id,n.deal_id&&n.deal_id);var f=JSON.stringify(n).length;5e3<=f&&(n={overlen_cutoff:1,overlen_length:f}),c.val_lab=n}r&&(c.val_bid=r),("AQ"===e||1<vt&&Ne)&&(c.refer_req_id=Ne);var l=J.getAll();return l&&(c.tag=l),a&&(c=m(c||{},a),a.refer_req_id||delete c.refer_req_id,a.val_ref||delete c.val_ref),c.lx_inner_data=m({},function(e){return e?xe[e]:xe}()||{}),"PV"!==e&&"AQ"!==e||Fe.cnt&&(c.lx_inner_data.dc_cnt=JSON.parse(JSON.stringify(Fe)),Fe.cnt=0,Fe.list={cid:[],bid:[],bid_null:0}),c}catch(e){re("index.js","lx-api-error",e.message,!0),S(e.message)}}function wt(e){var t=getCurrentPages(),n="";t&&t.length&&t[t.length-1]&&(n=t[t.length-1].__route__||"");e?it.set(n,e):it.set(n,n)}function bt(e,t){try{if(!e||!l(e))return;var n=JSON.parse(JSON.stringify(me("",!0))),r=JSON.parse(JSON.stringify(t));n.evs=r,e(n,r)}catch(e){re("index.js","lx-function-error-execCallBack",e.message,!0),S(e.message)}}gt.setCurrentCid=function(e){e?(Je=rt,wt(rt=e)):S("调用setCurrentCid方法请必传cid参数")},module.exports=yt;