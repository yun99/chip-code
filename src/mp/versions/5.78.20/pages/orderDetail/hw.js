var e=Object.create,t=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,d=(e,r,a)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,c=(e,t)=>{for(var r in t||(t={}))l.call(t,r)&&d(e,r,t[r]);if(i)for(var r of i(t))u.call(t,r)&&d(e,r,t[r]);return e},p=(e,t)=>r(e,s(t)),m=e=>t(e,"__esModule",{value:!0}),g=r=>((e,r,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let i of o(r))l.call(e,i)||"default"===i||t(e,i,{get:()=>r[i],enumerable:!(s=a(r,i))||s.enumerable});return e})(m(t(null!=r?e(n(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),y=(e,t,r)=>new Promise(((a,s)=>{var o=e=>{try{n(r.next(e))}catch(e){s(e)}},i=e=>{try{n(r.throw(e))}catch(e){s(e)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,i);n((r=r.apply(e,t)).next())}));((e,r)=>{for(var a in m(e),r)t(e,a,{get:r[a],enumerable:!0})})(exports,{default:()=>v});var f=g(require("../../ob.js")),_=g(require("../../sn.js")),h=g(require("../../u8.js")),x=g(require("./g6.js")),I=g(require("./gc.js")),b=g(require("./p9.js")),{formatTime:S}=require("../../p0.js"),T=getApp(),D=e=>({title:e.left,rightStyle:"text-align: left",children:[{text:e.right}]}),k=e=>({title:"下单编号",rightStyle:"text-align: left",children:[{text:e.orderId,style:"display: inline-block"},{btn:"复制",style:"\n            display: inline-flex;\n            ",customClass:"copy",action:"toCopy",args:{text:e.orderId}}]}),P=e=>({title:"拼团信息",topStyle:"margin: 6rpx 0;",rightStyle:"text-align: right",children:[{action:"gotoGroupDetail",style:"display: inline-flex;\n                        align-item: center;\n                ",children:[{text:e.longStatusDesc||"",style:"display: inline-block;\n                                color: #FF5E24;\n                                font-family: PingFangSC-Medium;\n                                font-weight: 500;\n                                font-size: 28rpx;\n                                "},{img:"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/order_detail_group_arrow.38261030.png",style:"display: inline-block;\n                                width: 20rpx;\n                                height: 20rpx;\n                                "}]}]}),v=class{constructor(e){this.orderDetail=e,this.timeLoop=null}mapTempData(e){const{status:t,groupBasicVO:r,groupStatus:a,detailStatusView:{detailButton:s=[]}={},orderId:o,orderDelivery:i,remark:n=""}=e,l=[];var u;if(l.push({type:"cardStatus"}),!(null==i?void 0:i.distributionInfo)||0===(null==i?void 0:i.distributionInfo.displayMapFlag)||(0,h.isMTTiny)()||(0,h.isMTTurbo)()||(0,h.isAppTiny)()||l.push({type:"distributionInfo"}),(a.isGrouping||a.isSuccess)&&l.push({type:"groupInfo",data:[P(r)]}),e.orderDelivery&&l.push({type:"selfLiftInfo"}),e.prices&&l.push({type:"sku",data:e.prices.map(((t,r)=>((e,t,r)=>({title:e.name,leftStyle:"width:140rpx;color: #121924;",rightStyle:"flex: initial",topStyle:`justify-content: space-between;\n    ${0===t?"margin-top:12rpx;":""}\n    ${t!==r-1?"margin-bottom:-10rpx;":""}\n    ${t===r-1?"margin-bottom:15rpx;":""}\n    `,children:[{text:e.priceString,style:e.price<0?"color: #F20000;":""}]}))(t,r,e.prices.length)))}),e.backCoupons&&e.backCoupons.content&&l.push({type:"normal",data:[(u=e.backCoupons,{title:u.title,leftStyle:"color: #121924;",style:"padding: 24rpx 0;",children:[{text:u.content,style:"display: inline-block;color:#FF1929;",action:"toggleCouponBack",args:{show:!0}},{img:"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/orderDetailSanjiao2.c935514.png",style:"width: 20rpx;\n            height: 20rpx;\n            display: inline-block;"}]})]}),e.orderId){const r=S(new Date(e.orderTime)).replace(/-/g,"/"),a=[k(e),D({left:"下单时间",right:r})];n&&(T.$lxLog.mv("b_youxuan_dzcdr4cy_mv",{order_st:t}),a.push(D({left:"订单备注",right:n}))),e.detailStatusView.status!==x.ORDER_STATUS.WAIT_PAY&&e.payType&&a.push(D({left:"支付方式",right:e.payType.name})),l.push({type:"orderInfo",data:a,title:{title:"订单信息",right:{}}})}e.questionList&&e.questionList.length&&(e.questionList=[]);const d=s.find((({type:e})=>1===e));return t===x.ORDER_STATUS.WAIT_PAY&&d&&l.push({type:"normal",data:[{style:"padding: 27rpx 0;",leftStyle:"width:0;margin:0;",rightStyle:"text-align: center;",children:[{text:d.name,style:"\n                                font-family: PingFangSC-Regular;\n                                font-size: 30rpx;\n                                color: rgba(0,0,0,0.70);\n                                font-weight: 400;\n                                line-height: 42rpx;\n                                ",action:"toOperateOrder",args:{detail:{orderId:o,btnType:1,phone:"",extractInfo:"{}"}}}]}]}),l}getOrderInfoBtnType(e,t,r=null){const a={order_id:e,sku_id:t.skuId,poi_id:T.$poiId,poiIdStr:T.$poi.getPoiIdStr()},s=r||t.reverseButton;switch(s.type){case 1:return{bid:"b_youxuan_mq3gufqc_mv",lxParams:a,text:s.name,onTap:()=>{T.$lxLog.mc("b_youxuan_mq3gufqc_mc",a),T.$router.goto("/subPackages/refund/pages/detail/index",{orderId:e,stackId:t.stackId})}};case 2:return{bid:"b_youxuan_ikfp8ze8_mv",lxParams:a,text:s.name,onTap:()=>{T.$lxLog.mc("b_youxuan_ikfp8ze8_mc",a),this.applyRefund({orderId:e,sku:t,secondButton:r,lxParams:a})}};case 3:case 4:return s.secondButton=s.secondButton.map((r=>c(c({},r),this.getOrderInfoBtnType(e,t,r)))),{lxParams:a,text:s.name,onTap:()=>{T.$lxLog.mv("b_youxuan_r1kftg7a_mv",{order_id:e}),this.orderDetail.setData({showSkuOperatePop:!0,skuOperatePopData:s})}};case 5:return{onTap:()=>{T.$lxLog.mc("b_youxuan_sqjek5wr_mc",{order_id:e}),T.$router.goto("igrocery://www.grocery.com/insuranceDetail",{stackId:t.stackId,orderId:e,skuId:t.skuId})}}}}applyRefund(e){return y(this,arguments,(function*({orderId:e,sku:t,secondButton:r,lxParams:a}){try{r&&T.$lxLog.mc("b_youxuan_zb7xd4io_mc",a);const s=r||t.reverseButton;let o={};try{o=JSON.parse(s.extractInfo||"{}")}catch(e){f.log.warn(`<OrderDetail applyRefund> 级按钮extractInfo非法, ${s.extractInfo}`,e)}const i={orderId:e,reverseComputeItemList:[{quantity:t.count,skuId:t.skuId,stackId:t.stackId}],hasShowRefundStay:!1};this.orderDetail.loading(!0);try{const r={order_id:e,sku_list:t.skuId},a={orderId:e,skuId:t.skuId,stackId:t.stackId,refundApplyPageSource:2,refundApplyType:2};(yield T.$order.refundApplyVerify({reqParams:a,mvBid:"b_youxuan_sbdvo91k_mv",lxParams:r,onTapBtn:({type:e,buttonText:t,jumpType:a,title:s,contentText:o})=>(T.$lxLog.mc("ok"===e?"b_youxuan_tp28v257_mc":"b_youxuan_yjeux6n3_mc",c({button_name:t},r)),a===x.REFUND_BUTTON_JUMP_TYPE.CALL_GROUP_HEADER?(this.orderDetail.onContactGroupHeader(),null):a===x.REFUND_BUTTON_JUMP_TYPE.REFUND_APPLY_PAGE?i:void 0)}))&&T.$router.goto("/subPackages/refund/pages/apply/index",i)}catch(r){f.log.warn("<OrderDetail applyRefund> 开始执行旧版申请退款逻辑",r),this.applyRefundOld({orderId:e,sku:t,btn:s,extractInfo:o,lxParams:a})}}catch(e){this.orderDetail.toast("网络异常，请稍后重试"),f.log.error("<OrderDetail applyRefund> 申请退款失败",e)}finally{this.orderDetail.loading(!1)}}))}applyRefundOld(e){return y(this,arguments,(function*({orderId:e,sku:t,btn:r,extractInfo:a,lxParams:s}){if([3,7,10,20].includes(a.status))3===a.status&&T.$lxLog.mv("b_youxuan_54a6m94p_mv",s),this.orderDetail.alert({title:null==a?void 0:a.title,message:null==a?void 0:a.subTitle,customContentStyle:"text-align: center",zIndex:101,textOK:"知道了",ok:()=>{3===a.status&&T.$lxLog.mc("b_youxuan_j5ia2xei_mc",s)}});else if(2===a.status){this.orderDetail.loading(!0);const r={orderId:e,reverseComputeItemList:[{quantity:t.count,skuId:t.skuId,stackId:t.stackId}],hasShowRefundStay:!1};b.getRefundStayInfo({skuId:t.skuId,orderId:e,type:"detail"}).then((e=>{this.orderDetail.loading(!1),r.hasShowRefundStay=e.stay,e.stay?this.orderDetail.toggleRefundStayPop({skuId:t.skuId,message:e.message,routerParams:r}):T.$router.goto("/subPackages/refund/pages/apply/index",r)})).catch((e=>{this.orderDetail.loading(!1),this.orderDetail.toast(`${e.message||"网络异常，请重试"}`)}))}else if(6===a.status)T.$lxLog.mv("b_youxuan_osyfmp9e_mv",{order_id:e}),this.orderDetail.toggleBuyFreePopShow(),this.orderDetail.alert({title:null==a?void 0:a.title,message:null==a?void 0:a.subTitle,zIndex:101,textOK:"知道了",ok:()=>{T.$lxLog.mc("b_youxuan_cl961auh_mc",{order_id:e}),this.orderDetail.toggleBuyFreePopShow()}});else if(8===a.status)if(this.orderDetail.refundWithHeader(),this.orderDetail.data.orderInfo.showIM){T.$lxLog.mv("b_youxuan_3jp2a156_mv",{order_id:e});const t=[{pic:I.Images.order_phone_guard,btn_icon:I.Images.order_phone_gray,btn_text:"电话联系"},{pic:I.Images.order_IM_guard,btn_icon:I.Images.order_IM_gray,btn_text:"在线联系"}],s=r.buttonTipsList.map((e=>1===e.btnTipsType?c(c({},e),t[0]):c(c({},e),t[1])));this.orderDetail.setData({showLookforIM:!0,lookforGroupHeader:{title:a.title,btns:s}})}else T.$lxLog.mv("b_youxuan_x38i7tqd_mv",{order_id:e}),this.orderDetail.confirm({title:a.title,message:a.subTitle,customContentStyle:"text-align: center",zIndex:101,textCancel:"取消",textOK:"联系团长",ok:()=>{T.$lxLog.mc("b_youxuan_2ou3vhsv_mc",{order_id:e}),this.orderDetail.onContactGroupHeader(),this.orderDetail.refundWithHeader()},cancel:()=>{T.$lxLog.mc("b_youxuan_yh6xluom_mc",{order_id:e}),this.orderDetail.refundWithHeader()}});else 11===a.status?this.orderDetail.alert({title:null==a?void 0:a.title,message:null==a?void 0:a.subTitle,zIndex:101,textOK:"知道了",ok:()=>{this.orderDetail.toggleBuyFreePopShow()}}):12===a.status&&this.orderDetail.confirm({title:null==a?void 0:a.title,message:null==a?void 0:a.subTitle,zIndex:101,textCancel:"取消",textOK:"联系客服",ok:()=>{a.url&&T.$router.goto(a.url)}})}))}mapOrderInfo(e){var t,r;const{detailStatusView:{status:a=0}={},groupBasicVO:s}=e,o=[];return(e.orderDetailItemList||[]).forEach((t=>{o.push(p(c({},t),{skuCutlinePrice:t.dashSellPrice||0,extraBtn:t.reverseButton?this.getOrderInfoBtnType(e.orderId,t):null,orderSkuItemType:1===e.type?"group":"",notCanJump:6===t.itemSkuType})),t.giftInfo&&o.push(p(c({},t.giftInfo),{orderSkuItemType:1===e.type?"group":"",isGift:!0}))})),(e.tradingItemList||[]).forEach((e=>{o.push(p(c({},e),{skuId:e.tradingItemId,skuName:e.name,notCanJump:!0,isVip:!0}))})),p(c({},e),{orderPoiId:e.poiIdStr||e.poiId,status:a,cashPay:(0,_.formatMoney)(e.cashPay).replace("￥",""),skus:o,groupStatus:T.$order.getGroupStatus(a,s),showIM:null==(r=null==(t=e.orderDelivery)?void 0:t.groupHeaderInfo)?void 0:r.showGroupHeaderOnline})}mapStatusCard(e){const{status:t,detailStatusView:{detailTitle:r="",detailSubTitle:a=""}={},orderDelivery:{deliveryTimeDesc:s=""}={},remainPayTime:o,groupStatus:i,orderStatusProcessInfo:n={}}=e,l={_subCls:"",title:[r],subtitle:"",pic:"",processInfo:n.orderStatusNodeList||[]};if(clearInterval(this.timeLoop),![x.ORDER_STATUS.UNKNOWN,x.ORDER_STATUS.WAIT_PAY].includes(t)){const e=/<time>([\s\S]*)<\/time>/;l.subtitle=this.getSubTitle(a.replace(e,`${this.getSubTitle("$1","orange")}`),e.test(a)?"balck":"gray")}switch(t){case x.ORDER_STATUS.UNKNOWN:case x.ORDER_STATUS.WAIT_PAY:l.pic="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/order_detail_status_waiting.1f4f1041.png",null!=o&&(e.remainPayTime=10*o,l.title.push(this.getRemainPayDesc(e.remainPayTime)),this.loopUpdateStatusTitle());break;case x.ORDER_STATUS.GOODS_PREPARING:case x.ORDER_STATUS.WAIT_PICK_UP:case x.ORDER_STATUS.GRID_STATION_IN_DELIVERY:case x.ORDER_STATUS.DRIVER_DELIVERED_POI:case x.ORDER_STATUS.REFUNDING:case x.ORDER_STATUS.REFUND_APPLY:l.pic="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/order_detail_status_doing.1a281038.png",t===x.ORDER_STATUS.DRIVER_DELIVERED_POI&&(l.subtitle=this.getSubTitle(a,"orange"));break;case x.ORDER_STATUS.COMPLETE:l.pic="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/order_detail_status_success.b3dc1039.png";break;case x.ORDER_STATUS.REFUND_SUCESS:case x.ORDER_STATUS.CANCEL:l.pic="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/order_detail_status_close.4c7d1037.png"}return i.groupId&&((i.isSuccess||i.isGrouping||i.isFail)&&(l.title=[i.shortStatusDesc||r]),i.isFail&&(l.pic="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/order_detail_status_error.2cab1042.png")),l}getSubTitle(e,t="gray"){return`<span class="${t}" style="color: ${{gray:"#7F7F7F",black:"#191919",red:"#F20000",orange:"#FF6000"}[t]};">${e}</span>`}mapBtn(e){const{detailStatusView:{detailButton:t=[]}={},groupStatus:r}=e;let a=4;f.log.info(`<OrderDetail mapBtn> 获取到的服务端下发的按钮信息为 ${JSON.stringify(t)}`),t.some((e=>2===e.type))&&(a=3);const s=t.map(((e,r)=>{let s="",o="",i=!0;return[2,12,17,24].includes(e.type)&&(s="primary",o="btn-primary",i=!1),p(c({},e),{more:!!(t.length>a&&r>=a-1),_btnStyle:s,_btnClass:o,_isPlain:i})}));return f.log.info(`<OrderDetail mapBtn> 处理后的按钮信息为 ${JSON.stringify(s)}`),{btns:s,maxLength:a,hasMore:s.length>a}}loopUpdateStatusTitle(){this.timeLoop=setInterval((()=>{const{orderInfo:e,statusCard:t}=this.orderDetail.data,{remainPayTime:r}=e;let a;r>0?a=r-1:clearInterval(this.timeLoop),t.title[1]=r?this.getRemainPayDesc(r):"已过期",this.orderDetail.setData({statusCard:t,"orderInfo.remainPayTime":a})}),100)}getRemainPayDesc(e){const t=parseInt(""+e/36e3,10),r=parseInt(""+e%36e3/600,10),a=Math.floor(e%600/10),s=e%600%10;if(0===t&&0===r&&a<1)return"已过期";const o=t<10?`0${t}`:t,i=r<10?`0${r}`:r,n=a<10?`0${a}`:a;return t<1?`请在${this.getSubTitle(`${i}:${n}.${s}`,"red")}内完成支付`:`请在${this.getSubTitle(`${o}:${i}:${n}`,"red")}内完成支付`}};