var e=Object.create,t=Object.defineProperty,i=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,s=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(e,i,r)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,d=(e,t)=>{for(var i in t||(t={}))n.call(t,i)&&l(e,i,t[i]);if(a)for(var i of a(t))o.call(t,i)&&l(e,i,t[i]);return e},u=a=>{return((e,a,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let o of r(a))n.call(e,o)||"default"===o||t(e,o,{get:()=>a[o],enumerable:!(s=i(a,o))||s.enumerable});return e})((o=t(null!=a?e(s(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0}),t(o,"__esModule",{value:!0})),a);var o},c=u(require("../../jc.js")),f=u(require("./ng.js")),h=u(require("../../ob.js")),m=getApp(),{convertRpxToPx:p,isMMP:g}=require("../../p0.js");(0,c.defineComponent)(new class{constructor(){this.ready=function(){const{orderStatus:e,selfLiftInfo:t,distributionInfo:i}=this.data;if(h.log.info(`司机配送信息：订单状态为${e}, 司机位置信息为${JSON.stringify(i)}`),this.arrived=2===(null==i?void 0:i.displayMapFlag),t){const e={latitude:t.latitude,longitude:t.longitude};let r=null;!this.arrived&&i&&i.distance&&i.latitude&&i.longitude&&(r={latitude:i.latitude,longitude:i.longitude}),this.setData({selfLiftCoords:e,selfLiftMarkers:this.getSelfLiftMarkers(e),driverCoords:r}),this.initMap(),r&&!this.arrived&&(g()?this.setData({driverMarkers:this.getDriverMarkers(r)},(()=>{this.includePoints()})):(this.initDrawController(),this.setData({driverDrawConfig:this.getDriverDrawConfig(i.distance)},(()=>{setTimeout((()=>{this.commonData.posterController.create()}),300)})))),m.$lxLog.mv("b_youxuan_ytgh5hbs_mv")}},this.methods={initMap(){this.mapCtx=wx.createMapContext("distribution-map",this)},initDrawController(){const{driverCoords:e}=this.data;this.commonData.posterController=new f.CanvasDrawController(this,"order-detail-map-driver"),this.commonData.posterController.onCreateSuccess((t=>{this.commonData.driverInfoPic=t,this.setData({driverMarkerPic:t,driverMarkers:this.getDriverMarkers(e)},(()=>{this.includePoints()}))})),this.commonData.posterController.onCreateFail((t=>{this.setData({driverMarkers:this.getDriverMarkers(e)},(()=>{this.includePoints()}))}))},getSelfLiftMarkers(e){const t=[];return t.push(d({id:0,width:p(42),height:p(42),iconPath:"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/map_selfLift_marker.9ae4995.png"},e)),t.push(d({id:1,width:p(this.arrived?306:222),height:p(116),iconPath:this.arrived?"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/map_selfLift_arrived_bubble.a413996.png":"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/map_selfLift_bubble.3577998.png"},e)),t},getDriverMarkers(e){const t=[],i=d({id:2,width:p(42),height:p(42),iconPath:"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/map_driver_marker.9d6b992.png"},e);if(t.push(i),this.commonData.driverInfoPic)t.push(d({id:3,width:p(328),height:p(148),iconPath:"https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/map_driver_bubble.ddb5994.png"},e)),t.push(d({id:4,width:p(328),height:p(148),iconPath:this.commonData.driverInfoPic,zIndex:4},e));else{const{distributionInfo:e}=this.data;i.callout={display:"ALWAYS",content:`司机配送中\n距离${e.distance}`,color:"#191919",fontSize:p(28),padding:p(18),bgColor:"#fff",borderRadius:p(18),textAlign:"center",zIndex:10,anchorY:p(18)}}return t},getDriverDrawConfig:(e="0")=>({canvasWidth:328,canvasHeight:148,backgroundColor:"rgba(255,255,255,0)",debug:!1,filter:!0,pixelRatio:2,texts:[{name:"司机配送中",display:!0,x:164,y:45,width:328,lineHeight:40,fontFamily:"PingFangSC-Medium",fontSize:28,fontWeight:"500",color:"#191919",baseLine:"middle",textAlign:"center",text:"司机配送中",lineNum:1,zIndex:1},{name:"距离",display:!0,x:(128-6*e.length)/2,y:94,width:328,text:[{name:"距离自提点",display:!0,text:"距离自提点",lineHeight:40,fontFamily:"PingFangSC-Regular",fontSize:28,fontWeight:"400",color:"#7f7f7f",baseLine:"middle"},{name:"KM",display:!0,text:`${e}`,lineHeight:40,fontFamily:"PingFangSC-Medium",fontSize:28,fontWeight:"500",color:"#FF6000",baseLine:"middle"}]}]}),setMarkers(){const e=[...this.data.selfLiftMarkers,...this.data.driverMarkers];this.mapCtx.addMarkers({markers:e,success:()=>{this.includePoints()}})},includePoints(){const e=[...this.data.selfLiftMarkers,...this.data.driverMarkers],t=e.map((({longitude:e,latitude:t})=>({longitude:e,latitude:t}))),i=`${p(164)}`,r=`${p(164)}`,a=`${p(10)}`,s=`${p(164)}`;let n=[i,r,a,s];g()&&(n=[s,r,i,a]),this.mapCtx.includePoints({points:t,padding:n}),this.setData({markers:e,points:t})},onTapMap(){m.$lxLog.mc("b_youxuan_ytgh5hbs_mc")}},this.properties={canShow:{type:Boolean,value:!0},selfLiftInfo:{type:Object,value:null},distributionInfo:{type:Object,value:null},orderStatus:{type:Number,value:0}},this.data={selfLiftCoords:null,driverCoords:null,markers:[],points:[],selfLiftMarkers:[],driverMarkers:[],driverDrawConfig:{},driverMarkerPic:""},this.commonData={posterController:{},driverInfoPic:""}}created(){this.mapCtx=null,this.arrived=!1,this.commonData={posterController:{},driverInfoPic:""}}});