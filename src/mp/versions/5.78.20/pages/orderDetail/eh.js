var t=Object.create,e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,u=a=>{return((t,a,i)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let n of r(a))d.call(t,n)||"default"===n||e(t,n,{get:()=>a[n],enumerable:!(i=s(a,n))||i.enumerable});return t})((i=e(null!=a?t(o(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0}),e(i,"__esModule",{value:!0})),a);var i},p=u(require("../../jc.js")),h=u(require("./p9.js")),m=getApp();(0,p.defineComponent)({properties:{show:{type:Boolean,value:!0},orderId:{type:String},poiId:{type:String},poiIdStr:{type:String},satisfied:{type:Object,observer(t){var e,a,s;if(null==(e=null==t?void 0:t.questions)?void 0:e[0]){const e=null==(s=null==(a=null==t?void 0:t.questions)?void 0:a[0])?void 0:s.index;this.setData({currentIndex:e||(0===e?0:-1)})}}},isAndroid:Boolean},data:{currentIndex:-1,selected:{},selectData:{},num:0},observers:{currentIndex(t){-1!==t&&this.oldVal!==t&&(this.oldVal=t,this.setData({containerStyle:"",num:this.data.num+1}),this.mv(t))}},ready(){this.remark={}},methods:{genLxParams(t){const e=this.data.satisfied.questions.find((e=>e.index===t));return{order_id:this.data.orderId,toast_type:{1:"B/B类问题弹窗",3:"A1/A类问题评分弹窗",2:"A2/A类问题原因弹窗"}[e.type]}},mv(t){m.$lxLog.mv("b_youxuan_a7myeyao_mv",this.genLxParams(t))},selectMc(t){m.$lxLog.mc("b_youxuan_fcejo4k0_mc",this.genLxParams(t))},submitMc(t){m.$lxLog.mc("b_youxuan_eip0d56p_mc",this.genLxParams(t))},closeMc(t){m.$lxLog.mc("b_youxuan_t7k302wz_mc",this.genLxParams(t))},close(){this.closeMc(this.data.currentIndex),this.triggerEvent("cancel")},onChangeStyle(t){this.setData({containerStyle:t.detail||""})},changeSelect(t){var e,a;const{index:s,item:i}=t.detail;this.selectMc(s);const r=this.data.satisfied.questions.find((t=>t.index===s));1===r.type||3===r.type?(this.data.selectData[s]=i,this.setData({selectData:this.data.selectData},(()=>{i.nextQuestion&&this._gotoNext(s,i.nextQuestion)}))):(this.data.selectData[s]||(this.data.selectData[s]={type:"multi"}),this.data.selectData[s][i.code]?(this.remark[s]||(this.remark[s]={}),this.remark[s][i.code]=this.data.selectData[s][i.code].remark,this.data.selectData[s][i.code]=null):this.data.selectData[s][i.code]={remark:(null==(a=null==(e=this.remark)?void 0:e[s])?void 0:a[i.code])||""},this.setData({selectData:this.data.selectData}))},input(t){const{index:e,code:a,remark:s}=t.detail,i=this.data.selectData[e];"multi"===i.type&&(i[a].remark=s),this.setData({selectData:this.data.selectData})},nextStep(){const t=this.data.satisfied.questions.find((t=>t.index===this.data.currentIndex)),e=Object.keys(this.data.selectData[this.data.currentIndex]).filter((t=>"type"!==t&&!!this.data.selectData[this.data.currentIndex][t])).map((e=>t.options.find((t=>t.code===+e))));e.length&&this._gotoNext(this.data.currentIndex,e[0].nextQuestion)},_gotoNext(t,e){this.data.selected[t]=!0,this.setData({currentIndex:e,selected:this.data.selected})},submit(){return t=this,e=null,s=function*(){const t=[];this.submitMc(this.data.currentIndex);const{selectData:e}=this.data;Object.keys(e).map((s=>{const r=this.data.satisfied.questions.find((t=>t.index===+s)),o=e[s];"multi"===o.type?Object.keys(o).filter((t=>"type"!==t&&!!o[t])).map((t=>{return e=((t,e)=>{for(var a in e||(e={}))d.call(e,a)&&l(t,a,e[a]);if(n)for(var a of n(e))c.call(e,a)&&l(t,a,e[a]);return t})({},r.options.find((e=>e.code===+t))),s={remark:o[t].remark},a(e,i(s));var e,s})).forEach((e=>{t.push({index:+s,code:e.code,remark:e.remark||""})})):t.push({index:+s,code:o.code,remark:o.remark||""})}));try{const e=yield h.satisfiedSubmit(this.data.orderId,{answers:t},{poi:m.$poiId||this.data.poiId,poiIdStr:m.$poi.getPoiIdStr()||this.data.poiIdStr});getApp().page().toast(e.msg),this.triggerEvent("cancel")}catch(t){getApp().page().toast(t.message||"提交失败，请稍后重试")}},new Promise(((a,i)=>{var r=t=>{try{o(s.next(t))}catch(t){i(t)}},n=t=>{try{o(s.throw(t))}catch(t){i(t)}},o=t=>t.done?a(t.value):Promise.resolve(t.value).then(r,n);o((s=s.apply(t,e)).next())}));var t,e,s}}});