var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,s=e=>t(e,"__esModule",{value:!0}),i=i=>((e,n,s)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let i of o(n))a.call(e,i)||"default"===i||t(e,i,{get:()=>n[i],enumerable:!(s=r(n,i))||s.enumerable});return e})(s(t(null!=i?e(n(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);((e,r)=>{for(var o in s(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{default:()=>u});var d=i(require("./3m.js")),l=i(require("./3g.js")),u=class{constructor(e){this.coreModule=e,this.canvasUtils=new d.default(e)}downloadImageAndInfo(e,t){return new Promise(((r,o)=>{const n=this.getWorkEnvironmentImage();n.onload=()=>{let o,a;const s=this.canvasUtils.toRpx(n.width),i=this.canvasUtils.toRpx(n.height);s/i<=e.width/e.height?(o=0,a=(i-s/e.width*e.height)/2):(a=0,o=(s-i/e.height*e.width)/2),this.coreModule.drawingSchema.drawImages.push({name:e.name,display:e.display,type:"drawImage",borderRadius:e.borderRadius||0,borderWidth:e.borderWidth,borderColor:e.borderColor,zIndex:void 0!==e.zIndex?e.zIndex:t,context2dImageObj:n,sx:o,sy:a,sWidth:s-2*o,sHeight:i-2*a,x:e.x,y:e.y,width:e.width,height:e.height}),r()},n.onerror=e=>o(e),n.src=e.url}))}getWorkEnvironmentImage(){let e;switch(this.coreModule.workEnvironment){case l.WORK_ENVIRONMENT.WEIXIN:if(e=this.coreModule.canvas.createImage(),!e)throw new Error("<CanvasImageModule getWorkEnvironmentImage> 无法获取WEIXIN环境图片对象");return e;case l.WORK_ENVIRONMENT.NODE:if(e=new this.coreModule.CanvasNodeImage,!e)throw new Error("<CanvasImageModule getWorkEnvironmentImage> 无法获取NODE环境图片对象");return e;default:throw new Error(`<CanvasImageModule getWorkEnvironmentImage> 获取图片对象失败，不支持当前环境（${this.coreModule.workEnvironment}）`)}}};