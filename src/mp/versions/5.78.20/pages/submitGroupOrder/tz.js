var e=Object.create,t=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,p=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,l=(e,o,r)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,c=(e,t)=>{for(var o in t||(t={}))n.call(t,o)&&l(e,o,t[o]);if(i)for(var o of i(t))u.call(t,o)&&l(e,o,t[o]);return e},m=o=>{return((e,o,a)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let i of s(o))n.call(e,i)||"default"===i||t(e,i,{get:()=>o[i],enumerable:!(a=r(o,i))||a.enumerable});return e})((a=t(null!=o?e(p(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0}),t(a,"__esModule",{value:!0})),o);var a},d=m(require("../../ob.js")),h=m(require("../../jc.js")),b=getApp();(0,h.defineComponent)({properties:{hasRedemptionInfo:{type:Boolean,default:!1,observer(){this.calcShow()}},redemptionData:{type:Object,observer(e){const t=e.popupItemVOList&&e.popupItemVOList[0]||{};var r,s;this.setData({skuItem:Object.assign((r=c({},t),s={newPrice:this.formatPrice(void 0!==t.promotionPrice?t.promotionPrice:t.sellPrice),oldPrice:this.formatPrice(t.scatter?t.totalCutlinePrice:t.skuCutlinePrice),feUnit:t.scatter?"":t.sellUnitViewName},o(r,a(s))))}),t.skuId&&this.data.hasRedemptionInfo&&b.$lxLog.mv("b_youxuan_3k9vuct5_mv",{sku_id:t.skuId,toast_type:e.type})}}},data:{show:!1,skuItem:{}},methods:{calcShow(){this.setData({show:this.data.hasRedemptionInfo})},formatPrice:e=>e?+(e/100).toFixed(2):0,closePopup(){this.setData({show:!1})},getReportParams(){const{skuId:e,promotionPrice:t,sellPrice:o}=this.data.skuItem;return{sku_id:e,sale_price:t,origin_price:o}},handleBtnClick(e){const{code:t}=e.currentTarget.dataset,{skuId:o}=this.data.skuItem,{type:r}=this.data.redemptionData,a={sku_id:o,toast_type:r};let s=b.$store.getCacheValue("orderFullRedemptionPopupCancelNum")||0;switch(t){case 0:b.$lxLog.mc("b_youxuan_qbf85sqb_mc",a),s=Number(s)+1,b.$store.setCache("orderFullRedemptionPopupCancelNum",String(s),{expires:Number.MAX_SAFE_INTEGER}),this.closePopup(),this.triggerEvent("back");break;case 1:b.$lxLog.mc("b_youxuan_48inrxbd_mc",a),this.handleRedemption();break;default:d.log.error(`[submitOrder] fullRedemptionPopup: 换购弹窗未知的按钮code:${t}`),this.closePopup()}},handleRedemption(){return e=this,t=null,o=function*(){const{skuId:e,promotionId:t,promotionType:o}=this.data.skuItem;if(!(yield b.$cart.operateCart({cartOpSource:"ORDER",cartOpType:"REDEMPTION",opTarget:{promotionId:t,opTargets:[{skuId:e,promotionId:t,promotionType:o}]},lxData:{bid:"b_chaoshi_z48cd2rh_mc",valLab:this.getReportParams()},showSuccessToast:!1})))return d.log.error(`[submitOrder] fullRedemptionPopup: 换购弹窗中商品添加到购物车失败，skuId 为 ${e}`),void this.closePopup();this.triggerEvent("redemptionSku"),this.closePopup()},new Promise(((r,a)=>{var s=e=>{try{p(o.next(e))}catch(e){a(e)}},i=e=>{try{p(o.throw(e))}catch(e){a(e)}},p=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,i);p((o=o.apply(e,t)).next())}));var e,t,o}}});