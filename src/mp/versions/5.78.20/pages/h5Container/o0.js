var e=Object.create,t=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,s=Object.getPrototypeOf,r=Object.prototype.hasOwnProperty,o=e=>t(e,"__esModule",{value:!0}),l=l=>((e,s,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let l of a(s))r.call(e,l)||"default"===l||t(e,l,{get:()=>s[l],enumerable:!(o=i(s,l))||o.enumerable});return e})(o(t(null!=l?e(s(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l);((e,i)=>{for(var a in o(e),i)t(e,a,{get:i[a],enumerable:!0})})(exports,{default:()=>$});var n=l(require("../../up.js")),u=l(require("../../uc.js")),h=l(require("../../u2.js")),m=l(require("../../iu.js")),c=l(require("../../ob.js")),p=l(require("../../u8.js")),d=l(require("../../p3.js")),g=l(require("../../a0.js")),y=l(require("./ce.js")),f=getApp(),$={data:{h5Url:""},onLoad(e){c.log.debug("h5Container page onLoad options",e);let t=`${u.h5Uri}/404.html?`;if(this.isNeedLXParams=!0,e){let i=e.title?decodeURIComponent(e.title):"美团优选";if(wx.setNavigationBarTitle({title:i}),t=e.url?decodeURIComponent(e.url):"",~t.indexOf("/app/cs-fe-mai-portal/index.html")){this.isNeedLXParams=!1;const{query:e,url:i}=(0,g.parseUrl)(t);e.utm_medium="ttApp",t=`${i}?${(0,g.stringify)(e)}`,c.log.warn(`处理了客服链接为 ${t}`)}this.params=e.params?decodeURIComponent(e.params):"";const{type:a}=e;if(a&&!t){const e=h.H5_PROTOCOL.filter((e=>e.type===a))[0];e&&(i=e.title,t=`${u.h5Uri}/${e.pathname}.html?`)}}this.url=t,this.path=`${this.route}?url=${encodeURIComponent(this.url)}`,this.loading(!0),wx.hideShareMenu(),this.isH5PageOnLoaded=!1},h5PageOnload(e){var t;this.checkShareMenu(e.detail.src||this.url),this.isH5PageOnLoaded||(null==(t=n.metrics)||t.addWebview("load",{url:e.detail.src}),this.isH5PageOnLoaded=!0)},h5Error(e){f.$cat.reportError(m.CAT_SEC_CATEGORY.H5_ERROR(`sourceUrl：${this.url}，targetUrl：${this.data.h5Url}，params：${this.normalParams}，error: ${e}，src : ${e&&e.detail&&e.detail.src}`))},checkShareMenu(e){if((0,p.isMMP)())return;let t=!1,i=["activity/","subject/detail","hfe/block"];const a=f.$config.get("h5WhiteList");a&&(i=i.concat(a));const{hostname:s=""}=(0,d.parse)(e),r=f.$config.get("h5DomainWhiteList");r&&(t=s&&r.some((e=>e===s))),t||(t=i.some((t=>e.indexOf(t)>=0))),t?wx.showShareMenu():wx.hideShareMenu()},onShow(e){c.log.debug("h5Container page onShow options",e),this.normalParams=(0,y.genParams)(this.params,this.isNeedLXParams);let t="";t=-1!==this.url.indexOf(u.payUrl)?this.url:`${this.url}${this.url.indexOf("?")>-1?"":"?"}${this.normalParams}${(0,p.isMMP)()||(0,p.isTT)()?"":"#wechat_redirect"}`;const i=f.getModule("env").getSwimlane(),a=f.getModule("env").getEnv(),s=(0,d.parse)(t);"test"===a&&i&&"consumer.mall.test.sankuai.com"===s.host&&(s.host=`${i}-sl-${s.hostname}`,t=(0,d.format)(s));const r=f.getModule("env");if(r&&"test"===r.env){r.getTestEnvHttps()&&(t=t.replace("http://","https://"))}this.setData({h5Url:t}),c.log.warn(`h5Url 是：${this.data.h5Url}，原始url是：${this.url}`),wx.hideNavigationBarLoading()},receiveMessage(e){const t=e.detail.data,i=t[t.length-1];if(i&&"share"===i.type&&"invite/receive"===i.pageName){const e=i.params||{};this.title=`${e.title||"邀请有礼"}`,this.imageUrl=`${e.image||""}`,this.path=`pages/index/index?inviteCode=${e.code}&action=invited&poiId=${f.$module.getModule("activity")&&f.$module.getModule("activity").invite.invitePoi}`}else if(i&&"share"===i.type){const e=i.params||{};this.title=`${e.title||"活动页"}`,this.imageUrl=`${e.image||""}`,this.path=`${e.url||""}`,this.activityId=e.activityId,this.cid=e.cid,this.shareFromPoi=e.poiId}c.log.info("h5发过来的postMsg:",i,{title:this.title,imageUrl:this.imageUrl,path:this.path,activityId:this.activityId,cid:this.cid,shareFromPoi:this.shareFromPoi})},onShareAppMessage(){const e=this.path,{path:t,requestId:i}=f.$lxLog.genLxSharePath(this.route,e,{activity_id:this.activityId,cid:this.cid,shareFromPoi:this.shareFromPoi});return f.$lxLog.mc("b_youxuan_y5g64pno_mc",{share_url:t},{requestId:i}),c.log.info("h5分享",t),{title:`${this.title||"美团优选"}`,imageUrl:`${this.imageUrl||""}`,path:t,success:()=>{},fail:()=>{}}}};