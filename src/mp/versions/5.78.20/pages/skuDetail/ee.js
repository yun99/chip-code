var e=Object.create,t=Object.defineProperty,o=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,n=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,s=s=>{return((e,n,s)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let l of a(n))i.call(e,l)||"default"===l||t(e,l,{get:()=>n[l],enumerable:!(s=o(n,l))||s.enumerable});return e})((l=t(null!=s?e(n(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0}),t(l,"__esModule",{value:!0})),s);var l},l=(e,t,o)=>new Promise(((a,n)=>{var i=e=>{try{l(o.next(e))}catch(e){n(e)}},s=e=>{try{l(o.throw(e))}catch(e){n(e)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,s);l((o=o.apply(e,t)).next())})),u=s(require("../../az.js")),r=s(require("../../u8.js")),p=s(require("./xv.js")),d=getApp();Component(new class{constructor(){this.debounce=!1,this.observers={},this.attached=function(){this.getSkuDetailCouponList()},this.pageLifetimes={show(){this.isRequest()}},this.methods={getSkuDetailCouponList(){var e;d.$service.getRedPacketCouponListNew({source:this.data.source,trafficSource:(null==(e=this.data.queryParams)?void 0:e.trafficSource)||"",needGetMarketingData:this.data.isShowMarketingTips,skuId:this.data.skuId||"",needOrderCashBack:!0}).then((e=>{var t,o,a,n,i;const s=(0,p.transformTempStringToArray)((null==(t=null==e?void 0:e.memberEntranceInfoVO)?void 0:t.title)||"");this.setData({availableCouponList:(null==e?void 0:e.availableCouponList)||[],userCouponList:(null==e?void 0:e.userCouponList)||[],availableCouponLength:((null==e?void 0:e.availableCouponList)||[]).length,userCouponLength:((null==e?void 0:e.userCouponList)||[]).length,monthData:(null==e?void 0:e.memberEntranceInfoVO)||{},titleArray:s,floatingRefundBannerVO:(null==e?void 0:e.floatingRefundBannerVO)||{},marketingData:(null==(o=null==e?void 0:e.groceryShoppingDisplayResponse)?void 0:o.bottom)||{},orderCashBack:(null==e?void 0:e.orderCashBackActivityResponse)||{},couponPopInfo:{popupRewardValue:(null==(a=null==e?void 0:e.floatingRefundBannerVO)?void 0:a.popupRewardValue)||"",popupTitle:(null==(n=null==e?void 0:e.floatingRefundBannerVO)?void 0:n.popupTitle)||"",popupBtnText:(null==(i=null==e?void 0:e.floatingRefundBannerVO)?void 0:i.popupBtnText)||""}})})).catch((e=>{d.page().toast(e&&e.message||"获取优惠券数据失败")}))},getRiskParams(){return l(this,null,(function*(){this.riskParams=yield(0,u.getRiskParamsWeChat)()}))},takeAllCoupons(){return l(this,null,(function*(){if(this.debounce)return;const e=(this.getCouponConfigIds()||[]).join();d.$lxLog.mc("b_youxuan_42jyy1fm_mc",{coupon_list:e}),yield this.getRiskParams(),this.debounce=!0,d.$service.takeRedPacketAllCoupon({couponConfigIds:this.getCouponConfigIds(),riskParams:this.riskParams,couponPageType:3}).then((e=>{this.debounce=!1;let t=0;const o=this.data.availableCouponList||[];((null==e?void 0:e.takeCouponResList)||[]).map(((a,n)=>{o.map(((i,s)=>{(null==i?void 0:i.couponConfigId)===(null==a?void 0:a.couponConfigId)&&(null==a?void 0:a.result)&&(o[s]=null==e?void 0:e.takeCouponResList[n],t+=1)}))})),this.setData({availableCouponList:o||[],availableCouponLength:this.data.availableCouponLength-t,userCouponLength:this.data.userCouponLength+t}),d.page().toast(e&&e.message)})).catch((e=>{var t;this.debounce=!1,null==(t=null==d?void 0:d.page())||t.toast((null==e?void 0:e.message)||"优惠券领取失败")}))}))},getCouponConfigIds(){const{availableCouponList:e=[]}=this.data,t=[];return e.map((e=>{!(null==e?void 0:e.result)&&(null==e?void 0:e.couponConfigId)&&t.push(null==e?void 0:e.couponConfigId)})),t},closePopup(){this.triggerEvent("close",{},{})},onMvReport(e){d.$lxLog.mv(e.detail.bid,e.detail.lxParams)},takeCoupon(e){const t=this.data.availableCouponList||[];t.map(((o,a)=>{var n,i;(null==(n=null==e?void 0:e.detail)?void 0:n.couponConfigId)===(null==o?void 0:o.couponConfigId)&&(null==(i=null==e?void 0:e.detail)?void 0:i.result)&&(t[a]=null==e?void 0:e.detail)})),this.setData({availableCouponLength:this.data.availableCouponLength-1,userCouponLength:this.data.userCouponLength+1,availableCouponList:t})},goto(){var e;const t=getApp(),o=null==(e=this.data.monthData)?void 0:e.landingPage;getApp().$lxLog.mc("b_youxuan_yhjm8x4y_mc"),o&&t.$router.goto(o)},isRequest(){var e;["3","5","7"].indexOf(null==(e=this.data.orderCashBack)?void 0:e.taskStatus)>-1&&this.getSkuDetailCouponList()},gotoCash(){const e=getApp(),{taskStatus:t="",jumperUrl:o,btnClickText:a,moduleTitle:n=""}=this.data.orderCashBack;getApp().$lxLog.mc("b_youxuan_t94bumfk_mc",{activity_status:t,message:n.text||"",type:3}),"1"===t&&this.triggerEvent("close",{},{}),"2"===t&&e.page().toast((null==a?void 0:a.text)||""),["3","5","7"].indexOf(t)>-1&&o.text&&e.$router.goto(o.text)},displayCouponPop(){this.setData({showCouponPop:!0})},closeCouponPop(){this.setData({showCouponPop:!1},(()=>{this.closePopup()}))}},this.properties={showPopup:{type:Boolean,value:!1},isShowIpxBar:{type:Boolean,value:!0},popTitle:{type:String,value:""},queryParams:{type:Object,value:null},isShowMarketingTips:{type:Boolean,value:!1},skuId:{type:String},source:{type:String,value:""}},this.data={userCouponList:[],availableCouponList:[],availableCouponLength:0,userCouponLength:0,isWXMT:(0,r.isWXMT)(),monthData:{},titleArray:["月卡限时开通，大额神券等你拿"],orderCashBack:{}}}});