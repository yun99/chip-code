var t=Object.create,e=Object.defineProperty,o=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,s=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,l=a=>{return((t,a,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let p of r(a))i.call(t,p)||"default"===p||e(t,p,{get:()=>a[p],enumerable:!(s=o(a,p))||s.enumerable});return t})((p=e(null!=a?t(s(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0}),e(p,"__esModule",{value:!0})),a);var p},n=l(require("../../a0.js")),c=l(require("../../ob.js")),d=l(require("../../u8.js")),{PROTOCOL_PRES:m}=require("../../sy.js"),g=[{protocol:"coupon_list/valid/sku",targetPageTitle:"商品详情页优惠券弹窗",remarks:"?sku_id=&poi_id=",operateType:2},{protocol:"goodsdetail/promotion",targetPageTitle:"商品详情页促销活动弹窗",remarks:"?sku_id=&poi_id=",operateType:1}],y=getApp();Component(new class{constructor(){this.methods={prevents(){},closePopup(){this.setData({showPopup:!1})},onMvReport(t){const{__mvHandler:e}=getApp().page();"function"==typeof e&&e(t)},onSaleMvReport(){y.$lxLog.mv("b_youxuan_c2q4w2o2_mv",{sku_id:this.data.moduleParams.skuId,product_id:this.data.moduleParams.productId,activity_type:this.getSaleType()})},gotoMonthCardPage(t){y.$lxLog.mc("b_youxuan_1eitdbb4_mc",{sku_id:this.data.moduleParams.skuId});const{protocol:e}=t.currentTarget.dataset;y.$router.goto(e,{trafficSource:this.data.trafficSource||""})},getSaleType(){const t=this.data.moduleParams;let e="";return t&&t.groupTagTextList&&t.groupTagTextList.length?(t.groupTagTextList.forEach((t=>{var o,r;t&&t.textList&&"促销"===t.title&&(e=(null==(r=null==(o=t.textList[0])?void 0:o.tag)?void 0:r.text)||"")})),e):e},tapRightArrow(t){var e,o;"promotion"===t.currentTarget.dataset.promotiontype&&y.$lxLog.mc("b_youxuan_c2q4w2o2_mc",{sku_id:null==(e=this.data.moduleParams)?void 0:e.skuId,product_id:null==(o=this.data.moduleParams)?void 0:o.productId,activity_type:this.getSaleType()});const{protocol:r}=t.currentTarget.dataset;if(!r)return;const a=r.trim();let s=-1,i="",p=null,u=!1;for(let t=0;t<m.length;t++)if(s=a.indexOf(m[t]),-1!==s){i=a.substr(m[t].length);break}if(-1!==s&&i.length>0&&g.forEach((t=>{if(!i.indexOf(t.protocol)){const{query:e}=(0,n.parseUrl)(r);p={operateType:t.operateType,query:{poiIdStr:e.poiIdStr,poiId:e.poi_id,skuId:e.sku_id}},this.setData({"moduleParams.skuId":e.sku_id}),u=!0}})),p)switch(p.operateType){case 2:this.setData({popUpType:p.operateType,showPopup:!0});break;case 1:this.setData({popUpType:p.operateType}),this.searchPromotionBullet(p.query);break;default:return}else u||(0,d.isTT)()||y.$router.goto(r,{trafficSource:this.data.trafficSource||""})},checkParams:(t=[],e=null)=>(t.forEach((t=>!(!t||!e||void 0===e[`${t}`]||null===e[`${t}`])||(y.page().toast(`协议错误，缺少参数：${t}`),!1))),!0),searchPromotionBullet(t={}){this.checkParams(["poiIdStr","skuId"],t)&&(this.setData({showPopup:!0}),y.$service.searchPromotionBullet(((t,e)=>{for(var o in e||(e={}))i.call(e,o)&&u(t,o,e[o]);if(a)for(var o of a(e))p.call(e,o)&&u(t,o,e[o]);return t})({},t)).then((t=>{var e;(null==(e=null==t?void 0:t.bulletPromotionList)?void 0:e.length)?this.setData({promotionPopupTitle:(null==t?void 0:t.bulletDesc)||"促销活动",promotionList:(null==t?void 0:t.bulletPromotionList)||[]}):this.setData({showPopup:!1})})).catch((t=>{y.page().toast(t&&t.message||"获取促销活动数据失败"),this.setData({showPopup:!1}),c.log.info(`<navigatorRow searchPromotionBullet> 获取促销活动数据失败, ${t.message}`)})))}},this.properties={moduleParams:{type:Object,value:{}},trafficSource:{type:String,value:""},mvHandler:{type:Function}},this.data={showPopup:!1,popUpType:1,availableCouponList:[],userCouponList:[],promotionList:[],promotionPopupTitle:"促销活动",specialTextStyle:"border: 1px solid #FF9999;border-radius: 6rpx;",specialTagStyle:"border: 1px solid #FF757F;border-radius: 6rpx;",popupMonthData:{},popupMonthDataTitleArray:[]}}});