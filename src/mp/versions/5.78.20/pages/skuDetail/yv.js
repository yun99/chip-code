var e=Object.create,t=Object.defineProperty,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,s=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,r=e=>t(e,"__esModule",{value:!0}),n=n=>((e,s,r)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let n of i(s))a.call(e,n)||"default"===n||t(e,n,{get:()=>s[n],enumerable:!(r=o(s,n))||r.enumerable});return e})(r(t(null!=n?e(s(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);((e,o)=>{for(var i in r(e),o)t(e,i,{get:o[i],enumerable:!0})})(exports,{moreSkuRecommendSchema:()=>y});var u=n(require("../../u5.js")),l=n(require("../../jc.js")),d=n(require("../../lm.js")),m=n(require("../../a8.js")),c=n(require("./pk.js")),{getGlobalRequestId:p}=require("../../p0.js"),y=(0,d.default)({hiddenNodes:["sale-info"]});(0,l.defineComponent)(new class{constructor(){var e,t;this.created=function(){this.listPagination={offset:0,limit:15},this.loadFirstPageMoreRecommend=!1},this.attached=function(){this.globalRequestId=p(u.$poi.getPoiIdStr()||u.$poi.getPoiId()),m.default.registerLxOperator(m.ListTypes.skuDetailMore,{operator:e=>{const{moreSkuRecommendTraceId:t,skuId:o,productId:i}=this.data;return Object.assign(e,{origin_sku_id:o,product_id:i||"",requestid:t,global_request_id:this.globalRequestId}),e},[m.LxEventTypes.CardClick]:"b_youxuan_gadip7mu_mc",[m.LxEventTypes.CardView]:"b_youxuan_gadip7mu_mv",[m.LxEventTypes.AddCartClick]:"b_youxuan_jp0j9nar_mc",[m.LxEventTypes.DecreaseCartClick]:"b_youxuan_majs719o_mc",[m.LxEventTypes.SpecPopupShowClick]:"b_youxuan_k9ap5358_mc",[m.LxEventTypes.SpecPopupSkuView]:"b_youxuan_yb8egt7p_mv",[m.LxEventTypes.SpecPopupAddCartClick]:"b_youxuan_zqfp0g97_mc",[m.LxEventTypes.SpecPopupEditAttrClick]:"b_youxuan_js1sapl9_mc",[m.LxEventTypes.SpecPopupRemindClick]:"b_youxuan_n74yky66_mc"})},this.observers={middleSkuList(e){this.loadFirstPageMoreRecommend||(this.excludeSkuIds=e||[])},loadFirstPageMoreRecommend(e){e&&this.loadMoreRecSku()}},this.methods={gotoSkuDetail(e){this.triggerEvent("gotoSkuDetail",e)},loadMoreRecSku(){return this.getMoreRecommendData(this.listPagination)},getMoreRecommendData(e){return t=this,o=arguments,i=function*({offset:e=0,limit:t=15}){var o,i,s;try{const a=0===e,{skuId:r,moreSkuRecommendData:n}=this.data,l=yield(0,c.getMoreSkuRecommendDataV2)({poiId:u.$poi.getPoiId(),poiIdStr:u.$poi.getPoiIdStr(),skuId:r,detailScene:"DETAIL_MORE_RECOMMEND_V2"},{offset:e,limit:t,excludeSkuIds:this.excludeSkuIds}),d=this.getMoreSkuRecommendDisplayData(l,a),m=(null==(o=null==d?void 0:d.itemList)?void 0:o.map((e=>e.skuId)))||[];if(this.excludeSkuIds=this.excludeSkuIds.concat(m),a&&(null==(i=null==d?void 0:d.itemList)?void 0:i.length))this.setData({moreSkuRecommendData:d,moreSkuRecommendTraceId:(null==l?void 0:l.M_TraceId)||""}),this.triggerEvent("moreSkuRecommendFirstPageLoaded"),this.loadFirstPageMoreRecommend=!0;else if(null==(s=null==d?void 0:d.itemList)?void 0:s.length){const e=(null==n?void 0:n.itemList)||[];d.itemList.forEach((t=>{e.push(t)})),this.setData({"moreSkuRecommendData.itemList":e,moreSkuRecommendTraceId:(null==l?void 0:l.M_TraceId)||""})}else this.setData({isLoadDone:!0});d&&Object.keys(d).length&&d.total&&!(d.offset+d.limit>=d.total)&&d.itemList||(this.setData({isLoadDone:!0,isRecEnd:!0}),this.triggerEvent("moreSkuRecommendEnd")),(null==d?void 0:d.itemList)&&this.calculatePaginate()}catch(e){this.setData({isLoadDone:!0}),this.triggerEvent("moreSkuRecommendEnd")}},new Promise(((e,s)=>{var a=e=>{try{n(i.next(e))}catch(e){s(e)}},r=e=>{try{n(i.throw(e))}catch(e){s(e)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,r);n((i=i.apply(t,o)).next())}));var t,o,i},calculatePaginate(){const e=this.listPagination.offset+this.listPagination.limit;this.listPagination.offset=e},getMoreSkuRecommendDisplayData(e,t){var o;return(null==(o=e.itemList)?void 0:o.length)>0||!t?{offset:e.offset,total:e.total,limit:e.limit,moduleTitle:e.moduleTitle||null,itemList:e.itemList||[]}:null}},this.properties={mvHandler:{type:Function},skuId:{type:Number},productId:{type:Number},middleSkuList:{type:Array},loadFirstPageMoreRecommend:{type:Boolean,value:!1},showRedPackertBar:{type:Boolean,value:!1}},this.data={isIpx:(null==(t=null==(e=u.$systemInfo)?void 0:e.getSystemInfo())?void 0:t.isIpx)||!1,isLoadDone:!1,isRecEnd:!1,moreSkuRecommendData:null,moreSkuRecommendTraceId:"",skuType:m.ListTypes.skuDetailMore,moreSkuRecommendSchema:y},this.globalRequestId="",this.excludeSkuIds=[]}});