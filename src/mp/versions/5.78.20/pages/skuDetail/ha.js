var e=Object.create,t=Object.defineProperty,a=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,r=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,s=e=>t(e,"__esModule",{value:!0}),u=u=>((e,r,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let u of i(r))o.call(e,u)||"default"===u||t(e,u,{get:()=>r[u],enumerable:!(s=a(r,u))||s.enumerable});return e})(s(t(null!=u?e(r(u)):{},"default",u&&u.__esModule&&"default"in u?{get:()=>u.default,enumerable:!0}:{value:u,enumerable:!0})),u),l=(e,t,a)=>new Promise(((i,r)=>{var o=e=>{try{u(a.next(e))}catch(e){r(e)}},s=e=>{try{u(a.throw(e))}catch(e){r(e)}},u=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);u((a=a.apply(e,t)).next())}));((e,a)=>{for(var i in s(e),a)t(e,i,{get:a[i],enumerable:!0})})(exports,{default:()=>S});var n=u(require("../../ob.js")),p=u(require("../../is.js")),g=u(require("../../u5.js")),c=u(require("../../p0.js")),d=u(require("../../ht.js")),_=u(require("./l1.js")),m=u(require("./cu.js")),h=u(require("./h3.js")),D=u(require("./cy.js")),y=u(require("./pk.js")),S=class{constructor(e){this.getSkuBasicData=function(e=null){return l(this,null,(function*(){var t;try{this._page.__fstDetailReport(9);const t=yield this.getSkuDetailAggregationData(e);this._page.__fstDetailReport(11);const{skuDetail:a={}}=t||{};if((0,_.isNotEmptyObject)(a)){this._page.controllers.skuShareImageController.setSkuShareImageSchemaData(a),this._page.controllers.skuSharePosterController.setSkuSharePosterSchemaData(a),D.default.setCommonData(this._page,this._page.commonData,a);const{renderSection1Data:e,renderSection2Data:i,renderSection3Data:r}=D.default.getSectionRenderData(this._page,t);this._page.__fstDetailReport(12),this._page.metricsSetData(e,{fmp:!0,extra:(0,c.getPerformanceExtraData)()},(()=>{var t,o;h.default.renderBaseWxml(this._page),this._page.__fstDetailReport(13),this._page.skuDetailMetricReport.reportFMP(this._page.__pageLoadTime__),this._page.skuDetailMetricReport.reportSkuDetailFMPCount(p.YXReportTarget,p.ReportValue,g.$cat,g.$version,g.$systemInfo);const s=Date.now();this._page.compelteRenderTime=s;this._page.initOptions.__RST;if(!this._page.reported){this._page.reported=!0;const i=(null==(o=null==(t=e.groupBuyEntryData)?void 0:t.groupPrice)?void 0:o.text)?"groupBuySku":"otherSku";g.$lxLog.pv("c_youxuan_productdetail",{custom:{sku_id:null==a?void 0:a.skuId,goods_type:i,page_source:d.default.getPageFromRoute(!1),product_id:(null==a?void 0:a.productId)||-999}})}this._page.metricsSetData(i,{key:"skuDetailRenderSection2"},(()=>{this._page.metricsSetData(r,{key:"skuDetailRenderSection3"})}))}))}g.$cat.reportCustomMetrics(p.YXReportTarget.SKU_DETAIL_RENDER_API_PV,p.ReportValue.SUCCESS,{skuSaleStatus:null==a?void 0:a.skuSaleStatus,detailPoiType:this.getDetailPoiType(g.$poi.getPoiId(),null==a?void 0:a.poiId,g.$poi.getPoiIdStr(),null==a?void 0:a.poiIdStr),sceneCode:this._page.sceneCode,subChannel:this._page.subChannel,mainInfoStatus:(null==a?void 0:a.skuTitle)&&(null==a?void 0:a.picUrls)?m.SKU_MAIN_INFO_STATUS.NORMAL:m.SKU_MAIN_INFO_STATUS.ERROR})}catch(a){if(h.default.renderBaseWxml(this._page),g.$cat.reportCustomMetrics(p.YXReportTarget.SKU_DETAIL_RENDER_API_PV,p.ReportValue.FAILED,{sceneCode:this._page.sceneCode,subChannel:this._page.subChannel,mainInfoStatus:m.SKU_MAIN_INFO_STATUS.ERROR}),[5,19].includes(+(null==(t=null==a?void 0:a.data)?void 0:t.code)))return;this._page.toast((null==a?void 0:a.message)||"获取商品数据失败"),this._page.error({show:!0,type:"no_network",ok:()=>{this.getSkuBasicData(e),this._page.error(!1)}})}}))},this._page=e}getDetailPoiType(e,t,a,i){return i===a||e===t?m.DEFAULT_POI_TYPE.USE_POI:t===this._page.liveDefaultPoiId||i===this._page.poiIdStr_liveDefaultPoiId?m.DEFAULT_POI_TYPE.USE_DEFAULT_POI:m.DEFAULT_POI_TYPE.USE_OTHER_POI}getSkuIdByLiveSpu(){return l(this,null,(function*(){const e=this._page;try{const{skuId:t}=yield(0,y.getSkuIdByLiveSpuReq)({poiId:g.$poi.getPoiId(),poiIdStr:g.$poi.getPoiIdStr(),liveSpuId:e.liveSpuId,liveDefaultSkuId:e.liveDefaultSkuId});return e.setData({originalSkuId:t}),t}catch(e){n.log.warn(`微信直播商详获取 skuId 失败，error：${null==e?void 0:e.message}`)}}))}getSkuDetailAggregationData(e){return l(this,null,(function*(){try{return yield this._page.getPreFetchedData()}catch(t){try{const t={skuId:e||this._page.data.originalSkuId,poiId:d.default.getCurrentPoiId(),poiIdStr:d.default.getCurrentPoiIdStr(),originalPoiId:this._page.data.originalPoiId,poiIdStr_originalPoiId:this._page.data.poiIdStr_originalPoiId,liveDefaultPoiId:this._page.liveDefaultPoiId,poiIdStr_liveDefaultPoiId:this._page.poiIdStr_liveDefaultPoiId,sceneCode:this._page.sceneCode||g.$sceneCode,appVersion:d.default.getAppVersion(),page_from:d.default.getPageFromRoute(!1),keyword:d.default.convertKeyword(this._page.initOptions),sourcePage:d.default.convertSourcePage(this._page.initOptions),homepageLat:d.default.getLocationLat(),homepageLng:d.default.getLocationLng()};return(0,y.getSkuDetailAggregation)(t)}catch(e){throw n.log.warn(`<skuDetail service getSkuDetailAggregationData> 获取商品详情数据 失败，error：${e.message}`,e),e}}}))}};