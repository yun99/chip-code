var t=Object.create,a=Object.defineProperty,u=Object.getOwnPropertyDescriptor,e=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,n=n=>{return((t,o,n)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let i of e(o))s.call(t,i)||"default"===i||a(t,i,{get:()=>o[i],enumerable:!(n=u(o,i))||n.enumerable});return t})((i=a(null!=n?t(o(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0}),a(i,"__esModule",{value:!0})),n);var i},i=(t,a,u)=>new Promise(((e,o)=>{var s=t=>{try{i(u.next(t))}catch(t){o(t)}},n=t=>{try{i(u.throw(t))}catch(t){o(t)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,n);i((u=u.apply(t,a)).next())})),r=n(require("../../jz.js")),c=n(require("../../u8.js")),S=n(require("../../u5.js")),d=n(require("../../sm.js")),B=n(require("../../lq.js")),m=n(require("../../o9.js")),l=n(require("../../cz.js")),_=n(require("./cj.js")),k=n(require("./ck.js")),p=n(require("../../kg.js")),{subscribeAll:C,unsubscribeAll:h}=require("../../sz.js"),{getSeckillActivitySubscribeRequest:E,getTakeOnSubscribeRequest:T,getSkuArriveSubscribeRequest:R,getCouponExpirationSubscribeRequest:D,getSeckillSubscribeRequest:g}=require("../../cl.js"),I=getApp();(0,r.defineComponent)(new class{constructor(){this.attached=function(){this.setData({cartSkuNum:S.$cart.cartTotalNum}),this.changeCartSkuNumBindThis=this.changeCartSkuNum.bind(this),S.$event.on(S.$event.CONTANTS.CARTTOTALNUM_CHANGE,this.changeCartSkuNumBindThis)},this.detached=function(){S.$event.off(S.$event.CONTANTS.CARTTOTALNUM_CHANGE,this.changeCartSkuNumBindThis)},this.pageLifetimes={show(){this.data.skuBottomBtnData.from===_.EFrom.skuDetail&&this.processCommentChangeStatus()}},this.methods={changeCartSkuNum(t){t.totalItemCounts!==this.data.cartSkuNum&&this.setData({cartSkuNum:t.totalItemCounts})},onMvReport(t){const{__mvHandler:a}=getApp().page();"function"==typeof a&&a(t)},jumpToHomePage(t){var a,u,e;const o=getCurrentPages();let s="";const n=o[o.length-2];s=(null==(a=null==n?void 0:n.route)?void 0:a.indexOf("pages/index/index"))>-1?"navigateBack":"navigateTo";const i=null==(e=null==(u=null==I?void 0:I.$appShowOptions)?void 0:u.query)?void 0:e.pageId,r=i?{pageId:i}:{},{type:c}=t.currentTarget.dataset;let d="b_youxuan_ngz4xruy_mc";"navigator"===c&&(d="b_youxuan_5ewou67f_mc"),S.$lxLog.mc(d,{sku_id:this.data.skuBottomBtnData.currentSkuId,product_id:this.data.skuBottomBtnData.productId||-999}),S.$router.goto("igrocery://www.grocery.com/main",r,{fnName:s})},jumpToCart(){if(S.$lxLog.mc("b_youxuan_qvnc4xh1_mc",{sku_id:this.data.skuBottomBtnData.currentSkuId,product_id:this.data.skuBottomBtnData.productId||-999}),!S.$login.isLogin())return void S.$login.login();const{trafficSource:t}=this.data.skuBottomBtnData;S.$cart.goToCartLanding(t)},subscriptCurrentSku(t){return i(this,null,(function*(){let a,u,e,o;if(this.data.skuBottomBtnData.subStatus){a=R(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.MAJOR,d.SKU_ARRIVE_SUBSCRIBE_STATUS.UNSUBSCRIBE),u=E(d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),e=D(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR);const s=[a,u];(0,c.isWX)()&&s.push(e),o=yield h(s),o.success===d.SUBSCRIBE_REQUEST_STATUS.SUCCESS&&o.status===d.SUBSCRIBE_STATUS.UNSUBSCRIBED&&this.setButtonStatus(k.ButtonStatus.STOCK_REMIND,t,!1)}else{a=R(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.MAJOR,d.SKU_ARRIVE_SUBSCRIBE_STATUS.SUBSCRIBE),u=E(d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),e=D(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR);const s=[a,u];(0,c.isWX)()&&s.push(e),o=yield C(s),o.success===d.SUBSCRIBE_REQUEST_STATUS.SUCCESS&&o.status===d.SUBSCRIBE_STATUS.SUBSCRIBED&&this.setButtonStatus(k.ButtonStatus.STOCK_REMIND,t,!0)}}))},subscribeSkuTakeOn(t,a,u){return i(this,null,(function*(){var e,o,s,n;let i,r,c,B;switch(S.$lxLog.mc("b_youxuan_my1i0ixo_mc",{title:a,sku_id:this.data.skuBottomBtnData.currentSkuId,page_source:this.getPageSource(),origin_price:(null==(e=this.data.skuBottomBtnData.dashPrice)?void 0:e.text)||"",sale_price:(null==(o=this.data.skuBottomBtnData.promotionPrice)?void 0:o.text)||(null==(s=this.data.skuBottomBtnData.sellPrice)?void 0:s.text)||"",tips_id:-999,product_id:(null==(n=this.data.skuBottomBtnData)?void 0:n.productId)||""}),t){case k.ButtonStatus.TAKE_ON_UNSUBSCRIBE:i=T(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.MAJOR,d.TAKE_ON_SUBSCRIBE_STATUS.SUBSCRIBE),r=E(d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),c=D(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),B=yield C([i,r,c]),B.success===d.SUBSCRIBE_REQUEST_STATUS.SUCCESS&&B.status===d.SUBSCRIBE_STATUS.SUBSCRIBED&&this.setButtonStatus(k.ButtonStatus.TAKE_ON_SUBSCRIBE,u);break;case k.ButtonStatus.TAKE_ON_SUBSCRIBE:i=T(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.MAJOR,d.TAKE_ON_SUBSCRIBE_STATUS.UNSUBSCRIBE),r=E(d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),c=D(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.NOT_MAJOR),B=yield h([i,r,c]),B.success===d.SUBSCRIBE_REQUEST_STATUS.SUCCESS&&B.status===d.SUBSCRIBE_STATUS.UNSUBSCRIBED&&this.setButtonStatus(k.ButtonStatus.TAKE_ON_UNSUBSCRIBE,u)}}))},getPageSource(){const t=(0,S.pages)()||[];let a="";if(t.length&&t.length>1){const u=t[t.length-2];a=(null==u?void 0:u.route)||""}return a},addToCart(t){return i(this,null,(function*(){var a,u,e,o;if(yield(0,p.default)(I))return;const s={bid:"b_youxuan_9m9b65rb_mc",valLab:{requestid:"",index_id:"",origin_sku_id:this.data.skuBottomBtnData.originalSkuId||-999,sku_id:this.data.skuBottomBtnData.currentSkuId,tips_id:-999,sale_price:(null==(u=null==(a=this.data.skuBottomBtnData)?void 0:a.promotionPrice)?void 0:u.text)||(null==(o=null==(e=this.data.skuBottomBtnData)?void 0:e.sellPrice)?void 0:o.text)||"",product_id:this.data.skuBottomBtnData.productId||-999,page_source:this.getPageSource()}};1===this.data.skuBottomBtnData.productPattern?S.$cart.operateCart({cartOpType:"INCREASE",cartOpSource:"ITEMDETAIL",opTarget:{opTargets:[{skuId:this.data.skuBottomBtnData.currentSkuId}]},isSelectedSkuId:!0,lxData:s,forceRefresh:!1,trafficSource:this.data.skuBottomBtnData.trafficSource,addSource:this.data.skuBottomBtnData.addSource},t):2===this.data.skuBottomBtnData.productPattern&&(S.$lxLog.mc("b_youxuan_ahg9s4ky_mc",s.valLab),I.page().popupSkuPurchasePanel({popupStatus:!0,panelType:l.SkuPurchasePanelType.ADD_TO_CART,requestParams:{skuId:this.data.skuBottomBtnData.currentSkuId,productPattern:2,choicesScene:this.data.skuBottomBtnData.from===_.EFrom.skuComment?4:0},moduleLxBids:{skuView:"b_youxuan_nxjf1lty_mv",editAttrClick:"b_youxuan_gv6zqv55_mc",addCartClick:"b_youxuan_bpllah2f_mc",remindClick:"b_youxuan_4vqwo5x1_mc",changeCountClick:this.data.skuBottomBtnData.from===_.EFrom.skuComment?"b_youxuan_rb2ml985_mc":"",closeClick:this.data.skuBottomBtnData.from===_.EFrom.skuComment?"b_youxuan_jj2a6vfm_mc":""},moduleLxParams:s.valLab,trafficSource:this.data.skuBottomBtnData.trafficSource,customOpCartParams:{addSource:this.data.skuBottomBtnData.addSource}}))}))},tapButton(t){var a,u,e,o,s,n,i,r,d,B,m;const{status:l,enable:_,text:p,iretail:C,index:h}="onTapButton"===t.type?(null==(u=null==(a=t.detail)?void 0:a.currentTarget)?void 0:u.dataset)||{}:null==(e=null==t?void 0:t.currentTarget)?void 0:e.dataset;if(_)switch(l){case k.ButtonStatus.STOCK_REMIND:(0,c.isTT)()?null==(o=null==I?void 0:I.page())||o.toast("下载【美团优选APP】查看更多"):(0,c.isMT)()||this.subscriptCurrentSku(h);break;case k.ButtonStatus.TAKE_ON_UNSUBSCRIBE:case k.ButtonStatus.TAKE_ON_SUBSCRIBE:(0,c.isTT)()?(null==(s=null==I?void 0:I.page())||s.toast("下载【美团优选APP】查看更多"),S.$lxLog.mc("b_youxuan_my1i0ixo_mc",{title:p,sku_id:this.data.skuBottomBtnData.currentSkuId,page_source:this.getPageSource(),origin_price:(null==(n=this.data.skuBottomBtnData.dashPrice)?void 0:n.text)||"",sale_price:(null==(i=this.data.skuBottomBtnData.promotionPrice)?void 0:i.text)||(null==(r=this.data.skuBottomBtnData.sellPrice)?void 0:r.text)||"",tips_id:-999,product_id:(null==(d=this.data.skuBottomBtnData)?void 0:d.productId)||""})):(0,c.isMTChannel)()||this.subscribeSkuTakeOn(l,p,h);break;case k.ButtonStatus.PURCHASE_NOW:case k.ButtonStatus.ORDER_NOW:this.onTapPurchaseNow(l,t);break;case k.ButtonStatus.PRE_ADD:case k.ButtonStatus.NORMAL:this.addToCart(t);break;case k.ButtonStatus.MORE_CATEGORY:(0,c.isTT)()?null==(B=null==I?void 0:I.page())||B.toast("下载【美团优选APP】查看更多"):this.jumpToCategory(p,C);break;case k.ButtonStatus.SEC_START_REMIND:case k.ButtonStatus.SEC_CANCEL_REMIND:(0,c.isTT)()?null==(m=null==I?void 0:I.page())||m.toast("下载【美团优选APP】查看更多"):this.onSubscribeReminder(h,l)}},getSessionTime(t){const a=new Date(t);return`${(0,B.padding0)(a.getHours(),2)}:${(0,B.padding0)(a.getMinutes(),2)}`},onSubscribeReminder(t,a){return i(this,null,(function*(){var u,e;if(S.$lxLog.mc("b_youxuan_lr6j3lr1_mc",{title:"开抢提醒",sku_id:this.data.skuBottomBtnData.currentSkuId,product_id:this.data.skuBottomBtnData.productId||-999}),!S.$networkStatus.isConnected||"none"===S.$networkStatus.networkType){const t={type:"network_abnormal",show:!0,errorStyleType:"toast",code:m.default.NETWORK_ABNORMAL};return void I.page().error(t)}if((0,c.isMT)()){const t=this.getSessionTime(this.data.skuBottomBtnData.countdownVO.secKillStartTime);return void I.page().toast(`${t}开抢，别错过抢购哦`)}let o,s;const n={selectedTabTime:this.data.skuBottomBtnData.countdownVO.secKillStartTime||"",skuName:(null==(u=this.data.skuBottomBtnData.skuTitle)?void 0:u.text)||"",seckillPrice:(null==(e=this.data.skuBottomBtnData.countdownVO.seckillPrice)?void 0:e.text)||"",seckillType:this.data.skuBottomBtnData.seckillingSubType||1};a===k.ButtonStatus.SEC_CANCEL_REMIND?(o=g(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.MAJOR,d.SECKILL_SUBSCRIBE_STATUS.UNSUBSCRIBE,n),s=yield h([o]),s.success===d.SUBSCRIBE_REQUEST_STATUS.SUCCESS&&s.status===d.SUBSCRIBE_STATUS.UNSUBSCRIBED&&(I.page().toast("已取消提醒 \n 可能会错过抢购哦"),this.setButtonStatus(k.ButtonStatus.SEC_START_REMIND,t))):a===k.ButtonStatus.SEC_START_REMIND&&(o=g(this.data.skuBottomBtnData.currentSkuId||"",d.SUBSCRIBE_MAJOR_TYPE.MAJOR,d.SECKILL_SUBSCRIBE_STATUS.SUBSCRIBE,n),s=yield C([o]),s.success===d.SUBSCRIBE_REQUEST_STATUS.SUCCESS&&s.status===d.SUBSCRIBE_STATUS.SUBSCRIBED&&(I.page().toast("将在开抢前5min提醒您"),this.setButtonStatus(k.ButtonStatus.SEC_CANCEL_REMIND,t)))}))},setButtonStatus(t,a,u){const e={[k.ButtonStatus.SEC_CANCEL_REMIND]:"取消提醒",[k.ButtonStatus.SEC_START_REMIND]:"开抢提醒",[k.ButtonStatus.TAKE_ON_UNSUBSCRIBE]:"上架提醒",[k.ButtonStatus.TAKE_ON_SUBSCRIBE]:"取消提醒",[k.ButtonStatus.STOCK_REMIND]:t=>(this.data.skuBottomBtnData.subStatus=t,t?"取消提醒":"到货提醒")};let o=e[t];"string"!=typeof o&&(o=e[t](u)),this.setData({[`skuBottomBtnData.buttonV2List[${a}].text`]:o,[`skuBottomBtnData.buttonV2List[${a}].status`]:t}),this.data.skuBottomBtnData.from===_.EFrom.skuComment&&(I.skuDetailAndCommentBtn={[this.data.skuBottomBtnData.currentSkuId]:{index:a,subStatus:u,status:t}})},processCommentChangeStatus(){var t;const a={[k.ButtonStatus.SEC_CANCEL_REMIND]:k.ButtonStatus.SEC_START_REMIND,[k.ButtonStatus.SEC_START_REMIND]:k.ButtonStatus.SEC_CANCEL_REMIND,[k.ButtonStatus.TAKE_ON_UNSUBSCRIBE]:k.ButtonStatus.TAKE_ON_SUBSCRIBE,[k.ButtonStatus.TAKE_ON_SUBSCRIBE]:k.ButtonStatus.TAKE_ON_UNSUBSCRIBE,[k.ButtonStatus.STOCK_REMIND]:k.ButtonStatus.STOCK_REMIND},u=null==(t=I.skuDetailAndCommentBtn)?void 0:t[this.data.skuBottomBtnData.currentSkuId];if(u){const{index:t,subStatus:e,status:o}=u,s=this.data.skuBottomBtnData.buttonV2List[t];a[o]===s.status&&this.setButtonStatus(o,t,e),I.skuDetailAndCommentBtn[this.data.skuBottomBtnData.currentSkuId]=null}},jumpToCategory(t,a){a&&(S.$lxLog.mc("b_youxuan_olx8xndy_mc",{sku_id:this.data.skuBottomBtnData.currentSkuId,fcategory_id:this.data.skuBottomBtnData.firstCategoryId,fcategory_name:this.data.skuBottomBtnData.firstCategoryName,title:t,product_id:this.data.skuBottomBtnData.productId||-999}),S.$router.goto(a))},onTapPurchaseNow(t,a){return i(this,null,(function*(){var u;if(!(yield(0,p.default)(I)))if(S.$login.isLogin()){if(this.data.skuBottomBtnData.currentSkuId){if(2!==this.data.skuBottomBtnData.productPattern){S.$lxLog.mc("b_youxuan_74y6b2eq_mc",{sku_id:this.data.skuBottomBtnData.currentSkuId,product_id:this.data.skuBottomBtnData.productId||-999});const e=`${(null==(u=I.$user)?void 0:u.userId)||""}_${Date.now()}`,o={cartOpSource:"BUYNOW",cartOpType:"INCREASE",opTarget:{opTargets:[{skuId:this.data.skuBottomBtnData.currentSkuId}]},tempCartId:e,createTempCart:!0,showSuccessToast:!1,needAnimation:!1,trafficSource:this.data.skuBottomBtnData.trafficSource};t===k.ButtonStatus.PURCHASE_NOW&&(o.addSource=this.data.skuBottomBtnData.addSource);if(!(yield I.$cart.operateCart(o,a)).addSuccess)return;const s={cartOpSource:"buyNow",tempCartId:e,trafficSource:this.data.skuBottomBtnData.trafficSource};return t===k.ButtonStatus.PURCHASE_NOW&&(s.addSource=this.data.skuBottomBtnData.addSource),void I.$router.goto("igrocery://www.grocery.com/submit_order",s)}S.$lxLog.mc("b_youxuan_f38n3b3n_mc",{sku_id:this.data.skuBottomBtnData.currentSkuId,product_id:this.data.skuBottomBtnData.productId||-999}),I.page().popupSkuPurchasePanel({popupStatus:!0,panelType:l.SkuPurchasePanelType.PURCHASE_NOW,isShowRecSku:t===k.ButtonStatus.PURCHASE_NOW,requestParams:{skuId:this.data.skuBottomBtnData.currentSkuId,productPattern:this.data.skuBottomBtnData.productPattern||1,choicesScene:this.data.skuBottomBtnData.from===_.EFrom.skuComment?4:0},moduleLxBids:{skuView:"b_youxuan_52s4xagc_mv",editAttrClick:"b_youxuan_4tyzzvq3_mc",addCartClick:"b_youxuan_bpllah2f_mc",buyNowClick:"b_youxuan_6tdm94qk_mc",remindClick:"b_youxuan_4vqwo5x1_mc",changeCountClick:this.data.skuBottomBtnData.from===_.EFrom.skuComment?"b_youxuan_rb2ml985_mc":"",closeClick:this.data.skuBottomBtnData.from===_.EFrom.skuComment?"b_youxuan_jj2a6vfm_mc":""},moduleLxParams:{sku_id:this.data.skuBottomBtnData.currentSkuId,product_id:this.data.skuBottomBtnData.productId||-999,origin_sku_id:this.data.skuBottomBtnData.originalSkuId||-999},trafficSource:this.data.skuBottomBtnData.trafficSource,customOpCartParams:{addSource:this.data.skuBottomBtnData.addSource}})}}else S.$login.login()}))}},this.properties={skuBottomBtnData:{type:Object,value:{}},mvHandler:{type:Function}},this.data={cartSkuNum:S.$cart.cartTotalNum}}});