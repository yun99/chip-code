var t=Object.create,e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,o=o=>{return((t,i,o)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let r of a(i))n.call(t,r)||"default"===r||e(t,r,{get:()=>i[r],enumerable:!(o=s(i,r))||o.enumerable});return t})((r=e(null!=o?t(i(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0}),e(r,"__esModule",{value:!0})),o);var r},r=o(require("../../u5.js")),l=o(require("../../u8.js")),d=o(require("../../ux.js")),u=o(require("../../ob.js")),c=o(require("../../u3.js")),h=o(require("../../is.js")),p=getApp(),m=p.$systemInfo.systemInfo.screenHeight,y=p.$systemInfo.systemInfo.screenWidth;Component(new class{constructor(){this.observers={skuId(t){const{appVersion:e}=p.$systemInfo.systemInfo;(0,l.isApp)()&&(0,c.default)(e||"0.0.0","6.5.0")<0||(0,l.isMMP)()&&(0,l.isMT)()&&(0,c.default)(e||"0.0.0","11.6.400")<0||t&&(getApp().$isLiving||(0,l.isWX)()||this.getLiveStream())}},this.attached=function(){const t=p.$systemInfo&&p.$systemInfo.systemInfo&&p.$systemInfo.systemInfo.isIpx||!1,e=y-this.calcRpx(215),s=m-this.calcRpx(420+(t?70:0));this.setData({x:e,y:s,cssAnimation:`translate3d(${e}px, ${s}px, 0)`})},this.pageLifetimes={show(){this.data.skuId&&this.data.playerUrl?this.setData({showLivePlayer:!0,showLivePendant:!0}):this.data.liveJumpUrl&&this.setData({showLivePlayer:!1,showLivePendant:!0})}},this.methods={gotoLive(){var t,e;r.$lxLog.mc("b_youxuan_352mh2fb_mc",{sku_id:this.data.skuId||"",product_id:this.data.productId||"",show_type:this.data.showLivePlayer?1:0}),(null==(t=this.data)?void 0:t.liveJumpUrl)&&(this.setData({showLivePlayer:!1,showLivePendant:!1,playerBackground:"#000000",isConnecting:!0}),r.$router.goto(null==(e=this.data)?void 0:e.liveJumpUrl))},closeLive(){r.$lxLog.mc("b_youxuan_qyx9mg9d_mc",{sku_id:this.data.skuId||"",product_id:this.data.productId||"",show_type:this.data.showLivePlayer?1:0}),this.setData({showLivePendant:!1})},onMvReport(t){const{__mvHandler:e}=getApp().page();"function"==typeof e&&e(t)},getLiveStream(){return t=this,e=null,s=function*(){var t;try{const e=yield d.default.getLiveRoomInfo({poiId:r.$poi.getPoiId(),poiIdStr:r.$poi.getPoiIdStr(),skuId:this.data.skuId}),s=e&&e.skuRoom;if(s&&20===s.status&&s.pullStreamUrl&&s.liveUrl){let e=s.pullStreamUrl;(null==(t=p.$module.getModule("env"))?void 0:t.debug)&&(e=s.pullStreamUrl.replace("_LD","")),this.setData({showLivePendant:!0,showLivePlayer:!0,liveJumpUrl:s.liveUrl,liveid:s.outLiveId,playerBackground:"transparent",playerUrl:e})}else s&&10===s.status&&s.liveUrl?this.setData({showLivePendant:!0,showLivePlayer:!1,liveJumpUrl:s.liveUrl,liveid:s.outLiveId,isInit:!0,iconUrl:s.iconUrl||"https://p0.meituan.net/mallimages/fb01d041a9f60d3fdbe338ad72f60e0425959.gif"}):u.log.info(`[mlive] getLiveStream info: ${s}`)}catch(t){u.log.error(`[mlive] getLiveStream err: ${JSON.stringify(t)}`)}},new Promise(((a,i)=>{var n=t=>{try{r(s.next(t))}catch(t){i(t)}},o=t=>{try{r(s.throw(t))}catch(t){i(t)}},r=t=>t.done?a(t.value):Promise.resolve(t.value).then(n,o);r((s=s.apply(t,e)).next())}));var t,e,s},onPlayStateChange(t){var e;const{code:s}=t.detail||t.currentTarget.detail;2005!==s&&(2103!==s&&2007!==s||!this.data.isConnecting&&this.data.isInit&&this.setData({isConnecting:!0,playerBackground:"#000000"}),2003!==s&&2004!==s||(this.data.isInit||this.setData({isInit:!0}),this.removeTip()),-2301!==s&&-2302!==s||null==(e=p.$cat)||e.reportCustomMetrics(h.YXReportTarget.SKU_DETAIL_LIVE_PENDANT,1,{skuid:this.data.skuId,statusCode:s,productid:this.data.productId,poiid:r.$poi.getPoiId()}))},onNetStateChange(t){const{info:e}=t.detail;e.netSpeed>20&&this.removeTip()},onPlayError(t){u.log.error(`[mlive] onPlayError liveId: ${this.data.liveid}, msg:${t.detail}, pullUrl: ${this.data.playerUrl}`)},removeTip(){const{isConnecting:t}=this.data;t&&this.setData({isConnecting:!1,playerBackground:"transparent"})},touchContanier(t){this.startX=t.changedTouches[0].clientX,this.startY=t.changedTouches[0].clientY,this.clientX=this.data.x,this.clientY=this.data.y,this.now=Date.now()},moveContanier(t){this.data.x=this.clientX+t.changedTouches[0].clientX-this.startX,this.data.y=this.clientY+t.changedTouches[0].clientY-this.startY,this.data.x<0&&(this.data.x=0),this.data.y<0&&(this.data.y=0),this.data.y>m-this.calcRpx(100)&&(this.data.y=m-this.calcRpx(100)),this.data.x>y-this.calcRpx(180)&&(this.data.x=y-this.calcRpx(180)),this.data.cssAnimation=`translate3d(${this.data.x}px, ${this.data.y}px, 0)`,this.setData({cssAnimation:this.data.cssAnimation})},endTouch(){Date.now()-this.now<300&&this.gotoLive()},calcRpx(t){const e=750/y;return Math.floor(t/e)}},this.properties={skuId:{type:Number},pageFrom:{type:String,value:""},productId:{type:Number},mvHandler:{type:Function}},this.data={isInit:!1,showLivePendant:!1,showLivePlayer:!1,isConnecting:!0,playerBackground:"transparent",playerUrl:"",liveid:0,isIOS:!!p.$systemInfo.isIOS(),x:0,y:0,cssAnimation:"translate3d(0px, 0px, 0)"}}});