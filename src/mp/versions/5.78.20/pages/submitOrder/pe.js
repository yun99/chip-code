var e=Object.create,t=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,l=(e,r,o)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,c=(e,t)=>{for(var r in t||(t={}))u.call(t,r)&&l(e,r,t[r]);if(a)for(var r of a(t))p.call(t,r)&&l(e,r,t[r]);return e},d=e=>t(e,"__esModule",{value:!0}),h=r=>((e,r,i)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let a of s(r))u.call(e,a)||"default"===a||t(e,a,{get:()=>r[a],enumerable:!(i=o(r,a))||i.enumerable});return e})(d(t(null!=r?e(n(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),m=(e,t,r)=>new Promise(((o,i)=>{var s=e=>{try{n(r.next(e))}catch(e){i(e)}},a=e=>{try{n(r.throw(e))}catch(e){i(e)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,a);n((r=r.apply(e,t)).next())}));((e,r)=>{for(var o in d(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{default:()=>x});var g=h(require("../../ob.js")),f=h(require("../../p0.js")),y=h(require("../../is.js")),P=h(require("../../u8.js")),b=h(require("../../gb.js")),v=h(require("./ci.js")),w=h(require("../../ko.js")),O=h(require("../../cw.js")),S=getApp(),x=class extends O.default{constructor(){super(...arguments),this.initService=function(){this.service=new v.default(this)},this.onChangeMobile=function(e){this.setData({"orderPreview.selfLifting.selfLiftingMobile":e.detail})},this.onChangeName=function(e){this.setData({"orderPreview.resultPersonName":e.detail})},this.toggleNoticeBoardClose=function(){g.log.info("<submitOrder toggleNoticeBoardClose> 关闭消息面板"),this.setData({marginTop:0,noticeBoardShow:!1})},this.togglePayTypeSelect=function(){this.setData({showPayTypePop:!this.data.showPayTypePop})},this.onSelectPayType=function(e){const{payType:t,toggleOneClickSwitch:r}=e.detail,{priceThresholdStatus:o,deliveryPriceThreshold:i}=this.data.orderPreview;let s=t===w.PayType.oneClickPay?"极速支付":"立即支付";o&&(s=`商品满${(0,b.fen2Yuan)(i,2,!0)}元起送`),this.setData({payType:t,toggleOneClickSwitch:r,submitText:s}),g.log.info("<submitOrder onSelectPayType 修改了支付方式",e.detail.payType),this.data.showPayTypePop&&this.togglePayTypeSelect()},this.toggleCouponPackage=function(e){const t=e.detail;g.log.info("<submitOrder toggleCouponPackage> 触发券包开关"),void 0!==t&&(this.setData({"orderPreview.useSwitch.couponPackageInfo.open":t,"orderPreview.couponInfo.couponIds":[-1]}),this.fromSource=8,g.log.info("<submitOrder toggleCardSelect> 调用service.orderPreview"),this.service.orderPreview())},this.toggleMemberCard=function(e){return m(this,null,(function*(){const t=e.detail;g.log.info("<submitOrder toggleRedPackage> 触发红包开关",t),this.setData({"orderPreview.useSwitch.memberInfo.open":t});const r=this.fromSource;this.fromSource=10,yield this.service.orderPreview(),this.fromSource=r}))},this.back=function(){const{fromApp:e}=this.options;"tuanApp"===e&&(0,P.isMT)()?wx.exitMiniProgram():S.$router.triggerBack("submitOrder-back")},this.goBack=function(){const{userWithdrawModel:e,hasFullRedemptionPopupInfo:t}=this.data.orderPreview,{showRefundDetentionPopup:o}=this.data,s=S.$store.getCacheValue("orderFullRedemptionPopupCancelDate")||"",a=S.$store.getCacheValue("submitOrderRefundDetention")||"",n=(0,f.formatTimeToDay)(new Date,"/");s!==n&&(S.$store.setCache("orderFullRedemptionPopupCancelDate",n,{expires:Number.MAX_SAFE_INTEGER}),S.$store.setCache("orderFullRedemptionPopupCancelNum","",{expires:Number.MAX_SAFE_INTEGER}));const u=a!==n&&1===(null==e?void 0:e.popStrategy);u&&S.$store.setCache("submitOrderRefundDetention",n,{expires:Number.MAX_SAFE_INTEGER});const p=S.$store.getCacheValue("orderFullRedemptionPopupCancelNum")||0,l=e&&!o&&(u||2===e.popStrategy);var d,h;t&&p<3?this.setData({orderPreview:(d=c({},this.data.orderPreview),h={showFullRedemptionPopup:!0},r(d,i(h)))}):l?this.setData({showRefundDetentionPopup:!0}):this.back()},this.updateSkuCount=function(e){this.skuCountInfo=e.detail,this.service.orderPreview()},this.toggleCouponAssign=function(){S.$lxLog.mc("b_z6p4i92n"),this.service.queryOrderReturn()},this.closeCouponAssignToast=function(){this.setData({ifCouponAssignToastShow:!1})},this.loading=function(e){(e||this.ifPreviewResponse)&&this.useComponentFunc("#base_loading","loading",e)},this.refreshOrderPreviewInfo=function(e){const{isCancel:t}=e.detail||{};t||this.service.orderPreview()},this.onSkuInfoShowAll=function(e){this.setData({skuInfoShowAll:e.detail})},this.onExtraOnePieceClose=function(){this.fromSource=11,this.refreshOrderPreviewInfo()},this.gotoRemark=function(){if(this.remarkPageRouting)return;this.remarkPageRouting=!0,setTimeout((()=>{this.remarkPageRouting=!1}),800),S.$lxLog.mc("b_youxuan_z6a235eh_mc",{page_from:this.data.fromPage||"-999"});const{selects:e=[],otherText:t=""}=this.remarkObj[this.data.orderPreview.shippingType]||{};S.$router.goto("/subPackages/submitOrderSub/pages/remark/index",{selects:e.join(),otherText:t,nowEdit:this.data.remark||"",shippingType:this.data.orderPreview.shippingType})}}onLoad(e){var t,r;wx.hideShareMenu({}),S.$lxLog.mv("b_youxuan_4r1zj09d_mv",{},{cid:"c_youxuan_di9fwjxp"}),null==(t=this.submitOrderMetricReport)||t.resetReportSymbol(),null==(r=this.submitOrderMetricReport)||r.reportSubmitOrderOnLoadCount(y.YXReportTarget,y.ReportValue,S.$cat,S.$version,S.$systemInfo),this.renderStartTime=Date.now(),this.pageLoad(e)}onReady(){var e;null==(e=this.submitOrderMetricReport)||e.reportSubmitOrderOnReadyCount(y.YXReportTarget,y.ReportValue,S.$cat,S.$version,S.$systemInfo)}onUnload(){clearTimeout(this.timer),S.$store.remove("pickerId")}onPoiInfoUpdated(e){return m(this,null,(function*(){g.log.info("<submitOrder onPoiInfoUpdated> 门店发生变化"),this.remarkObj[this.data.orderPreview.shippingType]=null;const{fromApp:e}=this.options;"tuanApp"===e&&(g.log.info("<submitOrder onPoiInfoUpdated> 门店信息更新，调用onLoadInit，getOrderPreview"),this.onLoadInit(),this.service.orderPreview())}))}onShow(){this.pageOnShow()}pageOnShow(){var e;if(S.$lxLog.pv("c_youxuan_di9fwjxp",{custom:{page_from:this.options.fromPage||"-999"}}),g.log.info("<submitOrder onShow> 提单页onShow触发了"),this._payNotSuccessUrl)return S.$router.goto(this._payNotSuccessUrl,{},{fnName:"redirectTo"});if(this.onShowFromPay)return;const{fromApp:t}=this.options;"tuanApp"!==t&&(this.pageFirstLoad?(this.pageFirstLoad=!1,null==(e=this.submitOrderMetricReport)||e.reportSubmitOrderFMPCount(y.YXReportTarget,y.ReportValue,S.$cat,S.$version,S.$systemInfo)):(0==+this.data.orderPreview.shippingType&&this.getSelectedAddress(),this.service.orderPreview()))}onMvReport(e){S.$lxLog.mv(e.detail.bid,e.detail.lxParams)}};