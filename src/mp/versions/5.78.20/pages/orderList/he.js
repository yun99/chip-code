var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,i=e=>t(e,"__esModule",{value:!0}),l=l=>((e,n,i)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let l of o(n))a.call(e,l)||"default"===l||t(e,l,{get:()=>n[l],enumerable:!(i=r(n,l))||i.enumerable});return e})(i(t(null!=l?e(n(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l),u=(e,t,r)=>new Promise(((o,n)=>{var a=e=>{try{l(r.next(e))}catch(e){n(e)}},i=e=>{try{l(r.throw(e))}catch(e){n(e)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,i);l((r=r.apply(e,t)).next())}));((e,r)=>{for(var o in i(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{PROMOTION_BOOTH_CODE:()=>g,PROMOTION_TACTIC_CODE:()=>O,assembleRequest:()=>P,closeOrder:()=>y,getCancelReason:()=>f,getNoticeInfo:()=>I,getOrderDetail:()=>_,getPromotionComposite:()=>h,getTransactionComposite:()=>C,needPoiAssembleRequest:()=>D});var s=l(require("../../ob.js")),c=l(require("../../u1.js")),d=l(require("./p9.js")),p=l(require("./hq.js")),m="<OrderDetail service>",g={VEGETABLE_MONEY_OR_MONTH_CARD:"BMXPZZRE",FREE_ORDER_POP:"BIQKZYEQ",ACTIVITY_POP:"BKREFCVB",ACTIVITY_BUBBLE:"BIWAEBMB"},O={MONTH_CARD:"TUARRBEV"};function f(e){return u(this,null,(function*(){return(0,c.get)({url:"/mallorder/getCancelReason",params:{orderId:e}})}))}function y(e){return u(this,null,(function*(){return(0,c.post)({url:"/mallorder/closeOrder",body:JSON.stringify(e)})}))}function P(e,t){return u(this,null,(function*(){const r=yield C(e,t);return[r,D(e,null==r?void 0:r.orderDetail)]}))}function D(e,t){const r=getApp(),o=(null==t?void 0:t.poiId)||r.$poiId,n=(null==t?void 0:t.poiIdStr)||r.$poi.getPoiIdStr();return Promise.all([h(e,o,n)])}function C(e,t){return u(this,null,(function*(){let r={};try{if(e){const o=t.action===p.OPTIONS_ACTION.LACK_REFUND_PUSH?1:0,{orderDetail:{data:n=null}={},popupGuide:{data:a=null}={}}=yield d.getOrderDetailTransactionComposite(e,{lackAuthSource:o});r={orderDetail:n,contactGroupHeaderGuideData:a}}}catch(e){s.log.error(m,"[getTransactionComposite] 交易聚合接口异常",e)}return r}))}function h(e,t,r){return u(this,null,(function*(){let o={};try{if(e){const n=[];for(const e in g)Object.hasOwnProperty.call(g,e)&&n.push(g[e]);const a=n.map((t=>({boothCode:t,extParams:{orderId:e}}))),i=yield d.getPromotionComposite([{key:"deliveryResourceQuery",data:a}],{poi:t,poiIdStr:r}),{data:l={}}=(i||[])[0];if(!l.success)throw new Error(l.msg);o=l}}catch(e){s.log.warn(m,"[getPromotionComposite] 调用营销聚合接口报错",e)}return o}))}function _(e){return u(this,arguments,(function*(e,t={}){var r;let o=null;if(e)try{s.log.info(m,`[getOrderDetail] 准备获取订单详情数据,${e}`),o=yield d.getOrderDetailTransactionComposite(e,t),o=null==(r=null==o?void 0:o.orderDetail)?void 0:r.data,s.log.info(m,"[getOrderDetail] 准备获取订单详情数据 data",o)}catch(t){s.log.error(m,`[getOrderDetail] 获取订单详情失败, ${e}`,t),getApp().page().toast({message:t.message||"获取订单详情失败，请稍后重试"})}return o}))}function I(e){return u(this,null,(function*(){getApp();return{}}))}