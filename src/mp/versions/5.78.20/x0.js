function e(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,n)}return r}function a(a){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?e(Object(t),!0).forEach((function(e){n(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):e(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function r(e,a){for(var r=0;r<a.length;r++){var n=a[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}var t,o,c,i,s,u={env:new(function(){function e(){!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"tradeno",""),n(this,"abTestConfig",{}),n(this,"openId",""),n(this,"commonParams",{app:"weixin",source:"miniprogram"}),n(this,"queryUrlParams",{})}var t,o,c;return t=e,o=[{key:"setTradeNo",value:function(e){this.tradeno=e}},{key:"setABTestConfig",value:function(e){this.abTestConfig=e}},{key:"setOpenId",value:function(e){this.openId=e}},{key:"setCommonParams",value:function(e){this.commonParams=a(a({},this.commonParams),e)}},{key:"setQueryUrlParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.queryUrlParams=e}}],o&&r(t.prototype,o),c&&r(t,c),e}())},l=u.env,p=getApp(),d=p&&p.owl,f=function(e){o&&o.error.pushError(e,!0)},y=function(e,a,r,n){try{f({content:""+JSON.stringify(a),category:r,sec_category:e,level:n})}catch(e){try{f({content:""+e.stack,category:"jsError",sec_category:"monitor reportDetailError 函数出现异常",level:"error"})}catch(e){}}},m=(c=1e3,i=function(){t.report(),t.clearMetric()},s=null,function(){var e=this,a=arguments;clearTimeout(s),s=setTimeout((function(){i.apply(e,a)}),c)}),h=function(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";y(e,a,"jsError",r)};var b={test:"test",staging:"staging",production:"production"},g=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var r={project:"com.sankuai.fspfepayresource.finance.pay",devMode:e,resource:{sample:1,errSample:1},onErrorPush:function(e){return e.updateTags(a({},l.commonParams))}};o=new d.OWL(r),t=o.newMetric()}catch(e){}},k=h,v=u.env,P=b,_=function(e){var a;return k("[原生]业务方接入参".concat((a=getCurrentPages())[a.length-1].route||""),{options:e}),e.sdkVersion?e:function(e){var a={};return Object.keys(e).forEach((function(r){a[r]=decodeURIComponent(e[r])})),a}(e)},I=function(e){g(e.runtime===P.test),function(e){var a=getApp().globalData,r=a.openId,n=a.userId,t=_(e),o=t.tradeno,c=void 0===o?"":o,i=t.from,s=t.callback_app_id,u=t.sdkVersion,l=void 0===u?"":u,p=t.nbVersion,d=void 0===p?"":p;v.setQueryUrlParams(t),v.setTradeNo(c),v.setOpenId(r),v.setCommonParams({sdkVersion:l,nbVersion:d,tradeno:c||"",from:i,userid:n,app_id:s})}(e)},O=u.env,T={preposedCashier:"preposed-cashier",standardMiniprogramCashier:"standard-miniprogram-cashier",standardH5Cashier:"standard-h5-cashier",exceptionCashier:"exception-cashier"},w={default:"default",success:"success",fail:"fail",cancel:"cancel"},j={wx:"wxpay",mt:"mtpay"},C=b,S=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;t||(t=o&&o.newMetric()),t&&"string"==typeof e&&(t.setTags(a(a({},l.commonParams),r)),t.setMetric(e,n),m())},N=h,x={sdkVersion:{name:"@fdfe/finance-pay",version:"3.0.5",description:"",main:"dist/index.js",scripts:{test:'echo "Error: no test specified" && exit 1',build:"rollup --config rollup.config.js"},author:"",license:"ISC",dependencies:{"@babel/runtime-corejs3":"^7.14.7","core-js":"^3.16.1"},devDependencies:{"@babel/core":"^7.15.0","@babel/plugin-transform-runtime":"^7.14.5","@babel/preset-env":"^7.15.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^20.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.4",rollup:"^2.56.2"},browserslist:["android >= 5.0.0","ios >= 10"]}.version,nbVersion:"4.6.0"},D="sdk_start",q="sdk_callup_cashier",U="sdk_success_callback",E="sdk_cancel_callback",M="sdk_fail_callback",V=getApp(),K=C.production,F=!1;function J(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;setTimeout((function(){F&&(F=!1)}),e)}function A(e){wx.navigateTo({url:e,success:function(){N("[sdk]navigateTo 跳转成功",{url:e})},fail:function(e){N("[sdk]navigateTo 跳转失败",{error:e},"error")}},!0)}function B(e){return Object.keys(e).map((function(a){return a+"="+encodeURIComponent(e[a]||"")})).join("&")}var R={mtpay:{requestFinancePaySDKInfo:function(){return{sdkInfo:JSON.stringify(x)}},requestFinancePayment:function(e){if(!F){F=!0,J(6e3),I(a(a({},e),x)),S(D);var r=function(e){K=e.runtime,function(e){V.financePay={};var r=function(e){V.financePay.tradeNo!==e.tradeNo&&N("[sdk]唤起和支付订单 tradeno 不一致,触发".concat(e.callbackFun,"回调"),{tradeNoFromCashier:e.tradeNo,tradeNoFromApp:V.financePay.tradeNo})},n=function(e){var a=e;return delete a.cashierType,a};V.financePay.callbackSDKPay=function(t,o){switch(r(a(a({},o),{},{callbackFun:t})),t){case w.success:N("[sdk]支付成功",o),S(U,o),J(500),e.success&&e.success(n(o));break;case w.fail:N("[sdk]支付失败".concat(o.message||""),o,"error"),S(M,o),J(0),e.fail&&e.fail(n(o));break;case w.cancel:case w.default:default:N("[sdk]支付取消",o),S(E,o),J(0),e.cancel&&e.cancel(n(o))}}}(e),r=e,["runtime","callback_app_id","from","productInfo"].forEach((function(e){r[e]||(K===C.test&&wx.showModal({content:"接入参数错误 ".concat(e," 字段未传"),success:function(e){e.confirm},confirmText:"知道了",showCancel:!1}),N("[sdk]接入参数错误 ".concat(e," 未传"),{params:r}))}));var r;var n={};try{n=JSON.parse(e.productInfo),V.financePay.tradeNo=n.tradeNo}catch(e){return V.financePay.callbackSDKPay(w.fail,{message:"[sdk]JSON.parse productInfo 失败（前端）",cashierType:T.exceptionCashier,resultSouceType:j.mt}),{productInfo:n}}return{productInfo:n}}(e);if(n=r.productInfo,0!==Object.keys(n).length){var n,t,o,c=r.productInfo.productType||"",i=r.productInfo.sdkType||"";"preposed-cashier"===c?(S(q,{cashierType:T.preposedCashier}),function(e){var r=e.productInfo,n={},t={tradeNo:r.tradeNo,cashierType:T.preposedCashier,resultSouceType:j.wx};try{n=JSON.parse(r.url)}catch(e){return void V.financePay.callbackSDKPay(w.fail,a(a({},t),{},{message:"[sdk]JSON.parse productInfo.url 失败（前端）",resultSouceType:j.mt}))}if(K===C.test)return V.financePay.callbackSDKPay(w.success,t),void("navigateBack"!==O.queryUrlParams.callback_type&&A(O.queryUrlParams.callback_path));wx.requestPayment(a(a({},n),{},{success:function(){V.financePay.callbackSDKPay(w.success,t),"navigateBack"!==O.queryUrlParams.callback_type&&A(O.queryUrlParams.callback_path)},fail:function(e){"requestPayment:fail:cancel"===e.errMsg||"requestPayment:fail cancel"===e.errMsg?V.financePay.callbackSDKPay(w.cancel,a(a({},e),t)):V.financePay.callbackSDKPay(w.fail,a(a({},e),t))}}))}(r)):"standard-cashier"===c&&"miniprogram"===i?(S(q,{cashierType:T.standardMiniprogramCashier}),t=a(a({},e),r),delete(o=a(a({runtime:K},t),{},{tradeno:t.productInfo.tradeNo||"",pay_token:t.productInfo.payToken||"",standardParam:t.productInfo.standardParam||"",nbVersion:x.nbVersion,sdkVersion:x.sdkVersion})).success,delete o.fail,delete o.cancel,delete o.productInfo,A("/finance-pay/pages/cashier/index?".concat(B(o)))):"standard-cashier"===c&&"h5"===i?(S(q,{cashierType:T.standardH5Cashier}),function(e){var a=V.globalData,r=a.openId,n=a.uuid,t=a.cityId,o=a.token,c=a.appid,i=a.location,s=void 0===i?{}:i,u=a.mt_localCity,l=void 0===u?{}:u,p=a.mtpayCityId,d={token:o,auth:"v2",tradeno:e.productInfo.tradeNo,pay_token:e.productInfo.payToken,pay_success_url:e.callback_path,nb_app:"weixin",nb_location:"".concat(s.latitude||0,"_").concat(s.longitude||0),nb_ci:p||l&&l.id||t||"",openid:r,app_id:c,ext_param:e.ext_param||"",nb_uuid:n,degrade_ext_param:e.productInfo.standardParam,degradeFromMiniprogramSDK:1,callback_type:O.queryUrlParams.callback_type},f="https://npay.meituan.com";K===C.test?f="http://stable.pay.test.sankuai.com":K===C.staging&&(f="https://stable-pay.st.meituan.com");var y="".concat(f,"/i/cashier/show/index?").concat(B(d)),m={tradeno:e.productInfo.tradeNo,from:e.from};A("/finance-pay/pages/h5/index?weburl=".concat(encodeURIComponent(y),"&").concat(B(m)))}(a(a({},e),r))):V.financePay.callbackSDKPay(w.fail,{tradeNo:r.productInfo.tradeNo,cashierType:T.exceptionCashier,resultSouceType:j.mt,message:"[sdk]进入收银台数据异常，无法唤起任意收银台(前端)"})}}}}};module.exports=R;