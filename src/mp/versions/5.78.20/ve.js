var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,i=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,u=(e,r,o)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,a=(e,t)=>{for(var r in t||(t={}))l.call(t,r)&&u(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&u(e,r,t[r]);return e},p=e=>t(e,"__esModule",{value:!0}),c=n=>((e,n,i)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let s of o(n))l.call(e,s)||"default"===s||t(e,s,{get:()=>n[s],enumerable:!(i=r(n,s))||i.enumerable});return e})(p(t(null!=n?e(i(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),y=(e,t,r)=>new Promise(((o,n)=>{var i=e=>{try{s(r.next(e))}catch(e){n(e)}},l=e=>{try{s(r.throw(e))}catch(e){n(e)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,l);s((r=r.apply(e,t)).next())}));((e,r)=>{for(var o in p(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{default:()=>O});var d=c(require("./u8.js")),h=c(require("./ob.js")),m=c(require("./v2.js")),{qs:f}=require("./p0.js"),g=require("./p3.js"),b="[Router]:ProxyActivity",O=class{constructor(e){this.proxyDefferor=new m.default,this.getAppShowOptions=()=>this.appShowOptions,this.runInterceptor=e=>y(this,null,(function*(){const t=(0,d.isApp)()&&getApp().$systemInfo.isIOS()?this.query:this.appShowOptions.getQuery();h.log.warn(b,"执行函数 runInterceptor","query是：",t,"eventInfo信息是：",e,`protocol是：${null==t?void 0:t.protocol}`,"isHandled",this.isHandled);const{protocol:r=""}=t||{};try{r&&!this.isHandled&&(this.isHandled=!0,yield this.handleProtocol(t)),this.isHandled&&h.log.warn(b,"执行函数 runInterceptor后：无跳转行为"),delete t.protocol}catch(e){h.log.warn(b,"执行函数 runInterceptor后：跳转失败"),this.isHandled=!1}return h.log.info(b,"执行函数 runInterceptor后: query",t),t})),this.handleProtocol=(e,t=!1)=>y(this,null,(function*(){const{protocol:r=""}=a({},e);if(r){h.log.warn(b,"handleProtocol",e);const[o=""]=decodeURIComponent(r.trim()).split("?"),n=g.parse(decodeURIComponent(r.trim()),!0);let i=n.query;return e&&"object"==typeof e&&(i=a(a({},e),n.query),t&&(i.need_type="redirectTo")),delete i.protocol,i.noHandTouch=!0,i&&Object.keys(i).length&&(i._routerEncodeCount=1),yield this.$router.goto(`${o}?${f.stringify(i)}`),!0}return!1})),this.$router=e}init(e){this.appShowOptions=e.$appShowOptions,this.isHandled=!1}initYXQuery(e){try{this.query=JSON.parse(JSON.stringify(e))}catch(t){this.query=Object.assign({},e),h.log.warn(b,"initYXQuery","query是：",this.query,t)}h.log.info(b,"initYXQuery","query是：",this.query),this.isHandled=!1}};module.exports={ProxyActivity:O};