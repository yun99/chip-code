var e=Object.create,r=Object.defineProperty,t=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,i=(e,t,l)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,o=e=>r(e,"__esModule",{value:!0}),m=a=>((e,a,n)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let u of l(a))s.call(e,u)||"default"===u||r(e,u,{get:()=>a[u],enumerable:!(n=t(a,u))||n.enumerable});return e})(o(r(null!=a?e(n(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);((e,t)=>{for(var l in o(e),t)r(e,l,{get:t[l],enumerable:!0})})(exports,{default:()=>C});var c=m(require("./20.js")),p=m(require("./ms.js")),g=m(require("./31.js")),d=m(require("./35.js")),y=m(require("./34.js")),U=m(require("./vw.js")),f=m(require("./po.js")),E=m(require("./ob.js")),{MOUDULE_NAME:O}=(require("./p3.js"),require("./vw.js")),{CAT_SEC_CATEGORY:w}=require("./iu.js"),{JUMP_PROTOCOL:D}=require("./sy.js"),{qs:_}=require("./p0.js"),C=class extends c.default{constructor(){super(),this.shouldHandle=e=>{const r=e.getUri().getScheme(),t=e.getUri().getHost();e.getUri().getQuery();let l="imaicai:"===r||"iretail:"===r||"iyouxuan:"===r||"igrocery:"===r;return l||"imeituan:"!==r||"www.grocery.com"!==t&&"www.maicai.com"!==t||(l=!0),l},this.needInterceptor=e=>{let r=!1;const t=e.getUri().getQuery();if(t.need_login){"1"===(Array.isArray(t.need_login)?t.need_login[0]:t.need_login)&&(r=!0,this.addInterceptor(new g.default(this)))}t.need_type&&e.fn.setExtFnName(t.need_type);const l=e.getUri().getPath();return"/mgc"===l&&(r=!0,this.addInterceptor(new d.default(this))),/^\/marketingGame\/.*/.test(l)&&(r=!0,this.addInterceptor(new y.default(this))),r},this.handleInternal=e=>{const r=e.getUri();let t=r.getPath();const l=r.getQuery();if("/web_knb"===t&&(t="/web"),"/web"===t){const e=l.url;return Promise.resolve({resultCode:p.RESULT_CODE.NEXT,finallyUrl:e})}if("/mp"===t)return this.handleMP(e);if("/mmp"===t)return this.handleMP(e);if("/mpback"===t)return this.handleMPBack(e);let n="",o=((e,r)=>{for(var t in r||(r={}))s.call(r,t)&&i(e,t,r[t]);if(a)for(var t of a(r))u.call(r,t)&&i(e,t,r[t]);return e})({},l);if(D.forEach((e=>{t===`/${e.protocol}`&&(n=e.targetPage,Object.keys(o).length&&e.queryHandler&&"function"==typeof e.queryHandler&&(o=e.queryHandler(l)))})),n){const e=`${U.IROUTER_PREFIX}${-1!==n.indexOf("?")?`${n}&`:`${n}?`}${_.stringify(o)}`;return Promise.resolve({resultCode:p.RESULT_CODE.NEXT,finallyUrl:e})}return Promise.resolve({resultCode:p.RESULT_CODE.NOT_FOUND,finallyUrl:r.getUrl(),errMsg:"未支持该协议"})},this.handleMP=e=>{const r=e.getUri(),t=r.getQuery();return E.log.warn(O,"跳转另一个小程序",r.getUrl(),t),new Promise(((e,l)=>{wx.navigateToMiniProgram?t.appId?(E.log.warn(O,"跳转另一个小程序："+((0,f.isMMP)()?"mmp":"wx"),r.getUrl(),t),wx.navigateToMiniProgram({appId:t.appId,path:t.path||"",extraData:t.extraData||t||{},envVersion:t.envVersion||"release",success:t=>{e({resultCode:p.RESULT_CODE.SUCCESS,finallyUrl:r.getUrl(),errMsg:null==t?void 0:t.errMsg})},fail:e=>{l({resultCode:p.RESULT_CODE.ERROR,finallyUrl:r.getUrl(),errMsg:null==e?void 0:e.errMsg})}})):l({resultCode:p.RESULT_CODE.REQUEST_ERROR,finallyUrl:r.getUrl(),errMsg:"参数错误，appId必传"}):l({resultCode:p.RESULT_CODE.NOT_FOUND,finallyUrl:r.getUrl(),errMsg:"未支持该协议"})}))},this.handleMPBack=e=>{const r=e.getUri(),t=r.getQuery();return new Promise(((e,l)=>{wx.navigateBackMiniProgram?t.appId?wx.navigateBackMiniProgram({extraData:t.extraData||t||{},success:t=>{e({resultCode:p.RESULT_CODE.SUCCESS,finallyUrl:r.getUrl(),errMsg:null==t?void 0:t.errMsg})},fail:e=>{l({resultCode:p.RESULT_CODE.ERROR,finallyUrl:r.getUrl(),errMsg:null==e?void 0:e.errMsg})}}):l({resultCode:p.RESULT_CODE.REQUEST_ERROR,finallyUrl:r.getUrl(),errMsg:"参数错误，appId必传"}):l({resultCode:p.RESULT_CODE.NOT_FOUND,finallyUrl:r.getUrl(),errMsg:"未支持该协议"})}))},this.name="MallUriHandler"}};