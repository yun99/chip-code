var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,s=e=>t(e,"__esModule",{value:!0}),c=c=>((e,n,s)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let c of o(n))a.call(e,c)||"default"===c||t(e,c,{get:()=>n[c],enumerable:!(s=r(n,c))||s.enumerable});return e})(s(t(null!=c?e(n(c)):{},"default",c&&c.__esModule&&"default"in c?{get:()=>c.default,enumerable:!0}:{value:c,enumerable:!0})),c);((e,r)=>{for(var o in s(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{default:()=>f});var l=c(require("./dg.js")),i=c(require("./j9.js")),p=c(require("./k5.js")),g=c(require("./dj.js")),u=[],f=class{constructor(e){this.cfgManager=e}pushError(e,t){try{let r=this.cfgManager.config;(0,l.getEnv)().then((o=>{let n=e;if(n instanceof g.default||(n=new g.default(e)),n=this._handleError(n),n){let a=(0,i.getVersions)(r);n=n.updateTags(a),n=n.toJson(),e=this.parse(n);let{network:s,container:c,os:l,unionId:p}=o;p=r.unionId||p,e=Object.assign({network:s,container:c,os:l,unionId:p},e),u.push(e),t&&this.report()}}))}catch(e){this.reportSystemError(e)}}_handleError(e){try{let t=this.cfgManager.get("onErrorPush");if("function"==typeof t&&(e=t(e)),e instanceof g.default||void 0===e)return e}catch(t){return e}}parse(e){return e.project||(e.project=this.cfgManager.get("project")),e.pageUrl||(e.pageUrl=this.cfgManager.get("pageUrl")||(0,l.getPageUrl)()),e}addError(e,t,r){e=e||"default";let o=(t=t||"error").category||p.CATEGORY.SCRIPT,n=t.level||p.LEVEL.ERROR,a=t.pageUrl||"";try{t instanceof g.default||(t instanceof Error?t=t.stack||t.message:"object"==typeof t&&(t={sec_category:t.name,content:t.msg})),this.pushError({sec_category:e,content:t,category:o,level:n,pageUrl:a},r)}catch(e){this.reportSystemError(e)}}reportSystemError(e){if(e)try{(0,l.getEnv)().then((t=>{u.push(new g.default({project:"owl",pageUrl:"wxapp_version_"+p.VERSION,sec_category:e.message||e.name||"parseError",content:e.stack?JSON.stringify(e.stack):e.toString&&e.toString()||""})),this.report()})).catch((e=>{}))}catch(e){}}onError(e="",t="jsError"){if(!e)return;let r,o,n;try{if("string"==typeof e?o=e:"object"==typeof e&&(o=e.message||e.toString()),o&&"string"==typeof o)if(o.indexOf("SDKScriptError")>-1||o.indexOf("webviewScriptError")>-1)n=!0;else{let e=o.replace("thirdScriptError","").split(";");r=(e&&e.length&&e[0]||"").replace(/\t|\n/g,"")}if(!n){let e=this.cfgManager.get("pageUrl")||(0,l.getPageUrl)()||"";this.pushError(new g.default({sec_category:r||"Unknown error",content:o||"",pageUrl:e,category:t,level:p.LEVEL.ERROR}),!0)}}catch(e){this.reportSystemError(e)}}onPromiseRejection(e){try{this.pushError(new g.default({sec_category:e.message?"[unhandledrejection] "+e.message:"unhandledrejection",content:e.stack||e.message||"",pageUrl:this.cfgManager.get("pageUrl")||(0,l.getPageUrl)()||""}),!0)}catch(e){this.reportSystemError(e)}}report(e,t){if(u.length)try{let r=[].concat(u);u=[];const o=this.cfgManager;let n=(0,i.stringify)(o.getApiPath("error"));n+=`&pageId=${o.get("pageId")}&${(0,i.getReportVersions)(o.config)}`,(0,i.requestQueue)({url:n,data:"c="+encodeURIComponent(JSON.stringify(r)),method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded"},success(t){r=[],"function"==typeof e&&e(t)},fail(e){u=r.concat(u),"function"==typeof t&&t(e)}})}catch(e){this.reportSystemError(e)}}};