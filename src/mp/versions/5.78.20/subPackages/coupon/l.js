var t=Object.create,e=Object.defineProperty,a=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,r=r=>{return((t,n,r)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let u of o(n))s.call(t,u)||"default"===u||e(t,u,{get:()=>n[u],enumerable:!(r=a(n,u))||r.enumerable});return t})((u=e(null!=r?t(n(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0}),e(u,"__esModule",{value:!0})),r);var u},u=r(require("../../jc.js")),i=r(require("../../az.js")),c=r(require("./2a.js")),l=getApp();(0,u.defineComponent)(new class{constructor(){this.debounce=!1,this.attached=function(){},this.observers={moduleParams:function(t){this.initCommonData(t)}},this.methods={initCommonData(t){var e;const{reducePriceType:a,reducePrice:o=""}=t;let n="",s="";2===a?n=o:(n=parseFloat(o).toString(),s=(null==(e=o.replace)?void 0:e.call(o,/\d+\.?\d?/g,""))||(0===a?"¥":"")),this.setData({reducePriceNumber:n,reducePriceUnit:s,buttonStatus:this.setButtonStatus(t.btnLabel||"")})},setButtonStatus:t=>-1!==t.indexOf("立即领取")?c.EButtonStatus.TAKE_COUPON:-1!==t.indexOf("去使用")?c.EButtonStatus.USE_NOW:0,getRiskParams(){return t=this,e=null,a=function*(){this.riskParams=yield(0,i.getRiskParamsWeChat)()},new Promise(((o,n)=>{var s=t=>{try{u(a.next(t))}catch(t){n(t)}},r=t=>{try{u(a.throw(t))}catch(t){n(t)}},u=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,r);u((a=a.apply(t,e)).next())}));var t,e,a},tapButton(){switch(this.data.buttonStatus){case c.EButtonStatus.USE_NOW:this.gotoAddOnPage();break;case c.EButtonStatus.TAKE_COUPON:this.takeCoupon()}},takeCoupon(){const{moduleFrom:t}=this.data;this.debounce||this.getRiskParams().then((()=>{this.debounce=!0,l.$service.takeSkuDetailCouponNew({couponConfigId:this.data.moduleParams.couponConfigId,riskParams:this.riskParams,couponPageType:"redPacketTips"===t?3:2,couponType:this.data.moduleParams.member?"MEMBER":"NORMAL"}).then((t=>{var e;this.debounce=!1,t&&t.result&&(l.page().toast("领取成功"),this.triggerEvent("takeCoupon",t),this.setData({"moduleParams.btnLabel":t.btnLabel,"moduleParams.btnLink":t.btnLink||"",buttonStatus:c.EButtonStatus.USE_NOW})),t&&!t.result&&(null==(e=null==l?void 0:l.page())||e.toast(t.message||"优惠券领取失败"))})).catch((t=>{var e;this.debounce=!1,null==(e=null==l?void 0:l.page())||e.toast(t&&t.message||"优惠券领取失败")}));const{bid:e="",index_id:a="",coupon_id:o=""}=this.data.mvProps;"redPacketTips"===t&&l.$lxLog.mc(e,{index_id:a,coupon_id:o})}))},gotoAddOnPage(){var t;const{btnLink:e="",coupon_id:a=""}=null==(t=this.data)?void 0:t.moduleParams;e&&e.length&&("redPacketTips"===this.data.moduleFrom&&l.$lxLog.mc("b_youxuan_ohj788aj_mc",{coupon_id:a}),l.$router.goto(e,{trafficSource:this.data.trafficSource}))},showDescription(){this.setData({needFold:!this.data.needFold})}},this.properties={moduleParams:{type:Object},skuId:{type:Number,value:-1},moduleFrom:{type:String,value:""},mvProps:{type:Object,value:{bid:"",traceId:"",mvHandler:()=>{}}},trafficSource:{type:String,value:""}},this.data={needFold:!0,reducePriceNumber:"",reducePriceUnit:"",buttonStatus:0}}});