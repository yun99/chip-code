var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,c=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,n=(e,t)=>{for(var i in t||(t={}))r.call(t,i)&&c(e,i,t[i]);if(a)for(var i of a(t))s.call(t,i)&&c(e,i,t[i]);return e},o=(e,a)=>t(e,i(a));Component(new class{constructor(){this.ready=function(){const e=getApp(),{screenHeight:t=667}=e.getModule("systemInfo").systemInfo;this.setData({popupMaxHeight:(2*t*3-45)/4+"rpx",scrollHeight:(2*t*3-45)/4-110+"rpx"})},this.methods={prevents(){},closeSpecModal(){this.setData({show:!1})},setSelectedAllFalse(e){const t=[this.data.skuSpecialScreenData,...this.data.skuPropertyScreenData].filter((e=>e));return e=(e||[]).map(((e,i)=>{if(e&&(e.radioList||[]).length){const a=e.radioList.map((e=>o(n({},e),{selected:!1})))||[];return o(n({},e),{radioList:a,isFold:t[i]&&t[i].isFold&&!0})}return null})).filter((e=>e))},setDefaultFold(){let{referenceFoldNum:e,skuSpecialScreenData:t,skuPropertyScreenData:i}=this.data;t=t?o(n({},t),{isFold:!!(t.radioList.length>e)}):null,i=i.map((t=>o(n({},t),{isFold:!!(t.radioList.length>e)}))),this.setData({skuSpecialScreenData:t,skuPropertyScreenData:i})},reset(e){var t;e.currentTarget&&e.currentTarget.dataset&&e.currentTarget.dataset.isBtn&&this.triggerEvent("tapSearchOptions",{field:"reset",aggregationItemList:[]});let i=!e||e.currentTarget?null==(t=this.data.screenData)?void 0:t.siftItems:e;i=i||[],i=this.setSelectedAllFalse(i),this.setData({priceSelectIndex:-1,lowPrice:"",highPrice:"",skuSpecialScreenData:i.filter((e=>-4===e.screenItem.itemId))[0]||null,skuPropertyScreenData:i.filter((e=>-4!==e.screenItem.itemId))||[]})},tagSelect(e){const{screenItem:t,item:i,type:a,index:r,featureName:s,feature:c,featureIndex:l}=e.currentTarget.dataset;switch(a){case"Special":{let{skuSpecialScreenData:e}=this.data;const t=(e.radioList||[]).map((e=>i.meta.itemId===e.meta.itemId?o(n({},e),{selected:!e.selected}):e));e=o(n({},e),{radioList:t}),this.setData({skuSpecialScreenData:e},(()=>{this.triggerEvent("tapSearchOptions",{field:"options",options:{title:i.meta.itemValue,is_selected:i.selected?0:1,feature:c,index:r,featureName:s,featureIndex:l},aggregationItemList:this.aggregateData()})}));break}case"Price":this.data.priceSelectIndex===r?(this.triggerEvent("tapSearchOptions",{field:"options",options:{title:`${i.lowPrice/100}-${i.highPrice/100}`,is_selected:0}}),this.setData({priceSelectIndex:-1,lowPrice:"",highPrice:""})):(this.triggerEvent("tapSearchOptions",{field:"options",options:{title:`${i.lowPrice/100}-${i.highPrice/100}`,is_selected:1}}),this.setData({priceSelectIndex:r,lowPrice:+i.lowPrice,highPrice:+i.highPrice}));break;case"Property":{let{skuPropertyScreenData:e}=this.data;e=(e||[]).map((e=>e.screenItem.itemId===t.itemId?o(n({},e),{radioList:e.radioList.map((e=>e.meta.itemId===i.meta.itemId?o(n({},e),{selected:!e.selected}):e))}):e)),this.setData({skuPropertyScreenData:e},(()=>{this.triggerEvent("tapSearchOptions",{field:"options",options:{title:i.meta.itemValue,is_selected:i.selected?0:1,index:r,featureIndex:this.data.skuSpecialScreenData&&this.data.skuSpecialScreenData.radioList?l+1:l,featureName:s,feature:c},aggregationItemList:this.aggregateData()})}))}}},inputGetFocus(e){const{inputFocus:t=""}=e.currentTarget.dataset;"lowPrice"===t?this.setData({inputLowPriceFocus:!0}):this.setData({inputHighPriceFocus:!0})},inputLoseFocus(e){const{inputFocus:t=""}=e.currentTarget.dataset;"lowPrice"===t?this.setData({inputLowPriceFocus:!1}):this.setData({inputHighPriceFocus:!1})},onLowHighPriceInput(e){const{inputFocus:t}=e.currentTarget.dataset,i=""===e.detail.value?"":Number(e.detail.value),{priceItems:a=[]}=this.data.screenData;let{priceSelectIndex:r}=this.data;if(""!==i){const{lowPrice:e,highPrice:s}=this.data,c=a.map(((a,r)=>"lowPrice"===t?""===s?-1:a.lowPrice===100*+i&&s===a.highPrice?r:-1:""===e?-1:a.highPrice===100*+i&&e===a.lowPrice?r:-1)).filter((e=>-1!==e));r=c.length>0?c[0]:-1}else r=-1;"lowPrice"===t?(this.triggerEvent("tapSearchOptions",{field:"options",options:{title:`${""===i?"":i}-${""===this.data.highPrice?"":this.data.highPrice/100}`,is_selected:1}}),this.setData({lowPrice:""===i?"":100*+i,priceSelectIndex:r})):(this.triggerEvent("tapSearchOptions",{field:"options",options:{title:`${""===this.data.lowPrice?"":this.data.lowPrice/100}-${""===i?"":i}`,is_selected:1}}),this.setData({highPrice:""===i?"":100*+i,priceSelectIndex:r}))},togglePanel(e){const{screenItem:t,item:i,type:a}=e.currentTarget.dataset,{skuSpecialScreenData:r,skuPropertyScreenData:s}=this.data;switch(a){case"Special":this.setData({skuSpecialScreenData:o(n({},r),{isFold:!this.skuSpecialScreenData.isFold})});break;case"Property":this.setData({skuPropertyScreenData:s.map((e=>e.screenItem.itemId===t.itemId?o(n({},e),{isFold:!e.isFold}):e))});break}},aggregateData(){const{skuSpecialScreenData:e,skuPropertyScreenData:t}=this.data;return[...[e].filter((e=>e)).map((e=>{const t=e.radioList.filter((e=>e.selected));if(t.length)return{item:e.screenItem.itemId,items:t.map((e=>e.meta)).filter((e=>e))}})).filter((e=>e)),...(t||[]).map((e=>{const t=e.radioList.filter((e=>e.selected));if(t.length)return{item:e.screenItem.itemId,items:t.map((e=>e.meta)).filter((e=>e))}})).filter((e=>e))]},onOk(){this.triggerEvent("tapSearchOptions",{field:"onOk"});const{priceSelectIndex:e,skuSpecialScreenData:t,skuPropertyScreenData:i}=this.data,a=[t].filter((e=>e)).map((e=>{const t=e.radioList.filter((e=>e.selected));if(t.length)return{item:e.screenItem.itemId,items:t.map((e=>e.meta)).filter((e=>e))}})).filter((e=>e));let r={};if(-1!==e)r={priceItems:(this.data.screenData.priceItems||[])[e]};else{const{lowPrice:e,highPrice:t}=this.data;let i=Number.isNaN(e)||"number"!=typeof e?{}:{lowPrice:e};if(i=Number.isNaN(t)||"number"!=typeof t?i:o(n({},i),{highPrice:t}),!Number.isNaN(e)&&!Number.isNaN(t)&&"number"==typeof e&&"number"==typeof t&&e>t){const e=i.highPrice,t=i.lowPrice;r={priceItems:{lowPrice:e,highPrice:t}};const{priceItems:a=[]}=this.data.screenData,s=a.map(((i,a)=>i&&i.lowPrice===e&&i.highPrice===t?a:-1)).filter((e=>-1!==e))[0];this.setData({lowPrice:e,highPrice:t,priceSelectIndex:s||-1})}else r={priceItems:i};e||t||0===e||0===t||(r={})}const s=(i||[]).map((e=>{const t=e.radioList.filter((e=>e.selected));if(t.length)return{item:e.screenItem.itemId,items:t.map((e=>e.meta)).filter((e=>e))}})).filter((e=>e));this.triggerEvent("skuNavChange",{priceItems:r,aggregationItemList:[...a,...s]}),this.closeSpecModal()}},this.properties={type:{type:String,value:"bottom"},show:{type:Boolean,value:!1},isShowPrice:{type:Boolean,value:!0},screenData:{type:Object,value:{},observer(e){if(!e)return;const{siftItems:t=[]}=e;this.reset(t),this.setDefaultFold()}}},this.data={skuSpecialScreenData:null,skuPropertyScreenData:[],priceSelectIndex:-1,focus:"",lowPrice:"",highPrice:"",hidePanel:{},referenceFoldNum:8,inputLowPriceFocus:!1,inputHighPriceFocus:!1}}});