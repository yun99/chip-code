var e=Object.create,t=Object.defineProperty,o=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,s=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,p=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,u=r=>{return((e,r,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let i of a(r))n.call(e,i)||"default"===i||t(e,i,{get:()=>r[i],enumerable:!(s=o(r,i))||s.enumerable});return e})((i=t(null!=r?e(s(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0}),t(i,"__esModule",{value:!0})),r);var i},l=(e,t,o)=>new Promise(((a,r)=>{var s=e=>{try{i(o.next(e))}catch(e){r(e)}},n=e=>{try{i(o.throw(e))}catch(e){r(e)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,n);i((o=o.apply(e,t)).next())})),c=u(require("../../ob.js")),d=u(require("../../az.js")),g=u(require("./a6.js")),m=getApp();Component({options:{multipleSlots:!0},properties:{recGoodCoupons:{type:Array,observer(e){this.data.recGoodCoupons.length&&this.setData({recGoodCouponsPage:this.data.recGoodCoupons})}},tab:{type:Number}},data:{recGoodCouponsPage:[],riskParams:"",TAB_NAME_DICT:{1:"未使用",2:"已使用",3:"已失效"}},methods:{takeCoupon(e){return l(this,null,(function*(){m.page().loading(!0),yield this.setFinger();const{index:t}=e.currentTarget.dataset,{couponConfigId:o}=this.data.recGoodCoupons[t],{riskParams:a}=this.data;if(!this.data.riskParams)return m.page().toast({message:"获取优惠券失败，请稍后重试"}),void m.page().loading(!1);(0,g.takeCoupon)({couponConfigId:o,riskParams:a,couponPageType:1}).then((e=>{m.page().loading(!1);const{fresh:o,btnLabel:a,status:r,valid:s,btnLink:n,message:i,validTime:p,addCart:u}=e;e.result?(this.setData({[`recGoodCouponsPage[${t}].fresh`]:o,[`recGoodCouponsPage[${t}].btnLabel`]:a,[`recGoodCouponsPage[${t}].status`]:r,[`recGoodCouponsPage[${t}].valid`]:s,[`recGoodCouponsPage[${t}].btnLink`]:n,[`recGoodCouponsPage[${t}].validTime`]:p,[`recGoodCouponsPage[${t}].addCart`]:u}),this.triggerEvent("updateRec",this.data.recGoodCouponsPage),m.page().toast({message:i||"优惠券领取成功"})):m.page().toast({message:i||"获取优惠券失败，请稍后重试"})})).catch((e=>{m.page().loading(!1),m.page().toast({message:e.message||"获取优惠券失败，请稍后重试"})}))}))},goInvalid(e){const{index:t}=e.currentTarget.dataset,{btnLink:o,typeDesc:a,addCart:r}=this.data.recGoodCoupons[t];"商品券"!==a||r?m.$router.goto(o):m.page().toast(o)},openCityScopePop(e){this.triggerEvent("openCityScopePop",e.detail)},setFinger(){return l(this,null,(function*(){try{const e=yield(0,d.getRiskParamsWeChat)();this.setData({riskParams:JSON.stringify(e)})}catch(e){c.log.error("newCouponList","风控参数获取失败",`${JSON.stringify(e)}`)}}))},onMvReport(e){m.$lxLog.mv(e.detail.bid,((e,t)=>{for(var o in t||(t={}))n.call(t,o)&&p(e,o,t[o]);if(r)for(var o of r(t))i.call(t,o)&&p(e,o,t[o]);return e})({},e.detail.lxParams))}}});