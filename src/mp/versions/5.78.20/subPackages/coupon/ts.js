var e=Object.create,t=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,c=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,p=(e,t)=>{for(var o in t||(t={}))s.call(t,o)&&c(e,o,t[o]);if(i)for(var o of i(t))l.call(t,o)&&c(e,o,t[o]);return e},d=o=>{return((e,o,r)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let i of n(o))s.call(e,i)||"default"===i||t(e,i,{get:()=>o[i],enumerable:!(r=a(o,i))||r.enumerable});return e})((r=t(null!=o?e(u(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0}),t(r,"__esModule",{value:!0})),o);var r},g=d(require("../../p0.js")),m=d(require("../../s4.js")),y=getApp();Component({options:{multipleSlots:!0},properties:{coupon:{type:Object,value:{},observer(e){let t=!1;"cart"===this.data.pageType?t=!0:e.ruleDetails&&(t=e.ruleDetails.length>1||(0,g.getStrLen)(e.ruleDetails[0].ruleDetail)>47);let a="",n="";var i,u;2===e.reducePriceType?a=e.reducePrice:(a=parseFloat(e.reducePrice),n=e.reducePrice.replace(/\d+\.?\d?/g,"")||(0===e.reducePriceType?"￥":"")),this.setData((i=p({},e),u={needFolding:t,reducePriceNumber:a,reducePriceUnit:n,processed:!0,validTime:e.validTime||"",countDownTime:e.countDownTime||0},o(i,r(u))))}},couponParams:{type:Object,value:{}},pageType:{type:String,value:"list",observer(e){"cart"===e&&this.setData({needFolding:!0})}},textIndent:{type:Boolean,value:!0},useRadio:{type:Boolean,value:!1}},externalClasses:["external-class"],data:{expanded:!1,title:"",reducePrice:"",needFolding:!1,reducePriceType:1,reducePriceNumber:"",reducePriceUnit:"",priceLimit:"",validTime:"",status:1,id:0,couponId:0,fresh:!1,ruleChannel:"",ruleDetail:"",issued:!1,ENUM:{TAKE_COUPON:m.TAKE_COUPON,COUPON_IS_TAKED:m.COUPON_IS_TAKED},couponDisable:!1,couponSelected:!1,countDownTime:0},ready(){},methods:{useCoupon(e){const{pageType:t,isCanUseInCart:o,couponCode:a}=this.data;if("cart"===t)this.triggerEvent("use",this.data.coupon);else if("payShareLanding"===t){const{orderId:t,activityId:o}=this.data.couponParams;y.$lxLog.mc("b_youxuan_esblthpz_mc",{coupon_id:e.id,order_id:t,activity_id:o})}else y.$lxLog.mc("b_htjipj8f",{coupon_id:e.id});y.$router.goto(e.url)},toggleFolding(){const{pageType:e,needFolding:t,expanded:o,couponCode:a}=this.data;t&&this.setData({expanded:!o})},toggleCouponSelect(){this.triggerEvent("couponSelect",{couponSelected:!this.data.couponSelected})},takeCoupon(e){y.$service.takeItemCoupon(p({couponId:e},this.data.couponParams)).then((e=>{e&&(y.page().toast(e&&e.message),this.setData({issued:!0}))})).catch((e=>{y.page().toast(e&&e.message||"优惠券领取失败")}))},jumpToRuleLink(e){const{link:t}=e.currentTarget.dataset;t&&y.$router.goto(t)},tapCoupon(){const{useRadio:e,btnLabel:t,valid:o,pageType:a,issued:r,notLink:n,couponCode:i,btnLink:u,couponId:s}=this.data;e?this.toggleCouponSelect():t&&!n&&o&&"list"===a||t&&!n&&o&&"payShareLanding"===a||t&&o&&"cart"===a||t&&!o?this.useCoupon({id:i,url:u}):"take"!==a||r||this.takeCoupon(s)}}});