var e=Object.create,t=Object.defineProperty,i=Object.defineProperties,s=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,r=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,p=(e,t)=>{for(var i in t||(t={}))l.call(t,i)&&u(e,i,t[i]);if(a)for(var i of a(t))c.call(t,i)&&u(e,i,t[i]);return e},d=(e,t)=>i(e,n(t)),m=i=>{return((e,i,n)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let a of o(i))l.call(e,a)||"default"===a||t(e,a,{get:()=>i[a],enumerable:!(n=s(i,a))||n.enumerable});return e})((n=t(null!=i?e(r(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0}),t(n,"__esModule",{value:!0})),i);var n},h=(e,t,i)=>new Promise(((s,n)=>{var o=e=>{try{r(i.next(e))}catch(e){n(e)}},a=e=>{try{r(i.throw(e))}catch(e){n(e)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,a);r((i=i.apply(e,t)).next())})),y=m(require("../../../../er.js")),g=m(require("../../../../a4.js")),f=m(require("../../a5.js")),P=m(require("../../a6.js")),x=m(require("../../a7.js")),b=m(require("../../../../a8.js")),v=getApp(),L={show:!0,type:"empty_sku_list",customStyle:"margin-top: 168rpx;"};(0,y.default)({data:{schema:(0,x.default)(),skuType:b.ListTypes.couponDeliveryAddon,addonInfo:{},priceFilterRange:[],skuList:[],extensions:""},normalSkuList:[],onLoad(){b.default.registerLxOperator(b.ListTypes.couponDeliveryAddon,{operator:e=>(Object.assign(e,{moduleId:9,module_id:9}),e),[b.LxEventTypes.CardClick]:"b_youxuan_5drmmvps_mc",[b.LxEventTypes.CardView]:"b_youxuan_5drmmvps_mv",[b.LxEventTypes.AddCartClick]:"b_youxuan_cqa6z21q_mc",[b.LxEventTypes.DecreaseCartClick]:"b_youxuan_md1orotl_mc"})},onShow(){this.initPage()},initPage(){return h(this,null,(function*(){try{this.loading(!0),this.initPagination(),yield this.getDeliveryAddonInfo();const e=yield v.$cart.operateCart({cartOpType:"REFRESH",cartOpSource:"CART",forceRefresh:!0});e&&e.normalSkuList&&(this.normalSkuList=e.normalSkuList),this.loadRecommendSkuInfo()}catch(e){this.error(L)}}))},initPagination(){this.pagination={offset:0,limit:20,notLimit:-1,isEnd:!1}},getDeliveryAddonInfo(){return h(this,null,(function*(){try{const e=yield P.getDeliveryAddonInfo(),t=(0,f.parse)(e.addOnDescList[0]),i=Math.ceil(e.addOnMaxPrice/100);let s=0,n=[{selected:!0,info:"不限"}];for(let e=0,t=(i%10==0?i:10-i%10+i)/10;e<t;e++)n.push({selected:!1,lowPrice:100*s,info:`${s}-${s+=10}元`,highPrice:100*s});this.setData(p({addonInfo:d(p({},e),{addonDesc:t}),priceFilterRange:n},this.data.extensions?{}:{extensions:e.extensions}))}catch(e){}}))},loadRecommendSkuInfo(e=!1){return h(this,null,(function*(){const t={poiId:v.$poiId,limit:this.pagination.limit,offset:this.pagination.offset,notLimit:this.pagination.notLimit,priceDifference:this.data.addonInfo.diffPrice,extensions:this.data.extensions,exclusiveSkuIds:this.normalSkuList};try{if(this.pagination.isEnd)this.loading(!1),this.toast({message:"没有更多商品了"});else{this.loading(!0);const i=yield P.getDeliveryAddonSku(this.pagination.highPrice?d(p({},t),{lowPrice:this.pagination.lowPrice,highPrice:this.pagination.highPrice,notLimit:1}):t),{limit:s,offset:n,total:o}=i;this.loading(!1),this.error&&i.itemList.length?this.error({show:!1,type:"empty_sku_list"}):i.itemList.length||this.error(L),i.itemList=(0,g.parseStyle)(i.styleMap||{},i.itemList||[]),this.setData({skuList:e?i.itemList:this.data.skuList.concat(i.itemList)},(()=>{v.$cart.emitUpdateSkuCount()})),n+s>=o?(this.pagination.isEnd=!0,this.setData({isEnd:!0})):this.pagination=d(p({},this.pagination),{limit:s,offset:s+n})}}catch(e){this.loading(!1),this.error(L)}}))},onCartChange(){this.getDeliveryAddonInfo()},onPullDownRefresh(){this.initPage(),wx.stopPullDownRefresh()},onReachBottom(){this.loadRecommendSkuInfo()},filterPrice(e){this.setData({isEnd:!1});const{highPrice:t,lowPrice:i}=e.target.dataset.price;this.setData({priceFilterRange:this.data.priceFilterRange.slice().map(((t,i)=>(t.selected=i===e.target.dataset.index,t)))}),this.initPagination(),this.pagination=d(p({},this.pagination),{highPrice:t,lowPrice:i}),this.loadRecommendSkuInfo(!0)}});