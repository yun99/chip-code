var e=Object.create,t=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,a=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,i,o)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o,d=(e,t)=>{for(var i in t||(t={}))s.call(t,i)&&u(e,i,t[i]);if(l)for(var i of l(t))c.call(t,i)&&u(e,i,t[i]);return e},p=e=>t(e,"__esModule",{value:!0}),g=i=>((e,i,r)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let l of n(i))s.call(e,l)||"default"===l||t(e,l,{get:()=>i[l],enumerable:!(r=o(i,l))||r.enumerable});return e})(p(t(null!=i?e(a(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i),f=(e,t,i)=>new Promise(((o,r)=>{var n=e=>{try{a(i.next(e))}catch(e){r(e)}},l=e=>{try{a(i.throw(e))}catch(e){r(e)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,l);a((i=i.apply(e,t)).next())}));((e,i)=>{for(var o in p(e),i)t(e,o,{get:i[o],enumerable:!0})})(exports,{default:()=>k});var m=g(require("./so.js")),P=g(require("../../pa.js")),y=g(require("../../iy.js")),h=g(require("../../ob.js")),x=g(require("./sg.js")),b=require("./ls.js"),I=require("./vb.js"),S=getApp(),k=class{constructor(){this.isSkuValidInPoi=function(e,t){return f(this,null,(function*(){const{result:i}=yield b.checkSkuValidInPoi({targetPoiId:(null==e?void 0:e.poiId)||S.$poiId,poiIdStr_targetPoiId:(null==e?void 0:e.poiIdStr)||S.$poiIdStr,skuIdList:[t]}).catch((e=>{}));return!!i}))},this.confirmModal=function(e){return I(e)}}switchPoiForBargainSkuList(e,t,i,o,r){return f(this,null,(function*(){if(yield this.isSkuValidInPoi(t,i))return this.handleSkuValidInPoi(e,t,o,r);S.page().toast("商品不支持在本自提点取货，请重新选择自提点"),o&&o()}))}switchPoiConfirm(e,t,i){const{poiName:o="",distanceText:r="",address:n="",picUrl:l=""}=i;return this.confirmModal({title:"请确认切换自提点",message:"确认切换后，您需要前往该自提点提货",textCancel:"取消",textOK:"确认",customContentStyle:"text-align: center",poi:{poiName:o,distanceText:r,address:n,picUrl:l},cancel:()=>{S.$lxLog.mc("b_youxuan_43x3nnpd_mc"),t&&t()},ok:()=>{S.$lxLog.mc("b_youxuan_7ertq2jj_mc"),e&&e()}})}handleSkuValidInPoi(e,t,i,o){this.switchPoiConfirm((()=>f(this,null,(function*(){const o=+t.poiId!=+S.$poiId;yield y.default.togglePoiByPoi(t),"bargainSkuList"===e?S.$event.emit(P.SELF_PICK_POI_CHANGE,{isSelfPcikPoiChange:o}):"EGG_EXCHANGE_FROM"===e&&S.page().toast("已切换门店"),i&&i(),S.$router.triggerBack("selfliftPointMap_handleSkuValidInPoi")}))),(()=>{o&&o()}),t)}checkSiteIfValidate(e,t){return f(this,null,(function*(){var o;const{poiId:n,poiIdStr:l}=e;let a={};const{longitude:s,latitude:c}=S.$location||{};s&&(a={homepageLng:s,homepageLat:c});let u={currentPoiId:S.$poiId,descPoiId:n,cartType:t};var p,g;l&&(p=d(d({},u),a),g={poiIdStr_currentPoiId:null==(o=null==S?void 0:S.$poi)?void 0:o.getPoiIdStr(),poiIdStr_descPoiId:l},u=i(p,r(g)));return yield b.checkSFAddress(u)}))}switchPoiItem(e,t,i,o,r,n){return f(this,null,(function*(){const{poiName:l="",distanceText:a="",address:s="",picUrl:c=""}=e;if((0,m.setHistoryPoi)(l,e),("bargainSkuList"===t||"EGG_EXCHANGE_FROM"===t)&&i)return this.switchPoiForBargainSkuList(t,e,i,r,n);if(t===x.FROM_MAP.SUBMIT_ORDER){const t=yield this.checkSiteIfValidate(e,o);if(t.redirectLocation)return this.confirmModal({title:"请确认切换自提点",message:null==t?void 0:t.promotion,textOK:"确定切换",textCancel:"取消切换",poi:{poiName:l,distanceText:a,address:s,picUrl:c},cancel:()=>{S.$lxLog.mc("b_youxuan_43x3nnpd_mc"),n&&n()},ok:()=>f(this,null,(function*(){if(1===t.redirectLocation)yield y.default.togglePoiByPoi(e),r&&r(),S.$router.goto("/pages/index/index");else if(2===t.redirectLocation){yield y.default.togglePoiByPoi(e),r&&r();const t=this.getSelfLiftNumber();S.$router.triggerBack("selfliftPointMap_1back ---1",Math.abs(t-1))}}))}),null;S.page().toast((null==t?void 0:t.promotion)||"已切换自提站，请您确认商品信息"),S.$store.setCache("originalPoiId",S.$poiId,{isOnlyCache:!0}),yield y.default.togglePoiByPoi(e);const i=this.getSelfLiftNumber();return r&&r(),S.$router.triggerBack("selfliftPointMap_2back",i),null}try{yield y.default.togglePoiByPoi(e,y.ToggleSource.SELF_PICK_PAGE)}catch(e){h.log.info("switchPoiItem togglePoiByPoi error ",e)}if(r&&r(),"needToHome"===t)S.$router.goto("pages/index/index");else{const e=this.getSelfLiftNumber();S.$router.triggerBack("selfliftPointMap_3back",e)}}))}isContain(e){const t=["location/pages/selfliftPointMap/index","location/pages/otherSelfPickSelect/index","location/pages/searchPoi/index","location/pages/selfPickSelect/index"];let i=!1;for(let o=0;o<t.length;o++){const r=t[o];if(i=e.includes(r),i)break}return i}getSelfLiftNumber(){const e=S.pages()||[];if(e.length<1)return void h.log.info("exitSelfLift pages.length < 1");let t=0;for(let i=e.length-1;i>0;i--){const o=e[i];this.isContain(o.route)&&t++}return t}executeBack(e,t,i,o,r,n){this.switchPoiItem(e,t,i,o,r,n)}};