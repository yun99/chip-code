var e=Object.create,t=Object.defineProperty,a=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(e,a,i)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[a]=i,d=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&n(e,a,t[a]);if(l)for(var a of l(t))s.call(t,a)&&n(e,a,t[a]);return e},u=l=>{return((e,l,o)=>{if(l&&"object"==typeof l||"function"==typeof l)for(let s of i(l))r.call(e,s)||"default"===s||t(e,s,{get:()=>l[s],enumerable:!(o=a(l,s))||o.enumerable});return e})((s=t(null!=l?e(o(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0}),t(s,"__esModule",{value:!0})),l);var s},h=u(require("../../jc.js")),c=u(require("../../u4.js")),m=u(require("./sp.js")),g=u(require("../../ob.js")),p=u(require("./zd.js")),y=getApp();(0,h.defineComponent)({propTypes:{overlayManger:null},properties:{updateModel:{type:Object,value:null,observer(e){e&&this.handleDataVal(e)}},initModel:{type:Object,value:null,observer(e){e&&this.handleInitDataVal(e)}},layout:{type:Object,value:{},observer(e){e&&this.handleLayoutVal(e)}}},data:{latitude:0,longitude:0,markers:[],includePoints:[],customCallouts:[],mapHeight:0,showList:[],type:-1},attached(){this.handleAttached()},detached(){this.handleDetached()},methods:{handleInitDataVal(e){this.overlayManger=this.getOverlayManger();const{latitude:t,longitude:a}=e;t&&a&&this.setData({latitude:Number(t),longitude:Number(a)})},handleDataVal(e){const t=null==e?void 0:e.rgeoInfo;this.setData({type:e.type}),(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&this.setData({latitude:Number(t.latitude),longitude:Number(t.longitude)}),e.type===m.MAP_TYPE.LIST?this.showRecommendMarks(e.showList,{longitude:(null==t?void 0:t.longitude)||0,latitude:(null==t?void 0:t.latitude)||0}):(this.overlayManger.clearOverlay(this.data.markers),this.setData({markers:[],customCallouts:[]}))},handleLayoutVal(e){e.mapHeight&&this.setData({mapHeight:e.mapHeight})},handleAttached(){c.default.on(m.SELF_LIFT_EVETN.SELECT_CARD,this.selectCard.bind(this))},handleDetached(){c.default.off(m.SELF_LIFT_EVETN.SELECT_CARD,this.selectCard.bind(this))},selectCard(e){const t={latitude:this.data.latitude,longitude:this.data.longitude};let a=null;for(let i=0;i<this.data.markers.length;i++){const l=this.data.markers[i];if(l.longitude===e.longitude&&l.latitude===e.latitude){a=l.id,this.overlayManger.hightRecomendPoint(a,this.data.markers,this,this.data.showList,t),this.overlayManger.moveMapCenter({latitude:Number(l.latitude),longitude:Number(l.longitude)});break}}},clickMarkrs(e){var t;const a=e.markerId||(null==(t=e.detail)?void 0:t.markerId),i={latitude:this.data.latitude,longitude:this.data.longitude};for(let e=0;e<this.data.markers.length;e++){const t=this.data.markers[e];if(t.id===a){const{longitude:e,latitude:l}=t;for(let t=0;t<this.data.showList.length;t++){const o=this.data.showList[t];if(e===o.longitude&&l===o.latitude){y.$lxLog.mc("b_youxuan_9ph3nif7_mc",{click_poiid:o.poiId,poiIdStr_click_poiid:o.poiIdStr||""}),c.default.emit(m.SELF_LIFT_EVETN.MAP_SELECT_POI,d({},o)),this.overlayManger.hightRecomendPoint(a,this.data.markers,this,this.data.showList,i);break}}break}}},onRefreshIconLoadFail(e){g.log.info("onRefreshIconLoadFail",e)},onRegionChange(e){const{type:t,causedBy:a}=e;"end"===t&&"drag"===a&&(c.default.emit(m.SELF_LIFT_EVETN.MAP_CHANGE_DOWN),this.overlayManger.getCenterLocation((e=>{e&&this.triggerEvent("regionChange",e)})))},showRecommendMarks(e,t){if(this.overlayManger){const{longitude:a,latitude:i}=t,l=this.overlayManger.genGPSMarkCongfig(a,i);this.overlayManger.clearOverlay(this.data.markers),this.setData({markers:[],customCallouts:[]});const o=l.markers;if(this.data.showList=e,Array.isArray(e)&&e.length){const t=this.overlayManger.genMarks(e),a=t.markers.concat(o);this.setData({markers:a,customCallouts:t.customCallouts});for(let t=0;t<e.length;t++){const a=e[t];y.$lxLog.mv("b_youxuan_9ph3nif7_mv",{click_poiid:a.poiId,poiIdStr_click_poiid:a.poiIdStr||""})}}else this.setData({markers:o})}},getOverlayManger(){const e=wx.createMapContext("selfliftPoint_map",this);return new p.default(e)}}});