var t=Object.create,e=Object.defineProperty,i=Object.defineProperties,a=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,s=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,y=(t,e)=>{for(var i in e||(e={}))n.call(e,i)&&u(t,i,e[i]);if(r)for(var i of r(e))l.call(e,i)&&u(t,i,e[i]);return t},h=(t,e)=>i(t,c(e)),d=i=>{return((t,i,c)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let r of o(i))n.call(t,r)||"default"===r||e(t,r,{get:()=>i[r],enumerable:!(c=a(i,r))||c.enumerable});return t})((c=e(null!=i?t(s(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0}),e(c,"__esModule",{value:!0})),i);var c},L=(t,e,i)=>new Promise(((a,c)=>{var o=t=>{try{s(i.next(t))}catch(t){c(t)}},r=t=>{try{s(i.throw(t))}catch(t){c(t)}},s=t=>t.done?a(t.value):Promise.resolve(t.value).then(o,r);s((i=i.apply(t,e)).next())})),m=d(require("./ls.js")),p=d(require("./zf.js")),g=d(require("../../u9.js")),C=d(require("../../jc.js")),{convertRpxToPx:b}=require("../../p0.js"),T=new p.default,I={PROVINCE:"province",CITY:"city",COUNTY:"county"},v={TAB_1:"tab1",TAB_2:"tab2",TAB_3:"tab3"},f=t=>0===Object.keys(t).length,N=(t,e)=>{const{currentCity:i}=e,{PROVINCE:a,CITY:c}=I,{TAB_1:o,TAB_2:r,TAB_3:s}=v;switch(t){case a:return f(i)?s:o;case c:return f(i)?s:r;default:return s}},x=getApp();(0,C.defineComponent)({properties:{innerText:{type:String,value:"default value"},defaultCity:{type:Object,value:{}},isShow:{type:Boolean,value:!1,observer(t){this.setData({show:t,isDistrictTabShowed:!t}),x.$lxLog.pv("c_youxuan_9o6ex0tc",{}),t&&this.data.isLocatedFailed&&this.initial()}}},data:{show:!1,currentProvince:{},currentCityList:[],currentDistrictList:[],currentCity:{},location:{},localCity:{},historyCityList:[],locationList:[],tabId:v.TAB_3,isLocationLoading:!1,locationTip:"定位中...",scrollTop:0,curMenuType:I.PROVINCE,districtInitialList:[],citySearchKey:"",showCitySearchList:!1,provinceList:[],provinceInitialList:[],cityList:[],searchCityList:[],letterItemHeight:42,curProvinceLetter:"",curCityLetter:"",curLocationLetter:"",showLetterBubble:!1,bubbleTop:"",letterListTop:0,isIpx:!1,isDistrictTabShowed:!1,isLocatedFailed:!1},observers:{location(t){if(!t||f(t))return;const{locationId:e,locationName:i,districtType:a}=t,{cityId:c,cityName:o}=this.data.currentCity;let r={};r=a?{cityId:c,cityName:o,districtId:e,districtName:i,districtType:a}:{cityId:e,cityName:i},this.triggerEvent("citySelect",r),T.pushHistoryCityList(r),T.setCurrentCity(r),this.setData({historyCityList:T.getHistoryCityList()})},localCity(t){T.setLocalCity(this.formatCityForStore(t)),this.setData({historyCityList:T.getHistoryCityList()})},curMenuType(t){this.setData({tabId:N(t,this.data)})}},lifetimes:{attached(){this.initial()}},methods:{initial(){var t,e;this.getCityByPoi(),this.getHistoryCityList(),this.getOpenLocationList(),this.setData({isIpx:(null==(e=null==(t=x.getModule("systemInfo"))?void 0:t.getSystemInfo())?void 0:e.isIpx)||!1})},getCityByPoi(){return L(this,null,(function*(){try{this.setData({isLocationLoading:!0,locationTip:"定位中..."});const t=yield g.default.getWxLocation({refresh:!0}),e=yield x.$service.getPosition(t);this.setData({localCity:e,isLocationLoading:!1,locationTip:e.cityId&&e.cityName?"":"定位失败",isLocatedFailed:!(e.cityId&&e.cityName)})}catch(t){this.setData({isLocationLoading:!1,locationTip:"定位失败",isLocatedFailed:!0})}}))},getHistoryCityList(){this.setData({historyCityList:T.getHistoryCityList()})},getOpenLocationList(){let t={};const{longitude:e,latitude:i}=x.$location||{};e&&(t={homepageLng:e,homepageLat:i}),m.getOpenLocation(t).then((({provinceList:t})=>{const{list:e,initialList:i}=this.locationListFormat(t);this.setData({provinceList:e,provinceInitialList:i})}))},onProvinceChange(t){const e=t.currentTarget.dataset.province;this.setData({currentProvince:e,currentCityList:e.cityList,curMenuType:I.CITY,currentCity:{}})},onCityChange(t){return L(this,null,(function*(){const{city:e={}}=t.currentTarget.dataset,{provinceId:i,provinceName:a}=this.data.currentProvince,{cityId:c,cityName:o}=e;let r={};const{longitude:s,latitude:n}=x.$location||{};s&&(r={homepageLng:s,homepageLat:n});const{districtList:l=[]}=yield m.getOpeningDistricts(y({cityId:c,cityName:o,provinceId:i,provinceName:a},r));if(!l||0===l.length)return this.locationChangeHandler({locationId:c,locationName:o});const{list:u,initialList:h}=this.districtFormat(l);this.data.isDistrictTabShowed||(x.$lxLog.mv("b_youxuan_p1wo2hix_mv"),this.setData({isDistrictTabShowed:!0})),this.setData({currentDistrictList:u,districtInitialList:h,currentCity:e,curMenuType:I.COUNTY})}))},onSearchResultChange(t){const e=this.formatLocation(t.currentTarget.dataset.location);this.locationChangeHandler(e)},onCountyChange(t){const e=this.formatLocation(t.currentTarget.dataset.location);x.$lxLog.mc("b_youxuan_x3johhoa_mc"),this.locationChangeHandler(e)},locationChangeHandler(t){this.close(),this.setData({location:t}),setTimeout((()=>{this.reset()}),200)},formatLocation(t){const{locationId:e=null,locationName:i=null,districtId:a=null,districtName:c=null,cityId:o=null,cityName:r=null,districtType:s=null}=t;return{cityId:o,cityName:r,locationId:e||a||o,locationName:i||c||r,districtType:s}},onTabClick(t){const e=t.currentTarget.dataset.tabid,{TAB_1:i,TAB_2:a,TAB_3:c}=v,{PROVINCE:o,CITY:r}=I;return e===i?this.setData({curMenuType:o}):e===a?this.setData({curMenuType:r}):e===c?this.onChoiceClick():void 0},close(){this.setData({show:!1,citySearchKey:"",showCitySearchList:!1}),this.triggerEvent("onCitySelectorClose")},reset(){this.setData({currentProvince:{},currentCity:{},location:{},currentCityList:[],currentDistrictList:[],scrollTop:0,curMenuType:I.PROVINCE,showLetterBubble:!1,curCityLetter:"",curLocationLetter:"",curProvinceLetter:"left-wrap-header",citySearchKey:"",showCitySearchList:!1})},locationListFormat(t=[],e){let i="";const a=[];return{initialList:a,list:t.map((t=>{const c=h(y({},t),{isFirstLocation:!1});if(c.cityList){const{list:e,initialList:i}=this.locationListFormat(c.cityList,t);c.cityList=e,c.initialList=i,this.data.cityList.push(...c.cityList)}else e&&(c.provinceName=e.provinceName,c.otherMatchText="");return c.initial!==i&&(i=c.initial,a.push(c.initial),c.isFirstLocation=!0),c}))}},districtFormat(t=[]){let e="";const i=[];return{list:t.map((t=>{const a=t.initial!==e;return a&&(e=t.initial,i.push(t.initial)),h(y({},t),{isFirstLocation:a})})),initialList:i}},formatCityForStore:({cityId:t,cityName:e,districtId:i=null,districtName:a=null,districtType:c=null})=>c?{cityId:i,cityName:a}:{cityId:t,cityName:e},onLocalCityClick(t){this.onCountyChange(t);const{locationId:e}=this.formatLocation(t.currentTarget.dataset.location);x.$lxLog.mc("b_youxuan_tlnxfoh0_mc",{click_cityid:e})},reLocation(){this.getCityByPoi(),x.$lxLog.mc("b_youxuan_j14rwwyc_mc",{})},onHistoryCityClick(t){const{locationId:e}=this.formatLocation(t.currentTarget.dataset.location);this.onCountyChange(t),x.$lxLog.mc("b_youxuan_w8qkivab_mc",{click_cityid:e})},onChoiceClick(){const{currentProvince:t,currentCity:e}=this.data,{CITY:i,COUNTY:a}=I;t.provinceId&&this.setData({curMenuType:e.cityId?a:i})},onSearchInput(t){const e=t.detail.value.replace(/\s/g,"");this.setData({citySearchKey:e,showCitySearchList:e.length>0}),this.searchLocation()},onSearchSubmit(){const{citySearchKey:t,searchCityList:e}=this.data;t&&0===e.length&&x.page().toast("暂无搜索结果")},onSearchFocus(){x.$lxLog.mc("b_youxuan_kpmuis8x_mc")},onSearchBlur(){0===this.data.citySearchKey.length&&this.closeCitySearchList()},onSearchClear(){this.closeCitySearchList()},closeCitySearchList(){this.setData({citySearchKey:"",showCitySearchList:!1})},searchLocation(){return L(this,null,(function*(){const{citySearchKey:t}=this.data;if(!t)return;let e={};const{longitude:i,latitude:a}=x.$location||{};i&&(e={homepageLng:i,homepageLat:a});const c={},{detailAreaList:o=[]}=yield m.searchOpeningCities(y({keyword:t},e)),r=o.filter((e=>!!e.cityName.startsWith(t)&&(!c[`C${e.cityId}`]&&(c[`C${e.cityId}`]=e.cityName,!0)))).map((e=>h(y({},e),{locationId:e.cityId,locationName:e.cityName,otherMatchText:e.cityName.substr(t.length)}))),s=o.filter((t=>t.districtId)).filter((e=>!!e.districtName.startsWith(t)&&(!c[`D${e.districtId}`]&&(c[`D${e.districtId}`]=e.districtName,!0)))).map((e=>h(y({},e),{locationId:e.districtId,locationName:e.districtName,otherMatchText:`${e.districtName.substr(t.length)}，${e.cityName}`})));this.setData({searchCityList:[...r,...s]})}))},searchCity:function(t,e,i){let a,c=null;return function(...o){return L(this,null,(function*(){const r=this,s=+new Date;clearTimeout(c),a||(a=s),s-a>=i?(yield t.apply(r,o),a=s):c=setTimeout((()=>L(this,null,(function*(){yield t.apply(r,o)}))),e)}))}}((function(){const{citySearchKey:t,cityList:e}=this.data;let i=[];if(t.length>0){i=[...e.filter((e=>e.cityName.startsWith(t))).map((e=>h(y({},e),{otherMatchText:e.cityName.substr(t.length)}))),...e.filter((e=>{const i=e.provinceName.startsWith(t),a=e.cityName.startsWith(t);return i&&!a})).map((e=>h(y({},e),{otherMatchText:`${e.provinceName.substr(t.length)} - ${e.cityName}`})))]}this.setData({searchCityList:i})}),100,300),onLetterTouchStart(t){const{letter:e,index:i,type:a}=t.currentTarget.dataset;this.createSelectorQuery().select(`#${a}LettleList`).boundingClientRect((({top:a})=>{this.setData({showLetterBubble:!0,curProvinceLetter:e,curCityLetter:e,curLocationLetter:e,bubbleTouchStartY:t.changedTouches[0].clientY,bubbleTop:""+(this.data.letterItemHeight/2-41+i*this.data.letterItemHeight),letterListTop:a})})).exec(),x.$lxLog.mc("b_youxuan_foxhmhd3_mc")},onLetterTouchMove(t){this.moveLetterBubble(t)},onLetterTouchEnd(t){setTimeout((()=>{this.setData({showLetterBubble:!1,curProvinceLetter:"",curCityLetter:"",curLocationLetter:""})}),500)},moveLetterBubble(t){const{letterItemHeight:e,letterListTop:i,provinceInitialList:a,currentProvince:c}=this.data,{letter:o,index:r,type:s}=t.currentTarget.dataset,n=t.changedTouches[0].clientY-i,l=parseInt(n/b(e),10),u=a[l],y=c.initialList&&c.initialList[l];("province"===s&&u&&o!==u||"city"===s&&y&&o!==y)&&this.setData({curProvinceLetter:u,curCityLetter:y||"",curLocationLetter:y||"",bubbleTop:""+(this.data.letterItemHeight/2-41+l*this.data.letterItemHeight)})}}});