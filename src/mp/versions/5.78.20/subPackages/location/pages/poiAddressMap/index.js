var t=Object.create,e=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,r=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,n=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,c=(t,e)=>{for(var i in e||(e={}))r.call(e,i)&&n(t,i,e[i]);if(a)for(var i of a(e))d.call(e,i)&&n(t,i,e[i]);return t},l=t=>e(t,"__esModule",{value:!0}),u=a=>((t,a,o)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let d of s(a))r.call(t,d)||"default"===d||e(t,d,{get:()=>a[d],enumerable:!(o=i(a,d))||o.enumerable});return t})(l(e(null!=a?t(o(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);l(exports);var p=u(require("../../../../er.js")),h=u(require("../../../../po.js")),m=u(require("../../as.js")),y=u(require("../../pb.js")),g=u(require("../../aa.js")),f=getApp(),C="bigSearchResult";(0,p.default)({position:null,mapCtx:null,poiDeliveryInfo:null,data:{poiId:"",longitude:0,latitude:0,centerAddress:{},showSearchList:!1,showCityListView:!1,searchAddress:[],cityAddress:{},focusin:!1,dataList:[],showStoreList:!1,storeListData:[],defaultCity:{},isMMP:!1,from:"index",address:{},isShowMap:!0,pageFrom:"",polygons:[],circles:[],includePoints:[],supportMap:(0,g.supportMap)()},onLoad(t){const{from:e="index",latitude:i,longitude:s,address:a,cityId:o,cityName:r,districtId:d,districtName:n,districtType:c,pageFrom:l}=t||{};this.position=null,this.setData({fromTo:a?decodeURIComponent(a):"",reloadCurrentAddress:Math.random(),from:e,latitude:i,longitude:s,isMMP:(0,h.isMMP)(),centerAddress:{latitude:i,longitude:s},cityAddress:{cityId:o,cityName:r?decodeURIComponent(r):"",districtId:d?decodeURIComponent(`${d}`):"",districtName:n?decodeURIComponent(`${n}`):"",districtType:c?decodeURIComponent(`${c}`):""},defaultCity:{cityId:o,cityName:r?decodeURIComponent(r):"",districtId:d?decodeURIComponent(`${d}`):"",districtName:n?decodeURIComponent(`${n}`):"",districtType:c?decodeURIComponent(`${c}`):""},pageFrom:l})},onReady(){this.mapCtx=wx.createMapContext("poiAddressMap",this)},onShow(){const{pageFrom:t=""}=this.data;"deliveryAddress"===t&&this.initRangeData()},onRegionChange(t){var e;const{type:i,causedBy:s,detail:a}=t;"end"===i&&(null==(e=null==t?void 0:t.detail)?void 0:e.centerLocation)&&f.$service.getPosition(a.centerLocation).then((t=>{const e=c(c({},t),a.centerLocation);this.setData({centerAddress:{cityId:t.cityId,latitude:a.centerLocation.latitude,longitude:a.centerLocation.longitude,cityAddress:e}})}))},onLocate(){this.mapCtx.moveToLocation(),this.setData({centerAddress:{latitude:this.data.latitude,longitude:this.data.longitude}})},showCityList(t){const{showCityListView:e}=t.detail;this.setData({showCityListView:e,isShowMap:!e,showSearchList:!1})},changeAddress(t){const e=c(c({},t.detail),this.data.cityAddress);if(this.setData({address:t.detail}),this.isFromBigSearch())return this.fromBigSearchHandler();this.setPoiAddressCache(e),this.goBack()},mapChangeAddress(t){const e=c({},t.detail);if(this.setData({address:t.detail}),this.isFromBigSearch())return this.fromBigSearchHandler();this.setPoiAddressCache(e),this.goBack()},setPoiAddressCache:t=>f.$store.setCache("poiAddressMap_poi",t,{isOnlyCache:!0}),fromBigSearchHandler(){return(0,m.navigateBackNative)(c({},this.tranfromAddrforNative()))},isFromBigSearch(){const{from:t}=this.data;return t===C},goBack(){f.$router.triggerBack("poiAddressMap-goBack")},onCitySelect(t){const e=t.detail;this.setData({focusin:!0,showCityListView:!1,isShowMap:!0,cityAddress:e});const{cityAddress:i,latitude:s,longitude:a}=this.data;this.setPoiAddressCache(c(c({latitude:s,longitude:a},i),e))},setSearchList(t){const{show:e=this.data.showSearchList,addrList:i=this.data.dataList}=t.detail,s=!f.$systemInfo.isIOS(),a=!(0,h.isMMP)()||!s||!e;this.setData({showSearchList:e,showCityListView:!1,isShowMap:a,dataList:i})},tranfromAddrforNative(t){const{latitude:e="",longitude:i="",address:s=""}=t||this.data.address;return{latitude:e,longitude:i,address:s,fromType:"poiAddressMap"}},onCitySelectorClose(){this.setData({showCityListView:!1,isShowMap:!0})},initRangeData(){return t=this,e=null,i=function*(){var t;const e=null==f?void 0:f.$poiId,i=null==(t=null==f?void 0:f.$poi)?void 0:t.getPoiIdStr(),s=yield(0,y.getRangeData)({poiId:e,poiIdStr:i}),{poiDeliveryInfo:a={}}=s;this.poiDeliveryInfo=a;const o=(0,y.handleRangeData)(a,!1);this.setData(c({},o),(()=>{setTimeout((()=>{this.mapCtx.moveToLocation()}),300)}))},new Promise(((s,a)=>{var o=t=>{try{d(i.next(t))}catch(t){a(t)}},r=t=>{try{d(i.throw(t))}catch(t){a(t)}},d=t=>t.done?s(t.value):Promise.resolve(t.value).then(o,r);d((i=i.apply(t,e)).next())}));var t,e,i}});