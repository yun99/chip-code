var t=Object.create,e=Object.defineProperty,i=Object.defineProperties,s=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,o=Object.getOwnPropertySymbols,c=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,h=(t,e)=>{for(var i in e||(e={}))d.call(e,i)&&l(t,i,e[i]);if(o)for(var i of o(e))n.call(e,i)&&l(t,i,e[i]);return t},p=(t,e)=>i(t,a(e)),u=i=>{return((t,i,a)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let o of r(i))d.call(t,o)||"default"===o||e(t,o,{get:()=>i[o],enumerable:!(a=s(i,o))||a.enumerable});return t})((a=e(null!=i?t(c(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0}),e(a,"__esModule",{value:!0})),i);var a},y=u(require("../../ao.js")),g=u(require("./ld.js")),L=u(require("./ls.js")),m=getApp();Component({properties:{fromTo:{type:String,value:"",observer(t){this.setData({fromTo:t})}},pageFrom:{type:String,value:"",observer(t){this.setData({pageFrom:t})}},cityAddress:{type:Object,value:{},observer(t,e){this.setData({showCityListView:!1}),t&&t.cityName&&(this.setData({cityAddress:t}),e.cityId!==t.cityId&&this.data.keyword&&this.search(this.data.keyword))}},position:{type:Object},focusin:{type:Boolean,value:!1},page:{type:String,value:"",observer(t){const e={selfLifting:"输入位置查找附近自提站点",selfPickSelect:"请输入地址或自提点名称",otherSelfPickSelect:"请输入地址或自提点名称",searchPoi:"输入地址或者自提点名称"}[t];this.setData({placeHolder:e})}},showSearchList:{type:Boolean,value:"",observer(t){"selfLifting"===this.data.page&&!1===t&&this.setData({keyword:this.data.lastSearch})}},showCityListView:{type:Boolean,value:!1,observer(t){this.setData({showCityListView:t})}},currentAddress:{type:Object,value:{address:"定位中…"}},lastSearch:{type:String,value:"",observer(t){this.setData({keyword:t})}},isHideBar:{type:Boolean,value:!1},isMMP:{type:Boolean,value:!1}},data:{keyword:"",addrList:[],poiList:[],showCityListView:!1,placeHolder:"请输入地址",isShowIconClear:!1,canBlur:!0},attached(){},methods:{bindKeyFocus(){this.triggerEvent("setSearchList",{show:!0}),this.setData({focusin:!0,showCityListView:!1}),"selfLifting"===this.data.page?(this.data.keyword&&this.search(this.data.keyword),m.$lxLog.mc("b_chaoshi_ktkz1z1e_mc")):"selfPickSelect"===this.data.page?m.$lxLog.mc("b_youxuan_eg1awiq2_mc"):"otherSelfPickSelect"===this.data.page&&m.$lxLog.mc("b_youxuan_9ao6e8qp_mc",{},{cid:"c_youxuan_07h85u7f"})},bindKeyBlur(t){this.data.canBlur&&"selfLifting"!==this.data.page&&(this.setData({focusin:!1}),0===this.data.keyword.length&&(this.setData({isShowIconClear:!1}),this.triggerEvent("setSearchList",{show:!1})))},confirm(t){this.search(t.detail.value)},bindKeyInput(t){var e;clearTimeout(this.timer);const i=(null==(e=t.detail.value)?void 0:e.length)||0;this.setData({keyword:t.detail.value,isShowIconClear:i>0}),this.timer=setTimeout((()=>{this.search(t.detail.value)}),500)},clearInput(){this.triggerEvent("setSearchList",{addrList:[],poiList:[]}),this.setData({keyword:"",focusin:!0,isShowIconClear:!1,canBlur:!0,addrList:[],poiList:[]})},handleClearIconTouchStart(t){this.setData({canBlur:!1})},cancelSearch(){this.triggerEvent("setSearchList",{show:!1,showCityListView:!1,addrList:[],poiList:[]}),this.setData({isShowIconClear:!1,focusin:!1,keyword:"selfLifting"===this.data.page?this.data.lastSearch:""})},search(t){const e=(t||"").trim();if(0===e.length)this.triggerEvent("setSearchList",{addrList:[],poiList:[]}),this.setData({addrList:[],poiList:[]});else if("selfPickSelect"===this.data.page||"otherSelfPickSelect"===this.data.page){const t=this.searchPoi(e),i=this.searchAddress(e);Promise.all([t,i]).then((([t,e])=>{this.triggerEvent("setSearchList",{poiList:t,addrList:e})})).catch((t=>{}))}else this.searchAddress(e).then((t=>{this.triggerEvent("setSearchList",{addrList:t})})).catch((t=>{}))},searchAddress(t){var e;if(!t)return;const{cityId:i,cityName:s,districtId:a,districtName:r,districtType:o=-1}=this.data.cityAddress,c={cityId:i,cityName:s,districtId:a,districtName:r,districtType:o};if("deliveryAddress"===this.properties.pageFrom&&(c.locateType=1,c.sourcePoi=m.$poiId,c.poiIdStr_sourcePoi=null==(e=null==m?void 0:m.$poi)?void 0:e.getPoiIdStr()),m.$location){const{longitude:t="",latitude:e=""}=m.$location;t&&e&&(c.location=`${t},${e}`)}return L.getAddressByKeyword(c,t).then((e=>{var i;let s=e.addressList||[];return 0===s.length&&(s=[{type:"emptyList",errorCode:null==(i=(0,y.getLocationErrorWithType)(y.PoiLocationErrorType.BACK_END_NO_POI_DATA))?void 0:i.errorCode}]),"emptyList"!==s[0].type&&(s=s.map((e=>p(h({},e),{lightTxt:(0,g.parseSugText)(e.name,t)})))),this.setData({addrList:s}),s})).catch((t=>{var e;m.page().toast(t.message||"服务繁忙！");const{code:i}=(null==t?void 0:t.data)||{},{statusCode:s}=(null==t?void 0:t.res)||{};let a=y.PoiLocationErrorType.HTTP_ERROR;420===i?a=y.PoiLocationErrorType.ANTI_ERROR_420:403===s&&(a=y.PoiLocationErrorType.ANTI_ERROR);const r=[{type:"emptyList",errorCode:null==(e=(0,y.getLocationErrorWithType)(a))?void 0:e.errorCode}];return this.setData({addrList:r}),r}))},searchPoi(t){if(!t)return;const{cityId:e=-1,districtId:i=-1,districtType:s=-1}=this.data.cityAddress;return m.$service.searchPoi(h({cityId:e,districtId:i,districtType:s,keyword:t},this.data.position)).then((e=>{var i;let s=e.poiSimpleInfos||[];return 0===s.length&&(s=[{type:"emptyList",errorCode:null==(i=(0,y.getLocationErrorWithType)(y.PoiLocationErrorType.BACK_END_NO_POI_DATA))?void 0:i.errorCode}]),"emptyList"!==s[0].type&&(s=s.map((e=>p(h({},e),{lightTxt:(0,g.parseSugText)(e.poiName,t)})))),this.setData({poiList:s}),s})).catch((t=>{var e;m.page().toast(t.message||"服务繁忙！");const{code:i}=(null==t?void 0:t.data)||{},{statusCode:s}=(null==t?void 0:t.res)||{};let a=y.PoiLocationErrorType.HTTP_ERROR;420===i?a=y.PoiLocationErrorType.ANTI_ERROR_420:403===s&&(a=y.PoiLocationErrorType.ANTI_ERROR);const r=[{type:"emptyList",errorCode:null==(e=(0,y.getLocationErrorWithType)(a))?void 0:e.errorCode}];return this.setData({poiList:r}),r}))},changeCity(){setTimeout((()=>{"selfLifting"===this.data.page?m.$lxLog.mc("b_chaoshi_f3brnw6n_mc"):"selfPickSelect"!==this.data.page&&"otherSelfPickSelect"!==this.data.page||m.$lxLog.mc("b_youxuan_d7gjrrew_mc",{},{cid:"c_youxuan_qjnyfx9c"}),this.setData({showCityListView:!this.data.showCityListView}),this.triggerEvent("showCityList",{showCityListView:this.data.showCityListView})}),this.data.focusin?200:0)},clickMyLoc(){m.$lxLog.mc("b_chaoshi_84rs4n4b_mc"),"定位中…"===this.data.currentAddress.address?m.page().toast("正在定位中，请稍后重试"):"定位失败"===this.data.currentAddress.address?m.page().toast("定位失败，请手动搜索"):this.triggerEvent("setSearchLoc")}}});