var t=Object.create,e=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,a=t=>e(t,"__esModule",{value:!0});((t,r)=>{for(var i in a(t),r)e(t,i,{get:r[i],enumerable:!0})})(exports,{default:()=>h});var l,u,s,d=(l=require("../../ob.js"),((t,n,a)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let l of i(n))o.call(t,l)||"default"===l||e(t,l,{get:()=>n[l],enumerable:!(a=r(n,l))||a.enumerable});return t})(a(e(null!=l?t(n(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l)),{convertRpxToPx:c}=require("../../p0.js"),m="https://p0.meituan.net/groceryimages/8cf03ac54e4f7317b144b82294c033f013543.png";(s=u||(u={}))[s.NORMAL=0]="NORMAL",s[s.PULLDOWN=1]="PULLDOWN";var h=class{constructor(t){this.mapContext=null,this.currentMarkId=-1,this.mapContext=t}genGPSMarkCongfig(t,e){return{markers:[{id:1,iconPath:"https://p1.meituan.net/groceryimages/2d7d1b854d9bf99099f712a8a3edfc1f7618.png",latitude:Number(e),longitude:Number(t),width:29,height:51,joinCluster:!1}]}}findSelectRecommendPointId(t,e){let r=-1;for(let i=0;i<e.length;i++){if(e[i].id===t){r=i;break}}return r}findSelectPositonRecommendPointId(t,e){let r=null;for(let i=0;i<e.length;i++){const n=e[i];if(n.id===t){r={latitude:n.latitude,longitude:n.longitude};break}}return r}genMarks(t){const e=[],r=[];for(let i=0;i<t.length;i++){const n=t[i],o={id:100+i,iconPath:m,latitude:Number(n.latitude),longitude:Number(n.longitude),width:50,height:69,joinCluster:!1,customCallout:{anchorY:74,anchorX:0,display:"BYCLICK"}};r.push({id:o.id,name:n.poiName,picUrl:this.transformSrc(n.picUrl,47,47)}),e.push(o)}return{markers:e,customCallouts:r}}genMarksWithSelectdCalloutIDs(t,e,r){const i=[],n=this.genGPSMarkCongfig(r.longitude,r.latitude),o=[];let a=null;for(let r=0;r<t.length;r++){const n=t[r];let l=null;e&&e.latitude===Number(n.latitude)&&e.longitude===Number(n.longitude)?(a={id:100+r,iconPath:m,latitude:Number(n.latitude),longitude:Number(n.longitude),width:50,height:69,joinCluster:!1,customCallout:{anchorY:74,anchorX:0,display:"ALWAYS"}},o.push({id:a.id,name:n.poiName,picUrl:this.transformSrc(n.picUrl,47,47)})):(l={id:100+r,iconPath:m,latitude:Number(n.latitude),longitude:Number(n.longitude),width:50,height:69,joinCluster:!1,customCallout:{anchorY:74,anchorX:0,display:"BYCLICK"}},i.push(l))}return i.push(...n.markers),a&&i.push(a),{markers:i,customCallouts:o}}hightRecomendPoint(t,e,r,i,n){if(this.currentMarkId===t)return void d.log.info("OverlayManager","hightRecomendPoint  currentMarkId == markerId");if(!Array.isArray(e))return void d.log.info("OverlayManager","hightRecomendPoint  markers invaild");this.currentMarkId=t;const o=this.findSelectPositonRecommendPointId(t,e),a=this.genMarksWithSelectdCalloutIDs(i,o,n);r.setData({markers:a.markers,customCallouts:a.customCallouts})}transformSrc(t,e,r){let i=t.trim();return e&&r&&(i+=`@${e}w_${r}h_1e_1l_200Q`),i}moveMapCenter(t){const{longitude:e,latitude:r}=t;this.mapContext.moveToLocation({longitude:e,latitude:r,success:t=>{},fail:t=>{}})}overView(t,e,r){if(!e)return;let i=[];i.push(t),i=i.concat(e),i.map((({longitude:t,latitude:e})=>({longitude:t,latitude:e})));let n=0;r&&(n=r.contnetHeight-r.contnetTop);const o=[88,30,.7*c(n),30];this.mapContext.includePoints({points:i,padding:o,success(t){},fail(t){}})}getCenterLocation(t){this.mapContext.getCenterLocation({success:e=>{t({latitude:e.latitude,longitude:e.longitude})}})}clearOverlay(t){const e=[];t.forEach((t=>{e.push(t.id)})),this.mapContext&&"function"==typeof this.mapContext.removeMarkers&&this.mapContext.removeMarkers({markerIds:e})}};