<wxs module="fps" src="../../../../ij.sjs" /><wxs module="asset" src="../../../../i0.sjs" /><include src="../../../../er.ttml" /><view class="page {{isIpx ? 'device-ipx' : ''}}" capture-bind:touchstart="__fstBindCaptureTouchStart"><yy bid="b_youxuan_surjhz01_mv" lxParams="{{lxParams}}" bindmvReport="mvHandler"><rg customStyle="margin: 0; border-radius: 0; padding: 10rpx 22rpx 10rpx 30rpx" customTextStyle="font-size: 24rpx" opsource="REFUND_APPLY" noticeBoardInfo="{{noticeBoardInfo}}" show="{{isShowNoticeBoard}}" id="notice-board" bindtap="onTapNoticeBoard" bindshowPop="onNoticeBoardShow" bindclosePop="onNoticeBoardShow" /></yy><view class="section section-area"><view class="receiving-status-item" tt:if="{{receivingStatusOptions.length}}"><view class="receiving-status" bindtap="handleReceivingStatusClick"><view class="receiving-label required">收货状态 (必选)</view><view class="receiving-option-enter"><text class="receiving-status-text">{{selectedReceivingStatus.desc}}</text><text class="default-text" tt:if="{{!selectedReceivingStatus.desc}}">选择收货状态</text><image class="icon-go" src="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/refund-apply-right-arrow.b833601.png"></image></view></view><yy bid="b_youxuan_gpjl9vm5_mv" noData bindmvReport="mvHandler" tt:if="{{retrievalTip}}"><view class="retrieval-tag" tt:if="{{retrievalTip}}">{{retrievalTip}}</view></yy></view><yy bid="b_youxuan_5ivjrw1u_mv" lxParams="{{lxParams}}" bindmvReport="mvHandler"><view class="section-reason" bindtap="toggleFirstReasonPop"><text class="section-reason-left required">退款原因 (必选)</text><view class="section-reason-right"><text class="content" tt:if="{{selectedFirstReason.reason}}">{{selectedSecondReason.reason || selectedFirstReason.reason}}</text><text class="placeholder-content" tt:else>选择退款原因</text><image class="icon-go" src="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/refund-apply-right-arrow.b833601.png"></image></view></view></yy></view><view class="section section-sku-list"><view class="sku-wrapper"><wq class="pic" style-str="border-radius: 8rpx" mode="aspectFill" src="{{stackSkuInfo.picUrl || 'https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/sku_default_750_750.ca34718.png'}}" webp-conf="{{({width:'130rpx', height:'130rpx'})}}" /><view class="info"><view class="name">{{stackSkuInfo.skuName}}</view><view class="extra">实付：￥{{stackSkuInfo.cashPayStr}}</view></view></view><view class="numbers refund-line"><view class="numbers-dec"><view class="num">退款数量</view><text class="remain-num">剩余可退数量 {{stackSkuInfo.reversableQuantity}}</text></view><yy bid="b_youxuan_k4a6xs6s_mv" lxParams="{{lxParams}}" bindmvReport="mvHandler"><ye size="normal" lxParams="{{lxParams}}" showPos="refundApply" source="refundApply" bind:blur="onRefundNumBlur" use-input initial-value="{{stackSkuInfo.quantity}}" min-num="{{1}}" max-num="{{stackSkuInfo.reversableQuantity}}" bind:change="onRefundNumChange" numStyle="font-family: PingFangSC-Medium; font-weight: 700; font-size: 32rpx; line-height: 45rpx" changeStep="{{1}}" displayType="sync" customStyle="min-width: 208rpx" /></yy></view></view><view class="section section-refund-money"><view class="refund-num refund-line" tt:if="{{aftersaleType!==zeroCompensation}}"><view class="refund-money-wrap"><view class="refund-money-label"><text>退款金额</text></view><view class="refund-display" tt:if="{{!showRefundEdit}}"><view class="refund-display-money"><text class="unit">¥</text><text class="price">{{totalPrice}}</text></view><block tt:if="{{!(refundScaleAble || maxRefundPrice === 0 || maxRefundPrice === '0' || hideScaleRefundByCode)}}"><yy bid="b_youxuan_8f0yao7d_mv" lxParams="{{lxParams}}" bindmvReport="mvHandler"><view class="change-money-btn" bindtap="onEditRefundPrice"><image class="image" src="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/refund_edit_icon.51c21074.png" />修改金额</view></yy></block></view></view><view class="refund-edit" tt:if="{{showRefundEdit}}"><text class="unit">¥</text><input class="refund-edit-input" type="digit" auto-focus="{{true}}" adjust-position="{{true}}" hold-keyboard="{{true}}" always-embed="{{true}}" bindinput="handleRefundEditInput" bindblur="handleInputBlur" bindkeyboardheightchange="handleKeyBoardHeightChange" focus="{{inputFocus}}" /><view class="placeholder-text" bindtap="handlePlaceholderTap" tt:if="{{showInputPlaceholder}}">商品最高可退 {{maxRefundPrice || totalPrice}}</view></view><view class="edit-tip" tt:if="{{showRefundEdit && isInvalidateText}}">已将金额自动修改为最高可退金额</view><view class="refund-ratio-list" tt:if="{{!(refundScaleAble || maxRefundPrice === 0 || maxRefundPrice === '0' || hideScaleRefundByCode)}}"><view class="ratio-btn {{item.ratio === selectedRatio.ratio ? 'ratio-btn-selected' : ''}}" data-ratio-item="{{item}}" bindtap="handleRatioClick" tt:for="{{ratioData}}"><text>{{item.text}}</text></view></view><view class="refund-money-detail" tt:if="{{skuRefundPriceStr && deliveryRefundPriceStr}}"><view class="refund-detail-title">退款金额明细</view><view class="refund-detail-item" tt:if="{{skuRefundPriceStr}}"><text class="refund-detail-item-label">商品金额</text><text class="refund-detail-item-num">￥{{skuRefundPriceStr}}</text></view><view class="refund-detail-item" tt:if="{{deliveryRefundPriceStr}}"><view><text class="refund-detail-item-label">配送费</text><image class="refund-detail-item-icon" src="{{asset('images/help_icon')}}" bindtap="onDeliveryMoneyClick" tt:if="{{deliveryRefundPriceTip}}" /></view><text class="refund-detail-item-num">￥{{deliveryRefundPriceStr}}</text></view></view><view class="refund-tip">退款成功后将退还用户 {{totalPrice}} 元</view></view><view class="compensation-box" tt:if="{{aftersaleType===zeroCompensation}}"><view class="allRefund-box"><ya channelType="customer" desc="本单为活动订单，申请退款成功后将退还等值优惠券" money="{{compensationMsg.amountCent}}" couponSubTypeStr="{{compensationMsg.couponTypeDesc}}" couponTypeStr="{{compensationMsg.couponName}}" title="{{compensationMsg.couponType}}" ruleStr="申请退款成功后可使用"></ya></view><view class="noAllRefund-box" tt:if="{{!(refundScaleAble || hideScaleRefundByCode)}}"><view class="compensation-scale refund-ratio-list"><view class="ratio-btn {{item.ratio === selectedRatio.ratio ? 'ratio-btn-selected' : ''}}" data-ratio-item="{{item}}" bindtap="handleRatioClick" tt:for="{{ratioData}}"><text>{{item.text}}</text></view></view><view class="compensation-tips"><text>若退款成功，将退￥{{compensationMsg.amountCent}}等值优惠券</text></view></view></view></view><view class="section"><view class="refund-explain"><view class="title"><view class="title-text {{selectedSecondReason && selectedSecondReason.needRemark ? 'required' : ''}}">退款说明{{selectedSecondReason && selectedSecondReason.needRemark ? ' (必填)' : ''}}</view><view class="can-input-words-length">您还可以输入 {{canInputWordsLength}} 个字</view></view><view class="content"><yt maxlength="{{descLimit}}" placeholder="{{textareaPlaceholder}}" bindinput="onDescInput" containerStyle="{{containerStyle}}" placeholder-style="{{placeholderStyle}}" textAreaStyle="{{textAreaStyle}}" countStyle="{{countStyle}}" autoFocus="{{false}}" value="{{remark}}" bindfocus="showPadding" bindblur="hidePadding" /></view></view><view class="upload-text-wrapper"><view class="upload-text {{selectedSecondReason && selectedSecondReason.needApplyPicture ? 'required' : ''}}">上传凭证{{selectedSecondReason && selectedSecondReason.needApplyPicture ? ' (必填)' : ''}}</view></view><view class="pic-area"><yr customStyle="margin: 0;" limit="{{imgLimit}}" bindprogressUpdate="onImgUpload"></yr><view class="pic-tip" tt:if="{{selectedSecondReason && selectedSecondReason.refundReasonTip}}">{{selectedSecondReason && selectedSecondReason.refundReasonTip}}</view></view></view><view class="top-z-index bottom-bar" style="{{btnStyle}}" tt:if="{{showRefundEdit}}"><view class="top-z-index btn-submit" catchtap="handleEditOk">完成修改</view></view><view class="top-z-index bottom-bar" tt:if="{{!showFirstReasonPop && !showRefundStayPop && !showRefundRatioPopup && !showNoticeBoardPop && !showRefundEdit && !showReceivingStatusOption && !showValidateConfirm && !showRefundPopup && !isShowContactGroupHeader}}"><yy bid="b_youxuan_o93ojjqx_mv" lxParams="{{lxParamsV2}}" bindmvReport="mvHandler"><view class="top-z-index btn-submit" catchtap="onSubmit">提交</view></yy></view><view class="__fst_judge_target" style="display:hidden;" /></view><yu show="{{showRefundRatioPopup}}" totalPrice="{{totalPrice}}" maxPrice="{{maxRefundPrice}}" bindconfirm="onRefundRatioConfirm" bindclose="onRefundRatioClose" /><ed show="{{showFirstReasonPop}}" bindclose="toggleFirstReasonPop" type="bottom" closeOnClickMask catchtouchmove mask="{{true}}" isShowIpxBar="{{true}}"><view class="reason-selector"><view class="reason-selector__header">退款原因</view><view class="reason-selector-close-btn" catchtap="toggleFirstReasonPop"></view><scroll-view scroll-y class="reason-selector__content"><view class="reason-selector__content-item {{tempSelectedFirstReason.code === firstReason.code ? 'selected': ''}} {{index === orderReverseReasons.length - 1 ? 'first-reason-last' : ''}}" data-first-reason="{{firstReason}}" catchtap="onSelectFirstReason" tt:for="{{orderReverseReasons}}" tt:for-item="firstReason"><view class="desc"><view class="first-reason-text">{{(firstReason.specificReverseReasonList && firstReason.specificReverseReasonList.length === 1) ? firstReason.specificReverseReasonList[0].reason : firstReason.reason}}</view><image class="check-icon" src="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/check.bcc4917.png" tt:if="{{tempSelectedFirstReason.code === firstReason.code ? 'selected': ''}}" /><image class="check-icon" src="https://s3plus.meituan.net/v1/mss_1f3dca8fe8534e6fa640054bf3ad2ba6/grocery-fe-cdn/wx/images/cdn/selfLiftingUncheckedIcon.b77b664.png" tt:else /><view class="refund-secondReason refund-line" tt:if="{{tempSelectedFirstReason.code === firstReason.code && tempSelectedFirstReason.specificReverseReasonList && tempSelectedFirstReason.specificReverseReasonList.length > 1}}"><view class="refund-secondReasonList"><view class="secondReason-item {{secondReason.code === tempSelectedSecondReason.code ? 'selectedSecondReasons' : ''}}" data-second-reason="{{secondReason}}" catchtap="onSelectSecondReason" tt:for="{{tempSelectedFirstReason.specificReverseReasonList}}" tt:for-item="secondReason" tt:key="secondReason"><view class="second-reason-text">{{secondReason.reason}}</view></view></view></view><view tt:if="{{tempSelectedFirstReason.code === firstReason.code && showPriceMatch}}"><yy bid="b_youxuan_hcxpblux_mv" lxParams="{{({order_id: orderId, sku_id: stackSkuInfo.skuId})}}" bindmvReport="mvHandler"><view class="price-match-area" catchtap><view>{{priceMatchInfo.message}}</view><view class="price-match-btn" catchtap="gotoInsurance">{{priceMatchInfo.buttonText || '申请价保'}}</view></view></yy></view></view></view></scroll-view><view class="reason-selector__footer"><view class="switch-label"><yp show="{{isSwitchLabelShow}}" label-text="{{switchLabelText}}" from="{{switchLabelFrom}}" order-id="{{orderId}}" sku-id="{{stackSkuInfo.skuId}}" switch-checked="{{switchLabelChecked}}" bindonSwitchChange="onSwitchLabelChange"></yp></view><view class="btn-submit btn-primary {{!tempSelectedFirstReason.code || !tempSelectedSecondReason.code ? 'disabled' : ''}}" catchtap="handleReasonOk">确定</view></view></view></ed><tt from="{{stayPopfrom}}" sku-id="{{stackSkuInfo.skuId}}" order-id="{{orderId}}" stack-id="{{stackSkuInfo.stackId}}" show="{{showRefundStayPop}}" info="{{refundStayInfo}}" cancel-text="{{refundStayCancelText}}" ok-text="{{refundStayOkText}}" bindclose="closeRefundStayPop" /><yi show="{{showReceivingStatusOption}}" title="收货状态" option-data="{{receivingStatusOptions}}" selected-data="{{selectedReceivingStatus}}" binditemselected="handleSelectReceivingStatus" bindclose="closeReceivingStatusOption"></yi><yo show="{{showRefundPopup}}" title="{{refundPopupData.title}}" content="{{refundPopupData.content}}" tip="{{refundPopupData.tip}}" btnList="{{refundPopupData.btnList}}" bindmaskClick="handleRefundPopupMaskClick" bindbtnClick="handleRefundPopupBtnClick" /><rc id="contact-group-header" bindshowPop="handleContactShowPop" /><view change:prop="{{fps.fpsRecord}}" prop="{{_fpsIsComputed}}"></view>