Object.defineProperty(exports,"__esModule",{value:!0});var s,t=require("./d8.js"),e=new((s=t)&&s.__esModule?s:{default:s}).default,a={data:{smsInfo:{}},initSmsSDK:function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.data,e=s.success,a=s.fail;this.callBackSuccess=e,this.callBackFail=a,this.setData({smsInfo:{data:t,isMobile:t.mobile,isSend:!1,show:!0,mobileLable:t.mobileLable||"手机号",verifyCodeLable:t.verifyCodeLable||"验证码",smscode:"",opacity:.5,sendSmsDisa:!t.mobile,verifyDisa:!0,buttonValue:t.buttonValue||"验证"}}),"true"===t.autoSend&&this.tapSeedSmS()},tapSeedSmS:function(){var s=this,t=this,a=this.data,i=a.smsInfo,o=a.smsInfo,n=o.isMobile,d=o.data,r=d.action,c=d.request_code,l=d.type,m=d.options,f=i.mobile;"undefined"!=typeof mmp&&mmp.getRiskControlFingerprint({success:function(t){var e=t.fingerprint;i.fp=e,s.setData({smsInfo:i})}}),n&&(f=""),wx.showLoading({title:"发送中...",mask:!0}),e.sendInfo({request_code:c,type:l,action:r,options:{mobile:f,moduleEnable:!0}}).then((function(s){wx.hideLoading();var e=s.status,a=s.error;1===e?(wx.showToast({title:"已发送短信"}),t.showWaitModal(),i.isSend=!0):t.smsHandleError(a),t.setData({smsInfo:i})})).catch((function(){e.catchCallback("发送短信异常",0,"请求发送短信异常",m,s)}))},bindSmsVerify:function(){var s=this,t=this,a=this.data,i=a.smsInfo,o=a.smsInfo,n=o.isMobile,d=o.isSend,r=o.smscode,c=o.opacity,l=o.fp,m=o.data,f=m.action,u=m.request_code,h=m.type,p=m.options,b=m.listIndex,I=n?"":i.mobile;d&&1===c&&(wx.showLoading({title:"验证中...",mask:!0}),e.verify({request_code:u,type:h,action:f,options:{smscode:r,mobile:I,listIndex:b,fingerprint:l}}).then((function(a){wx.hideLoading();var o=a.status,n=a.data,d=a.error;if(1===o){if(i.show=!1,e.nextVerify(b,a.data&&a.data.nextVerifyMethodId))return;e.successCallback(n.request_code,n&&n.response_code,p,s)}else t.smsHandleError(d)})).catch((function(){e.catchCallback("验证异常",0,"请求验证异常",p,s)})))},smsHandleError:function(s){var t=this.data.smsInfo.data.options;e.errorCallback(s,t,this.errorExit,this)},errorExit:function(){var s=this.data.smsInfo;s.smscode="",s.opacity=.5,s.verifyDisa=!0,this.setData({smsInfo:s})},showWaitModal:function(){var s=this,t=0,e=s.data.smsInfo,a=e.codeButText,i=e.sendSmsDisa,o=setInterval((function(){var e=s.data.smsInfo;a=60-(t+=1)+"s后请重试",i=!0,e.sendSmsDisa=i,e.codeButText=a,s.setData({smsInfo:e}),60===t&&(e.sendSmsDisa=!1,e.codeButText="发送验证码",s.setData({smsInfo:e}),clearInterval(o))}),1e3)},yodaEvent:function(s){var t=s.detail,a=t.status,i=t.code,o=t.msg;if(1===a)this.tapSeedSmS();else{var n=this.data.smsInfo.data.options,d={code:i,message:o};e.errorCallback(d,n,this.errorExit,this)}},bindMobileInput:function(s){var t=s.detail.value.trim(),e=this.data.smsInfo;e.mobile=t,e.sendSmsDisa=11!==t.length,this.setData({smsInfo:e})},bindSmsCodeInput:function(s){var t=s.detail.value,e=this.data.smsInfo;e.smscode=t,e.opacity=t.length>1&&e.isSend?1:.5,this.setData({smsInfo:e})},changeVerify:function(){var s=this.data.smsInfo.data;e.changeVerify(s)}};exports.default=a;