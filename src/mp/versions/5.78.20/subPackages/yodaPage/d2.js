Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("./d8.js"),a=new((t=e)&&t.__esModule?t:{default:t}).default,i={data:{buyingInfo:{}},initBuyingSDK:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,a=t.success,i=t.fail;this.callBackSuccess=a,this.callBackFail=i,this.setData({buyingInfo:{data:e,show:!0,opacity:.5,verifyDisa:!0,purchaseddeal:[],verifyButText:e.verifyButText||"验证"}}),this.getBuyInfo()},getBuyInfo:function(){var t=this,e=this.data,i=e.buyingInfo,n=e.buyingInfo.data,o=n.request_code,r=n.action,s=n.type,u=n.options;a.sendInfo({request_code:o,type:s,action:r}).then((function(e){var a=e.status,n=e.data,o=e.error;if(1===a){var r=n.prompt.purchaseddeal,s=r.items,u=r.hint,c=!0,d=!1,f=void 0;try{for(var l,y=s[Symbol.iterator]();!(c=(l=y.next()).done);c=!0){var h=l.value;h.couponTitle=h.couponTitle.length>25?h.couponTitle.substring(0,24)+"...":h.couponTitle,h.checked=!1}}catch(t){d=!0,f=t}finally{try{!c&&y.return&&y.return()}finally{if(d)throw f}}i.items=s,i.hint=u,i.opacity=.5,i.verifyDisa=!0,t.setData({buyingInfo:i})}else t.handleError(o)})).catch((function(){a.catchCallback("获取数据异常",0,"请求历史购买信息出异常了",u,t)}))},bindChange:function(){this.getBuyInfo()},bindVerify:function(){var t=this,e=this.data,i=e.buyingInfo,n=e.buyingInfo,o=n.purchaseddeal,r=n.data,s=r.action,u=r.request_code,c=r.type,d=r.options,f=r.listIndex;this.data.buyingInfo.verifyDisa=!0,this.setData(this.data),wx.showLoading({title:"验证中...",mask:!0}),a.verify({request_code:u,type:c,action:s,options:{purchaseddeal:JSON.stringify(o),listIndex:f}}).then((function(e){wx.hideLoading(),t.data.buyingInfo.verifyDisa=!1,t.setData(t.data);var n=e.status,o=e.data,r=e.error;if(1===n){if(i.show=!1,a.nextVerify(f,o.nextVerifyMethodId))return;t.setData({buyingInfo:i}),a.successCallback(o.request_code,o.response_code,d,t)}else t.handleError(r)})).catch((function(){a.catchCallback("验证异常",0,"请求验证异常了",d,t)}))},bindRadioChange:function(t){var e=t.detail.value,a=this.data.buyingInfo;a.purchaseddeal[0]=e,a.opacity=1,a.verifyDisa=!1;var i=!0,n=!1,o=void 0;try{for(var r,s=a.items[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var u=r.value;u.dealid===Number(e)?u.checked=!0:u.checked=!1}}catch(t){n=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.setData({buyingInfo:a})},handleError:function(t){var e=this.data.buyingInfo.data.options;a.errorCallback(t,e,this.getBuyInfo,this)},changeVerify:function(){var t=this.data.buyingInfo.data;a.changeVerify(t)},onPullDownRefresh:function(){wx.stopPullDownRefresh()}};exports.default=i;