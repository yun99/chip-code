Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),a=require("./d7.js"),o=function(){function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}return t(o,[{key:"getPageData",value:function(e,t){var o={requestCode:e,feVersion:"2.4.1",source:a.source,layer:t};return new Promise((function(e,t){var n=a.YodaServer.getYodaServer().getServer()+"/v2/ext_api/page_data";wx.request({method:"POST",url:n,data:o,timeout:5e3,header:{"content-type":"application/x-www-form-urlencoded"},headers:{"content-type":"application/x-www-form-urlencoded"},success:function(a){var o=a.data,n=o.status,c=o.data,s=o.error;200===a.statusCode||200===a.status?e({status:n,data:c,error:s}):t(a)},fail:function(e){t(e)}})})).catch((function(e){wx.showToast({icon:"none",title:e.message,duration:2e3})}))}},{key:"sendInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.request_code,n=t.type,c=t.action,s=void 0===c?"":c,i=t.options,r=void 0===i?null:i,u={request_code:o};return r&&"object"===(void 0===r?"undefined":e(r))&&Object.keys(r).forEach((function(e){Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e])})),new Promise((function(e,t){wx.request({url:a.YodaServer.getYodaServer().getServer()+"/v2/ext_api/"+s+"/info?id="+n,method:"POST",data:u,timeout:5e3,header:{"content-type":"application/x-www-form-urlencoded"},headers:{"content-type":"application/x-www-form-urlencoded"},success:function(a){var o=a.data,n=o.status,c=o.data,s=o.error;200===a.statusCode||200===a.status?e({status:n,data:c,error:s}):t("")},fail:function(e){t(e)}})})).catch((function(){wx.showToast({icon:"none",title:"获取sendInfo失败",duration:2e3})}))}},{key:"verify",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.request_code,n=t.type,c=t.action,s=void 0===c?"":c,i=t.options,r={request_code:o};return i&&"object"===(void 0===i?"undefined":e(i))&&Object.keys(i).forEach((function(e){Object.prototype.hasOwnProperty.call(i,e)&&(r[e]=i[e])})),new Promise((function(e,t){wx.request({url:a.YodaServer.getYodaServer().getServer()+"/v2/ext_api/"+s+"/verify?id="+n,method:"POST",data:r,timeout:5e3,header:{"content-type":"application/x-www-form-urlencoded"},headers:{"content-type":"application/x-www-form-urlencoded"},success:function(a){if(200===a.statusCode||200===a.status){var o=a.data,n=o.status,c=o.data,s=o.error;1===n&&c&&(c.request_code=c.origin_request_code?c.origin_request_code:r.request_code),e({status:n,data:c,error:s})}else t()},fail:function(e){t(e)}})})).catch((function(){wx.showToast({icon:"none",title:"获取verify失败",duration:2e3})}))}},{key:"nextVerify",value:function(e,t){return!(!t||!e&&0!==e||(wx.getStorage({key:"yodaPageData",success:function(a){var o=a.data;o.type=t,o.listIndex=e,"GROUP"!==o.category&&"MULTIPLE"!==o.category||!e&&0!==e||wx.setStorage({key:"yodaPageData",data:o,success:function(){wx.redirectTo({url:"./../../modules/index/index"})}})},fail:function(){wx.showToast({icon:"none",title:"获取验证信息失败",duration:2e3})}}),0))}},{key:"nextPMVerify",value:function(e){wx.redirectTo({url:"./../../modules/index/index?requestCode="+e})}},{key:"navigate",value:function(e){var t=e.options,a=e.url;if(wx.removeStorage({key:"yodaPageData",success:function(){return 0}}),t&&"back"===t.navigate){var o=a.split("?")[1].split("&"),n=Object.create(null);o.forEach((function(e){var t=e.split("=");n[t[0]]=t[1]})),getApp().yodaVerifyData=n;var c=t.delta||1;wx.navigateBack({delta:c})}else wx.redirectTo({url:a})}},{key:"catchCallback",value:function(e,t,a,o,n,c){var s=this;if("face"!==c)wx.showToast({title:e,icon:"none",mask:!0,duration:2e3,complete:function(){if("string"==typeof n.callBackFail){var e="status=0&code="+t+"&msg="+a;e=n.callBackFail.includes("?")?"&"+e:"?"+e,setTimeout((function(){s.navigate({options:o,url:n.callBackFail+e})}),1e3)}"function"==typeof n.callBackFail&&setTimeout((function(){n.callBackFail({status:0,code:t,msg:a})}),1e3)}});else{if("string"==typeof n.callBackFail){var i="status=0&code="+t+"&msg="+a;i=n.callBackFail.includes("?")?"&"+i:"?"+i,this.navigate({options:o,url:n.callBackFail+i})}"function"==typeof n.callBackFail&&n.callBackFail({status:0,code:t,msg:a})}}},{key:"toComponent",value:function(e,t){wx.getStorage({key:"yodaPageData",success:function(a){var o=a.data;e.Yoda.init({requestCode:t,env:o.env,appletsfp:o.appletsfp})},fail:function(){e.callBackFail({status:0,code:999031,msg:" 获取缓存失败"})}})}},{key:"errorCallback",value:function(e,t,o,n,c){var s=e.code||0,i=e.message||"验证异常";switch(Object.keys(a.closeStatus).forEach((function(e){Number(a.closeStatus[e])===s&&(s="jump")})),s){case 121008:wx.showToast({icon:"none",title:"验证错误",complete:o.bind(n)});break;case 121068:wx.showToast({icon:"none",title:"输入错误",complete:o.bind(n)});break;case 121038:wx.showToast({icon:"none",title:"操作过于频繁"});break;case 121044:this.catchCallback("授权码过期",e.code,i,t,n);break;case 121048:case 121060:this.toComponent(n,e.request_code);break;case 121117:this.nextPMVerify(e.request_code);break;case 121047:case 121054:wx.showToast({icon:"none",title:"请重新发送验证",complete:o.bind(n)});break;case 121079:case 121095:wx.showToast({icon:"none",title:"请重新操作",complete:o.bind(n)});break;case 121084:case 121101:wx.showToast({icon:"none",title:"人脸比对未通过",complete:o.bind(n)});break;case 121100:wx.showToast({icon:"none",title:"人脸多于一个,请核实后重试",complete:o.bind(n)});break;case 121102:wx.showToast({icon:"none",title:"人脸对比失败,请重试",complete:o.bind(n)});break;case 130003:wx.showToast({icon:"none",title:"数据上传失败,请重试",complete:o.bind(n)});break;case 121063:wx.showToast({icon:"none",title:"密码错误",complete:o.bind(n)});break;default:this.catchCallback(i,e.code,i,t,n,c)}}},{key:"successCallback",value:function(e,t,a,o){if("function"==typeof o.callBackSuccess&&o.callBackSuccess({status:1,requestCode:e,responseCode:t}),"string"==typeof o.callBackSuccess){var n="status=1&requestCode="+e+"&responseCode="+t;n=o.callBackSuccess.includes("?")?"&"+n:"?"+n,this.navigate({options:a,url:o.callBackSuccess+n})}}},{key:"callWebViewAndComponent",value:function(e){var t=e.requestCode,a=e.responseCode,o=e.code,n=e.msg;wx.getStorage({key:"yodaPageData",success:function(e){var c=e.data,s=function(e){var t=e.options,a=e.url;if(wx.removeStorage({key:"yodaPageData",success:function(){}}),t&&"back"===t.navigate){var o=a.split("?")[1].split("&"),n=Object.create(null);o.forEach((function(e){var t=e.split("=");n[t[0]]=t[1]})),getApp().yodaVerifyData=n;var c=t.delta||1;wx.navigateBack({delta:c})}else wx.redirectTo({url:a})};if(a)if("FUNCTION"===c.success)getApp().globalData.success({status:1,requestCode:t,responseCode:a});else{var i="status=1&requestCode="+t+"&responseCode="+a,r=c.success+(c.success.includes("?")?"&"+i:"?"+i);s({options:c.options,url:r})}else if("FUNCTION"===c.fail)getApp().globalData.fail({status:0,code:o,msg:n});else{var u="status=0&code="+o+"&msg="+n,l=c.fail+(c.fail.includes("?")?"&"+u:"?"+u);s({options:c.options,url:l})}},fail:function(){wx.showToast({icon:"none",title:"获取验证缓存信息异常",duration:2e3})}})}},{key:"changeVerify",value:function(){wx.getStorage({key:"yodaPageData",success:function(e){var t=e.data;t.type=-1,"GROUP"===t.category&&wx.setStorage({key:"yodaPageData",data:t,success:function(){wx.redirectTo({url:"./../../modules/index/index"})}})},fail:function(){wx.showToast({icon:"none",title:"获取验证缓存信息异常",duration:2e3})}})}}]),o}();exports.default=o;