var e,t,a=Object.create,s=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(e,t,a)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,p=e=>{return((e,t,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of o(t))l.call(e,r)||"default"===r||s(e,r,{get:()=>t[r],enumerable:!(a=i(t,r))||a.enumerable});return e})((t=s(null!=e?a(n(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0}),s(t,"__esModule",{value:!0})),e);var t},u=(e,t,a)=>new Promise(((s,i)=>{var o=e=>{try{n(a.next(e))}catch(e){i(e)}},r=e=>{try{n(a.throw(e))}catch(e){i(e)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);n((a=a.apply(e,t)).next())})),h=p(require("../../../../a3.js")),g=p(require("../../../../ad.js")),m=p(require("../../../../u9.js")),y=p(require("../../../../ob.js")),k=p(require("../../ak.js")),D=p(require("../../aj.js")),b=require("../../../../er.js"),f=getApp(),T=(null==(t=null==(e=f.getModule("systemInfo"))?void 0:e.getSystemInfo())?void 0:t.isIpx)||!1,{statusBarHeight:v}=(0,h.getStatusBarHeight)(),x=null,w=0;b({data:{pickerName:"",pickerPhone:"",label:"",opType:"",pickerId:"",pickerType:"",isIpx:T,showDeleteDialog:!1,showSaveDialog:!1,statusBarHeight:v,title:"",originName:"",originPhone:"",originLabel:"",originType:"",btnDisabled:!0,showDeleteBtn:!1,isNotSupportNavigationStyle:g.isNotSupportNavigationStyle,pageFrom:"",chooseAddress:"",houseNumber:"",latitude:"",longitude:"",addressId:"",tagList:D.TAG_LIST,selectedTag:{}},onLoad(e){wx.hideShareMenu({});const{opType:t,userPicker:a,pageFrom:s=""}=e;if(this.setData({opType:+t,pageFrom:s}),+t===D.OpType.Update?this.setData({showDeleteBtn:!0}):this.setData({showDeleteBtn:!1}),a)try{const e=JSON.parse(decodeURIComponent(a));let i,o,r,n;if(s===D.fromDeliveryAddress){const{houseNumber:a,name:s,phone:i,address:o,latitude:r,longitude:n,addressId:l}=e;+t===D.OpType.Update?this.setData({pickerName:s,pickerPhone:i,chooseAddress:o,houseNumber:a,latitude:r,longitude:n,addressId:l}):+t===D.OpType.Add&&this.setData({pickerName:s,pickerPhone:i,latitude:r,longitude:n})}else{const{label:a,pickerId:s,pickerName:l,pickerPhone:d,pickerType:c}=e,{tagList:p=[]}=this.data;if(i=l,o=d,r=a,n=c,+t===D.OpType.Update){let e={};p.forEach((t=>{t.tagName===a&&(e=t)})),this.setData({pickerName:l,pickerPhone:d,label:a,pickerId:s,pickerType:c,selectedTag:e})}else+t===D.OpType.Add&&this.setData({pickerName:l,pickerPhone:d})}this.judgeBtnDisabled(i,o),this.setData({originName:i,originPhone:o,originLabel:r,originType:n})}catch(e){y.log.warn("<提货人编辑/新增>解析传参错误",JSON.stringify(e))}else this.setData({btnDisabled:!0});let i="";+t===D.OpType.Add?i=s===D.fromDeliveryAddress?"添加收货地址":"添加提货人":+t===D.OpType.Update&&(i=s===D.fromDeliveryAddress?"编辑收货地址":"编辑提货人"),this.setData({title:i}),wx.setNavigationBarTitle({title:i})},onShow(){this.data.pageFrom===D.fromDeliveryAddress?f.$lxLog.pv("c_youxuan_4ij2h8wy"):f.$lxLog.pv("c_youxuan_pre6cx6n");const e=f.$store.getAndRemove("poiAddressMap_poi");if(e){let t=!0;e.address!==this.data.chooseAddress&&(t=!1);const{latitude:a,longitude:s,address:i}=e;this.setData({chooseAddress:i,latitude:a,longitude:s,btnDisabled:t})}},handleInput(e){const{editType:t="",value:a=""}=e.detail;t&&this.typeAction(t,a)},handleFocus(e){const{editType:t=""}=e.detail,a={pickerName:"b_youxuan_rnnsjulb_mc",pickerPhone:"b_youxuan_nkd4cmmm_mc",label:"b_youxuan_ez1xzvd1_mc"};a[t]&&f.$lxLog.mc(a[t])},handleClear(e){const{editType:t=""}=e.detail;this.typeAction(t,"")},typeAction(e,t){if(!e)return;let a=t,s=e;"pickerPhone"===e&&a.indexOf("+86")>-1?a=a.replace("+86",""):"tag"===e?s="label":"label"===e&&this.setData({selectedTag:{}}),this.setData({[s]:a.trim()},(()=>{const{pickerName:e,pickerPhone:t}=this.data;this.judgeBtnDisabled(e,t)}))},handleArrowClick(e){return u(this,null,(function*(){try{const e=yield m.default.getWxLocation({refresh:!0});if(e){const t=((e,t)=>{for(var a in t||(t={}))l.call(t,a)&&c(e,a,t[a]);if(r)for(var a of r(t))d.call(t,a)&&c(e,a,t[a]);return e})({},e);t.pageFrom=this.data.pageFrom,f.$router.goto("/subPackages/location/pages/poiAddressMap/index",t)}}catch(e){const t=e.type;"no_location_wx"===t||"no_location_wxapp"===t?wx.showModal({title:"定位服务未开启",content:"请在设置中开启定位服务",confirmText:"去设置",cancelText:"知道了",confirmColor:"#FFD100",cancelColor:"#333",success:e=>{e.confirm&&wx.openSetting({})}}):(y.log.warn("[收货地址页] handleArrowClick errorType ",t),"no_location_mmp"===t?wx.showModal({title:"定位服务未开启",content:"请在设置中开启定位服务",confirmText:"去设置",cancelText:"知道了",confirmColor:"#FFD100",cancelColor:"#333",success:e=>{e.confirm&&wx.openSetting({})}}):f.page().toast("获取定位信息失败"))}}))},judgeBtnDisabled(e,t){e&&t?this.setData({btnDisabled:!1}):this.setData({btnDisabled:!0})},handleTypeChange(e){const{value:t}=e.detail,a=t?1:0;this.setData({pickerType:a}),f.$lxLog.mc("b_youxuan_7y9h877c_mc",{status:t?"open":"close"})},handleEditUserInfo(){w?(x&&(clearTimeout(x),x=null),x=setTimeout((()=>{this.editUserInfo(),w++}),500)):(this.editUserInfo(),w++)},editUserInfo(){return u(this,null,(function*(){if(this.data.pageFrom===D.fromDeliveryAddress)return void this.checkAndSaveUserInfo();const{pickerName:e="",pickerPhone:t="",label:a="",opType:s,pickerId:i,pickerType:o,btnDisabled:r}=this.data;if(f.$lxLog.mc("b_youxuan_dp96turv_mc"),r)return;const n={opType:s,userPicker:{pickerId:i,pickerName:e,pickerPhone:t,pickerType:o,label:a}};if(e)if(e.length>16)f.page().toast("提货人名称太长");else if(t)if(/^\d{11}$/.test(t))try{(yield(0,k.editPicker)(n))&&(this.setData({showSaveDialog:!1,btnDisabled:!0}),f.page().toast("保存成功"),setTimeout((()=>{f.$router.triggerBack("edit-editUserInfo")}),800))}catch(e){f.page().toast(e.message)}else f.page().toast("请填写正确的手机号");else f.page().toast("请填写手机号");else f.page().toast("请填写提货人姓名")}))},checkAndSaveUserInfo(){return u(this,null,(function*(){const{btnDisabled:e}=this.data;if(f.$lxLog.mc("b_youxuan_fp3v05qj_mc"),e)return;const t={operateType:this.data.opType,name:this.data.pickerName,address:this.data.chooseAddress,houseNumber:this.data.houseNumber,phone:this.data.pickerPhone||"",latitude:this.data.latitude||"",longitude:this.data.longitude||"",addressId:this.data.addressId||""};if(this.data.pickerName)if(this.data.pickerName.length>20)f.page().toast("收货人名称太长");else if(this.data.pickerPhone)if(/^\d{11}$/.test(this.data.pickerPhone))if(this.data.chooseAddress)if(this.data.houseNumber)try{(yield(0,k.deliveryAddressListOperate)(t))&&(this.setData({showSaveDialog:!1}),f.page().toast("保存成功"),setTimeout((()=>{f.$router.triggerBack("edit-checkAndSaveUserInfo")}),800))}catch(e){f.page().toast(e.message)}else f.page().toast("请输入门牌号");else f.page().toast("请选择收货地址");else f.page().toast("请填写正确的手机号");else f.page().toast("请输入手机号");else f.page().toast("请输入收货人名称")}))},deleteAddress(){return u(this,null,(function*(){const e={operateType:D.OpType.Delete,name:this.data.pickerName,address:this.data.chooseAddress,houseNumber:this.data.houseNumber,phone:this.data.pickerPhone||"",latitude:this.data.latitude||"",longitude:this.data.longitude||"",addressId:this.data.addressId||""};f.$lxLog.mc("b_youxuan_3wbpot80_mc");try{(yield(0,k.deliveryAddressListOperate)(e))?(f.page().toast("删除成功"),this.setData({showDeleteDialog:!1}),setTimeout((()=>{f.$router.triggerBack("edit-deleteAddress")}),800)):f.page().toast("删除错误，请稍后重试")}catch(e){f.page().toast(e.message)}}))},deletePicker(){return u(this,null,(function*(){const{pickerId:e}=this.data,t={opType:D.OpType.Delete,userPicker:{pickerId:e}};f.$store.getCacheValue("pickerId")&&f.$store.remove("pickerId");try{(yield(0,k.editPicker)(t))?(f.page().toast("删除成功"),this.setData({showDeleteDialog:!1}),setTimeout((()=>{f.$router.triggerBack("edit-deletePicker")}),800)):f.page().toast("删除错误，请稍后重试")}catch(e){f.page().toast(e.message)}}))},handleDelete(){this.setData({showDeleteDialog:!0})},handleDeleteDialogCancel(){this.setData({showDeleteDialog:!1})},handleSaveDialogCancel(){this.setData({showSaveDialog:!1},(()=>{f.$router.triggerBack("edit-handleSaveDialogCancel")}))},handleBack(){const{pickerName:e,pickerPhone:t,label:a,pickerType:s,originName:i,originPhone:o,originLabel:r,originType:n,pageFrom:l}=this.data;l!==D.fromDeliveryAddress?e&&t?e!==i||t!==o||a!==r||+s!=+n?this.setData({showSaveDialog:!0}):f.$router.triggerBack("edit-handleBack-else"):f.$router.triggerBack("edit-handleBack-pickerName"):f.$router.triggerBack("edit-handleBack-fromDeliveryAddress")},handleTagClick(e){const{dataset:t={}}=e.target,{tag:a={}}=t;this.setData({selectedTag:a}),a.tagName&&this.typeAction("tag",a.tagName)}});