var t=Object.create,e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,r=r=>{return((t,n,r)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let u of i(n))o.call(t,u)||"default"===u||e(t,u,{get:()=>n[u],enumerable:!(r=s(n,u))||r.enumerable});return t})((u=e(null!=r?t(n(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0}),e(u,"__esModule",{value:!0})),r);var u},u=(t,e,s)=>new Promise(((i,n)=>{var o=t=>{try{u(s.next(t))}catch(t){n(t)}},r=t=>{try{u(s.throw(t))}catch(t){n(t)}},u=t=>t.done?i(t.value):Promise.resolve(t.value).then(o,r);u((s=s.apply(t,e)).next())})),l=r(require("../../../../uc.js")),a=r(require("../../../../er.js")),c=require("../../pg.js"),{wxLogin:h}=c;(0,a.default)({userId:null,uniqueCode:null,openId:null,unionId:null,systemInfo:null,platform:null,netWorkType:null,screenBrightness:null,batteryInfo:null,bluetoothDevices:null,userInfo:null,wifiList:[],onLoad(t){return u(this,null,(function*(){this.userId=t.userId,this.uniqueCode=t.scene,Promise.all([this.getOpenId(),this.getSystemInfo(),this.getNetWorkType(),this.getScreenBrightness(),this.getBatteryInfoSync(),this.getBluetoothDevices()]).then((()=>{this.report()}))}))},getOpenId(){return u(this,null,(function*(){const t=yield h({slient:!0,bind:!1});t.openId&&(this.openId=t.openId,this.unionId=t.unionId)}))},getSystemInfo(){return u(this,null,(function*(){try{const t=wx.getSystemInfoSync();let e;if(this.systemInfo=t,"android"===t.platform&&(e=parseInt(t.system.substr(8),10)),"ios"===t.platform&&(e=parseInt(t.system.substr(4),10)),"android"===t.platform&&e<6)return;if("ios"===this.platform&&e<11)return;this.platform=t.platform}catch(t){}}))},getNetWorkType(){return u(this,null,(function*(){wx.getNetworkType({success:t=>{this.netWorkType=t&&t.networkType}})}))},getScreenBrightness(){return u(this,null,(function*(){wx.getScreenBrightness({success:t=>{this.screenBrightness=t&&t.value}})}))},getBatteryInfoSync(){return u(this,null,(function*(){this.batteryInfo=wx.getBatteryInfoSync()}))},getBluetoothDevices(){return u(this,null,(function*(){wx.getBluetoothDevices({success:t=>{this.bluetoothDevices=t}})}))},getUserInfo(t){return u(this,null,(function*(){var e;(null==(e=null==t?void 0:t.detail)?void 0:e.userInfo)?(this.userInfo=t.detail.userInfo,wx.showToast({title:"获取用户信息成功"})):wx.showToast({title:"获取用户信息失败"})}))},startWifi(){try{wx.startWifi({success:()=>{this.getWifiListFunc()},fail:t=>{wx.showToast({title:`初始化WiFi失败:${t.errMsg}`,icon:"none",duration:3e3})}})}catch(t){}},getWifiListFunc(){"ios"===this.platform?this.getWifiList():wx.getSetting({success:t=>{t.authSetting["scope.userLocation"]?this.getWifiList():wx.authorize({scope:"scope.userLocation",success:t=>{this.getWifiList()},fail:t=>{wx.showModal({title:"提示",content:"定位失败，您未开启定位权限，点击开启定位权限",success:t=>{t.confirm&&wx.openSetting({success:t=>{t.authSetting["scope.userLocation"]?this.getWifiList():wx.showToast({title:"用户未开启地理位置权限",icon:"none",duration:3e3})}})}})}})}})},getWifiList(){wx.getWifiList({success:t=>{wx.onGetWifiList((t=>{this.wifiList=[],t&&t.wifiList?(wx.showToast({title:"获取Wifi列表信息成功"}),this.wifiList=t.wifiList):wx.showToast({title:"获取Wifi列表信息失败"})}))},fail(t){wx.showToast({title:`获取 Wi-Fi 列表数据失败${t.errMsg}`,icon:"none",duration:3e3})}})},report(){wx.request({url:`${l.smithReportDomain}/api/smith/risk/save/accountMsg`,dataType:"json",data:{unionId:this.unionId,accountBasicMsgVO:{openId:this.openId,headImgUrl:this.userInfo&&this.userInfo.avatarUrl,nickName:this.userInfo&&this.userInfo.nickName,userId:this.userId||null,uniqueCode:this.uniqueCode||null,wxAppId:"wx77af438b3505c00e"},positionMsg:JSON.stringify(getApp().$location),systemMsg:JSON.stringify(this.systemInfo),networkMsg:this.netWorkType,batteryMsg:JSON.stringify(this.batteryInfo),screenBrightMsg:JSON.stringify(this.screenBrightness),wifiMsg:this.wifiList?JSON.stringify(this.wifiList):"",bluetoothMsg:"",otherMsg:""},header:{swimlane:"test"===l.env?"28820-qmyhm":void 0},method:"POST",success(t){const e=t.data;0===e.code?wx.showToast({title:"上报成功",icon:"none"}):wx.showToast({title:`上报失败:${e.msg}`,icon:"none"})},fail(t){wx.showToast({title:t.errMsg,icon:"none"})}})}});