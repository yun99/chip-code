var{internal_safe_get:t,internal_get_original:e,internal_inline_style:o,getElementById:i,propsManager:n,genCompid:s,genLoopCompid:a}=require("../../gt.js"),c=Object.create,r=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u=Object.getOwnPropertyNames,d=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,m=t=>r(t,"__esModule",{value:!0}),h=t=>((t,e,o)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of u(e))p.call(t,i)||"default"===i||r(t,i,{get:()=>e[i],enumerable:!(o=l(e,i))||o.enumerable});return t})(m(r(null!=t?c(d(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),g=(t,e,o)=>new Promise(((i,n)=>{var s=t=>{try{c(o.next(t))}catch(t){n(t)}},a=t=>{try{c(o.throw(t))}catch(t){n(t)}},c=t=>t.done?i(t.value):Promise.resolve(t.value).then(s,a);c((o=o.apply(t,e)).next())}));((t,e)=>{for(var o in m(t),e)r(t,o,{get:e[o],enumerable:!0})})(exports,{default:()=>x});var y=h(require("../../gu.js")),f=h(require("../../gy.js")),P=h(require("../../../../iy.js")),I=require("../../../../er.js"),{wx2promiseify:w}=require("../../../../gi.js"),k=getApp(),x=class extends f.default{constructor(){super(...arguments),this.$usedState=["anonymousState__temp","titleStyle0","isPoi","titleStyle","isProd","isDebug","env","mockLocation","currentLocation","info","mockPoiId","mockPoiIdStr","poiInfo","currentPoiInfo","switchType"],this.customComponents=[]}_constructor(){this.state={isProd:!0,isDebug:!1,env:"",mockLocation:{latitude:0,longitude:0},currentLocation:{latitude:0,longitude:0},info:null,mockPoiId:"",mockPoiIdStr:"",poiInfo:{poiId:0,poiName:""},currentPoiInfo:{poiId:0,poiIdStr:"",poiName:""},switchType:"poi"},this.$$refs=[]}getCurrentLocation(t="gcj02"){return g(this,null,(function*(){try{const e=yield w(wx.getLocation,{type:t});this.setState({currentLocation:e})}catch(t){wx.showToast({title:"获取真是定位失败，请重试",icon:"none",duration:2e3})}}))}setMockLocation(){this.state.mockLocation.latitude&&this.state.mockLocation.longitude?(k.getModule("env").setMockLocation(this.state.mockLocation),this.setState({mockLocation:this.state.mockLocation}),this.getGeoInfo(),wx.showToast({title:"设置经纬度成功"+JSON.stringify(this.state.mockLocation),icon:"success",duration:2e3})):wx.showToast({title:"请输入正确的经纬度信息",icon:"none",duration:2e3})}clearMockLocation(){const t={longitude:0,latitude:0};k.getModule("env").setMockLocation(t),this.setState({mockLocation:t,info:null})}togglePoi(){return g(this,null,(function*(){if(!k.$isProd)if(this.state.mockPoiId){this.setState({mockPoiId:this.state.mockPoiId});try{const t=k.getModule("poi");yield P.default.togglePoiByPoi({poiId:this.state.mockPoiId});const e=t.getPoiInfo();this.setState({currentPoiInfo:e},(()=>{const{cityId:t=null}=e;4432==+t||29==+t?wx.showModal({title:"-- 注意 --",content:"城市ci为4432（点评实验室）和29（保定）为 liteset 专项使用的城市，使用会导致流量走不到对应泳道，半年内建议测试环境使用其他城市测试，"+JSON.stringify(this.state.currentPoiInfo),success(t){t.confirm||t.cancel},showCancel:!1,confirmText:"我知道了"}):wx.showModal({title:"设置门店成功",content:""+JSON.stringify(this.state.currentPoiInfo),success(t){t.confirm||t.cancel}})}))}catch(t){wx.showToast({title:"切换门店失败，lbs/location接口",icon:"none",duration:2e3})}}else wx.showToast({title:"请输入正确的门店id",icon:"none",duration:2e3})}))}togglePoiByPoiIdStr(){return g(this,null,(function*(){if(!k.$isProd)if(this.state.mockPoiIdStr){this.setState({mockPoiIdStr:this.state.mockPoiIdStr});try{const t=k.getModule("poi");yield P.default.togglePoiByPoi({poiIdStr:this.state.mockPoiIdStr});const e=t.getPoiInfo();this.setState({currentPoiInfo:e}),e&&wx.showModal({title:"设置门店成功",content:""+JSON.stringify(this.state.currentPoiInfo),success(t){t.confirm||t.cancel}})}catch(t){wx.showToast({title:"切换门店失败，lbs/location接口",icon:"none",duration:2e3})}}else wx.showToast({title:"请输入正确的门店id",icon:"none",duration:2e3})}))}clearMockPoiId(){this.setState({mockPoiId:"",mockPoiIdStr:""})}bindKeyInput(t){const{type:e="latitude"}=t.target.dataset,o=t.detail.value.trim();switch(e){case"poiId":this.state.mockPoiId=o;break;case"poiIdStr":this.state.mockPoiIdStr=o;break;case"latitude":case"longitude":this.state.mockLocation[e]=o}}changeSwitchType(t){const{value:e}=t.detail;this.setState({switchType:e?"poi":"location"})}getGeoInfo(){return g(this,null,(function*(){try{const t=yield getApp().$service.getPosition(this.state.mockLocation);this.setState({info:t})}catch(t){wx.showToast({title:"获取城市信息失败，geo接口",icon:"none",duration:2e3})}}))}gotoIndex(){return g(this,null,(function*(){getApp().$router.goto("/pages/index/index")}))}onShow(){const t=k.getModule("env").getEnv(),e=k.getModule("poi").getPoiInfo();this.getCurrentLocation();const{latitude:o=0,longitude:i=0}=k.getModule("env").getMockLocation()||{};this.setState({isProd:k.$isProd,isDebug:k.$env.getDebug(),env:t,mockLocation:{latitude:o,longitude:i},currentPoiInfo:e}),o&&i&&!this.state.info&&this.getGeoInfo()}_createData(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};this.$prefix;const{env:t,isDebug:e}=this.__state,o="poi"===this.__state.switchType,i="poi"===this.__state.switchType;return Object.assign(this.__state,{anonymousState__temp:i,titleStyle0:"color:chocolate; font-weight:700;",isPoi:o,titleStyle:"color:black; font-weight:700;"}),this.__state}};x.$$events=[],x.$$componentPath="Users/lyp/Documents/me/meituan/git/youxuan/mall-dyapp/src/subPackages/debug/pages/location/index",I(y.createPage(x));