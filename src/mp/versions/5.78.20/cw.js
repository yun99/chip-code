var e=Object.create,t=Object.defineProperty,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,s=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,u=(e,o,i)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,p=e=>t(e,"__esModule",{value:!0}),d=r=>((e,r,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let n of i(r))a.call(e,n)||"default"===n||t(e,n,{get:()=>r[n],enumerable:!(s=o(r,n))||s.enumerable});return e})(p(t(null!=r?e(s(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);((e,o)=>{for(var i in p(e),o)t(e,i,{get:o[i],enumerable:!0})})(exports,{default:()=>I});var c=d(require("./ob.js")),l=d(require("./u8.js")),m=d(require("./az.js")),h=d(require("./g8.js")),g=d(require("./mb.js")),f=d(require("./ne.js")),y=d(require("./mx.js")),b=d(require("./mc.js")),P=d(require("./mv.js")),w=d(require("./mn.js")),v=d(require("./ko.js")),O=d(require("./x8.js")),T=getApp(),I=class{constructor(){this.isPartReturnCouponInvalid=!1,this.remarkPageRouting=!1,this.remarkObj={},this.submitOrderMetricReport=new g.default,this.handleOptions=function(){},this.selectCoupon=function(){c.log.info("<submitOrder selectCoupon> 触发选择红包"),T.$lxLog.mc("b_youxuan_phx10yd5_mc",{coupon_id:this.data.orderPreview.couponInfo.cacheId,page_from:this.data.fromPage||"-999"}),this.service.getCouponList(this.data.orderPreview.couponInfo.cacheId)},this.toggleDiscount=function(e){var t,o;c.log.info("<submitOrder toggleDiscount> 显示折扣");const{status:i}=e.currentTarget.dataset,s=!!i;this.setData(((e,t)=>{for(var o in t||(t={}))a.call(t,o)&&u(e,o,t[o]);if(r)for(var o of r(t))n.call(t,o)&&u(e,o,t[o]);return e})({showDiscount:s},s?{discountPopupData:O.default.formatDiscountInfo(null==(o=null==(t=e.currentTarget)?void 0:t.dataset)?void 0:o.detail)}:{}))},this.closeCouponList=function(e){this.setData({showCouponList:!1}),e.detail.couponIds&&(c.log.info("<submitOrder onShow> 选择红包进入onShow"),this.data.orderPreview.couponInfo.couponIds=e.detail.couponIds,this.data.orderPreview.couponInfo._temp=!0,this.setData({"orderPreview.couponInfo":this.data.orderPreview.couponInfo}),this.fromSource=3,c.log.info("<submitOrder onShow> 选择红包开始调用service.orderPreview"),this.service.orderPreview())},this.toggleRedPackage=function(e){const t=e.detail;c.log.info("<submitOrder toggleRedPackage> 触发红包开关",t),T.$lxLog.mc("b_youxuan_0253hgpo_mc",{status:t?1:0,page_from:this.data.fromPage||"-999"}),this.setData({"orderPreview.useSwitch.redPackageInfo.open":t}),this.service.orderPreview()},this.showRedPackageRulePop=function(e){c.log.info("<submitOrder showRedPackageRulePop> 显示红包规则弹窗",this.data.redPackageRulePopShow),T.$lxLog.mc("b_youxuan_2eflt0mn_mc"),this.setData({redPackageRulePopShow:!this.data.redPackageRulePopShow})},this.setRemark=function(e){this.remarkObj[this.data.orderPreview.shippingType]=e,this.setData({remark:e&&e.submitOrderShowText||""})},this.onSwitchTab=function(e){const{isSelf:t}=e.detail;this.setData({"orderPreview.shippingType":t?1:0}),this.getSelectedAddress(),this.service.orderPreview()},this.submit=function(){return c.log.info("<submitOrder submit> 准备提交订单"),T.$lxLog.mc("b_youxuan_b7qzpmmd_mc",{button_name:this.data.submitText,page_from:this.data.fromPage||"-999"}),(0,m.getCommonFinger)().then((({weChatFingerprint:e})=>{this.weChatFingerprint=e,this.service.submit()}))},this.disabledSubmit=function(){const{deliveryPriceThreshold:e,diffPriceThreshold:t,priceThresholdStatus:o}=this.data.orderPreview;T.$poi.isExperiencePoi()?this.showNoLocationModal({from:"submitOrder",needToHomePage:!1}):o&&e&&t&&this.toast(`商品满${e/100}元起送，还差${t/100}元`)},this.remindPopupBtnClick=function(e){let t;if(this.submitError.handleCode(e.detail.currentTarget.dataset.type),e.detail.currentTarget.dataset.special)t="b_youxuan_wdb6aqdv_mc";else switch(e.detail.currentTarget.dataset.type){case 1:t="b_youxuan_mba2l16c_mc";break;case 6:t="b_youxuan_74nuhz7n_mc"}T.$lxLog.mc(t)};const e=this.resetSubmitCartData();this.data=e,c.log.warn(`<购物车> base isSubmitCart: ${this.data.isSubmitCart}, now:${Date.now()}`)}resetSubmitCartData(){var e,t,o;this.submitPending=!1,this.actionSelect=0,this.groupSkuInfo={},this.fromSource=0,this.pageFirstLoad=!0,this.ifPreviewResponse=!1,this.payType=v.PayType.traditionPay,this.onShowFromPay=!1,this.remarkObj={};return{remark:"",showPackageId:-1,showDiscount:!1,noticeBoardShow:!1,marginTop:0,showMask:!1,arrivalTimeShowMsg:"",specialTimeTipMsg:"",showPayTypePop:!1,submitText:"立即支付",toggleOneClickSwitch:!1,payType:v.PayType.traditionPay,couponPopList:[],couponPopTitle:"",isIpx:null==(t=null==(e=T.$systemInfo)?void 0:e.systemInfo)?void 0:t.isIpx,showCouponList:!1,isShowCouponPackage:!0,couponData:{couponDesc:{enable:0,title:"",url:""},bestCouponList:[],otherUsefullCouponList:[],unUsefullCouponList:[]},returnCouponList:[],ifCouponAssignToastShow:!1,hasPromotion:!1,discountPopupData:{},focusName:!1,focus:!1,isMMP:(0,l.isMMP)(),isApp:(0,l.isApp)(),isMTTiny:(0,l.isMTTiny)(),isMTTurbo:(0,l.isMTTurbo)(),isAppTiny:(0,l.isAppTiny)(),isTT:(0,l.isTT)(),errorMessage:null,confirmPopupShow:!1,tipArrowStyle:"left: auto; right: 130rpx;",ABTestKey:"",isPageReady:!0,skuInfoShowAll:!1,submitDisabled:!1,showRefundDetentionPopup:!1,selfLiftingTest:"",redPackageRulePopShow:!1,isSubmitCart:!1,fontRate:(null==(o=null==T?void 0:T.$cart)?void 0:o.getCartFontRate())||1,orderPreview:{couponInfo:{couponIds:[-1]},useSwitch:{pointInfo:{open:!0},cardInfo:{open:!0}},shippingType:1}}}pageLoad(e,{fetchPreview:t=!0}={}){const o=O.default.parseOptions(e);this.options=o,this.handleOptions();const{fromApp:i}=this.options;"tuanApp"!==i&&(this.onLoadInit(),0==+this.data.orderPreview.shippingType&&this.getSelectedAddress(),t&&this.service.orderPreview().then((()=>{c.log.info("<submitOrder onload> onLoad执行完成")})))}onLoadInit(){const{options:e}=this;this.isBuyNow="buyNow"===(null==e?void 0:e.cartOpSource),this.initService(),this.getting=new y.Getting,this.mapping=new P.default(this),this.submitError=new b.default(this),this.validate=new w.Validate(this),(0,l.isWX)()&&setTimeout((()=>{var e;(0,h.getPrefetchBundle)({openId:T.getModule("user").getOpenId(),name:"pay-finance-cashier",env:"gray",app:"grocery_mp_pay",dynamicEnv:null==(e=T.$env)?void 0:e.getDynamicEnv()})}),0),c.log.info("<submitOrder onloadInit> 初始化服务完成")}initService(){this.service=new f.default(this)}getSelectedAddress(){const e=T.$store.getAndRemove("selectedAddress");(e||null===e||-1===e)&&(c.log.info("<submitOrder getSelectedAddress> 从本地缓存获取选择的地址"),this.data.orderPreview.addressInfo||(this.data.orderPreview.addressInfo={}),-1!==e&&(this.data.orderPreview.addressInfo.addressId=e))}onPoiInfoUpdated(e){c.log.info("<submitOrder onPoiInfoUpdated> 门店发生变化"),this.remarkObj[this.data.orderPreview.shippingType]=null;const{fromApp:t}=this.options;"tuanApp"===t&&(c.log.info("<submitOrder onPoiInfoUpdated> 门店信息更新，调用onLoadInit，getOrderPreview"),this.onLoadInit(),this.service.orderPreview())}};