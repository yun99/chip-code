var e,t;Object.defineProperty(exports,"__esModule",{value:!0});var o,s=(e=require("./pp.js"))&&"object"==typeof e&&"default"in e?e.default:e,r=[1.2,1.2,1.4,1.7,1.9],n=["标准","放大","更大","特大","超大"];function a(){return new Promise((function(e){wx.getStorage({key:"zoomable_storage_strategy",success:function(t){e(t.data)},fail:function(){e("")}})}))}function i(e){wx.setStorage({key:"zoomable_storage_strategy",data:e})}function u(){return new Promise((function(e){wx.getStorage({key:"zoomable_storage_show_guide",success:function(t){e(!!t.data)},fail:function(){e(!1)}})}))}function l(){wx.setStorage({key:"zoomable_storage_show_guide",data:!0})}function c(e){var t;if(!e)return 0;var o=e.fontSizeSetting,s=0;return~(null==(t=e.system)?void 0:t.toLowerCase().indexOf("ios"))?18===o?s=1:19===o?s=2:20===o||23===o?s=3:o>=21&&(s=4):o>=26?s=4:o>=24?s=3:o>=20?s=2:o>=17&&(s=1),s}(t=exports.Strategy||(exports.Strategy={})).Auto="auto",t.User="user",t.Off="off";var f=new(function(){function e(){this._hostLevel=-1,this._cache=null,this.systemInfo=void 0}var t=e.prototype;return t.getHostLevel=function(){return this._hostLevel>=0?Promise.resolve(this._hostLevel):this.systemInfo?(this._hostLevel=c(this.systemInfo),Promise.resolve(this._hostLevel)):(this._cache||(this._cache=this.getLatestHostLevel()),this._cache)},t.getLatestHostLevel=function(){var e=this;return new Promise((function(e){wx.getSystemInfo({success:function(t){e(t)},fail:function(){e(void 0)}})})).then(c).then((function(t){return e._hostLevel=t,t}))},e}()),h=new s,p=new(function(){function e(){this._level=0,this._rem=100,this.strategy=exports.Strategy.Off,this.enable=!1,this.scale=0}var t,o=e.prototype;return o.shouldShowGuide=function(){return!this.showSwitch||this.isSwitchOn?Promise.resolve(!1):Promise.all([u(),f.getHostLevel()]).then((function(e){return!e[0]&&e[1]>0}))},o.shownGuide=function(){l()},o.updateToStandard=function(){this._rem=100,h.emit("zoomable:update-rem")},o.updateByScale=function(){this.enable&&this._rem!==100*this.scale&&(this._rem=100*this.scale,h.emit("zoomable:update-rem"))},o.update=function(e){var t=100*r[e];(this.enable||this._rem==t)&&(this._level=e,this._rem=t,h.emit("zoomable:update-rem"))},o.onUpdate=function(e){h.on("zoomable:update-rem",e)},o.offUpdate=function(e){h.off("zoomable:update-rem",e)},o.setSwitch=function(e){this.scale>0?e?this.updateByScale():this.updateToStandard():e?f.getHostLevel().then((function(e){p.update(e)})):this.updateToStandard(),this.strategy=e?exports.Strategy.Auto:exports.Strategy.User,i(this.strategy)},o.getFontSize=function(e,t){var o=Number((e*this.rem/100).toFixed()),s=Math.min(o,t);return(s-=s%2)+"rpx"},(t=[{key:"rem",get:function(){return this._rem}},{key:"level",get:function(){return this._level}},{key:"levelText",get:function(){return n[this._level]}},{key:"isSwitchOn",get:function(){return this.strategy===exports.Strategy.Auto}},{key:"showSwitch",get:function(){return this.strategy!==exports.Strategy.Off}}])&&function(e,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}(e.prototype,t),e}());function m(){return f.getHostLevel()}function g(){return"--rem: "+p.rem+"rpx"}var d=((o={}).zoomable_rem=g(),o);function y(){p.onUpdate(this.zoomableOnREMUpdate),this.zoomableOnREMUpdate()}function _(){p.offUpdate(this.zoomableOnREMUpdate)}function x(){var e,t=this;this.setData(((e={}).zoomable_rem=g(),e),(function(){t.zoomableAfterREMUpdate&&t.zoomableAfterREMUpdate()}))}var S=Behavior({data:d,attached:function(){y.call(this)},detached:function(){_.call(this)},methods:{zoomableOnREMUpdate:function(){x.call(this)}}});exports.BASE_LEVEL=0,exports.BASE_REM=100,exports.CSS_VARIABLE_NAME="rem",exports.DATA_KEY="zoomable_rem",exports.LEVEL_TEXT=n,exports.SCALE=r,exports.STORAGE_SHOW_GUIDE_KEY="zoomable_storage_show_guide",exports.STORAGE_STRATEGY_KEY="zoomable_storage_strategy",exports.UPDATE_EVENT_NAME="zoomable:update-rem",exports.dataCenter=p,exports.fontSizeZoomable=S,exports.getHostLevel=m,exports.getStyle=g,exports.getUserStrategy=a,exports.hasShownGuide=u,exports.initZoomable=function(e){void 0===e&&(e={}),f.systemInfo=e.systemInfo,e.strategy=e.strategy||exports.Strategy.User,p.scale=e.scale||0,a().then((function(t){e.strategy!==exports.Strategy.Off&&t&&(e.strategy=t),p.strategy=e.strategy,p.strategy!==exports.Strategy.Off&&(p.enable=!0,p.scale>0?p.strategy===exports.Strategy.Auto&&p.updateByScale():m().then((function(e){p.strategy===exports.Strategy.Auto&&p.update(e)})))}))},exports.saveUserStrategy=i,exports.shownGuide=l,exports.zoomableData=d,exports.zoomableOnAppShow=function(){p.scale>0||f.getLatestHostLevel().then((function(e){p.strategy===exports.Strategy.Auto&&p.update(e)}))},exports.zoomableOnLoad=y,exports.zoomableOnREMUpdate=x,exports.zoomableOnUnload=_;