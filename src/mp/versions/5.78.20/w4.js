var e=Object.create,t=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(e,a,o)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,l=(e,t)=>{for(var a in t||(t={}))c.call(t,a)&&p(e,a,t[a]);if(i)for(var a of i(t))u.call(t,a)&&p(e,a,t[a]);return e},m=(e,t)=>a(e,r(t)),d=e=>t(e,"__esModule",{value:!0}),h=a=>((e,a,r)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let i of s(a))c.call(e,i)||"default"===i||t(e,i,{get:()=>a[i],enumerable:!(r=o(a,i))||r.enumerable});return e})(d(t(null!=a?e(n(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);((e,a)=>{for(var o in d(e),a)t(e,o,{get:a[o],enumerable:!0})})(exports,{default:()=>D});var y=h(require("./u8.js")),g=h(require("./ob.js")),f=h(require("./is.js")),v=h(require("./a8.js")),T=h(require("./zj.js")),R=h(require("./xg.js")),_=h(require("./kh.js")),b=h(require("./ln.js")),O=getApp(),C=0,P=1,S=0,x={sellingPointInfoType:!0,skuCombinedName:!0,sellUnit:!0,seqPrice:!0,v2Tags:!0,desc:!0},D=class{constructor(){this.created=function(){},this.attached=function(){this.cart=O.page().selectComponent("#cart")},this.ready=function(){var e;this.refreshRecommendBindThis=this.refreshRecommend.bind(this),O.$event.on(O.$event.CONTANTS.POI_ON_UPDATED,this.refreshRecommendBindThis),!(0,y.isMMP)()&&_.cart[null==(e=this.cart)?void 0:e.currentPage]||this.refreshRecommend(),~O.$abTest.getGrayStrategyVal("grocery_c_front_cart_point").indexOf("a")&&this.refreshRecommend()},this.detached=function(){O.$event.off(O.$event.CONTANTS.POI_ON_UPDATED,this.refreshRecommendBindThis)},this.pageLifetimes={show(){~O.$abTest.getGrayStrategyVal("grocery_c_front_cart_point").indexOf("b")&&this.refreshRecommend()},hide(){~O.$abTest.getGrayStrategyVal("grocery_c_front_cart_point").indexOf("b")&&this.getBackTop()}},this.methods={onSkuStatusChange(e){this.cart||(this.cart=O.page().selectComponent("#cart"));const t=O.$abTest.getGrayStrategyVal("grocery_c_front_cart_loading");this.cart.operatePopupCart(m(l({},(null==e?void 0:e.detail)||{}),{needLoading:~t.indexOf("a"),showSuccessToast:!1}))},onReachBottom(e){},onSkuTouchStart(e){this.setData({startTouch:e.detail})},onSkuTouchEnd(e){this.setData({currentTouchNodeId:e.detail.currentTouchNodeId,skuId:e.detail.skuId})},getRecSkus(e=!1){return t=this,a=null,o=function*(){var t,a;e&&(C=0,P=1);const{cartRecData:o}=this.data;if(!(e||(o.total||0)>C))return void(this.data.isNoMoreCommand||this.setData({isNoMoreCommand:!0}));const r=(null==(t=o.itemList)?void 0:t.slice(0))||[],s=[];r.forEach((e=>e.value&&e.value.skuId&&s.push(e.value.skuId)));try{const t=yield O.$service.getCartRecSkuList({poiId:O.$poiId,poiIdStr:O.$poi.getPoiIdStr(),offset:e?0:C,limit:10,skuIds:Object.keys(O.$cart.skuQtyList).map((e=>+e))||[],personalRecommendOpen:O.$store.getCacheValue("privacyAdminStatus")},{excludeSkuIds:e?[]:s,pageNum:P++});if(0===(null==(a=null==t?void 0:t.itemList)?void 0:a.length))return e&&this.setData({cartRecData:{}},(()=>{var e;null==(e=O.page().cartMetricsReport)||e.reportCartFMPCount(f.YXReportTarget,f.ReportValue,O.$cat,O.$version,O.$systemInfo,"FMPRecommendSku")})),void(C+=10);try{t.itemList=null==t?void 0:t.itemList.map((e=>{const a={};return Object.keys(e).forEach((t=>{x[t]||(a[t]=e[t])})),{type:R.CardType.RECOMMEND,value:m(l({},(0,b.cartSkuBoardFormat)({skuItem:a,type:a.type,requestid:t.M_TraceId})),{traceId:t.M_TraceId||""}),key:`card${e.skuId}`}}))}catch(e){t.itemList=[],g.log.error("组件化购物车推荐更多商品失败",JSON.stringify(t.itemList))}t.styleMap=null,e||(t.itemList=r.concat(t.itemList));const i=(0,T.popupCartDataDiff)({cartRecData:t},{cartRecData:o});C+=10,this.setData(i,(()=>{var e;null==(e=O.page().cartMetricsReport)||e.reportCartFMPCount(f.YXReportTarget,f.ReportValue,O.$cat,O.$version,O.$systemInfo,"FMPRecommendSku")}))}catch(e){}},new Promise(((e,r)=>{var s=e=>{try{n(o.next(e))}catch(e){r(e)}},i=e=>{try{n(o.throw(e))}catch(e){r(e)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,i);n((o=o.apply(t,a)).next())}));var t,a,o},onCheapBuyPopupShow(e){var t;this.setData({isCheapBuyPopupShow:!0,promotionId:e.detail.promotionId||0,promotionType:e.detail.promotionType||0,promotionHandel:e.detail.promotionHandel||""}),_.tabPage[null==(t=this.cart)?void 0:t.currentPage]&&wx.hideTabBar({animation:!0})},onCheapBuyPopupClose(e){this.setData({isCheapBuyPopupShow:!1})},onCommonOperateCart(e){this.cart||(this.cart=O.page().selectComponent("#cart")),this.cart.operatePopupCart(e.detail)},onViewScroll(e){var t,a;const{scrollTop:o}=e.detail,r=o>2*((null==(a=null==(t=O.getModule("systemInfo"))?void 0:t.systemInfo)?void 0:a.screenHeight)||667);r!==this.data.isShowReturnTopBtn&&this.setData({isShowReturnTopBtn:r})},getBackTop(){this.setData({topNum:0+Math.random()})},toIndex(){O.$router.goto("/pages/index/index")},toShowCouponDetail(e){var t,a;this.cart||(this.cart=null==(t=O.page())?void 0:t.selectComponent("#cart")),null==(a=this.cart)||a.onCouponPopupHandle()},onPullDownRefresh(){this.setData({isRefreshing:!0}),this.cart||(this.cart=O.page().selectComponent("#cart")),Promise.all([this.cart.operatePopupCart(),this.refreshRecommend()]).then((()=>{this.setData({isRefreshing:!1})}))},refreshRecommend(){const{trafficSource:e}=O.page().options;this.setData({isNoMoreCommand:!1,jumpOptions:e?{trafficSource:e}:{}})},onRecommendCardShow(){5===(S+=1)&&(O.$event.emit(O.$event.CONTANTS.BUY_ANOTHER_POPUP_SHOW),S=0)},handleSeeMore(e){try{const{index_id:t=0,iretail:a="",skuList:o=[],recSkuList:r=[],type:s=0}=e.detail,{activeTabName:i="-999"}=this.data,n=this.getItemList()[t].value,{seeMoreBid:c,moduleType:u}=b.skuBoardMaps[s];s&&O.$lxLog.mc(c,l({index_id:t,module_type:u,tab_name:i},n.extraParams)),a&&O.$router.goto(a,{skuList:o,recSkuList:r})}catch(e){g.log.info("购物车handleSeeMore报错",e)}},skuBoradsLxRegister(e){try{const{index_id:t=0,skuType:a}=e.detail,{activeTabName:o="-999"}=this.data,r=this.getItemList(),{type:s,requestid:i,extraParams:n}=r[t].value,{skuType:c,moduleType:u,lxEventBids:p}=b.skuBoardMaps[s];if(c===a){const e={index_id:t,requestid:i,module_type:u};v.default.registerLxOperator(c,l({operator:(t,a,r)=>(Object.assign(t,l(l({tab_name:o,recommend_index_id:r},e),n)),t)},p))}}catch(e){g.log.info("购物车skuBoradsLxRegister报错",e)}},onBoardMvReport(e){try{const{activeTabName:t="-999"}=this.data,{params:a={},index_id:o=0}=e.detail,r=this.getItemList()[o].value;O.$lxLog.mv(a.bid,l({index_id:o,module_type:a.moduleType,tab_name:t},r.extraParams))}catch(e){g.log.info("购物车BoardMvReport报错",e)}},getItemList(){try{const{cartRecData:e={},cartRecDataRenderingCache:t={}}=this.data,a=!this._isEmptyObject(t)&&t.itemList&&t.itemList.length?t.itemList:[];return e.itemList&&e.itemList.length?e.itemList:a}catch(e){return g.log.info("购物车getItemList()报错",e),[]}},_isEmptyObject(e){if(!e||e&&0===Object.keys(e).length)return!0},onRecommendMvReport(){O.$lxLog.mv("b_youxuan_hzejj6k7_mv",{order_st:-999,tab_name:-999})}},this.properties={card:{type:Array,value:[]},couponInfo:{type:Object,value:{}},totalItemCounts:{type:Boolean},cartRecDataRenderingCache:{type:Object}},this.data={cartRecData:{},isNoMoreCommand:!1,startTouch:{},currentTouchNodeId:{},skuId:0,isCheapBuyPopupShow:!1,promotionId:0,promotionType:0,promotionHandel:"",isShowReturnTopBtn:!1,topNum:0,isLogin:!1,isRefreshing:!1,jumpOptions:{},fontRate:O.$cart.getCartFontRate()||1,isTT:(0,y.isTT)()}}};Component(new D);