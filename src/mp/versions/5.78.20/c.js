var t=Object.create,e=Object.defineProperty,i=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,a=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,r=r=>{return((t,a,r)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let s of n(a))o.call(t,s)||"default"===s||e(t,s,{get:()=>a[s],enumerable:!(r=i(a,s))||r.enumerable});return t})((s=e(null!=r?t(a(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0}),e(s,"__esModule",{value:!0})),r);var s},s=r(require("./po.js")),c=r(require("./u4.js")),d=r(require("./ob.js")),l=[];for(let t=0;t<3;t++)l.push(t+1);var p=["pages/index/index","pages/categorySkuList/index","pages/cookbook/index","pages/cart/index","pages/userCenter/index"],h=["pages/index/index","pages/categorySkuList/index","pages/userCenter/index"];Component({data:{style:"",items:l},properties:{route:String,pageCount:Number,x:{type:String,observer(t){},value:""},y:{type:String,observer(t){},value:""},cartId:{type:String,value:"1",observer(t){}},iconPosition:{type:String,value:0}},ready(){this.cartIconRect={},this.animationYF=wx.createAnimation({timingFunction:"linear"}),this.animationXF=wx.createAnimation({timingFunction:"linear"}),this.sysInfo=getApp().$systemInfo.getSystemInfo()},attached(){this.addCartBindThis||(this.addCartBindThis=this.addCart.bind(this)),c.default.on(c.CONTANTS.ADD_CART_ANIMATION,this.addCartBindThis),this.index=0,this.animationObj={}},detached(){c.default.off(c.CONTANTS.ADD_CART_ANIMATION,this.addCartBindThis)},methods:{setTimeoutES6:t=>new Promise((e=>{setTimeout((()=>{e()}),t)})),getCartIcon(){const{iconPosition:t}=this.data,e=-1!==h.indexOf(this.data.route);return new Promise((i=>{var n,a;!e&&-1!==p.indexOf(this.data.route)||this.cartIconRect&&this.cartIconRect[t]?i():wx.createSelectorQuery().in((null==(a=null==(n=this.page)?void 0:n.page)?void 0:a.$rootComp)||this.page).select(`.cart-icon_symbol >>> #${this.data.cartId||"cart-icon"}`).boundingClientRect((e=>{d.log.info("animationDrop","createSelectorQuery",`.cart-icon_symbol>>>#${this.data.cartId||"cart-icon"}`,e),this.cartIconRect||(this.cartIconRect={}),this.cartIconRect[t]=e,i()})).exec()}))},addCart(t){return e=this,i=null,n=function*(){var e;const i=getApp().page();if((null==i?void 0:i.route)===this.data.route&&(null==i?void 0:i._pageCount)===this.data.pageCount)if(this.page=i,null==(e=null==t?void 0:t.touches)?void 0:e[0]){getApp().$cart.cartAnimationStart();const{clientX:e,clientY:i}=t.touches[0];d.log.info("animationDrop","addCart",{clientX:e,clientY:i}),yield this.getCartIcon(),d.log.info("animationDrop","getCartIcon",this.cartIconRect&&this.cartIconRect[this.data.iconPosition]),this.initBallPosition({x:e,y:i})}else d.log.warn("animationDrop","触发addCart没有e?.touches?.[0]数据",t)},new Promise(((t,a)=>{var o=t=>{try{s(n.next(t))}catch(t){a(t)}},r=t=>{try{s(n.throw(t))}catch(t){a(t)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,r);s((n=n.apply(e,i)).next())}));var e,i,n},initBallPosition({x:t,y:e}){const{left:i,top:n}=this.initEndPosition();this.creatAnimationApi({x:t,y:e,endX:i,endY:n})},initEndPosition(){try{const t=wx.getSystemInfoSync(),e=this.sysInfo.windowHeight||t.windowHeight,i=this.sysInfo.windowWidth||t.windowWidth,n=this.sysInfo.safeArea||t.safeArea;let a="",o="";if(!(-1!==h.indexOf(this.data.route))&&p&&p.length&&-1!==p.indexOf(this.data.route)){a=(n&&n.height?n.height:e)-10,o=i/5*3.4}else if(this.cartIconRect&&this.cartIconRect[this.data.iconPosition]){const t=this.cartIconRect[this.data.iconPosition];o=t.left+t.width/3,a=t.top+t.height/3}else-1===p.indexOf(this.data.route)&&d.log.warn("animationDrop","没有找到对应的购物车组件",this.page&&this.page.route),o="default";return{left:o,top:a}}catch(t){d.log.info(`sysInfo get error 上报终端信息, ${wx.getSystemInfoSync()}`)}},creatAnimationApi({x:t,y:e,endX:i,endY:n}){if(this.index=this.index%3+1,d.log.info("animationDrop","creatAnimationApi",{x:t,y:e,endX:i,endY:n}),"default"===i)return void getApp().$cart.cartAnimationDone({notShowAnimation:!0});const a=parseInt(t,10),o=parseInt(e,10),r=parseInt(i,10),c=parseInt(n,10);let l;try{l=comp}catch(t){}let p=[{translate3d:[a,o,0],opacity:0},{translate3d:[a,o,0],opacity:1,offset:.1},{translate3d:[.99*(r-a)+a,.99*(c-o)+o,0],opacity:1,offset:.95},{translate3d:[r,c,0],opacity:0}];!(0,s.isMMP)()&&getApp().$systemInfo.isIOS()&&(p=[{left:`${a}px`,top:`${o}px`,opacity:.5},{left:`${r}px`,top:`${c}px`,opacity:.5}]);const h=`#animation-drop-${this.index}`;if(this.animationObj[h])getApp().$cart.cartAnimationDone();else if("function"==typeof(this.animate||(null==l?void 0:l.animate))){this.animationObj[h]=!0,d.log.info("animationDrop","create",h);const t=Math.abs(r-a),e=Math.abs(c-o),i=Math.round(Math.sqrt(Math.pow(t,2)+Math.pow(e,2)));(this.animate||(null==l?void 0:l.animate))(h,p,.8*i,(()=>{(this.clearAnimation||(null==l?void 0:l.clearAnimation))(h,(()=>{this.animationObj[h]=!1,d.log.info("animationDrop","drop",h),getApp().$cart.cartAnimationDone()}))}))}else getApp().$cart.cartAnimationDone()}}});