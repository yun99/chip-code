var e=Object.create,t=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,s=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(e,o,r)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,i=(e,t)=>{for(var o in t||(t={}))c.call(t,o)&&p(e,o,t[o]);if(l)for(var o of l(t))u.call(t,o)&&p(e,o,t[o]);return e},d=(e,t)=>o(e,n(t)),g=e=>t(e,"__esModule",{value:!0}),y=o=>((e,o,n)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let l of a(o))c.call(e,l)||"default"===l||t(e,l,{get:()=>o[l],enumerable:!(n=r(o,l))||n.enumerable});return e})(g(t(null!=o?e(s(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o);((e,o)=>{for(var r in g(e),o)t(e,r,{get:o[r],enumerable:!0})})(exports,{bingSocket:()=>N,getConnectId:()=>A,getStart:()=>J,localLog:()=>M,log:()=>k,logger:()=>h,sendHar:()=>G,setLoggerEnv:()=>T,setStart:()=>q,start:()=>E,startLogger:()=>_,stop:()=>P});var m=y(require("./xo.js")),f=y(require("./xi.js")),v=y(require("./uc.js")),b=y(require("./uh.js")),I=y(require("./u8.js")),{CAT_SEC_CATEGORY:O}=require("./iu.js"),h=new m.Logger({appKey:(0,I.getAppKey)(!0),env:"production"===v.env?"production":"test"});f.default.addLayout("object",(()=>function(){return""}));var w,S,j,D="",x=[],L=[],$=!1;function C(){w&&S&&(x.forEach((e=>{w.send({data:JSON.stringify(d(i({},e),{connectId:D}))})})),L.forEach((e=>{w.send({data:JSON.stringify(d(i({},e),{connectId:D}))})})),x=[],L=[])}function U(e){let t=["colorConsole","wx"];j||(j=getApp()),f.default.configure({appenders:{console:{type:"console",layout:{type:"object"}},wx:{type:"wx",send(e){const t={type:"code",msg:e.data};h.isOpen&&"DEBUG"!==e.level.levelStr&&h[e.level.levelStr.toLocaleLowerCase()](t),S&&w?w.send({data:JSON.stringify({type:"log",level:e.level.levelStr,categoryName:e.categoryName,data:e.data,startTime:f.default.getDateStr(e.startTime),connectId:D})}):$&&x.push({type:"log",level:e.level.levelStr,categoryName:e.categoryName,data:e.data,startTime:f.default.getDateStr(e.startTime),connectId:D})}},colorConsole:{type:"wx",send(e){try{const t=e.level.levelStr.toLocaleLowerCase(),o=[],r=[];"warn"===t||"error"===t||"info"===t||(e.startTime&&(o.push(`%c${f.default.getDateStr(e.startTime)}`),r.push("color:#03bc78")),"warn"===t?(o.push(`%c[${t}]`),r.push("color:#dbd52b")):"error"===t?(o.push(`%c[${t}]`),r.push("color:red")):"debug"===t?(o.push(`%c[${t}]`),r.push("color:blue")):"info"===t?(o.push(`%c[${t}]`),r.push("color:green")):"trace"===t&&(o.push(`%c[${t}]`),r.push("color:#4286f4")))}catch(e){}},layout:{type:"json"}}},categories:{default:{appenders:t,level:e},local:{appenders:["console"],level:e}},separator:"\n"})}function N(){let e;(w=wx.connectSocket({url:"wss://api-mall.meituan.com/ws/client",header:{"content-type":"application/json","connect-id":D},protocols:["protocol1"],success(){},fail(e){}}))&&(e=setInterval((()=>{w&&w.send({data:"ping"})}),2e3)),w&&w.onOpen((()=>{if(S=!0,D)C();else{const e=getApp(),t=e.$user||{};w.send({data:JSON.stringify({type:"i",systemInfo:e.$systemInfo.getSystemInfo(),extraInfo:{mtUser:e.$mtuser||e.$store.getCacheValue("mtuser")||{},user:{userId:t.userId,uuid:t.uuid,openId:t.openId}}})})}})),w&&w.onError((t=>{clearInterval(e),w=null})),w&&w.onMessage((e=>{const t=JSON.parse(e.data);if("i"===t.type){D=t.connectId,C();try{b.default.setCache("mall_connectId",D)}catch(e){}}})),w&&w.onClose((t=>{w=null,S=!1,clearInterval(e),$&&setTimeout((()=>{N()}),1e3)}))}function T(e,t,o,r){e&&h.setUid(`${e}`),t&&h.setUUID(`${t}`),o&&h.setOpenID(`${o}`),r&&h.setUnionID(`${r}`)}function _(){h.start()}function E(e){$||(U("trace"),$=!0,D=e,N())}function P(){$&&(U(v.logLevel),$=!1,w&&w.close(),b.default.remove("mall_connectId"))}function q(){$=!1}function J(){return $}function A(){try{return D||b.default.getCacheValue("mall_connectId")||""}catch(e){return""}}U(v.logLevel);var k=f.default.getLogger(),M=f.default.getLogger("local");function G(e){S&&w?w.send({data:JSON.stringify({type:"networkLog",data:e,startTime:Date.now(),connectId:D})}):$&&L.push({type:"networkLog",data:e,startTime:Date.now(),connectId:D})}