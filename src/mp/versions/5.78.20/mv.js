var e=Object.create,i=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,p=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(e,t,o)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,i)=>{for(var t in i||(i={}))s.call(i,t)&&d(e,t,i[t]);if(a)for(var t of a(i))l.call(i,t)&&d(e,t,i[t]);return e},c=(e,i)=>t(e,r(i)),g=e=>i(e,"__esModule",{value:!0}),m=t=>((e,t,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of n(t))s.call(e,a)||"default"===a||i(e,a,{get:()=>t[a],enumerable:!(r=o(t,a))||r.enumerable});return e})(g(i(null!=t?e(p(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);((e,t)=>{for(var o in g(e),t)i(e,o,{get:t[o],enumerable:!0})})(exports,{default:()=>T});var y=m(require("./ob.js")),f=m(require("./sn.js")),I=m(require("./x0.js")),v=m(require("./ko.js")),{isWX:P}=require("./u8.js"),h=getApp(),T=class{constructor(e){this.order=e}getNormalOrderPreviewParams(){var e,i,t,o,r;const{order:n}=this,{orderPreview:a}=n.data,p=n.getting.getPackageInfo(n.data.orderPreview).length?{}:null;n.getting.getPackageInfo(n.data.orderPreview).forEach((e=>{p[e.packageId]=u({timeLabel:e.packageLabel||"",packageLabelId:e.packageLabelId,centerTime:e.centerTime,timeIntervals:e.timeIntervals,timeDeliveryPrice:e.timeDeliveryPrice,timeType:e.timeType,schemeId:e.schemeId,deliveryStartTime:e.deliveryStartTime,deliveryEndTime:e.deliveryEndTime},e.deliveryLevelParams)}));const s=c(u(u({},n.skuCountInfo),n.options.previewData),{scene:n.options.scene,allowZeroPay:!0,useRedPackage:!1!==(null==(i=null==(e=a.useSwitch)?void 0:e.redPackageInfo)?void 0:i.open),useMember:null==(o=null==(t=a.useSwitch)?void 0:t.memberInfo)?void 0:o.open,poiId:h.$poiId,poiIdStr:h.$poiIdStr,cityId:h.$poi.poiInfo.cityId,opSource:n.options.cartOpSource,tempCartId:n.options.tempCartId,pickerId:n.options.pickerId||h.$store.getCacheValue("pickerId")||(null==(r=null==a?void 0:a.defaultPerson)?void 0:r.pickerId),couponIds:n.getting.getCouponIds(n.data.orderPreview),addressId:n.getting.getAddressId(n.data.orderPreview)||0,actionSelect:n.actionSelect,stockPois:[h.$poiId],stockPoisStr:h.$poiIdStr?[h.$poiIdStr]:[],fromSource:n.fromSource,isUseCard:n.getting.getCardOpen(a),usePoint:n.getting.getPointOpen(a),shippingType:a.shippingType,selfLiftingMobile:n.getting.getSelfLiftingMobile(n.data.orderPreview),couponPackageId:n.getting.getCouponPackageId(a),useCouponPackage:n.getting.getUseCouponPackage(a)});if(n.data.isPageReady){const{showMemberCardTime:e=0}=h.$store.getCacheValue("orderInfo");s.showMemberSwitch=e<4}if(h.$location&&(s.longitude=h.$location.longitude,s.latitude=h.$location.latitude),p&&(s.packageInfo=p),n.data.groupOrderParams){const{groupBuyingType:e,shareGroupBuyingUserId:i,launchGroupBuyingId:t,skuId:o,count:r,unitRealPrice:a,promotionCount:p,promotionId:l}=n.data.groupOrderParams;s.groupBuyingType=e||"",s.shareGroupBuyingUserId=i||"",s.launchGroupBuyingId=t||"",s.productInfo=[{skuId:o,count:r,unitRealPrice:a,promotionParamList:[{promotionCount:p,promotionId:l}]}]}return s}mappingCouponInfo(e){const{order:i}=this,t=i.getting.getCouponChoiceCouponIdSet(e);return{couponIds:t,bestCouponLabel:e&&e.coupons&&e.coupons.bestCouponLabel,canUseCouponLength:i.getting.getCanUseCouponLength(e),couponReducePrice:+e.couponReducePrice/100,_temp:!1,defaultChoiceCouponId:i.getting.getDefaultCouponId(e),couponIdsString:t.join(),defaultChoiceCouponIdString:i.getting.getDefaultCouponId(e).join(),cacheId:i.getting.getCouponCacheId(e)}}mappingPackageInfo(e,i){if(!e.packageInfo)return[];const t=i===v.EshippingType.delivery;return e.packageInfo.map((e=>({skuProductInfo:(e.skuProductInfo||[]).map((e=>c(u({},e),{feViewSpec:e.scatter?`${e.spec} | 折合¥${((e.promotionViewPrice||e.sellUnitViewPrice)/100).toFixed(2)}/${e.sellUnitViewName}`:e.spec,feViewPrice:e.scatter?e.totalSellPrice:e.sellUnitViewPrice,fePromotionViewPrice:e.scatter?e.totalPromotionPrice:e.promotionViewPrice,feViewPriceUnit:e.scatter?"":e.sellUnitViewName}))),centerTime:t?e.estimateTime:e.selfLiftingTime,timeIntervals:t?e.estimateTimeString:e.selfLiftingTimeString,timeDeliveryPrice:e.timeDeliveryPrice,packageName:e.packageName,packageId:e.packageId,packageWeight:e.packageWeight,deliveryType:e.deliveryType,packageLabel:e.packageLabel||(t?"送达时间":"提货时间"),packageLabelId:e.packageLabelId,totalCount:e.totalCount,timeType:e.deliveryType,schemeId:e.schemeId,deliveryStartTime:e.deliveryStartTime,deliveryEndTime:e.deliveryEndTime,deliveryLevelParams:u(u(u({},void 0!==e.deliveryLevel?{deliveryLevel:e.deliveryLevel}:{}),void 0!==e.halfDayActivityTicketId?{halfDayActivityTicketId:e.halfDayActivityTicketId}:{}),void 0!==e.halfDayIconText?{halfDayIconText:e.halfDayIconText}:{})})))}getResultPersonName(e){var i,t;const o=null==(i=h.getModule("user"))?void 0:i.getWxNickName(),r=null==(t=e.defaultPerson)?void 0:t.addressPerson;return r?(y.log.info("<submitOrder getResultPersonName> 获取后端昵称成功",r),r):o&&P()?(y.log.info("<submitOrder getResultPersonName> 获取微信昵称成功",o),o):(y.log.info("<submitOrder getResultPersonName> 昵称都获取失败拉！"),"")}normalOrderPreviewMappingRes(e){var i,t,o,r,n,a,p,s,l,d,g,m,y,I;if(!e)return;e.priceInfo.forEach((e=>{const i=e.priceString.indexOf("+")>-1;e.priceUnit=i?"+ ￥":e.price>=0?"￥":"- ￥",e.priceValue=(0,f.formatMoney)(Math.abs(e.price)).replace("￥","")}));const{order:v}=this,P=this.mappingShippingType(e),T=c(u({},e),{couponInfo:this.mappingCouponInfo(e),packageInfo:this.mappingPackageInfo(e,P),resultPersonName:this.getResultPersonName(e),useSwitch:v.getting.getUseSwitch(e),shippingType:P,addressInfo:c(u({},e.addressInfo),{selectType:e.addressSelect}),hasRedemptionPopupInfo:Boolean(0===(null==(i=e.previewPopup)?void 0:i.type)&&(null==(t=e.previewPopup)?void 0:t.title)&&(null==(r=null==(o=e.previewPopup)?void 0:o.popupItemVOList)?void 0:r.length)&&(null==(a=null==(n=e.previewPopup)?void 0:n.popupItemVOList[0])?void 0:a.skuId)),hasFullRedemptionPopupInfo:Boolean((null==(p=e.orderFullRedemptionPopup)?void 0:p.title)&&(null==(l=null==(s=e.orderFullRedemptionPopup)?void 0:s.popupItemVOList)?void 0:l.length)&&(null==(g=null==(d=e.orderFullRedemptionPopup)?void 0:d.popupItemVOList[0])?void 0:g.skuId)),showFullRedemptionPopup:!1,isShowTab:2===e.deliveryTabType});if((null==(m=e.preDisplayInfo)?void 0:m.openStatus)||(null==(y=e.preDisplayInfo)?void 0:y.guideMark)){const i=1===(null==(I=e.preDisplayInfo)?void 0:I.defaultPayType)?"on":"off";h.$lxLog.mv("b_youxuan_ipup1xmz_mv",{status:i,page_from:v.options.fromPage||"-999"})}return T.couponInfo.cacheId&&h.$lxLog.mv("b_youxuan_phx10yd5_mv",{coupon_id:T.couponInfo.cacheId,page_from:v.options.fromPage||"-999"}),T}getNormalSubmitMapping(){var e,i,t,o,r,n,a,p,s;const{order:l}=this,{orderPreview:d}=l.data;let c={};try{const{utm:{utm_term:e="{}"}}=h.lx.get();c=JSON.parse(e)}catch(e){y.log.error("<submitOrder getNormalSubmitMapping> 解析shareUserInfo出错")}const g={allowZeroPay:!0,cityId:h.$poi.poiInfo.cityId,poiId:h.$poiId,poiIdStr:h.$poiIdStr,riskUuid:(null==(i=null==(e=h.$systemInfo)?void 0:e.systemInfo)?void 0:i.uuid)||h.$uuid,opSource:l.options.cartOpSource,tempCartId:l.options.tempCartId,isUseCard:l.getting.getCardOpen(d),packageInfo:d.packageInfo.map((e=>u({estimateTime:e.centerTime,packageId:e.packageId,deliverType:e.deliveryType,schemeId:e.schemeId,deliveryStartTime:e.deliveryStartTime,deliveryEndTime:e.deliveryEndTime},e.deliveryLevelParams?{deliveryLevel:e.deliveryLevelParams.deliveryLevel}:{}))),cardPay:+l.getting.getCardNote(d),usePoint:l.getting.getPointOpen(d),usePointCount:+l.getting.getPointNote(d),addressId:(null==(t=d.addressInfo)?void 0:t.addressId)||0,actionSelect:l.actionSelect,couponIds:l.getting.getCouponIds(d)||[0],cashPay:d.cashPay,stockPois:[h.$poiId],stockPoisStr:h.$poiIdStr?[h.$poiIdStr]:[],remark:l.data.remark||"",selfLiftingMobile:l.getting.getSelfLiftingMobile(d),shippingType:d.shippingType,selfLiftingAddress:"",useRedPackage:null==(r=null==(o=d.useSwitch)?void 0:o.redPackageInfo)?void 0:r.open,useMember:null==(a=null==(n=d.useSwitch)?void 0:n.memberInfo)?void 0:a.open,redPackagePay:d.redPackagePay,useCouponPackage:l.getting.getUseCouponPackage(d),couponPackageId:l.getting.getCouponPackageId(d),couponPackagePay:l.getting.getCouponPackagePay(d),weChatFingerprint:l.weChatFingerprint,fingerprint:l.fingerprint,appId:"tt48f03e4dd7c81b7d01",acquisitionScene:l.getting.getAcquisitionScene(),shareUserInfo:c,subChannelVersion:wx.requestOrderPayment?2:1,sdkInfo:(null==(s=null==(p=I.mtpay)?void 0:p.requestFinancePaySDKInfo())?void 0:s.sdkInfo)||void 0,scene:l.options.scene};if(l.submitPending=!0,d.shippingType!==v.EshippingType.self&&d.shippingType!==v.EshippingType.delivery||(g.selfLiftingAddress=l.getting.getSelfLiftingAddress(d),g.selfPickUpPerson=this.order.getting.getPersonInfo(d)),d.couponAssign&&d.couponAssign.configIds&&!l.isPartReturnCouponInvalid&&(g.couponAssignId=d.couponAssign.configIds),l.data.groupOrderParams){const{groupBuyingType:e,shareGroupBuyingUserId:i,launchGroupBuyingId:t}=l.data.groupOrderParams;g.groupBuyingType=e||"",g.shareGroupBuyingUserId=i||"",g.launchGroupBuyingId=t||""}return l.fromPageSource&&(g.fromPageSource=l.fromPageSource),g}mappingShippingType(e){let i=-1;const{order:t}=this;if(e.selectDeliveryTab||0===e.selectDeliveryTab)i=e.selectDeliveryTab;else{i={[v.EselftDeliveryType.selfAndDelivery]:t.data.orderPreview.shippingType===v.EshippingType.default?v.EshippingType.delivery:t.data.orderPreview.shippingType,[v.EselftDeliveryType.onlyDelivery]:v.EshippingType.delivery,[v.EselftDeliveryType.onlySelf]:v.EshippingType.self}[e.selfLifting.selfLiftingDeliveryType]}return i}};