var e=Object.create,t=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,l=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,c=(e,t)=>{for(var o in t||(t={}))s.call(t,o)&&u(e,o,t[o]);if(i)for(var o of i(t))p.call(t,o)&&u(e,o,t[o]);return e},h=(e,t)=>o(e,r(t)),g=o=>{return((e,o,r)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let i of n(o))s.call(e,i)||"default"===i||t(e,i,{get:()=>o[i],enumerable:!(r=a(o,i))||r.enumerable});return e})((r=t(null!=o?e(l(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0}),t(r,"__esModule",{value:!0})),o);var r},d=g(require("./ob.js")),m=g(require("./u8.js")),f=g(require("./la.js")),D=getApp();Component(new class{constructor(){this.attached=function(){let e=0;const{isIpx:t}=D.getModule("systemInfo").getSystemInfo(),o="pages/cart/index"===D.page().route;e=(0,m.isWXMT)()?t?o?150:68:o?86:0:t&&!o?68:0,this.setData({containerStyle:`bottom:0;padding-bottom:${e}rpx;background:#fff;border-radius:24rpx 24rpx 0 0;`}),this.cart=D.page().selectComponent("#cart")},this.methods={getAvailableCouponDetail(e){return t=this,o=null,a=function*(){var t;if(this.requestPending)return Promise.reject({message:"请勿重复点击"});this.requestPending=!0;const o=(this.data.couponDetailData||{}).couponUserList||[],a="new"===e?{offset:0,limit:30}:"refresh"===e?{offset:0,limit:o.length<30?30:o.length}:"more"===e?{offset:o.length||0,limit:30}:{offset:0,limit:30};return D.$service.queryAvailableCouponUserInCart(h(c({poi:+D.$poiId,poiIdStr:D.$poi.getPoiIdStr()},a),{cacheId:(null==(t=this.cart)?void 0:t.cacheId)||0})).then((t=>{this.requestPending=!1,("refresh"!==e&&"more"!==e||this.data.couponDetailShow)&&this.setData({couponDetailData:h(c({},t),{couponUserList:[...0===a.offset?[]:o,...(t.couponUserList||[]).map((e=>h(c({},e),{gatherTip:e.gatherTip})))]})})}))},new Promise(((e,r)=>{var n=e=>{try{l(a.next(e))}catch(e){r(e)}},i=e=>{try{l(a.throw(e))}catch(e){r(e)}},l=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,i);l((a=a.apply(t,o)).next())}));var t,o,a},toShowCouponDetail(e="new"){var t;try{null==(t=D.page())||t.loading(!0)}catch(e){d.log.error("购物车: CouponPopUp -> toShowCouponDetail -> error",e)}d.log.info("购物车: CouponPopUp -> toShowCouponDetail -> from",e),this.getAvailableCouponDetail(e).then((()=>{var e;this.setData({couponDetailShow:!0});try{null==(e=D.page())||e.loading(!1)}catch(e){d.log.error("购物车: CouponPopUp ->getAvailableCouponDetail error",e)}})).catch((e=>{var t;this.toHideCouponDetail();try{null==(t=D.page())||t.toast((null==e?void 0:e.message)||e||"获取可用优惠券异常"),D.page()&&D.page().loading(!1)}catch(e){d.log.error("购物车: catch toHideCouponDetail error",e)}}))},toLoadMoreCouponDetail(){const{couponUserList:e=[],total:t=0}=this.data.couponDetailData||{};e.length<t&&this.getAvailableCouponDetail("more").catch((e=>{D.page().toast(e.message||e||"加载更多可用优惠券异常")}))},toHideCouponDetail(){this.triggerEvent("close")},hideCouponDetail(){f.default.onCouponPopClose(),this.setData({couponDetailData:{},couponDetailShow:!1})},jumpToCouponDoc(){D.$router.jumpToH5("https://i.meituan.com/awp/hfe/block/d2f9fd1a7dfb/102790/index.html")},onCouponUse(){this.toHideCouponDetail()},stopPropagation(){},onMvReport(){f.default.onCouponPopShow()}},this.properties={show:{type:Boolean,value:!1,observer(e,t){e&&!t&&this.toShowCouponDetail("new"),!e&&t&&this.hideCouponDetail()}},getCacheId:{type:Function}},this.data={couponDetailData:{},couponDetailShow:!1,containerStyle:""},this.requestPending=!1}});