var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,l=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,a=a=>{return((e,l,a)=>{if(l&&"object"==typeof l||"function"==typeof l)for(let i of s(l))o.call(e,i)||"default"===i||t(e,i,{get:()=>l[i],enumerable:!(a=r(l,i))||a.enumerable});return e})((i=t(null!=a?e(l(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0}),t(i,"__esModule",{value:!0})),a);var i},i=a(require("./jc.js")),u=a(require("./ob.js")),n=a(require("./zs.js")),c=a(require("./is.js")),p=a(require("./iu.js")),d=getApp();(0,i.defineComponent)({properties:{src:{type:String,value:""},mode:{type:String,value:"scaleToFill"},lazyLoad:{type:Boolean,value:!0},webpConf:{type:Object,value:{width:"",height:"",watermark:"",quality:"",minify:"",isAuto:!1,isWithBackground:!1,isProgressive:!1,progressiveWith:"",progressiveHeight:"",useWebp:!0}},isWithEmptyBoder:{type:Boolean,value:!1},styleStr:{type:String},externalStyle:{type:String},pbgColor:{type:String,value:"#FAFBFC"},customPlaceholder:{type:String},isBlockImg:{type:Boolean,value:!1}},externalClasses:["bitc-image","custom-class","custom-cls"],data:{isShowPlaceholder:!1,useWebpUrl:(0,n.useWebpUrl)(),deviceW:d.$systemInfo.getDeviceW(),deviceGrading:d.$deviceGrade.getSimpleDeviceGrading()},observers:{src(){this.data.isShowPlaceholder&&this.setData({isShowPlaceholder:!1})}},lifetimes:{created(){var e;this.errorNum=0;const{src:t=""}=this.data;null==(e=null==d?void 0:d.$cat)||e.reportCustomMetrics(c.YXReportTarget.LOAD_IMAGE_START,c.ReportValue.SUCCESS,{uuid:(null==d?void 0:d.$uuid)||"",src:t})}},methods:{getSecCategory:(e=!0,t=!1)=>""+(e?"_webp":t?"_source":"_clip"),webpLoadError(e){return t=this,r=null,s=function*(){var t,r;this.errorNum++;const{src:s=""}=e.target.dataset,l=s.indexOf(".webp")>-1,o=!(s.indexOf("@")>-1);this.setData({isShowPlaceholder:!0});const a=`${this.getSecCategory(l,o)}，原图src: ${s}，报错时是否为原图：${o}，第${this.errorNum}次报错 msg: ${e.detail&&e.detail.errMsg}`,i={e:e,url:s,msg:a};this.triggerEvent("error",i),null==(t=null==d?void 0:d.$cat)||t.reportCustomMetrics(c.YXReportTarget.LOAD_IMAGE_ERROR,c.ReportValue.FAILED,{uuid:(null==d?void 0:d.$uuid)||"",src:s,isSource:o}),null==(r=null==d?void 0:d.$cat)||r.reportError(p.CAT_SEC_CATEGORY.IMAGE_LOAD_ERROR("default",a)),u.log.warn("<bitc-image> 图片加载失败",i)},new Promise(((e,l)=>{var o=e=>{try{i(s.next(e))}catch(e){l(e)}},a=e=>{try{i(s.throw(e))}catch(e){l(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);i((s=s.apply(t,r)).next())}));var t,r,s},webpLoadSuccess(e){var t;const{src:r}=this.data,s={e:e,url:r};this.triggerEvent("load",s),null==(t=null==d?void 0:d.$cat)||t.reportCustomMetrics(c.YXReportTarget.LOAD_IMAGE_SUCCESS,c.ReportValue.SUCCESS,{uuid:(null==d?void 0:d.$uuid)||"",src:r})}}});