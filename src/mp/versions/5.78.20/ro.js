var e,t=Object.create,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,n=e=>{return((e,t,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of o(t))a.call(e,n)||"default"===n||r(e,n,{get:()=>t[n],enumerable:!(i=s(t,n))||i.enumerable});return e})((n=r(null!=e?t(i(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0}),r(n,"__esModule",{value:!0})),e);var n},l=n(require("./jc.js")),h=n(require("./u3.js")),u=n(require("./po.js")),{getBoundingClientRect:c}=require("./p0.js"),{$event:p}=getApp(),{LAYOUT_MASK_MODEL:f}=p.CONTANTS,d=!1,{mmpVersion:m,SDKVersion:g,system:v,platform:y}=wx.getSystemInfoSync();if(e=(0,u.isMMP)()?!!((0,h.default)(m,"5.9.0")>=0):!!((0,h.default)(g,"2.10.1")>=0),(null==v?void 0:v.toLocaleLowerCase().includes("ios"))&&"devtools"!==y){const e=null==v?void 0:v.toLocaleLowerCase().replace("ios ","");d=-1===(0,h.default)(e,"11.0.0")}if((null==v?void 0:v.toLocaleLowerCase().includes("android"))&&"devtools"!==y){const e=null==v?void 0:v.toLocaleLowerCase().replace("android ","");d=-1===(0,h.default)(e,"7.0.0")}(0,l.defineComponent)({options:{multipleSlots:!0},properties:{refresherEnabled:{type:Boolean,value:!0},upperThreshold:{type:Number,value:50},lowerThreshold:{type:Number,value:80},refresherThreshold:{type:Number,value:300},refresherBackground:{type:String,value:"#ffd100"},isPullDowning:{type:Boolean,value:!1},bindrefresherrefresh:{type:Function,value:()=>{}},scrollTop:{type:Number},scrollToViewId:{type:Number},scrollAnimation:{type:Boolean,value:!1},outerStyle:{type:String,value:""},canScroll:{type:Boolean,value:!0},refreshBackGround:{type:String,value:"#ffd100"}},data:{refreshStatus:0,refreshHeight:0,canUsePullReachBottom:e,scrollEle:"",triggered:!1,showMask:!1,isMMP:(0,u.isMMP)(),animationData:{},isLowerIOSVersion:d,lowerVersionStyle:"height: 100vh"},timer:null,scrollDetail:null,isInit:!0,observers:{isPullDowning(e,t){this.isInit?this.isInit=!1:e||this.resetFresh()}},attached(){this.refreshing=!1,this.refreshOpt={top:0,height:0,pageY:0},this.onShowMaskEventThis=this.onShowMaskEvent.bind(this),p.on(f,this.onShowMaskEventThis)},detached(){p.off(f,this.onShowMaskEventThis)},ready(){d&&c("#layoutHeader").then((e=>{const t=null==e?void 0:e.height;t&&this.setData({lowerVersionStyle:`height: calc(100vh - ${t}px);`})}))},methods:{onShowMaskEvent(e){this.setData({showMask:e,refresherEnabled:!e})},onScroll:((e,t)=>{let r=Date.now();return function(...s){const o=this;Date.now()-r>=t&&(e.apply(o,s),r=Date.now())}})((function(e){this.data.canUsePullReachBottom||(this.refreshOpt.top=e.detail.scrollTop),this.scrollDetail=e.detail,this.triggerEvent("onScroll",this.scrollDetail)}),200),onRefresh(){e||(this.refTime&&(clearTimeout(this.refTime),this.refTime=null),this.refTime=setTimeout((()=>this.resetFresh()),800)),this.refreshing=!0,this.triggerEvent("onScrollRefresh","refresh")},onPulling(e){this.triggerEvent("beforeOnRefresh",e)},onReachBottom(e){this.triggerEvent("onScrollReachBottom",e)},onRestore(){this.refreshing&&(this.refreshing=!1,this.triggerEvent("afterOnRefresh","restore"),this.resetFresh())},onStopPull(){},touchstart(e){var t,r;this.data.canUsePullReachBottom||(this.refreshOpt.pageY=null==(r=null==(t=e.changedTouches)?void 0:t[0])?void 0:r.pageY)},touchmove(e){var t,r;if(this.data.canUsePullReachBottom)return;if(this.refreshOpt.top>10)return;if(0!==this.data.refreshStatus)return;let s=(null==(r=null==(t=e.changedTouches)?void 0:t[0])?void 0:r.pageY)-this.refreshOpt.pageY;s/=2,s>=80&&(s=80,this.setData({refreshStatus:1})),this.refreshOpt.height=s;const o=wx.createAnimation({duration:0,timingFunction:"linear"}).height(this.refreshOpt.height).step({duration:0});this.setData({refreshHeight:this.refreshOpt.height,animationData:o.export()})},touchend(e){this.data.canUsePullReachBottom||this.refreshOpt.top>10||(0===this.data.refreshStatus?this.resetFresh():1===this.data.refreshStatus&&(this.setData({refreshStatus:2}),this.onRefresh()))},resetFresh(){const e=wx.createAnimation({duration:200,timingFunction:"ease"}).height(0).step({duration:200});this.setData({refreshStatus:0,refreshHeight:0,animationData:e.export()})}}});