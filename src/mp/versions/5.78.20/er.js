var e=Object.create,t=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,n=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,d=(e,t)=>{for(var o in t||(t={}))l.call(t,o)&&p(e,o,t[o]);if(i)for(var o of i(t))u.call(t,o)&&p(e,o,t[o]);return e},h=e=>t(e,"__esModule",{value:!0}),c=o=>((e,o,r)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let i of s(o))l.call(e,i)||"default"===i||t(e,i,{get:()=>o[i],enumerable:!(r=a(o,i))||r.enumerable});return e})(h(t(null!=o?e(n(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o),g=(e,t,o)=>new Promise(((a,r)=>{var s=e=>{try{n(o.next(e))}catch(e){r(e)}},i=e=>{try{n(o.throw(e))}catch(e){r(e)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,i);n((o=o.apply(e,t)).next())}));((e,o)=>{for(var a in h(e),o)t(e,a,{get:o[a],enumerable:!0})})(exports,{default:()=>Y});var _=c(require("./o8.js")),m=c(require("./ua.js")),f=c(require("./up.js")),y=c(require("./ul.js")),S=c(require("./uk.js")),P=c(require("./a8.js")),O=c(require("./u9.js")),x=c(require("./us.js")),D=c(require("./ob.js")),T=c(require("./ug.js")),b=c(require("./u4.js")),A=c(require("./pa.js")),R=c(require("./iw.js")),E=c(require("./u8.js")),v=c(require("./vn.js")),w=c(require("./vm.js")),L=c(require("./v1.js")),N=c(require("./v2.js")),C=c(require("./gd.js")),$=c(require("./u7.js")),k=c(require("./is.js")),I=c(require("./iy.js")),M=c(require("./xf.js")),U=c(require("./o9.js")),j=c(require("./p0.js")),B=c(require("./ig.js")),H=["pages/submitOrder/index","pages/paySuccess/index"],q=["pages/submitOrder/index","pages/paySuccess/index"],K=m.default.pageLifeCycleInterceptor(),F=getApp(),W=1,V=[w.default,v.default,L.default,_.zoomableData,x.behavior].reduce(((e,t)=>(t.data&&(e.data=d(d({},e.data),t.data)),t.methods&&(e=d(d({},e),t.methods)),e)),{}),J="[Metrics:poiController]",z=(e,t)=>{const a=new N.default,{onLoad:s,onUnload:i,onShareAppMessage:n,onShow:l,onHide:u,onPullDownRefresh:p,onReachBottom:h,onTabItemTap:c,onPoiInfoUpdated:m=(()=>{}),onPoiInfoConfirmed:v=(()=>{}),useMvReport:w=!0,onPreLoad:L=null,__navigationBarColor__:z=null,__navigationBarTitle__:Y=null}=e,X={pageHidden:!1,pageUnloaded:!1,networkStatus:R.default.getModule("networkStatus"),__navigationBarColor__:z,__navigationBarTitle__:Y,_timer:null,_toMap:null,_toPending:0,_toCount:0,__fstDetail__:{},resetToMapIfNeeded(){(!this._toMap||0===this._toPending&&this._toCount>100)&&(this._toMap=Object.create(null),this._toCount=0)},setTimeout(e,t){this.resetToMapIfNeeded();const{_toMap:o}=this;this._toPending+=1,this._toCount+=1;const a=setTimeout((()=>{this._toPending-=1,o[a]=null,this.resetToMapIfNeeded(),e()}),t);return o[a]=a,a},clearTimeout(e){const{_toMap:t}=this;t&&t[e]&&(this._toPending-=1,t[e]=null,this.resetToMapIfNeeded()),clearTimeout(e)},cleanTimeouts(){const{_toMap:e}=this;if(e){const t=Object.keys(e);for(let o=t.length-1;o>-1;--o){const a=e[t[o]];null!==a&&clearTimeout(a)}this._toMap=null}},setCustomStyle(e){try{e&&(this.__navigationBarColor__=e.__navigationBarColor__||null,this.__navigationBarTitle__=e.__navigationBarTitle__||null),this.clearTimeout(this._timer),this._timer=this.setTimeout((()=>{this.route===getApp().page().route&&(this.__navigationBarColor__&&wx.setNavigationBarColor(this.__navigationBarColor__),this.__navigationBarTitle__&&wx.setNavigationBarTitle(this.__navigationBarTitle__))}),500)}catch(e){D.log.warn(`设置自定义样式错误: ${e}`)}},getNetworkTypeAsync(e){const t=F.$buildStartPoint();wx.getNetworkTypeAsync&&wx.getNetworkTypeAsync().then((o=>{switch(t("getNetworkTypeAsync"),this.networkStatus.setNetworkType(o.networkType),F.getModule("cat").setNetworkType(o.networkType),o.networkType){case"无网络":case"none":this.error({show:!0,type:"no_network",code:U.default.NONETWORK,ok:()=>{this.onLoad(this.onLoadArgs),this.onShow(this.onShowArgs),e&&e(),this.error(!1)}})}}),(e=>{}))},showError(e="no_network",t=U.default.NONETWORK,a={},s){var i;this.error((i=d({show:!0,type:e,code:t},a),o(i,r({ok:()=>{this.onLoad(this.onLoadArgs),this.onShow(this.onShowArgs),this.error(!1),s&&s()}}))))},initEvents(){a.injectJudges((e=>{let t=e;e.type&&(t=e.extra||{});return this.route===getApp().page().route&&t&&(t.poiId||t.poiIdStr)}));const e=a.deferredCallback(((e,{homePageAggregationData:t})=>{m.call(this,e,{homePageAggregationData:t}),this.clearMD5Arr()}));this.onPoiUpdated=(t,{homePageAggregationData:o})=>{e(t,{homePageAggregationData:o}),this.route===getApp().page().route&&this.lxPv(),F.$cart.refreshCart(),F.$cart.getGlobalSkuqty()},b.default.on(A.POI_ON_UPDATED,this.onPoiUpdated),b.default.on(b.CONTANTS.HTTP_CODE_ERROR,this.handlerHttpCodeError)},handlerHttpCodeError(e){D.log.warn(J,"「base handlerHttpCodeError」",`参数：${e}`);let t="",o="";const a={title:"",message:"",showImage:""};switch(e){case 403:t="forbidden",o=U.default.FORBIDDEN;break;case U.default.NONETWORK:t="no_network",o=U.default.NONETWORK;break;case U.default.SERVERERROR:t="server_error",o=U.default.SERVERERROR;break;case U.default.JSERROR:t="js_error",o=U.default.JSERROR;break;case U.default.JSERROR_UNRECOVERABLE:t="js_error_unrecoverable",o=U.default.JSERROR_UNRECOVERABLE;break;case U.default.LOWPERFORMANCE:t="low_performance",o=U.default.LOWPERFORMANCE;break;case U.default.HTTPTIMEOUT:t="time_out",o=U.default.HTTPTIMEOUT}t&&o&&this.showError(t,o,a)},offEvents(){this.originPageOnLoad&&poiEventHandler.removeHandler(PoiEventType.updated,this.originPageOnLoad),this.originPageOnShow&&poiEventHandler.removeHandler(PoiEventType.updated,this.originPageOnShow),this.onPoiUpdated&&b.default.off(A.POI_ON_UPDATED,this.onPoiUpdated),b.default.off(b.CONTANTS.HTTP_CODE_ERROR,this.handlerHttpCodeError)},checkRedirect(){const{lastShowPage:e}=F,t="subPackages/yodaPage/pages/redirect/index"===e||"subPackages/yodaPage/pages/modules/index/index"===e,o=F.pages().length;(0,I.poiLogger)(`当前门店：${F.$poiId}`,`上一个页面在白名单？${(0,C.default)(F.lastShowPage)}`,`当前页在白名单？${(0,C.default)(this.route)}`),F.$poiId||F.$poiIdStr||!(t||(0,C.default)(F.lastShowPage)&&!(0,C.default)(this.route))||F.lastPagesLength-o!=1||((0,I.poiLogger)("checkRedirect execPoi"),I.default.execPoi()),F.lastShowPage=this.route,F.lastPagesLength=o},compatibleIosExecPoi(e={}){if(!(0,E.isApp)()||!F.$systemInfo.isIOS())return;if((0,C.default)(this.route))return;const t={path:this.route,query:e},o=Object.keys(e),{sceneCode:a}=e;-1001!==a&&o.length&&"pages/index/index"===this.route&&(D.log.info("compatibleIosExecPoi options",t),F.$appShowOptions.init(t),$.default.init(F.$appShowOptions),F.$router.proxyActivity.initYXQuery(F.$appShowOptions.getQuery()))},zoomableOnREMUpdate(){_.zoomableOnREMUpdate.call(this)},onLoad(e){return g(this,null,(function*(){var t;this.__fstDetailReportSDK(),this.__fstDetailReport(1);try{e&&e.utm_term&&e.extraParams&&(e.utm_term=decodeURIComponent(e.utm_term),e.extraParams=decodeURIComponent(e.extraParams))}catch(e){D.log.error(`onLoad utm_term extraParams 发生错误：${e}`)}F.currentRoute=this.route,x.behavior.onLoad.call(this,e),this.route=this.route||this.page.route,-1===H.indexOf(this.route)&&_.zoomableOnLoad.call(this),F.$tagTime("onLoadStart");const o=F.$buildStartPoint();try{(0,T.resetPerformce)(this.perf&&this.perf.appReLaunchStartTime),"pages/index/index"!==this.route&&(0,T.forceStop)(),D.log.warn(J,`「base onLoad ${this.route||this.page.route}」`,`参数: ${JSON.stringify(e)}`),L&&this.getPreLoad(e,L),this._pageCount=++W;const t={__route:this.route||this.page.route,_pageCount:this._pageCount,iconPosition:0};w&&"pages/index/index"!==this.route&&(t.__mvHandler=this.mvHandler.bind(this)),"pages/index/index"===this.route&&this.saveNextState?(this.setData({__mvHandler:this.mvHandler.bind(this)}),this.saveNextState(t)):this.setData(t),this.__mvHandler=this.mvHandler.bind(this),this.onLoadArgs=e,this.pageUnloaded=!1,this.pageHidden=!1,this.pageUnloaded=!1,this.networkStatus=R.default.getModule("networkStatus"),this._toMap=null,this._toPending=0,this._toCount=0,this.__pageLoadTime__=Date.now(),s&&s.call(this,e),this.initEvents(),this.__fstDetailReport(2),(-1===q.indexOf(this.route)||(0,E.isMMP)())&&(this.compatibleIosExecPoi(e),I.default.judgeAndExecPoi({path:this.route,options:e,onPoiInfoUpdated:(e,t={})=>{this.__fstDetailReport(8);try{m.call(this,e,t)}catch(e){(0,I.poiLogger)("error",`onPoiInfoUpdated方法报错，页面：${this.route}`)}},onPoiInfoConfirmed:(e,t={})=>{this.__fstDetailReport(10),(0,I.poiLogger)("门店确认后执行路由路基",{isConfirmed:t.isConfirmed,toggleSource:null==t?void 0:t.toggleSource}),((0,E.isApp)()&&F.$systemInfo.isIOS()||t.isConfirmed)&&F.$router.proxyActivity.runInterceptor(e,t);try{v.call(this,e,t)}catch(e){(0,I.poiLogger)("error",`onPoiInfoConfirmed方法报错，页面：${this.route}`)}(0,E.isTT)()||O.default.locationStrategy.handleLocationAuthOperation()}}))}catch(o){D.log.error(J,`「base onLoad ${this.route||this.page.route}」 error`,`参数: ${JSON.stringify(e)}`),(null==(t=F.$cat)?void 0:t.reportCustomMetrics)&&F.$cat.reportCustomMetrics(k.YXReportTarget.ONLOAD_ERROR,k.ReportValue.FAILED)}o("onLoad"),O.default.getCurrentLocationInfo().then((e=>this.setFstTags(e()))),this.__fstDetailReport(3)}))},onShareAppMessage(...e){var t;const o=(0,M.genShareId)();if(n&&"function"==typeof n){const a=n.apply(this,e);a&&a.path&&(a.path=(0,M.linkSharePath)(a.path,o));try{const{from:r="",sharePageObject:s="",shareButtonObject:i="",sharePosition:n="",target:l={},shareExtra:u=null}=e[0]||{};let p=-1,d="",h=null,c=null;"menu"===r?(p=0,d=s,h=u):"button"===r&&(l.dataset&&(l.dataset.shareButtonObject||l.dataset.sharePosition)?(p=l.dataset.sharePosition,d=l.dataset.shareButtonObject):(p=n,d=i),h=l.dataset.shareExtra||u||a.shareExtra,c=l.dataset.skuList);const{sku_id:g}=this.parseUrlParams(a.path)||{};F.$lxLog.mc("b_youxuan_cshare_mc",{shareid:o,share_type:"url",share_pos:p,share_object:d,sku_id:g||(null==(t=null==l?void 0:l.dataset)?void 0:t.shareSkuId)||-999,sku_list:c,share_extra:h})}catch(e){D.log.error(`分享的模块位置-微信自定义分享-埋点上报错误(在base.js => onShareAppMessage方法里)：${e}`)}try{const e=(0,M.getLeaderShareParams)((0,M.getShareUrlParams)(a.path));F.$service.shareReport(e)}catch(e){D.log.error(`团长激励-微信自定义分享-埋点上报错误(在base.js => onShareAppMessage方法里)：${e}`)}return D.log.warn(`[common-share]: res ${JSON.stringify(a)}.`),a}F.$lxLog.mc("b_youxuan_cshare_mc",{shareid:o,share_type:"url"}),D.log.warn(J,`base onShareAppMessage ${this.route}」`);const a=this.route||"unknown",{queryString:r,requestId:s}=F.$lxLog.genLxShareParam(this.route,{from:`from_share_${a}`});let i=`/pages/index/index?${r}`;i=(0,M.linkSharePath)(i,o),D.log.info("base: onShareAppMessage -> path",i),F.$lxLog.mc("b_youxuan_y5g64pno_mc",{share_url:i},{requestId:s});try{const e=(0,M.getLeaderShareParams)((0,M.getShareUrlParams)(i));F.$service.shareReport(e)}catch(e){D.log.error(`团长激励-微信默认分享-埋点上报错误(在base.js => onShareAppMessage方法里)：${e}`)}return{title:"美团优选",path:i}},parseUrlParams(e){try{if(e){const t={},o=e.indexOf("?"),a=e.slice(o+1);return a.split("&").forEach((e=>{if(e){const[o,a]=e.split("=");t[o]=a}})),t}}catch(e){}},lxPv(){if(this.route){const e=this.getMorePVOptions();F.$lxLog.pvByRoute(this.route,{custom:e})}},onShow(e){var t;this.__fstDetailReport(4),F.currentRoute=this.route,F.$tagTime("pageOnShowStart"),F.globalData.yodaVerificationLock=!1;const o=F.$buildStartPoint();(0,B.initRoomInfo)(e),this.lxPv(),(null==(t=F.$cat)?void 0:t.reportCustomMetrics)&&F.$cat.reportCustomMetrics(k.YXReportTarget.YXPV,k.ReportValue.SUCCESS,{pageUrl:this.route||""}),this.checkRedirect(),D.log.warn(J,`「base onShow ${this.route}」`,`参数: ${JSON.stringify(e)}`),this.getNetworkTypeAsync(),this.onShowArgs=e;(()=>{this.setCustomStyle(),l&&l.call(this,e),this.pageHidden=!1})(),F.$router.proxyActivity.proxyDefferor.execDeferredCallbacks(),a.execDeferredCallbacks(),o("pageOnShow"),this.__fstDetailReport(5)},onReachBottom(){h&&h.call(this)},onHide(){this.__fstDetailReport(15),I.default.resetPendingData(`${this.route}-onHide`),(0,T.forceStop)(),D.log.warn(J,`base onHide ${this.route}」`),u&&u.call(this),this.pageHidden=!0,F.$cat.reportAllRightNow(),this.clearHttpTimer(),this.clearStore(),this.closeSpecModal(),this.closeNoLocationModal()},onUnload(){this.__fstDetailReport(16),this.__fstDetailReportSDK(),P.default.clearPageOperator(this.route),D.log.warn(J,`base onUnload ${this.route}」`),this.cleanTimeouts(),this.removeAllEventListener(),this.offEvents(),_.zoomableOnUnload.call(this),i&&i.call(this),this.pageUnloaded=!0,this.clearMD5Arr(),this.clearHttpTimer(),this.clearStore()},onPullDownRefresh(e){this.clearMD5Arr(),p&&p.call(this,e)},onTabItemTap(e){c&&c.call(this,e)},setFstTags(){this.fstTags=(0,j.getPerformanceExtraData)()},clearHttpTimer(){const{httpTimer:e}=R.default.getModule("http")||{};e&&e.clearAllTimer(),D.log.info(J,"base clearHttpTimer 」")},clearStore(){null==F||F.$store.remove("reqFailedRecord")},showNoLocationModal(){return g(this,arguments,(function*(e={}){var t;const o=null==(t=getApp().page())?void 0:t.selectComponent("#multi_poi_modal");if(!o)return null;const{title:a,message:r,refreshPoi:s,needToHomePage:i=!0}=e;try{return yield o.showNoLocationModal({title:a,message:r,refreshPoi:s,needToHomePage:i})}catch(e){return null}}))},closeNoLocationModal(){var e;const t=null==(e=getApp().page())?void 0:e.selectComponent("#multi_poi_modal");t&&t.closeNoLocationModal()},__fstDetailReportSDK(){var e,t,o;try{if(!/^pages\/skuDetail\/index/.test(this.route))return;if(!(null==(e=null==this?void 0:this.fstReport)?void 0:e.pageStartTime))return;if(this.__fstDetail__[this.__fstDetailKey[0]]=this.fstReport.pageStartTime,!(null==(t=null==this?void 0:this.fstReport)?void 0:t.fst))return;const a=this.__fstDetail__[this.__fstDetailKey[0]]+this.fstReport.fst-this.__fstDetail__[this.__fstDetailKey[12]];null==(o=f.metrics)||o.addPoint({pageName:this.route||"unknown",key:"FST_DETAIL",duration:a,step:this.__fstDetailKey[14]})}catch(e){D.log.warn(`[fst detail error]: ${e}`)}},__fstDetailReport(e){try{if(!/^pages\/skuDetail\/index/.test(this.route))return;const t=this.__fstDetailKey[e];this.__fstDetail__[t]=Date.now();this.__fstDurationMap[e].map((e=>this.__fstDetailKey[e])).map((e=>{var o;this.__fstDetail__[e]?null==(o=f.metrics)||o.addPoint({pageName:this.route||"unknown",key:"FST_DETAIL",duration:this.__fstDetail__[t]-this.__fstDetail__[e],step:t}):D.log.warn(`[fst detail error]: no ${e} time`)}))}catch(e){D.log.warn(`[fst detail error]: ${e}`)}},__fstDetailKey:["FST_START","BASE_ONLOAD_START","BASE_POI_START","BASE_ONLOAD_END","BASE_ONSHOW_START","BASE_ONSHOW_END","BASE_ONREADY_START","BASE_ONREADY_END","BASE_POI_UPDATED_START","BIZ_MAINNET_START","BASE_POI_CONFIRMED_END","BIZ_MAINNET_END","BIZ_SETDATA","BIZ_SETDATA_CALLBACK_START","FST_END","BASE_ONHIDE","BASE_ONUNLOAD"].map((e=>`FST_DETAIL_${e}`)),__fstDurationMap:[[],[0],[0],[0],[3],[4],[5],[6],[2],[8],[8],[9],[9],[12],[9],[],[]]},Z=d(d({platform:"tt"},e.data),V.data),Q=["isPrototypeOf","hasOwnProperty","propertyIsEnumerable","toString","valueOf","toLocaleString","nv_toString","nv_toValue","nv_constructor"];!function e(t){Object.getOwnPropertyNames(t).forEach((e=>{try{"constructor"!==e&&!e.startsWith("__")&&!Q.includes(e)&&Object.defineProperty(t,e,{enumerable:!0})}catch(e){}}));const o=Object.getPrototypeOf(t);o&&o!==Object&&e(o)}(e.constructor.prototype),((e=Object.assign(e,X,V,{data:Z})).__isHomePage||e.__isSkuDetailPage||e.__isPaySuccessPage||e.__isUserCenterPage||e.__isCouponList)&&(e.data.__isPageReady=!1),void 0===e.data._showErrorCode&&(e.data._showErrorCode=!0);const G={onShareAppMessage(){D.log.warn(J,`base onShareAppMessage ${this.route}」`);const e=this.route||"unknown",{queryString:t,requestId:o}=F.$lxLog.genLxShareParam(this.route,{from:`from_share_${e}`}),a=`/pages/index/index?${t}`;return D.log.info("base: onShareAppMessage -> path",a),F.$lxLog.mc("b_youxuan_y5g64pno_mc",{share_url:a},{requestId:o}),{title:"美团优选",path:a}},getMorePVOptions(){const e={};return this.onLoadArgs&&this.onLoadArgs.shareWay&&(e.shareWay=this.onLoadArgs.shareWay),this.onLoadArgs&&this.onLoadArgs.cookbookId&&(e.cookbook_id=this.onLoadArgs.cookbookId,e.refer_page_module=""),this.onLoadArgs&&this.onLoadArgs.g&&(e.activity_id=`g=${this.onLoadArgs.g}`,e.title=this.data.title),this.onLoadArgs&&this.onLoadArgs.resourceCode?e.resourceCode=this.onLoadArgs.resourceCode:e.resourceCode=-999,e}};return Object.keys(G).forEach((t=>{e[t]||(e[t]=G[t])})),(0,E.isTT)(),f.page&&(0,f.page)((0,S.page)(K(e)),(e=>(0,y.page)(e,t)))};module.exports=z;var Y=z;