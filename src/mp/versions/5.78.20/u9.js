var t=Object.create,e=Object.defineProperty,o=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,l=t=>e(t,"__esModule",{value:!0}),r=r=>((t,i,l)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let r of n(i))a.call(t,r)||"default"===r||e(t,r,{get:()=>i[r],enumerable:!(l=o(i,r))||l.enumerable});return t})(l(e(null!=r?t(i(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),u=(t,e,o)=>new Promise(((n,i)=>{var a=t=>{try{r(o.next(t))}catch(t){i(t)}},l=t=>{try{r(o.throw(t))}catch(t){i(t)}},r=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,l);r((o=o.apply(t,e)).next())}));((t,o)=>{for(var n in l(t),o)e(t,n,{get:o[n],enumerable:!0})})(exports,{default:()=>j});var c=r(require("./ua.js")),s=r(require("./ob.js")),d=r(require("./sr.js")),p=r(require("./sw.js")),g=r(require("./a2.js")),m=r(require("./ug.js")),y=r(require("./se.js")),f=null,h={},v=null,x=new Promise((t=>{v=t})),b=(...t)=>u(void 0,[...t],(function*({refresh:t=!1}={},e="gcj02"){const o=getApp(),n=(0,m.buildStartPoint)();try{if(o&&o.$location&&o.$location.longitude&&!t)return s.log.warn("从app拿到定位: ……………………………………",o.$location),P(o.$location),o.$location;const i=yield y.default.getLocation(d.cacheGetLocation,e),{longitude:a="",latitude:l=""}=i||{};if(a&&l){n("locationWxApiSuccess"),c.default.resetGeolocation(a,l);const t={longitude:a,latitude:l};o.$location=t,g.default.$location=t,i.type=e,P(i)}return i}catch(t){throw n("locationWxApiFail"),s.log.warn("getWxLocation",t),t}})),$=(t=!1)=>u(void 0,null,(function*(){const e=getApp()||f;let o=null;if(!t&&e&&e.$location&&e.$location.latitude&&(o=e.$location),!o)try{(0,m.tagTime)("onGetLocationStart");const n=yield b({refresh:t});(0,m.tagTime)("onGetLocationEnd"),n&&(o={longitude:n.longitude,latitude:n.latitude},e.$location=o,g.default.$location=o)}catch(t){}return o})),L=(0,p.getResFromRecently)($,{tag:"globalPoiGetLocation"});function P(t){var e,o,n;const{longitude:i,latitude:a}=t;if(!i||!a||!v||h&&h.longitude===i&&h.latitude===a)return;try{const i=null==(o=null==(e=getApp())?void 0:e.globalData)?void 0:o.jsguardInstance;null==(n=null==i?void 0:i.finger)||n.l(t)}catch(t){}const l=(f||getApp()).$store.getNoPrefixCache("address_exhaustive_info");return l&&l.longitude===i&&l.latitude===a?(h=l,v&&v((()=>h)),void(v=null)):(h={longitude:i,latitude:a},(f||getApp()).$service.getPosition({longitude:i,latitude:a}).then((t=>{const{address:e,cityId:o,cityName:n,districtId:i,districtName:a,districtType:l}=t;h.address={address:e,cityId:o,cityName:n,districtId:i,districtName:a,districtType:l},v&&v((()=>h)),v=null,setTimeout((()=>{(f||getApp()).$store.setNoPrefixCacheSync("address_exhaustive_info",h)}),5e3)})).catch((()=>v((()=>({}))))))}var j={getWxLocation:b,onGetLocation:$,onGetLocationCache:L,initApp:t=>{f=t},resetDeniedError:d.resetDeniedError,getLocationAuth:d.getLocationAuth,locationStrategy:y.default,getCurrentLocationInfo:function(){return x},getCurrentLocationInfoSync:function(){return h}};