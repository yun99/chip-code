var e,t,o=Object.create,a=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,c=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,d=(e,t,o)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,g=(e,t)=>{for(var o in t||(t={}))s.call(t,o)&&d(e,o,t[o]);if(l)for(var o of l(t))p.call(t,o)&&d(e,o,t[o]);return e},y=(e=require("./p0.js"),((e,t,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of u(t))s.call(e,r)||"default"===r||a(e,r,{get:()=>t[r],enumerable:!(o=i(t,r))||o.enumerable});return e})((t=a(null!=e?o(c(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0}),a(t,"__esModule",{value:!0})),e)),m=getApp();Component({options:{multipleSlots:!0},properties:{coupon:{type:Object,value:{},observer(e){let t=!1;"cart"===this.data.pageType?t=!0:e.ruleDetails&&(t=e.ruleDetails.length>1||(0,y.getStrLen)(e.ruleDetails[0].ruleDetail)>47);let o="",a="";var i,u;2===e.reducePriceType?o=e.reducePrice:(o=parseFloat(e.reducePrice),a=e.reducePrice.replace(/\d+\.?\d?/g,"")||(0===e.reducePriceType?"￥":"")),this.setData((i=g({},e),u={needFolding:t,reducePriceNumber:o,reducePriceUnit:a,processed:!0,validTime:e.validTime||"",countDownTime:e.countDownTime||0},r(i,n(u))))}},couponParams:{type:Object,value:{}},pageType:{type:String,value:"list",observer(e){"cart"===e&&this.setData({needFolding:!0})}},textIndent:{type:Boolean,value:!0},useRadio:{type:Boolean,value:!1}},externalClasses:["external-class"],data:{expanded:!1,title:"",reducePrice:"",needFolding:!1,reducePriceType:1,reducePriceNumber:"",reducePriceUnit:"",priceLimit:"",validTime:"",status:1,id:0,couponId:0,fresh:!1,ruleChannel:"",ruleDetail:"",issued:!1,ENUM:{TAKE_COUPON:"点击领取",COUPON_IS_TAKED:"已领取"},couponDisable:!1,couponSelected:!1,countDownTime:0},ready(){},methods:{useCoupon(e){const{pageType:t,isCanUseInCart:o,couponCode:a}=this.data;if("cart"===t)this.triggerEvent("use",this.data.coupon);else if("payShareLanding"===t){const{orderId:t,activityId:o}=this.data.couponParams;m.$lxLog.mc("b_youxuan_esblthpz_mc",{coupon_id:e.id,order_id:t,activity_id:o})}else m.$lxLog.mc("b_htjipj8f",{coupon_id:e.id});m.$router.goto(e.url)},toggleFolding(){const{pageType:e,needFolding:t,expanded:o,couponCode:a}=this.data;t&&this.setData({expanded:!o})},toggleCouponSelect(){this.triggerEvent("couponSelect",{couponSelected:!this.data.couponSelected})},takeCoupon(e){m.$service.takeItemCoupon(g({couponId:e},this.data.couponParams)).then((e=>{e&&(m.page().toast(e&&e.message),this.setData({issued:!0}))})).catch((e=>{m.page().toast(e&&e.message||"优惠券领取失败")}))},jumpToRuleLink(e){const{link:t}=e.currentTarget.dataset;t&&m.$router.goto(t)},tapCoupon(){const{useRadio:e,btnLabel:t,valid:o,pageType:a,issued:r,notLink:i,couponCode:n,btnLink:u,couponId:l}=this.data;e?this.toggleCouponSelect():t&&!i&&o&&"list"===a||t&&!i&&o&&"payShareLanding"===a||t&&o&&"cart"===a||t&&!o?this.useCoupon({id:n,url:u}):"take"!==a||r||this.takeCoupon(l)}}});