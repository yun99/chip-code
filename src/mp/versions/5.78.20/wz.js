var e=Object.create,t=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,i=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,p=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,c=(e,t)=>{for(var o in t||(t={}))s.call(t,o)&&p(e,o,t[o]);if(u)for(var o of u(t))l.call(t,o)&&p(e,o,t[o]);return e},d=o=>{return((e,o,r)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let u of n(o))s.call(e,u)||"default"===u||t(e,u,{get:()=>o[u],enumerable:!(r=a(o,u))||r.enumerable});return e})((r=t(null!=o?e(i(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0}),t(r,"__esModule",{value:!0})),o);var r},m=(e,t,o)=>new Promise(((a,r)=>{var n=e=>{try{i(o.next(e))}catch(e){r(e)}},u=e=>{try{i(o.throw(e))}catch(e){r(e)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,u);i((o=o.apply(e,t)).next())})),g=d(require("./p0.js")),y=d(require("./s4.js")),f=d(require("./az.js")),b=d(require("./ob.js")),h=(d(require("./po.js")),d(require("./u8.js")),d(require("./la.js"))),P=getApp();Component({options:{multipleSlots:!0},properties:{coupon:{type:Object,value:{},observer(e){let t=!1;"cart"===this.data.pageType?t=!0:e.ruleDetails&&(t=e.ruleDetails.length>1||(0,g.getStrLen)(e.ruleDetails[0].ruleDetail)>47);let a="",n="";2===e.reducePriceType?a=e.reducePrice:(a=parseFloat(e.reducePrice),n=e.reducePrice.replace(/\d+\.?\d?/g,"")||(0===e.reducePriceType?"￥":""));let u="";var i;e.validTime&&(u=e.validTime.replace(/\./g,"-")),this.setData((i=c({},e),o(i,r({needFolding:t,reducePriceNumber:a,reducePriceUnit:n,processed:!0,validTime:u}))))}},couponParams:{type:Object,value:{}},pageType:{type:String,value:"list",observer(e){"cart"===e&&this.setData({needFolding:!0})}},textIndent:{type:Boolean,value:!0},useRadio:{type:Boolean,value:!1},couponIndex:{type:Number}},externalClasses:["external-class"],data:{expanded:!1,title:"",reducePrice:"",needFolding:!1,reducePriceType:1,reducePriceNumber:"",reducePriceUnit:"",priceLimit:"",validTime:"",status:1,id:0,couponId:0,fresh:!1,ruleChannel:"",ruleDetail:"",ENUM:{TAKE_COUPON:y.TAKE_COUPON,COUPON_IS_TAKED:y.COUPON_IS_TAKED},couponDisable:!1,couponSelected:!1},ready(){this.getRiskParams()},methods:{useCoupon(e){var t;const{pageType:o,isCanUseInCart:a,couponCode:r}=this.data;"cart"===o?this.triggerEvent("use",this.data.coupon):"payShareLanding"===o?P.$lxLog.mc("b_youxuan_esblthpz_mc",{coupon_id:e.id}):P.$lxLog.mc("b_htjipj8f",{coupon_id:e.id});let{url:n}=e;const u=null==(t=getApp().page().options)?void 0:t.trafficSource;u&&(n+=`${n.indexOf("?")?"&":"?"}trafficSource=${u}`),n=n.replace(/promotion_name[^&]*&{0,1}/g,"").replace(/[&|?]*$/g,""),P.$router.goto(n)},toggleFolding(){const{pageType:e,needFolding:t,expanded:o,couponCode:a,couponIndex:r}=this.data;h.default.onHadCouponDetailShow(a,r),t&&this.setData({expanded:!o})},jumpToRuleLink(e){const{link:t}=e.currentTarget.dataset;t&&P.$router.goto(t)},getRiskParams(){return m(this,null,(function*(){this.riskParams=yield(0,f.getRiskParamsWeChat)()}))},tapCoupon(){return m(this,null,(function*(){const{btnLabel:e,valid:t,pageType:o,notLink:a,couponCode:r,btnLink:n,couponId:u,member:i,couponConfigId:s,couponIndex:l,status:p}=this.data;if(-1===p?h.default.onTakeCouponClick(r,l):h.default.onHadCouponClick(r,l),e&&!a&&t&&"list"===o||e&&!a&&t&&"payShareLanding"===o||e&&t&&"cart"===o)this.useCoupon({id:r,url:n});else try{let e;e=i?yield P.$service.takeMemberCoupon({couponConfigId:s,riskParams:this.riskParams}):yield P.$service.takeSkuDetailCoupon({couponConfigId:s,riskParams:this.riskParams,couponPageType:7}),e&&this.setData(c({},e))}catch(e){(0,b.log)(`优惠券领取失败${e.message}`),P.page().toast(e.message||"优惠券领取失败")}}))},onButtClick(){const{couponCode:e,couponIndex:t,btnLabel:o,status:a}=this.data;-1===a?h.default.onTakeCoupon(e,t):h.default.onHadCouponButtClick(o,e,t)},onMvReport(){const{couponCode:e,couponIndex:t,status:o}=this.data;-1===o?h.default.onTakeCouponShow(e,t):h.default.onHadCouponShow(e,t)}}});