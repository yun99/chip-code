var e=Object.create,r=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,c=(e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,r)=>{for(var t in r||(r={}))l.call(r,t)&&c(e,t,r[t]);if(n)for(var t of n(r))i.call(r,t)&&c(e,t,r[t]);return e},d=(e,r)=>t(e,o(r)),m=t=>{return((e,t,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of a(t))l.call(e,n)||"default"===n||r(e,n,{get:()=>t[n],enumerable:!(o=s(t,n))||o.enumerable});return e})((o=r(null!=t?e(u(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0}),r(o,"__esModule",{value:!0})),t);var o},y=(e,r,t)=>new Promise(((s,o)=>{var a=e=>{try{u(t.next(e))}catch(e){o(e)}},n=e=>{try{u(t.throw(e))}catch(e){o(e)}},u=e=>e.done?s(e.value):Promise.resolve(e.value).then(a,n);u((t=t.apply(e,r)).next())})),f=m(require("./up.js")),g=m(require("./ul.js")),O=m(require("./uc.js")),b=m(require("./p3.js")),h=m(require("./ob.js")),q=m(require("./p0.js")),v={99998:["timeout","请求超时","request connect error","The request timed out.","ssl hand shake error","ERR_TIMED_OUT"],99994:["似乎已断开与互联网的连接。","interrupted","jsapi has no permission","网络连接已中断","I/O error during system call","I/O error during system call, Software caused connection abort","ERR_CONNECTION_ABORTED"],99996:["Unable to resolve host","ERR_NAME_NOT_RESOLVED","ERR_ADDRESS_UNREACHABLE","未能找到使用指定主机名的服务器。"],99995:["invalid url"],99997:["url not in domain list"],99992:["ERR_CONNECTION_REFUSED","SSL 错误"]},E=(e,r,t)=>{var s;const{url:o,connectType:a}=t,n=getApp();let u=99999,l=!0,i="";if(e&&200===e.statusCode){const{data:t={}}=e||{},a=(null==(s=t.error)?void 0:s.msg)||(null==t?void 0:t.msg)||(null==t?void 0:t.message);u=+t.code,5===u&&"您的登录凭证已失效，请重新登录"===a?u=98905:19===u&&"您的登录凭证已失效，请重新登录"===a?u=98919:e.data&&"object"==typeof e.data.data?0===e.data.code?u=e.data.code:e.data.error&&e.data.error.code&&(u=e.data.error.code,i=JSON.stringify({res:e,reportUrl:r}),l=!1):u=99990,-1===u&&(u=-2),n.isProd()&&-1!==o.indexOf(O.default.getRequestDomain("test"))&&(u=99993)}else if(e&&e.errMsg){const{errMsg:t="",statusCode:s,header:o}=e;if(s){if(u=s,504!==u&&(i=JSON.stringify({res:e,reportUrl:r}),l=!1),403===s){const e=null==o?void 0:o["X-Forbid-Reason"];u=97999,"."===e?u=97998:".."===e&&(u=97997)}}else{const s=Object.keys(v);for(const o of s)if(v[o].find((e=>-1!==t.indexOf(e)))){u=Number(o),"cloudContainer"===a&&(i=JSON.stringify({res:e,reportUrl:r}));break}}99997!==u&&99999!==u||(i=JSON.stringify({res:e,reportUrl:r}),l=!1)}else i=JSON.stringify({res:e,reportUrl:r}),l=!1;let c=`request_${r}：${u}`;return"cloudContainer"===a&&(c=`cloud_container_request_${r}：${u}`),{code:u,log:i,name:c,ignoreAjaxError:l}};module.exports={wx2promiseify:function(e,r){const t=r||{};return new Promise(((r,s)=>{t.success=r,t.fail=s,e(t)}))},domPromiseify:function(e){return new Promise((r=>{wx.createSelectorQuery().select(`${e}`).boundingClientRect((e=>{r(e)})).exec()}))},catReq2promiseify:function(e,r){return y(this,arguments,(function*(e,r,t=g.request){var s,o;let a=null==(o=null==(s=getApp().globalData)?void 0:s.jsguardInstance)?void 0:o.request;const n=d(p({},e),{mtSecuritySign:!0,mtSecuritySiua:!0,reportError:t=>E(t,r,e)});return new Promise(((e,r)=>{var s;if(n.success=e,n.fail=r,n.metricsError=e=>e&&200!==e.statusCode,n.extra=(0,q.getPerformanceExtraData)(),t===g.request)n.isRequest=!0,(0,f.request)(n,(e=>a(e,g.request)));else if(t===(null==(s=getApp().$sharkService)?void 0:s.sharkSend)){let e=(0,g.request)(n);e=p({},e),(0,f.request)(e,(e=>a(e,getApp().$sharkService.sharkSend.bind(getApp().$sharkService))))}else{n.success=e;let r=(0,g.request)(n);if("GET"===r.method){const{pathname:e="",query:s="",host:o,protocol:u}=(0,b.parse)(r.url),l=p(p({},b.querystring.parse(s)||{}),r.data||{});let i=e,c=n.url;Object.keys(l).length&&(i=`${i}?${b.querystring.stringify(l)}`,c=`${u}//${o}${i}`),r=d(p({},r),{path:i,url:c}),delete r.data,(0,f.request)(r,(e=>a(e,t))),h.log.trace(`发起云托管请求：url：${r.url}`,`path：${r.path}`)}else{const{path:e=""}=(0,b.parse)(r.url);r=d(p({},r),{path:e}),(0,f.request)(r,(e=>a(e,t))),h.log.trace(`发起云托管请求：url：${r.url}`,`path：${r.path}`)}}}))}))}};