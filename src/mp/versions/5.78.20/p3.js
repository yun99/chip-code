var t=require("./l6.js");function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=v,exports.resolve=function(t,s){return v(t,!1,!0).resolve(s)},exports.resolveObject=function(t,s){return t?v(t,!1,!0).resolveObject(s):s},exports.format=function(h){t.isString(h)&&(h=v(h));return h instanceof s?h.format():s.prototype.format.call(h)},exports.Url=s;var h=/^([a-z0-9.+-]+:)/i,e=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),o=["'"].concat(r),n=["%","/","?",";","#"].concat(o),i=["/","?","#"],l=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,u={javascript:!0,"javascript:":!0},c={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=require("./l7.js");function v(h,e,a){if(h&&t.isObject(h)&&h instanceof s)return h;var r=new s;return r.parse(h,e,a),r}exports.querystring=m,s.prototype.parse=function(s,e,r){if(!t.isString(s))throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var v=s.indexOf("?"),g=-1!==v&&v<s.indexOf("#")?"?":"#",y=s.split(g);y[0]=y[0].replace(/\\/g,"/");var b=s=y.join(g);if(b=b.trim(),!r&&1===s.split("#").length){var d=a.exec(b);if(d)return this.path=b,this.href=b,this.pathname=d[1],d[2]?(this.search=d[2],this.query=e?m.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=h.exec(b);if(x){var j=(x=x[0]).toLowerCase();this.protocol=j,b=b.substr(x.length)}if(r||x||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var q="//"===b.substr(0,2);!q||x&&c[x]||(b=b.substr(2),this.slashes=!0)}if(!c[x]&&(q||x&&!f[x])){for(var O,A,U=-1,w=0;w<i.length;w++){-1!==(C=b.indexOf(i[w]))&&(-1===U||C<U)&&(U=C)}-1!==(A=-1===U?b.lastIndexOf("@"):b.lastIndexOf("@",U))&&(O=b.slice(0,A),b=b.slice(A+1),this.auth=decodeURIComponent(O)),U=-1;for(w=0;w<n.length;w++){var C;-1!==(C=b.indexOf(n[w]))&&(-1===U||C<U)&&(U=C)}-1===U&&(U=b.length),this.host=b.slice(0,U),b=b.slice(U),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var k=this.hostname.split(/\./),N=(w=0,k.length);w<N;w++){var R=k[w];if(R&&!R.match(l)){for(var $="",z=0,S=R.length;z<S;z++)R.charCodeAt(z)>127?$+="x":$+=R[z];if(!$.match(l)){var _=k.slice(0,w),D=k.slice(w+1),H=R.match(p);H&&(_.push(H[1]),D.unshift(H[2])),D.length&&(b="/"+D.join(".")+b),this.hostname=_.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase();var L=this.port?":"+this.port:"",Z=this.hostname||"";this.host=Z+L,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!u[j])for(w=0,N=o.length;w<N;w++){var E=o[w];if(-1!==b.indexOf(E)){var P=encodeURIComponent(E);P===E&&(P=escape(E)),b=b.split(E).join(P)}}var T=b.indexOf("#");-1!==T&&(this.hash=b.substr(T),b=b.slice(0,T));var B=b.indexOf("?");if(-1!==B?(this.search=b.substr(B),this.query=b.substr(B+1),e&&(this.query=m.parse(this.query)),b=b.slice(0,B)):e&&(this.search="",this.query={}),b&&(this.pathname=b),f[j]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){L=this.pathname||"";var F=this.search||"";this.path=L+F}return this.href=this.format(),this},s.prototype.format=function(){var s=this.auth||"";s&&(s=(s=encodeURIComponent(s)).replace(/%3A/i,":"),s+="@");var h=this.protocol||"",e=this.pathname||"",a=this.hash||"",r=!1,o="";this.host?r=s+this.host:this.hostname&&(r=s+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&t.isObject(this.query)&&Object.keys(this.query).length&&(o=m.stringify(this.query));var n=this.search||o&&"?"+o||"";return h&&":"!==h.substr(-1)&&(h+=":"),this.slashes||(!h||f[h])&&!1!==r?(r="//"+(r||""),e&&"/"!==e.charAt(0)&&(e="/"+e)):r||(r=""),a&&"#"!==a.charAt(0)&&(a="#"+a),n&&"?"!==n.charAt(0)&&(n="?"+n),h+r+(e=e.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(n=n.replace("#","%23"))+a},s.prototype.resolve=function(t){return this.resolveObject(v(t,!1,!0)).format()},s.prototype.resolveObject=function(h){if(t.isString(h)){var e=new s;e.parse(h,!1,!0),h=e}for(var a=new s,r=Object.keys(this),o=0;o<r.length;o++){var n=r[o];a[n]=this[n]}if(a.hash=h.hash,""===h.href)return a.href=a.format(),a;if(h.slashes&&!h.protocol){for(var i=Object.keys(h),l=0;l<i.length;l++){var p=i[l];"protocol"!==p&&(a[p]=h[p])}return f[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(h.protocol&&h.protocol!==a.protocol){if(!f[h.protocol]){for(var u=Object.keys(h),m=0;m<u.length;m++){var v=u[m];a[v]=h[v]}return a.href=a.format(),a}if(a.protocol=h.protocol,h.host||c[h.protocol])a.pathname=h.pathname;else{for(var g=(h.pathname||"").split("/");g.length&&!(h.host=g.shift()););h.host||(h.host=""),h.hostname||(h.hostname=""),""!==g[0]&&g.unshift(""),g.length<2&&g.unshift(""),a.pathname=g.join("/")}if(a.search=h.search,a.query=h.query,a.host=h.host||"",a.auth=h.auth,a.hostname=h.hostname||h.host,a.port=h.port,a.pathname||a.search){var y=a.pathname||"",b=a.search||"";a.path=y+b}return a.slashes=a.slashes||h.slashes,a.href=a.format(),a}var d=a.pathname&&"/"===a.pathname.charAt(0),x=h.host||h.pathname&&"/"===h.pathname.charAt(0),j=x||d||a.host&&h.pathname,q=j,O=a.pathname&&a.pathname.split("/")||[],A=(g=h.pathname&&h.pathname.split("/")||[],a.protocol&&!f[a.protocol]);if(A&&(a.hostname="",a.port=null,a.host&&(""===O[0]?O[0]=a.host:O.unshift(a.host)),a.host="",h.protocol&&(h.hostname=null,h.port=null,h.host&&(""===g[0]?g[0]=h.host:g.unshift(h.host)),h.host=null),j=j&&(""===g[0]||""===O[0])),x)a.host=h.host||""===h.host?h.host:a.host,a.hostname=h.hostname||""===h.hostname?h.hostname:a.hostname,a.search=h.search,a.query=h.query,O=g;else if(g.length)O||(O=[]),O.pop(),O=O.concat(g),a.search=h.search,a.query=h.query;else if(!t.isNullOrUndefined(h.search)){if(A)a.hostname=a.host=O.shift(),(k=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=k.shift(),a.host=a.hostname=k.shift());return a.search=h.search,a.query=h.query,t.isNull(a.pathname)&&t.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a}if(!O.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var U=O.slice(-1)[0],w=(a.host||h.host||O.length>1)&&("."===U||".."===U)||""===U,C=0,I=O.length;I>=0;I--)"."===(U=O[I])?O.splice(I,1):".."===U?(O.splice(I,1),C++):C&&(O.splice(I,1),C--);if(!j&&!q)for(;C--;C)O.unshift("..");!j||""===O[0]||O[0]&&"/"===O[0].charAt(0)||O.unshift(""),w&&"/"!==O.join("/").substr(-1)&&O.push("");var k,N=""===O[0]||O[0]&&"/"===O[0].charAt(0);A&&(a.hostname=a.host=N?"":O.length?O.shift():"",(k=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=k.shift(),a.host=a.hostname=k.shift()));return(j=j||a.host&&O.length)&&!N&&O.unshift(""),O.length?a.pathname=O.join("/"):(a.pathname=null,a.path=null),t.isNull(a.pathname)&&t.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=h.auth||a.auth,a.slashes=a.slashes||h.slashes,a.href=a.format(),a},s.prototype.parseHost=function(){var t=this.host,s=e.exec(t);s&&(":"!==(s=s[0])&&(this.port=s.substr(1)),t=t.substr(0,t.length-s.length)),t&&(this.hostname=t)};