var e=Object.create,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,s=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,i=e=>t(e,"__esModule",{value:!0}),n=n=>((e,s,i)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let n of o(s))u.call(e,n)||"default"===n||t(e,n,{get:()=>s[n],enumerable:!(i=r(s,n))||i.enumerable});return e})(i(t(null!=n?e(s(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),a=(e,t,r)=>new Promise(((o,s)=>{var u=e=>{try{n(r.next(e))}catch(e){s(e)}},i=e=>{try{n(r.throw(e))}catch(e){s(e)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(u,i);n((r=r.apply(e,t)).next())}));((e,r)=>{for(var o in i(e),r)t(e,o,{get:r[o],enumerable:!0})})(exports,{shareReporter:()=>O});var l=n(require("./ua.js")),c=n(require("./ph.js")),p=n(require("./ob.js")),m=n(require("./u4.js")),d=n(require("./pd.js")),h=require("./p3.js"),{JUMP_PROTOCOL:y}=require("./sy.js"),g="shareReport.ts",v=null,f=()=>v||(v=getApp()),O=new class{constructor(){this.eventsForBound=[m.CONTANTS.UTM_TERM_RESOLVED,m.CONTANTS.LOGIN_FINISH,m.CONTANTS.LOGIN_MANUALLY],this.isBoundEvents=!1,this.thisApp=null}tryReport(e){this.thisApp=e,this.isBoundEvents||(this.isBoundEvents=!0,this.eventsForBound.forEach((e=>{m.default.on(e,(t=>{let r="";e===m.CONTANTS.UTM_TERM_RESOLVED&&(r=t),setTimeout((()=>{this.doReport(e,r)}),1e3)}))})))}doReport(e,t){var r;const o=t||(null==(r=l.default.get("utm"))?void 0:r.utm_term)||"{}";try{const t=JSON.parse(o);this.getCid().then((e=>{const r={currentUserId:this.getUserId(),cid:e||"c_youxuan_shouye",shareTime:this.getTime(),shareUserId:t.suid||"",shareId:t.shareid||"",shareType:t.share_type||"",sappnm:t.sappnm||"",scid:t.scid||"",poiId:t.poi_id||-999,poiIdStr:t.poiIdStr||-999,skuId:t.sku_id||-999};t.extra_params&&(r.extra_params=t.extra_params),t.suid?(0,d.shareReport)(r):t.mtlm&&(r.mtlm=t.mtlm,(0,d.shareReport)(r))})).catch((t=>{p.log.error(`${g} - 上报失败, eventSource: ${e}, utmTermStr: ${o}, err: ${t}`)}))}catch(t){p.log.error(`${g} - 上报失败, eventSource: ${e}, utmTermStr: ${o}, err: ${t}`)}}getUserId(){var e,t;return(null==(t=null==(e=f())?void 0:e.$user)?void 0:t.userId)||0}getCid(){return a(this,null,(function*(){let e="";try{e=this.getCidFromProtocol(),e||(e=yield this.getCidFromCurrentPage()),e||(e="c_youxuan_shouye")}catch(e){p.log.error(`${g} - 获取 cid 失败`)}return e}))}getCidFromCurrentPage(){return a(this,null,(function*(){var e,t,r,o;try{let s=(null==(t=null==(e=f())?void 0:e.page())?void 0:t.route)||"",u=c.LX_CONFIG[s]&&c.LX_CONFIG[s].cid||"",i=0;for(;!u&&i<10;)i++,yield this.sleep(200),s=(null==(o=null==(r=f())?void 0:r.page())?void 0:o.route)||"",u=c.LX_CONFIG[s]&&c.LX_CONFIG[s].cid||"";return u}catch(e){p.log.error(`${g} - getCidFromCurrentPage failed, err: ${e}`)}return""}))}getCidFromProtocol(){var e,t,r;let o="";try{if(o=(null==(r=null==(t=null==(e=this.thisApp)?void 0:e.$appShowOptions)?void 0:t.query)?void 0:r.protocol)||"",!o)return"";const s=this.getPathnameByProtocol(o),u=this.getRouteByPathname(s),{cid:i=""}=c.LX_CONFIG[u];if(i)return i;p.log.error(`${g} - getCidFromProtocol failed, protocol: ${o}`)}catch(e){p.log.error(`${g} - getCidFromProtocol failed, protocol: ${o}, err: ${e}`)}return""}getPathnameByProtocol(e){const t=decodeURIComponent(e.trim())||"",r=h.parse(t)||{};return this.removePrefix(r.pathname||"","/")}getRouteByPathname(e){for(const t of y)if(e===t.protocol)return this.removePrefix(t.targetPage||"","/");return""}removePrefix(e,t){return e.startsWith(t)?e.replace(t,""):e}getTime(){return(new Date).getTime()}sleep(e){return new Promise((t=>{setTimeout(t,e)}))}};