var t,e,a=Object.create,i=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,d=t=>{return((t,e,a)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let n of o(e))s.call(t,n)||"default"===n||i(t,n,{get:()=>e[n],enumerable:!(a=r(e,n))||a.enumerable});return t})((e=i(null!=t?a(n(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0}),i(e,"__esModule",{value:!0})),t);var e},u=(t,e,a)=>new Promise(((i,r)=>{var o=t=>{try{s(a.next(t))}catch(t){r(t)}},n=t=>{try{s(a.throw(t))}catch(t){r(t)}},s=t=>t.done?i(t.value):Promise.resolve(t.value).then(o,n);s((a=a.apply(t,e)).next())})),c=d(require("./u8.js")),l=d(require("./jc.js")),h=d(require("./ob.js")),g=d(require("./xa.js")),m=d(require("./xp.js")),p=d(require("./kg.js")),y=getApp(),{$event:_,$cart:f,$router:B,$lxLog:S,page:P,$login:x,isLogin:b,$abTest:C,$service:v}=getApp(),{CARTTOTALNUM_CHANGE:k,CARTMONEY_CHANGE:T,UPDATE_POIINFO_FINISH:I,CART_SPECIAL_SKU:O}=_.CONTANTS,{CAT_SEC_CATEGORY:A}=require("./iu.js"),N=(null==(e=null==(t=null==y?void 0:y.getModule("systemInfo"))?void 0:t.getSystemInfo())?void 0:e.isIpx)||!1;(0,l.defineComponent)(new class{constructor(){this.attached=function(){this.addCartBarABTest(),this.changeCartSkuNumBindThis=this.changeCartSkuNum.bind(this),this.changeCartSkuMoneyBindThis=this.changeCartSkuMoney.bind(this),this.refreshCartByPoiBindThis=this.refreshCartByPoi.bind(this),this.checkSpecialSkuBindThis=this.checkSpecialSku.bind(this),_.on(k,this.changeCartSkuNumBindThis),_.on(T,this.changeCartSkuMoneyBindThis),_.on(I,this.refreshCartByPoiBindThis),_.on(O,this.checkSpecialSkuBindThis)},this.detached=function(){_.off(k,this.changeCartSkuNumBindThis),_.off(T,this.changeCartSkuMoneyBindThis),_.off(I,this.refreshCartByPoiBindThis),_.off(O,this.checkSpecialSkuBindThis)},this.ready=function(){"pages/index/index"!==P().__route__&&this.refreshCartByPoi()},this.methods={addCartBarABTest(){const t=C.isGrey("grocery_c_front_add_cart_bar_style","a")||C.isGrey("grocery_c_front_add_cart_bar_style","b");t!==this.data.isReducedAmountStyleABGrey&&this.setData({isReducedAmountStyleABGrey:t})},dealExtraParam(t){try{t.extra_param?t.extra_param="[object Object]"===Object.prototype.toString.call(this.data.extraParam)?Object.assign(this.data.extraParam,t.extra_param):t.extra_param:this.data.extraParam?t.extra_param=this.data.extraParam:t.extra_param="-999"}catch(t){h.log.error("dealExtraParam failed",t)}return t},getSkuListLxData(){const{totalNum:t}=this.data;if(!t)return"";return f._skuQtyList.map((t=>t.skuId)).toString()},refreshCartByPoi(){var t;const e=(null==(t=this.data.queryParams)?void 0:t.trafficSource)||"";f.refreshCart({trafficSource:e})},changeCartSkuNum(t){const{hasTabBar:e,needHide:a}=this.data;t&&t.totalItemCounts!==this.data.totalNum&&(this.setData({totalNum:t.totalItemCounts}),(e||a)&&this.triggerEvent("showAddCartBar",!!t.totalItemCounts))},changeCartSkuMoney(t){t&&t.realTotalAmount!==this.data.totalPrice&&this.setData({totalPrice:t.realTotalAmount}),t&&t.reducedAmountV2!==this.data.reducedAmount&&this.setData({reducedAmount:t.reducedAmountV2})},checkSpecialSku(t){const e=t&&t.containsNewRedemption;"boolean"==typeof e&&e!==this.hasNewRedemption&&(this.hasNewRedemption=e)},onMvReport(t){const{cid:e,lxBids:a}=this.data,i={};this.data.pageFrom&&(i.page_from=this.data.pageFrom),this.data.landingPageId&&(i.extra_param={activity_page_id:this.data.landingPageId||"-999"}),S.mv(a.submitBtnViewBid,this.dealExtraParam(i),{cid:e})},tapIconButton(t){return u(this,null,(function*(){const{beforHandleTap:t}=this.data;if("function"==typeof t){if(!(yield t()))return}const{cid:e,lxBids:a}=this.data,i={};this.data.pageFrom&&(i.page_from=this.data.pageFrom),this.data.landingPageId&&(i.extra_param={activity_page_id:this.data.landingPageId||"-999"}),S.mc(a.homeBtnClickBid,this.dealExtraParam(i),{cid:e}),B.goto("igrocery://www.grocery.com/main")}))},goSubmitOrderPage(){return u(this,null,(function*(){try{if(yield(0,p.default)(y))return;const{cid:t,lxBids:e,totalNum:a,queryParams:i={}}=this.data,r="igrocery://www.grocery.com/submit_order";if(!a){const t=this.hasNewRedemption?m.ButtonStatus.SELECT_TOAST:"您还没有选购商品哦";return void P().toast(t)}const o={sku_list:this.getSkuListLxData()};if(this.data.pageFrom&&(o.page_from=this.data.pageFrom),this.data.landingPageId&&(o.extra_param={activity_page_id:this.data.landingPageId||"-999"}),S.mc(e.submitBtnClickBid,this.dealExtraParam(o),{cid:t}),b()){const t=y.getModule("user").getToken(),e=y.getModule("user").getUserInfo(),a=y.getModule("user").getLastRemoveUserInfoPath();try{v.checkUserLogin(t).then((t=>{t?B.goto(r,i):(y.getModule("cat").reportError(A.TOKEN_INVALID_ERROR(`token status: token失效, userInfo=${JSON.stringify(e)}, lastRemoveUserInfoPath=${a}`)),this.goSubmitOrderPageWithoutLogin(r))})).catch((t=>{}))}catch(t){y.getModule("cat").reportError(A.MTUSER_ERROR(`获取用户头像、名称失败, userInfo=${JSON.stringify(e)}, lastRemoveUserInfoPath=${a}`)),B.goto(r,i)}}else this.goSubmitOrderPageWithoutLogin(r,i)}catch(t){}}))},goSubmitOrderPageWithoutLogin(t,e){x.login().then((a=>{a&&setTimeout((()=>{B.goto(t,e)}),1e3)})).catch((t=>{}))},goSubmitOrderPageThrottle(){(0,g.default)(this.goSubmitOrderPage(),200,500)},openShare(t){const{cid:e,lxBids:a}=this.data,i={};this.data.pageFrom&&(i.page_from=this.data.pageFrom),this.data.landingPageId&&(i.extra_param={activity_page_id:this.data.landingPageId||"-999"}),i.isShareDirect=this.data.isAutoShare,S.mc(a.shareBtnClickBid,this.dealExtraParam(i),{cid:e}),this.triggerEvent("openShare",t)},gotoCartLanding(){var t;const{cid:e,lxBids:a}=this.data,i={};this.data.pageFrom&&(i.page_from=this.data.pageFrom),this.data.landingPageId&&(i.extra_param={activity_page_id:this.data.landingPageId||"-999"}),S.mc(a.cartBtnClickBid,this.dealExtraParam(i),{cid:e});const r=(null==(t=this.data.queryParams)?void 0:t.trafficSource)||"";b()?f.goToCartLanding(r):x.login().then((t=>{t&&f.goToCartLanding(r)}))},goOrderPage(){return u(this,null,(function*(){const{beforHandleTap:t}=this.data;if("function"==typeof t){if(!(yield t()))return}const{cid:e,lxBids:a}=this.data,i={};this.data.pageFrom&&(i.page_from=this.data.pageFrom),this.data.landingPageId&&(i.extra_param={activity_page_id:this.data.landingPageId||"-999"}),S.mc(a.orderBtnClickBid,this.dealExtraParam(i),{cid:e}),b()?B.goto("igrocery://www.grocery.com/order_list?cur_tab=0"):x.login().then((t=>{t&&B.goto("igrocery://www.grocery.com/order_list?cur_tab=0")}))}))}},this.properties={extraParam:{type:Object,value:null},shareButtonObject:{type:String,value:"-999"},wrapperStyle:{type:String,value:""},cid:{type:String,value:""},showShareIcon:{type:Boolean,value:!1},isAutoShare:{type:Boolean,value:!1},isShareLandingPage:{type:Boolean,value:!1},hasTabBar:{type:Boolean,value:!1},queryParams:{type:Object,value:null},adaptSafeArea:{type:Boolean,value:!0},needHide:{type:Boolean,value:!1},pageFrom:{type:String,value:""},beforHandleTap:{type:Function},landingPageId:{type:String,value:""}},this.data={totalPrice:0,reducedAmount:0,totalNum:-1,isIpx:N,isMT:(0,c.isMT)(),isReducedAmountStyleABGrey:!1,lxBids:{submitBtnClickBid:"b_youxuan_jika21b4_mc",submitBtnViewBid:"b_youxuan_jika21b4_mv",shareBtnClickBid:"b_youxuan_seq69vcq_mc",homeBtnClickBid:"b_youxuan_t6ja9rt8_mc",cartBtnClickBid:"b_youxuan_0eq6kxcj_mc",myBtnClickBid:"b_youxuan_umzpgzeq_mc",closePopupClickBid:"b_youxuan_muojeecf_mc",orderBtnClickBid:"b_youxuan_uqffnrnk_mc"}},this.hasNewRedemption=!1}});